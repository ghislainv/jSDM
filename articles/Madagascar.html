<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Evolution of Madagascar's plant biodiversity under climate change • jSDM</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Evolution of Madagascar's plant biodiversity under climate change">
<meta property="og:description" content="jSDM">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">jSDM</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/jSDM.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Change log</a>
</li>
<li>
  <a></a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ghislainv/jSDM">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Madagascar_files/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1">
<link href="Madagascar_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet">
<script src="Madagascar_files/bootstrap-3.3.5/js/bootstrap.min.js"></script><script src="Madagascar_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script><script src="Madagascar_files/bootstrap-3.3.5/shim/respond.min.js"></script><style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="Madagascar_files/navigation-1.1/tabsets.js"></script><script src="Madagascar_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Evolution of Madagascar’s plant biodiversity under climate change</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ghislainv/jSDM/blob/master/vignettes/Madagascar.Rmd"><code>vignettes/Madagascar.Rmd</code></a></small>
      <div class="hidden name"><code>Madagascar.Rmd</code></div>

    </div>

    
    
<p>We want to identify biodiversity refuge zones in Madagascar</p>
<div id="load-librairies" class="section level1">
<h1 class="hasAnchor">
<a href="#load-librairies" class="anchor"></a><span class="header-section-number">1</span> Load librairies</h1>
<pre><code>#&gt; Loading required package: sp
#&gt; ##
#&gt; ## jSDM R package 
#&gt; ## For joint species distribution models 
#&gt; ## https://ecology.ghislainv.fr/jSDM 
#&gt; ##</code></pre>
</div>
<div id="datasets" class="section level1">
<h1 class="hasAnchor">
<a href="#datasets" class="anchor"></a><span class="header-section-number">2</span> Datasets</h1>
<div id="forest-inventory" class="section level2">
<h2 class="hasAnchor">
<a href="#forest-inventory" class="anchor"></a><span class="header-section-number">2.1</span> Forest inventory</h2>
<p>National forest inventories carried out on <span class="math inline">\(753\)</span> sites on the island of Madagascar are available, listing the presence or absence of <span class="math inline">\(555\)</span> plant species on each of these sites between 1994 and 1996.
We use these forest inventories to calculate a matrix indicating the presence by a <span class="math inline">\(1\)</span> and the absence by a <span class="math inline">\(0\)</span> of the species at each site by removing observations for which the species is not identified. This matrix therefore records the occurrences of <span class="math inline">\(483\)</span> species at <span class="math inline">\(751\)</span> sites.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># forest inventory</span>
<span class="va">trees</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/forest_inventory_Madagascar.csv"</span><span class="op">)</span>
<span class="va">trees</span> <span class="op">&lt;-</span> <span class="va">trees</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">trees</span><span class="op">$</span><span class="va">sp</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span>
<span class="va">trees</span><span class="op">$</span><span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">trees</span><span class="op">$</span><span class="va">plot</span><span class="op">)</span>
<span class="va">plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">trees</span><span class="op">$</span><span class="va">plot</span><span class="op">)</span>
<span class="va">nplot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">plots</span><span class="op">)</span>
<span class="va">sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">trees</span><span class="op">$</span><span class="va">taxize</span><span class="op">)</span>
<span class="va">nsp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">sp</span><span class="op">)</span>
<span class="co"># presence/absence of each species on each plot</span>
<span class="va">nplot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">trees</span><span class="op">$</span><span class="va">plot</span><span class="op">)</span><span class="op">)</span>
<span class="va">species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">trees</span><span class="op">$</span><span class="va">taxize</span><span class="op">)</span>
<span class="va">nsp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span>
<span class="co"># presence/absence of each species on each plot</span>
<span class="va">PA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">nplot</span>,<span class="va">nsp</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">PA</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">trees</span><span class="op">$</span><span class="va">plot</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">PA</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">species</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nplot</span><span class="op">)</span><span class="op">{</span>    
  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nsp</span><span class="op">)</span><span class="op">{</span>
    <span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">trees</span><span class="op">$</span><span class="va">taxize</span> <span class="op">==</span> <span class="va">species</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span>
    <span class="va">PA</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">trees</span><span class="op">$</span><span class="va">plot</span><span class="op">[</span><span class="va">idx</span><span class="op">]</span><span class="op">)</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> 
  <span class="op">}</span>
<span class="op">}</span>
<span class="co"># save presence/absence at inventory sites matrix</span>
<span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span><span class="va">PA</span>, file<span class="op">=</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/PA.RData"</span><span class="op">)</span></code></pre></div>
</div>
<div id="current-environmental-variables" class="section level2">
<h2 class="hasAnchor">
<a href="#current-environmental-variables" class="anchor"></a><span class="header-section-number">2.2</span> Current environmental variables</h2>
<p>Among the climatic and environmental data available on the site  concerning the whole island of Madagascar at present (interpolations of representative observed data from the years 1950-2000).
We choose to use the following variables because they have an ecological meaning which makes them easily interpretable and are little correlated between them according to the article <span class="citation">Vieilledent <em>et al.</em> (<a href="#ref-Vieilledent2013" role="doc-biblioref">2013</a>)</span> :
the average annual precipitation (mm)
- <strong>temp</strong>: the average annual temperature (<span class="math inline">\(^\circ C\times 10\)</span>).
- <strong>prec</strong>: the average annual precipitation (mm).
- <strong>sais_temp</strong>: the seasonality of temperatures corresponds to the standard deviation of monthly temperatures multiplied by <span class="math inline">\(100\)</span>.
- <strong>sais_prec</strong>: the seasonality of precipitation as a coefficient of variation.
- <strong>cwd</strong>: the annual climatic water deficit (mm) is based on monthly precipitation (<span class="math inline">\(prec\)</span>) and potential evapotranspiration (<span class="math inline">\(pet\)</span>) which is defined as the amount of evaporation that would occur in a month if a sufficient water source were available: <span class="math inline">\(\mathrm{cwd}= \sum_{m=1}^{12}\min(0, \ \mathrm{prec}_m-\ \mathrm{pet}_m)\)</span>.</p>
<p>We consider also the quadratic effects of these climate variables to perform a quadratic regression, which is more suitable for fitting a niche model than a linear regression.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># climatic variables </span>
<span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/stack.html">stack</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/current.tif"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"tmin"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">12</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"tmax"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">12</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,
              <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"prec"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">12</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"bio"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">19</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,
              <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"pet"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">12</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,<span class="st">"pet"</span>,<span class="st">"cwd"</span>,<span class="st">"ndm"</span><span class="op">)</span>
<span class="co"># get intersting covariables </span>
<span class="va">clim_var</span> <span class="op">&lt;-</span> <span class="fu">dropLayer</span><span class="op">(</span><span class="va">s</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">36</span>,<span class="fl">38</span>,<span class="fl">39</span>,<span class="fl">41</span><span class="op">:</span><span class="fl">47</span>,<span class="fl">49</span>,<span class="fl">50</span>,<span class="fl">52</span><span class="op">:</span><span class="fl">68</span>,<span class="fl">70</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">clim_var</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"temp"</span>,<span class="st">"prec"</span>,<span class="st">"sais_temp"</span>,<span class="st">"sais_prec"</span>,<span class="st">"cwd"</span><span class="op">)</span>
<span class="co"># representation</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>oma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">clim_var</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/title.html">title</a></span><span class="op">(</span><span class="st">"Current bioclimatic variables"</span>, outer<span class="op">=</span><span class="cn">TRUE</span>, cex<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span>

<span class="co"># spatial points of each plot</span>
<span class="va">coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">trees</span><span class="op">$</span><span class="va">long</span>,<span class="va">trees</span><span class="op">$</span><span class="va">lat</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">trees</span><span class="op">$</span><span class="va">plot</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">coords</span> <span class="op">&lt;-</span> <span class="va">coords</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="va">coords</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span>, index.return<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">$</span><span class="va">ix</span>,<span class="op">]</span>
<span class="va">longlat</span> <span class="op">&lt;-</span> <span class="fu">SpatialPoints</span><span class="op">(</span><span class="va">coords</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>
<span class="fu">proj4string</span><span class="op">(</span><span class="va">longlat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">CRS</span><span class="op">(</span><span class="st">"+proj=longlat +ellps=clrk66"</span><span class="op">)</span>

<span class="co"># latlong to UTM38S projection </span>
<span class="va">xy</span> <span class="op">&lt;-</span> <span class="fu">spTransform</span><span class="op">(</span><span class="va">longlat</span>, <span class="fu">CRS</span><span class="op">(</span><span class="st">"+proj=utm +zone=38 +south +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># extract climatic data on each plot</span>
<span class="va">clim</span> <span class="op">&lt;-</span>  <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extract.html">extract</a></span><span class="op">(</span><span class="va">clim_var</span>,<span class="va">xy</span><span class="op">)</span>
<span class="va">clim2</span> <span class="op">&lt;-</span> <span class="va">clim</span><span class="op">^</span><span class="fl">2</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">clim2</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">clim</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"2"</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">clim</span><span class="op">)</span><span class="op">)</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>
<span class="va">pos</span> <span class="op">&lt;-</span> <span class="va">coords</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">pos</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"long"</span>,<span class="st">"lat"</span>,<span class="st">"site"</span><span class="op">)</span>

<span class="co"># Add squared data</span>
<span class="va">data_clim2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">clim</span>,<span class="va">clim2</span>,<span class="va">pos</span><span class="op">)</span><span class="op">)</span>
<span class="va">nparam</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">data_clim2</span><span class="op">)</span> <span class="op">-</span><span class="fl">3</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span>

<span class="co"># reduced centered data</span>
<span class="va">scaled_data_clim2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">data_clim2</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="va">nparam</span><span class="op">]</span><span class="op">)</span>
<span class="va">means</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">scaled_data_clim2</span>,<span class="st">"scaled:center"</span><span class="op">)</span>
<span class="va">sds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">scaled_data_clim2</span>,<span class="st">"scaled:scale"</span><span class="op">)</span>
<span class="va">scaled_data_clim2</span> <span class="op">&lt;-</span> <span class="fu">as_tibble</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>site<span class="op">=</span><span class="va">data_clim2</span><span class="op">$</span><span class="va">site</span>,<span class="va">scaled_data_clim2</span>,lat<span class="op">=</span><span class="va">data_clim2</span><span class="op">$</span><span class="va">lat</span>,long<span class="op">=</span><span class="va">data_clim2</span><span class="op">$</span><span class="va">long</span><span class="op">)</span><span class="op">)</span>

<span class="co">## Design matrix</span>
<span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>intercept<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">nplot</span><span class="op">)</span>,<span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">scaled_data_clim2</span>,<span class="op">-</span><span class="va">lat</span>,<span class="op">-</span><span class="va">long</span>, <span class="op">-</span><span class="va">site</span><span class="op">)</span><span class="op">)</span>
<span class="va">np</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">X</span>, file <span class="op">=</span> <span class="st">"~/Documents/projet_BioSceneMada/Report/data/X.csv"</span>,row.names <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>

<span class="co"># save climatic data at inventory sites</span>
<span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span><span class="va">scaled_data_clim2</span>, <span class="va">means</span>, <span class="va">sds</span>, <span class="va">xy</span>,
     file<span class="op">=</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/scaled_data_clim.RData"</span><span class="op">)</span>

<span class="co"># save raster in .tif format</span>
<span class="co"># Add squared data</span>
<span class="va">clim_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/stack.html">stack</a></span><span class="op">(</span><span class="va">clim_var</span>,<span class="va">clim_var</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>
<span class="co"># Center and reduce climatic variables </span>
<span class="co"># using means and standard deviations of climatic variables at inventory sites</span>
<span class="va">scaled_clim_var</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">clim_var</span><span class="op">-</span><span class="va">means</span><span class="op">)</span><span class="op">/</span><span class="va">sds</span>
<span class="fu">writeRaster</span><span class="op">(</span><span class="va">scaled_clim_var</span>,<span class="st">"~/Documents/projet_BioSceneMada/Report/data/scaled_clim.tif"</span>,
            format<span class="op">=</span><span class="st">"GTiff"</span>, options<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"COMPRESS=LZW"</span>, <span class="st">"PREDICTOR=2"</span><span class="op">)</span>, overwrite<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="Madagascar_files/figure-html/current-environmental-variables-1.png" width="800" style="display: block; margin: auto;"></p>
<p>The values of these climate variables corresponding to the coordinates of the inventory plots are extracted and scaled to obtain the following dataset where coordinates of the sites will then be used for spatial interpolation and to spatially represent the results.</p>
</div>
<div id="future-environmental-variables" class="section level2">
<h2 class="hasAnchor">
<a href="#future-environmental-variables" class="anchor"></a><span class="header-section-number">2.3</span> Future environmental variables</h2>
<p>Future climate data have been obtained from the <a href="http://www.ccafs-climate.org/data/">CGIAR CCAFS</a> climate data portal and are available at .
Future conditions are <a href="http://www.ccafs-climate.org/statistical_downscaling_delta_cmip5/">downscaled</a> global climate model (GCM) data from CMIP5 (IPPC Fifth Assessment), at 30 arc-seconds (~1km) resolution.
We consider future conditions for the time period of 2080s, with the CO2 emission scenarios RCP 8.5, characterized by increasing greenhouse gas emissions over time representative for scenarios in the literature leading to high greenhouse gas concentration levels. The underlying scenario drivers and resulting development path are based on the A2r scenario detailed in <span class="citation">(Riahi, Grubler &amp; Nakicenovic <a href="#ref-Riahi2007" role="doc-biblioref">2007</a>)</span>.
We will then consider the mean of the presence probabilities predicted from future climate data obtained with three GCMs (GISS-E2-R, HadGEM2-ES and NorESM1-M).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/scaled_data_clim.RData"</span><span class="op">)</span>
<span class="co"># future climatic variables with GCM GISS-E2-R climatic variables </span>
<span class="va">s_gs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/stack.html">stack</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/gs_85_2080.tif"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">s_gs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"tmin"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">12</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"tmax"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">12</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,
                 <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"prec"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">12</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"bio"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">19</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,
                 <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"pet"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">12</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,<span class="st">"pet"</span>,<span class="st">"cwd"</span>,<span class="st">"ndm"</span><span class="op">)</span>
<span class="co"># get intersting covariables </span>
<span class="va">clim_var_gs</span> <span class="op">&lt;-</span> <span class="fu">dropLayer</span><span class="op">(</span><span class="va">s_gs</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">36</span>,<span class="fl">38</span>,<span class="fl">39</span>,<span class="fl">41</span><span class="op">:</span><span class="fl">47</span>,<span class="fl">49</span>,<span class="fl">50</span>,<span class="fl">52</span><span class="op">:</span><span class="fl">68</span>,<span class="fl">70</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">clim_var_gs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"temp"</span>,<span class="st">"prec"</span>,<span class="st">"sais_temp"</span>,<span class="st">"sais_prec"</span>,<span class="st">"cwd"</span><span class="op">)</span>
<span class="co"># representation</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>oma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">clim_var_gs</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/title.html">title</a></span><span class="op">(</span><span class="st">"Future bioclimatic variables under GISS-E2-R GCM"</span>, outer<span class="op">=</span><span class="cn">TRUE</span>, cex<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span>
<span class="co"># Add squared data</span>
<span class="va">clim_var_gs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/stack.html">stack</a></span><span class="op">(</span><span class="va">clim_var_gs</span>,<span class="va">clim_var_gs</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>
<span class="co"># Center and reduce climatic variables </span>
<span class="co"># using means and standard deviations of climatic variables at inventory sites</span>
<span class="va">scaled_clim_var_gs</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">clim_var_gs</span><span class="op">-</span><span class="va">means</span><span class="op">)</span><span class="op">/</span><span class="va">sds</span>
<span class="co"># save raster in .tif format</span>
<span class="fu">writeRaster</span><span class="op">(</span><span class="va">scaled_clim_var_gs</span>,<span class="st">"~/Documents/projet_BioSceneMada/Report/data/scaled_clim_gs.tif"</span>,
            format<span class="op">=</span><span class="st">"GTiff"</span>, options<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"COMPRESS=LZW"</span>, <span class="st">"PREDICTOR=2"</span><span class="op">)</span>, overwrite<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>

<span class="co"># future climatic variables with GCM HadGEM2-ES </span>
<span class="va">s_he</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/stack.html">stack</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/he_85_2080.tif"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">s_he</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"tmin"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">12</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"tmax"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">12</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,
                 <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"prec"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">12</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"bio"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">19</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,
                 <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"pet"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">12</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,<span class="st">"pet"</span>,<span class="st">"cwd"</span>,<span class="st">"ndm"</span><span class="op">)</span>
<span class="co"># get intersting covariables </span>
<span class="va">clim_var_he</span> <span class="op">&lt;-</span> <span class="fu">dropLayer</span><span class="op">(</span><span class="va">s_he</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">36</span>,<span class="fl">38</span>,<span class="fl">39</span>,<span class="fl">41</span><span class="op">:</span><span class="fl">47</span>,<span class="fl">49</span>,<span class="fl">50</span>,<span class="fl">52</span><span class="op">:</span><span class="fl">68</span>,<span class="fl">70</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">clim_var_he</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"temp"</span>,<span class="st">"prec"</span>,<span class="st">"sais_temp"</span>,<span class="st">"sais_prec"</span>,<span class="st">"cwd"</span><span class="op">)</span>
<span class="co"># representation</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>oma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">clim_var_he</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/title.html">title</a></span><span class="op">(</span><span class="st">"Future bioclimatic variables under HadGEM2-ES GCM"</span>, outer<span class="op">=</span><span class="cn">TRUE</span>, cex<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span>
<span class="co"># Add squared data</span>
<span class="va">clim_var_he</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/stack.html">stack</a></span><span class="op">(</span><span class="va">clim_var_he</span>,<span class="va">clim_var_he</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>
<span class="co"># Center and reduce climatic variables </span>
<span class="co"># using means and standard deviations of climatic variables at inventory sites</span>
<span class="va">scaled_clim_var_he</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">clim_var_he</span><span class="op">-</span><span class="va">means</span><span class="op">)</span><span class="op">/</span><span class="va">sds</span>
<span class="co"># save raster in the .tif format</span>
<span class="fu">writeRaster</span><span class="op">(</span><span class="va">scaled_clim_var_he</span>,<span class="st">"~/Documents/projet_BioSceneMada/Report/data/scaled_clim_he.tif"</span>,
            format<span class="op">=</span><span class="st">"GTiff"</span>, options<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"COMPRESS=LZW"</span>, <span class="st">"PREDICTOR=2"</span><span class="op">)</span>, overwrite<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>

<span class="co"># future climatic variables with GCM NorESM1-M </span>
<span class="va">s_no</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/stack.html">stack</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/no_85_2080.tif"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">s_no</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"tmin"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">12</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"tmax"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">12</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,
                 <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"prec"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">12</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"bio"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">19</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,
                 <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"pet"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">12</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,<span class="st">"pet"</span>,<span class="st">"cwd"</span>,<span class="st">"ndm"</span><span class="op">)</span>
<span class="co"># get intersting covariables </span>
<span class="va">clim_var_no</span> <span class="op">&lt;-</span> <span class="fu">dropLayer</span><span class="op">(</span><span class="va">s_no</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">36</span>,<span class="fl">38</span>,<span class="fl">39</span>,<span class="fl">41</span><span class="op">:</span><span class="fl">47</span>,<span class="fl">49</span>,<span class="fl">50</span>,<span class="fl">52</span><span class="op">:</span><span class="fl">68</span>,<span class="fl">70</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">clim_var_no</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"temp"</span>,<span class="st">"prec"</span>,<span class="st">"sais_temp"</span>,<span class="st">"sais_prec"</span>,<span class="st">"cwd"</span><span class="op">)</span>
<span class="co"># representation</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>oma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">clim_var_no</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/title.html">title</a></span><span class="op">(</span><span class="st">"Future bioclimatic variables under NorESM1-M GCM"</span>, outer<span class="op">=</span><span class="cn">TRUE</span>, cex<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span>
<span class="co"># Add squared data</span>
<span class="va">clim_var_no</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/stack.html">stack</a></span><span class="op">(</span><span class="va">clim_var_no</span>,<span class="va">clim_var_no</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>
<span class="co"># Center and reduce climatic variables </span>
<span class="co"># using means and standard deviations of climatic variables at inventory sites</span>
<span class="va">scaled_clim_var_no</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">clim_var_no</span><span class="op">-</span><span class="va">means</span><span class="op">)</span><span class="op">/</span><span class="va">sds</span>
<span class="co"># save raster in .tif format</span>
<span class="fu">writeRaster</span><span class="op">(</span><span class="va">scaled_clim_var_no</span>,<span class="st">"~/Documents/projet_BioSceneMada/Report/data/scaled_clim_no.tif"</span>,
            format<span class="op">=</span><span class="st">"GTiff"</span>, options<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"COMPRESS=LZW"</span>, <span class="st">"PREDICTOR=2"</span><span class="op">)</span>, overwrite<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="Madagascar_files/figure-html/future-environmental-variables-1.png" width="800" style="display: block; margin: auto;"><img src="Madagascar_files/figure-html/future-environmental-variables-2.png" width="800" style="display: block; margin: auto;"><img src="Madagascar_files/figure-html/future-environmental-variables-3.png" width="800" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="fitting-joint-species-distribution-model-jsdm" class="section level1">
<h1 class="hasAnchor">
<a href="#fitting-joint-species-distribution-model-jsdm" class="anchor"></a><span class="header-section-number">3</span> Fitting joint species distribution model (JSDM)</h1>
<div id="model-definition" class="section level2">
<h2 class="hasAnchor">
<a href="#model-definition" class="anchor"></a><span class="header-section-number">3.1</span> Model definition</h2>
<p>Referring to the models used in the articles <span class="citation">Warton <em>et al.</em> (<a href="#ref-Warton2015" role="doc-biblioref">2015</a>)</span> and <span class="citation">Albert &amp; Siddhartha (<a href="#ref-Albert1993" role="doc-biblioref">1993</a>)</span>, we define the following latent variable model (LVM) to account for species co-occurrence on all sites :</p>
<p><span class="math display">\[ \mathrm{probit}(\theta_{ij}) =\alpha_i + \beta_{0j}+X_i.\beta_j+ W_i.\lambda_j \]</span></p>
<ul>
<li><p>Link function probit: <span class="math inline">\(\mathrm{probit}: q \rightarrow \Phi^{-1}(q)\)</span> where <span class="math inline">\(\Phi\)</span> correspond to the repartition function of the reduced centred normal distribution.</p></li>
<li><p>Response variable: <span class="math inline">\(Y=(y_{ij})^{i=1,\ldots,nsite}_{j=1,\ldots,nsp}\)</span> with:</p></li>
</ul>
<p><span class="math display">\[y_{ij}=\begin{cases}
0 &amp; \text{ if species $j$ is absent on the site $i$}\\
1 &amp;  \text{ if species  $j$ is present on the site $i$}.
\end{cases}\]</span></p>
<ul>
<li>Latent variable <span class="math inline">\(z_{ij} = \alpha_i + \beta_{0j} + X_i.\beta_j + W_i.\lambda_j + \epsilon_{i,j}\)</span>, with <span class="math inline">\(\forall (i,j) \ \epsilon_{ij} \sim \mathcal{N}(0,1)\)</span> and such that:</li>
</ul>
<p><span class="math display">\[y_{ij}=\begin{cases}
1 &amp; \text{if} \ z_{ij} &gt; 0 \\
0 &amp;  \text{otherwise.}
\end{cases}\]</span></p>
<p>It can be easily shown that: <span class="math inline">\(y_{ij} \sim \mathcal{B}ernoulli(\theta_{ij})\)</span>.</p>
<ul>
<li><p>Latent variables: <span class="math inline">\(W_i=(W_i^1,\ldots,W_i^q)\)</span> where <span class="math inline">\(q\)</span> is the number of latent variables considered, which has to be fixed by the user (by default <span class="math inline">\(q=2\)</span>).
We assume that <span class="math inline">\(W_i \sim \mathcal{N}(0,I_q)\)</span> and we define the associated coefficients <span class="math inline">\(\lambda_j=(\lambda_j^1,\ldots, \lambda_j^q)'\)</span>, also known as “factor loadings” <span class="citation">(Warton <em>et al.</em> <a href="#ref-Warton2015" role="doc-biblioref">2015</a>)</span>. We use a prior distribution <span class="math inline">\(\mathcal{N}(0,10)\)</span> for all lambdas not concerned by constraints to <span class="math inline">\(0\)</span> on upper diagonal and to strictly positive values on diagonal.</p></li>
<li><p>Explanatory variables: bioclimatic data about each site. <span class="math inline">\(X=(X_i)_{i=1,\ldots,nsite}\)</span> with <span class="math inline">\(X_i=(x_i^1,\ldots,x_i^p)\in \mathbb{R}^p\)</span> where <span class="math inline">\(p\)</span> is the number of bioclimatic variables considered.
The corresponding regression coefficients for each species <span class="math inline">\(j\)</span> are noted : <span class="math inline">\(\beta_j=(\beta_j^1,\ldots,\beta_j^p)'\)</span>.</p></li>
<li><p><span class="math inline">\(\beta_{0j}\)</span> correspond to the intercept for species <span class="math inline">\(j\)</span> which is assumed to be a fixed effect. We use a prior distribution <span class="math inline">\(\mathcal{N}(0,10)\)</span> for all betas.</p></li>
<li><p><span class="math inline">\(\alpha_i\)</span> represents the random effect of site <span class="math inline">\(i\)</span> such as <span class="math inline">\(\alpha_i \sim \mathcal{N}(0,V_{\alpha})\)</span> and we assume that <span class="math inline">\(V_{\alpha} \sim \mathcal {IG}(\text{shape}=0.5, \text{rate}=0.005)\)</span> as prior distribution by default.</p></li>
</ul>
<p>This model is equivalent to a multivariate GLMM <span class="math inline">\(\mathrm{g}(\theta_{ij}) = \alpha_i + X_i.\beta_j + u_{ij}\)</span>, where <span class="math inline">\(u_{ij} \sim \mathcal{N}(0, \Sigma)\)</span> with the constraint that the variance-covariance matrix <span class="math inline">\(\Sigma = \Lambda \Lambda^{\prime}\)</span>, where <span class="math inline">\(\Lambda\)</span> is the full matrix of factor loadings, with the <span class="math inline">\(\lambda_j\)</span> as its columns.
b<br>
## Parameters inference</p>
<p>We fit a binomial joint species distribution model, including two latent variables and random site effect using the <code><a href="../reference/jSDM_binomial_probit.html">jSDM_binomial_probit()</a></code> function to perform binomial probit regression considering all the species from the data described above, by performing <span class="math inline">\(100 000\)</span> iterations including <span class="math inline">\(40 000\)</span> of burn-in and we retain <span class="math inline">\(N_{samp}=1 000\)</span> values for each parameter of the model.
We use species’s prevalences as starting values for species intercept <span class="math inline">\(\beta_0\)</span>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/scaled_data_clim.RData"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/PA.RData"</span><span class="op">)</span>
<span class="co"># Prevalence of species </span>
<span class="va">prevalence</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="va">PA</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">PA</span><span class="op">)</span>
<span class="va">beta_start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">np</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">PA</span><span class="op">)</span><span class="op">)</span>
<span class="va">beta_start</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op">(</span><span class="va">prevalence</span><span class="op">)</span>
<span class="co"># </span>
<span class="va">T1</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">mod_all</span> <span class="op">&lt;-</span> <span class="fu">jSDM</span><span class="fu">::</span><span class="fu"><a href="../reference/jSDM_binomial_probit.html">jSDM_binomial_probit</a></span><span class="op">(</span>
  <span class="co"># Response variable </span>
  presence_data <span class="op">=</span> <span class="va">PA</span>, 
  <span class="co"># Explanatory variables </span>
  site_formula <span class="op">=</span> <span class="op">~</span> <span class="va">temp</span> <span class="op">+</span> <span class="va">prec</span> <span class="op">+</span> <span class="va">sais_temp</span> <span class="op">+</span> <span class="va">sais_prec</span> <span class="op">+</span> <span class="va">cwd</span> <span class="op">+</span> <span class="va">temp2</span> <span class="op">+</span> <span class="va">prec2</span> <span class="op">+</span> <span class="va">sais_temp2</span> <span class="op">+</span> <span class="va">sais_prec2</span> <span class="op">+</span> <span class="va">cwd2</span>,   
  site_data<span class="op">=</span><span class="va">scaled_data_clim2</span>, 
  n_latent<span class="op">=</span><span class="fl">2</span>,
  site_effect<span class="op">=</span><span class="st">"random"</span>, 
  <span class="co"># Chains</span>
  burnin<span class="op">=</span> <span class="fl">40000</span>, mcmc<span class="op">=</span><span class="fl">40000</span>, thin<span class="op">=</span><span class="fl">40</span>,
  <span class="co"># Starting values</span>
  alpha_start<span class="op">=</span><span class="fl">0</span>, beta_start<span class="op">=</span><span class="va">beta_start</span>,
  lambda_start<span class="op">=</span><span class="fl">0</span>, W_start<span class="op">=</span><span class="fl">0</span>,
  V_alpha<span class="op">=</span><span class="fl">1</span>, 
  <span class="co"># Priors</span>
  shape<span class="op">=</span><span class="fl">0.5</span>, rate<span class="op">=</span><span class="fl">0.0005</span>,
  mu_beta<span class="op">=</span><span class="fl">0</span>, V_beta<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
  mu_lambda<span class="op">=</span><span class="fl">0</span>, V_lambda<span class="op">=</span><span class="fl">1</span>,
  <span class="co"># Various </span>
  seed<span class="op">=</span><span class="fl">1234</span>, verbose<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
<span class="va">T2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">T_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html">difftime</a></span><span class="op">(</span><span class="va">T2</span>,<span class="va">T1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span><span class="va">mod_all</span>,<span class="va">T_all</span>,file<span class="op">=</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/mada_mod.RData"</span><span class="op">)</span></code></pre></div>
<p>The MCMC algorithm is used to obtain draws from the posterior distribution of the parameters. We use as estimator for each parameter the mean of the <span class="math inline">\(N_{samp}\)</span> values estimated in corresponding MCMC chain and we save the estimated parameters in .csv format.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/mada_mod.RData"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/scaled_data_clim.RData"</span><span class="op">)</span>

<span class="va">species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">model_spec</span><span class="op">$</span><span class="va">presence_data</span><span class="op">)</span>
<span class="va">nplot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">model_spec</span><span class="op">$</span><span class="va">presence_data</span><span class="op">)</span>
<span class="va">nsp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">model_spec</span><span class="op">$</span><span class="va">presence_data</span><span class="op">)</span>
<span class="va">n_latent</span> <span class="op">&lt;-</span> <span class="va">mod_all</span><span class="op">$</span><span class="va">model_spec</span><span class="op">$</span><span class="va">n_latent</span>
<span class="va">np</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">model_spec</span><span class="op">$</span><span class="va">beta_start</span><span class="op">)</span>

<span class="co">## Save parameters </span>
<span class="co">### alphas</span>
<span class="va">alphas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.alpha</span>,<span class="fl">2</span>,<span class="va">mean</span><span class="op">)</span>
<span class="co">### V_alpha</span>
<span class="va">V_alpha</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.V_alpha</span><span class="op">)</span>
<span class="co">### latent variables </span>
<span class="va">W1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.latent</span><span class="op">[[</span><span class="st">"lv_1"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="va">W2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.latent</span><span class="op">[[</span><span class="st">"lv_2"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>

<span class="va">params_sites</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>plot <span class="op">=</span> <span class="va">scaled_data_clim2</span><span class="op">$</span><span class="va">site</span>,
                           lat <span class="op">=</span> <span class="va">scaled_data_clim2</span><span class="op">$</span><span class="va">lat</span>,
                           long <span class="op">=</span> <span class="va">scaled_data_clim2</span><span class="op">$</span><span class="va">long</span>,
                           <span class="va">alphas</span>, V_alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">V_alpha</span>,<span class="va">nplot</span><span class="op">)</span>,<span class="va">W1</span>,<span class="va">W2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">params_sites</span>, file <span class="op">=</span> <span class="st">"~/Documents/projet_BioSceneMada/Report/data/params_sites.csv"</span>,row.names <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>

<span class="co">### fixed species effect lambdas and betas </span>
<span class="va">lambdas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">nsp</span>,<span class="va">n_latent</span><span class="op">)</span>
<span class="va">betas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">nsp</span>,<span class="va">np</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nsp</span><span class="op">)</span><span class="op">{</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">l</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_latent</span><span class="op">)</span><span class="op">{</span>
    <span class="va">lambdas</span><span class="op">[</span><span class="va">j</span>,<span class="va">l</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.sp</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"sp_"</span>,<span class="va">j</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">np</span><span class="op">+</span><span class="va">l</span><span class="op">]</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">p</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">np</span><span class="op">)</span><span class="op">{</span>
    <span class="va">betas</span><span class="op">[</span><span class="va">j</span>,<span class="va">p</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.sp</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"sp_"</span>,<span class="va">j</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">p</span><span class="op">]</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">betas</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.sp</span><span class="op">$</span><span class="va">sp_1</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">np</span><span class="op">]</span>
<span class="va">params_species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>species<span class="op">=</span><span class="va">species</span>, Id_species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">nsp</span><span class="op">)</span>,
                             <span class="va">betas</span>, lambda_1 <span class="op">=</span> <span class="va">lambdas</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, lambda_2 <span class="op">=</span> <span class="va">lambdas</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">params_species</span>, file <span class="op">=</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/params_species.csv"</span>,row.names <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>

<span class="co">## probit_theta_latent</span>
<span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">probit_theta_latent</span>, file <span class="op">=</span> <span class="st">"~/Documents/projet_BioSceneMada/Report/data/probit_theta_latent.csv"</span>, row.names <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>
<span class="co">## theta_latent</span>
<span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">theta_latent</span>, file <span class="op">=</span> <span class="st">"~/Documents/projet_BioSceneMada/Report/data/theta_latent.csv"</span>, row.names <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></code></pre></div>
</div>
<div id="evaluation-of-mcmc-convergence" class="section level2">
<h2 class="hasAnchor">
<a href="#evaluation-of-mcmc-convergence" class="anchor"></a><span class="header-section-number">3.2</span> Evaluation of MCMC convergence</h2>
<p>We visually evaluate the convergence of MCMCs by representing the trace and density <em>a posteriori</em> of the estimated parameters.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/mada_mod.RData"</span><span class="op">)</span>
<span class="va">np</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">model_spec</span><span class="op">$</span><span class="va">beta_start</span><span class="op">)</span>
<span class="va">species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">model_spec</span><span class="op">$</span><span class="va">presence_data</span><span class="op">)</span>
<span class="co">## alpha_i of the first site</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,oma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1.4</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/traceplot.html">traceplot</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.alpha</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,main<span class="op">=</span><span class="st">"Trace of alpha_1"</span>,cex.main<span class="op">=</span><span class="fl">1.6</span><span class="op">)</span>
<span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/densplot.html">densplot</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.alpha</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,main<span class="op">=</span><span class="st">"Density of alpha_1"</span>, cex.main<span class="op">=</span><span class="fl">1.6</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.alpha</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>,col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/title.html">title</a></span><span class="op">(</span>main<span class="op">=</span><span class="st">"Random site effect alpha_1"</span>,outer<span class="op">=</span><span class="cn">T</span>,cex.main<span class="op">=</span><span class="fl">1.8</span><span class="op">)</span>
<span class="co">## V_alpha</span>
<span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/traceplot.html">traceplot</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.V_alpha</span>,main<span class="op">=</span><span class="st">"Trace of V_alpha"</span>,cex.main<span class="op">=</span><span class="fl">1.6</span><span class="op">)</span>
<span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/densplot.html">densplot</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.V_alpha</span>,main<span class="op">=</span><span class="st">"Density of V_alpha"</span>, cex.main<span class="op">=</span><span class="fl">1.6</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.V_alpha</span><span class="op">)</span>,col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/title.html">title</a></span><span class="op">(</span>main<span class="op">=</span><span class="st">" Variance of random site effects"</span>,outer<span class="op">=</span><span class="cn">T</span>, cex.main<span class="op">=</span><span class="fl">1.8</span><span class="op">)</span>

<span class="co">## beta_j of the first two species</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>,oma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1.4</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">p</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">np</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/traceplot.html">traceplot</a></span><span class="op">(</span><span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html">mcmc</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.sp</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"sp_"</span>,<span class="va">j</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">p</span><span class="op">]</span>,
                                  start<span class="op">=</span><span class="fl">40000</span>, end<span class="op">=</span><span class="fl">99940</span>, thin<span class="op">=</span><span class="fl">60</span><span class="op">)</span>,
                    main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Trace of"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.sp</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"sp_"</span>,<span class="va">j</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="va">p</span><span class="op">]</span><span class="op">)</span>,cex.main<span class="op">=</span><span class="fl">1.3</span><span class="op">)</span>
    <span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/densplot.html">densplot</a></span><span class="op">(</span><span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html">mcmc</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.sp</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"sp_"</span>,<span class="va">j</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">p</span><span class="op">]</span>,
                                 start<span class="op">=</span><span class="fl">40000</span>, end<span class="op">=</span><span class="fl">99940</span>, thin<span class="op">=</span><span class="fl">60</span><span class="op">)</span>, 
                   main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Density of"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.sp</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"sp_"</span>,<span class="va">j</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="va">p</span><span class="op">]</span><span class="op">)</span>,cex.main<span class="op">=</span><span class="fl">1.3</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.sp</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"sp_"</span>,<span class="va">j</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">p</span><span class="op">]</span><span class="op">)</span>,col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span>
    <span class="kw">if</span><span class="op">(</span><span class="va">p</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/graphics/title.html">title</a></span><span class="op">(</span>main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Fixed species effect beta for species"</span>, <span class="va">species</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span>, outer<span class="op">=</span><span class="cn">T</span>, cex.main<span class="op">=</span><span class="fl">1.6</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span>

<span class="co">## lambda_j of the first two species</span>
<span class="va">n_latent</span> <span class="op">&lt;-</span> <span class="va">mod_all</span><span class="op">$</span><span class="va">model_spec</span><span class="op">$</span><span class="va">n_latent</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">n_latent</span>,<span class="fl">2</span><span class="op">)</span>,oma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1.4</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">l</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_latent</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/traceplot.html">traceplot</a></span><span class="op">(</span><span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html">mcmc</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.sp</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"sp_"</span>,<span class="va">j</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">np</span><span class="op">+</span><span class="va">l</span><span class="op">]</span>,
                                  start<span class="op">=</span><span class="fl">40000</span>, end<span class="op">=</span><span class="fl">99940</span>, thin<span class="op">=</span><span class="fl">60</span><span class="op">)</span>,
                    main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Trace of"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.sp</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"sp_"</span>,<span class="va">j</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="va">np</span><span class="op">+</span><span class="va">l</span><span class="op">]</span><span class="op">)</span>,cex.main<span class="op">=</span><span class="fl">1.6</span><span class="op">)</span>
    <span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/densplot.html">densplot</a></span><span class="op">(</span><span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html">mcmc</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.sp</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"sp_"</span>,<span class="va">j</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">np</span><span class="op">+</span><span class="va">l</span><span class="op">]</span>,
                                 start<span class="op">=</span><span class="fl">40000</span>, end<span class="op">=</span><span class="fl">99940</span>, thin<span class="op">=</span><span class="fl">60</span><span class="op">)</span>,
                   main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Density of"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.sp</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"sp_"</span>,<span class="va">j</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="va">np</span><span class="op">+</span><span class="va">l</span><span class="op">]</span><span class="op">)</span>,cex.main<span class="op">=</span><span class="fl">1.6</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.sp</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"sp_"</span>,<span class="va">j</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">np</span><span class="op">+</span><span class="va">l</span><span class="op">]</span><span class="op">)</span>,col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/title.html">title</a></span><span class="op">(</span>main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Factor loadings lambda for species "</span>, <span class="va">species</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span>,outer<span class="op">=</span><span class="cn">T</span>,cex.main<span class="op">=</span><span class="fl">1.8</span><span class="op">)</span>
<span class="op">}</span>

<span class="co">## Latent variables W_i for one site</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>,oma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1.4</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">l</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_latent</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/traceplot.html">traceplot</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.latent</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"lv_"</span>,<span class="va">l</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">" Trace of W_1"</span>, <span class="va">l</span><span class="op">)</span>,cex.main<span class="op">=</span><span class="fl">1.6</span><span class="op">)</span>
  <span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/densplot.html">densplot</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.latent</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"lv_"</span>,<span class="va">l</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">" Density of W_1"</span>, <span class="va">l</span><span class="op">)</span>,cex.main<span class="op">=</span><span class="fl">1.6</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.latent</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"lv_"</span>,<span class="va">l</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>,col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/title.html">title</a></span><span class="op">(</span>main<span class="op">=</span><span class="st">"Latentes variables W_1"</span>, outer<span class="op">=</span><span class="cn">T</span>,cex.main<span class="op">=</span><span class="fl">1.8</span><span class="op">)</span>
<span class="co">## Deviance</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,oma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1.5</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/traceplot.html">traceplot</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.Deviance</span>,main<span class="op">=</span><span class="st">"Trace"</span>,cex.main<span class="op">=</span><span class="fl">1.6</span><span class="op">)</span>
<span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/densplot.html">densplot</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.Deviance</span>,main<span class="op">=</span><span class="st">"Density"</span>,cex.main<span class="op">=</span><span class="fl">1.6</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.Deviance</span><span class="op">)</span>,col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/title.html">title</a></span><span class="op">(</span>main <span class="op">=</span> <span class="st">"Deviance"</span>,outer<span class="op">=</span><span class="cn">T</span>,cex.main<span class="op">=</span><span class="fl">1.8</span><span class="op">)</span>
<span class="co"># theta</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">probit_theta_latent</span>,col<span class="op">=</span><span class="st">"light blue"</span>,  main <span class="op">=</span> <span class="st">"probit(theta) estimated"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">theta_latent</span>, breaks<span class="op">=</span><span class="va">pretty</span>, col<span class="op">=</span><span class="st">"light blue"</span>, main <span class="op">=</span> <span class="st">"theta estimated"</span><span class="op">)</span>
<span class="co"># # site and species prevalence</span>
<span class="co"># plot(colSums(PA)/nrow(PA),colMeans(mod_all$theta_latent), main="species prevalence", xlab="obs", ylab="fitted")</span>
<span class="co"># abline(a=0,b=1,col='red')</span>
<span class="co"># plot(rowSums(PA)/ncol(PA),rowMeans(mod_all$theta_latent), main="sites prevalence", xlab="obs", ylab="fitted")</span>
<span class="co"># abline(a=0,b=1,col='red')</span>
<span class="co"># # site and species prevalence according to intercepts</span>
<span class="co"># params_sites &lt;- read.csv("~/Documents/projet_BioSceneMada/Report/data/params_sites.csv")</span>
<span class="co"># params_species &lt;- read.csv("~/Documents/projet_BioSceneMada/Report/data/params_species.csv")</span>
<span class="co"># X &lt;- read.csv("~/Documents/projet_BioSceneMada/Report/data/X.csv")</span>
<span class="co"># plot(qnorm(colSums(PA)/nrow(PA)), params_species$beta_.Intercept., main="probit(species prevalence)", xlab="obs", ylab="fitted")</span>
<span class="co"># abline(a=0,b=1,col='red')</span>
<span class="co"># plot(qnorm(rowSums(PA)/ncol(PA)), params_sites$alphas + as.matrix(X) %*% colMeans(params_species[,grepl("beta",colnames(params_species))]) + as.matrix(params_sites[,c("W1","W2")]) %*% colMeans(params_species[,grepl("lambda",colnames(params_species))]), main="probit(sites prevalence)", xlab="obs", ylab="fitted")</span>
<span class="co"># abline(a=0,b=1,col='red')</span>
<span class="co"># species prevalence &lt;- mean probability of presence per site</span></code></pre></div>
<p><img src="Madagascar_files/figure-html/results-Mada-1.png" width="700" style="display: block; margin: auto;"><img src="Madagascar_files/figure-html/results-Mada-2.png" width="700" style="display: block; margin: auto;"><img src="Madagascar_files/figure-html/results-Mada-3.png" width="700" style="display: block; margin: auto;"><img src="Madagascar_files/figure-html/results-Mada-4.png" width="700" style="display: block; margin: auto;"><img src="Madagascar_files/figure-html/results-Mada-5.png" width="700" style="display: block; margin: auto;"><img src="Madagascar_files/figure-html/results-Mada-6.png" width="700" style="display: block; margin: auto;"><img src="Madagascar_files/figure-html/results-Mada-7.png" width="700" style="display: block; margin: auto;"><img src="Madagascar_files/figure-html/results-Mada-8.png" width="700" style="display: block; margin: auto;"><img src="Madagascar_files/figure-html/results-Mada-9.png" width="700" style="display: block; margin: auto;"><img src="Madagascar_files/figure-html/results-Mada-10.png" width="700" style="display: block; margin: auto;"><img src="Madagascar_files/figure-html/results-Mada-11.png" width="700" style="display: block; margin: auto;"><img src="Madagascar_files/figure-html/results-Mada-12.png" width="700" style="display: block; margin: auto;"><img src="Madagascar_files/figure-html/results-Mada-13.png" width="700" style="display: block; margin: auto;"><img src="Madagascar_files/figure-html/results-Mada-14.png" width="700" style="display: block; margin: auto;"><img src="Madagascar_files/figure-html/results-Mada-15.png" width="700" style="display: block; margin: auto;"><img src="Madagascar_files/figure-html/results-Mada-16.png" width="700" style="display: block; margin: auto;"><img src="Madagascar_files/figure-html/results-Mada-17.png" width="700" style="display: block; margin: auto;"><img src="Madagascar_files/figure-html/results-Mada-18.png" width="700" style="display: block; margin: auto;"></p>
<p>Overall, the traces and densities of the parameters indicate the convergence of the algorithm. Indeed, we observe on the traces that the values oscillate around averages without showing any upward or downward trend and we see that the densities are quite smooth and for most of them of gaussian form except for the <span class="math inline">\(\lambda_{11}\)</span> species effect what is certainly due to the way of imposing positive values to this parameter.</p>
</div>
</div>
<div id="representation-of-results-at-inventory-sites" class="section level1">
<h1 class="hasAnchor">
<a href="#representation-of-results-at-inventory-sites" class="anchor"></a><span class="header-section-number">4</span> Representation of results at inventory sites</h1>
<div id="presence-probabilities" class="section level2">
<h2 class="hasAnchor">
<a href="#presence-probabilities" class="anchor"></a><span class="header-section-number">4.1</span> Presence probabilities</h2>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">theta_latent</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/theta_latent.csv"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/scaled_data_clim.RData"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/PA.RData"</span><span class="op">)</span>

<span class="co"># Madagascar borders</span>
<span class="va">TA</span> <span class="op">&lt;-</span> <span class="fu">CRS</span><span class="op">(</span><span class="st">"+init=epsg:32738 +units=m"</span><span class="op">)</span>
<span class="va">MADA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/MADA.rds"</span><span class="op">)</span>
<span class="va">MADA</span> <span class="op">&lt;-</span> <span class="fu">sp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/sp/man/spTransform.html">spTransform</a></span><span class="op">(</span><span class="va">MADA</span>, <span class="va">TA</span><span class="op">)</span>
<span class="co"># define groups for mapping</span>
<span class="va">cuts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.1</span>,<span class="fl">0.2</span>,<span class="fl">0.3</span>,<span class="fl">0.4</span>,<span class="fl">0.5</span>,<span class="fl">0.7</span>,<span class="fl">0.8</span>,<span class="fl">0.9</span><span class="op">)</span>
<span class="va">col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'red3'</span>,<span class="st">'red'</span>,<span class="st">'orange'</span>,<span class="st">'yellow'</span>, <span class="st">'yellow green'</span>, <span class="st">'green3'</span>, <span class="st">'forest green'</span>,<span class="st">'dark green'</span><span class="op">)</span>
<span class="va">pols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"sp.polygons"</span>, <span class="va">MADA</span>, fill <span class="op">=</span> <span class="st">"lightgray"</span><span class="op">)</span>

<span class="co"># Observed presence absence</span>
<span class="va">id_pres</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">PA</span><span class="op">[</span>,<span class="st">"Ocotea laevis"</span><span class="op">]</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span>
<span class="va">id_abs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">PA</span><span class="op">[</span>,<span class="st">"Ocotea laevis"</span><span class="op">]</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span>
<span class="va">obs_pres</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>obs_pres<span class="op">=</span><span class="va">PA</span><span class="op">[</span><span class="va">id_pres</span>,<span class="st">"Ocotea laevis"</span><span class="op">]</span><span class="op">)</span>
<span class="va">obs_abs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>obs_abs<span class="op">=</span><span class="va">PA</span><span class="op">[</span><span class="va">id_abs</span>,<span class="st">"Ocotea laevis"</span><span class="op">]</span><span class="op">)</span>
<span class="va">obs_pres</span> <span class="op">&lt;-</span>  <span class="fu">sp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/sp/man/SpatialPoints.html">SpatialPointsDataFrame</a></span><span class="op">(</span><span class="va">xy</span><span class="op">[</span><span class="va">id_pres</span>,<span class="op">]</span>, <span class="va">obs_pres</span><span class="op">)</span>
<span class="va">obs_abs</span> <span class="op">&lt;-</span>  <span class="fu">sp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/sp/man/SpatialPoints.html">SpatialPointsDataFrame</a></span><span class="op">(</span><span class="va">xy</span><span class="op">[</span><span class="va">id_abs</span>,<span class="op">]</span>, <span class="va">obs_abs</span><span class="op">)</span>
<span class="co"># Representation</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="fu">sp</span><span class="fu">::</span><span class="fu">plot</span><span class="op">(</span><span class="va">MADA</span>, main <span class="op">=</span><span class="st">"Présences d'Ocotea laevis observées"</span>,cex.main<span class="op">=</span><span class="fl">1.4</span><span class="op">)</span> 
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">obs_pres</span>,pch<span class="op">=</span><span class="fl">16</span>,cex<span class="op">=</span><span class="fl">1.2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">obs_abs</span>,pch<span class="op">=</span><span class="fl">1</span>,cex<span class="op">=</span><span class="fl">1.2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"right"</span>,legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"presence"</span>,<span class="st">"absence"</span><span class="op">)</span> ,pch<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">16</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Estimated probabilities of presence</span>
<span class="va">theta_latent_sp</span> <span class="op">&lt;-</span> <span class="fu">SpatialPointsDataFrame</span><span class="op">(</span><span class="va">xy</span>,<span class="va">theta_latent</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">theta_latent_sp</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/make.names.html">make.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">PA</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Representation</span>
<span class="fu">sp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/sp/man/spplot.html">spplot</a></span><span class="op">(</span><span class="va">theta_latent_sp</span>, <span class="st">'Ocotea.laevis'</span>, cuts<span class="op">=</span><span class="va">cuts</span>, col.regions<span class="op">=</span><span class="va">col</span>, sp.layout<span class="op">=</span><span class="va">pols</span>, pch<span class="op">=</span><span class="fl">20</span>, cex<span class="op">=</span><span class="fl">1.6</span>, key.space
           <span class="op">=</span><span class="st">"right"</span>, main <span class="op">=</span><span class="st">"Probabilités de présence d'Ocotea laevis estimées"</span>,cex.main<span class="op">=</span><span class="fl">5</span><span class="op">)</span></code></pre></div>
<p><img src="Madagascar_files/figure-html/proba_representation-1.png" width="50%"><img src="Madagascar_files/figure-html/proba_representation-2.png" width="50%"></p>
</div>
<div id="species-richness" class="section level2">
<h2 class="hasAnchor">
<a href="#species-richness" class="anchor"></a><span class="header-section-number">4.2</span> Species richness</h2>
<p>Species richness also called diversity <span class="math inline">\(\alpha\)</span> reflects the number of species coexisting in a given environment and is estimated by summing the estimated probabilities of occurrence.
We spatially represent the species richness observed at each inventory site defined by <span class="math inline">\(R_i=\sum\limits_ {j=1}^{555} y_{ij}\)</span> and the species richness estimated for each site by <span class="math inline">\(\widehat{R_i}=\sum\limits_ {j=1}^{483} \widehat{\theta_{ij}}\)</span>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="va">species_richness</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>species_richness<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">theta_latent</span>,<span class="fl">1</span>,<span class="va">sum</span><span class="op">)</span><span class="op">)</span>
<span class="va">species_richness_sp</span> <span class="op">&lt;-</span> <span class="fu">SpatialPointsDataFrame</span><span class="op">(</span><span class="va">xy</span>, <span class="va">species_richness</span><span class="op">)</span>
<span class="va">cuts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">8</span>,<span class="fl">12</span>,<span class="fl">16</span>,<span class="fl">20</span>,<span class="fl">24</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">theta_latent</span><span class="op">)</span><span class="op">)</span>
<span class="va">col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'red4'</span>,<span class="st">'red'</span>,<span class="st">'orange'</span>,<span class="st">'yellow'</span>, <span class="st">'yellow green'</span>, <span class="st">'green3'</span>, <span class="st">'forest green'</span>,<span class="st">'dark green'</span><span class="op">)</span>
<span class="va">pols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"sp.polygons"</span>, <span class="va">MADA</span>, fill <span class="op">=</span> <span class="st">"lightgray"</span><span class="op">)</span>
<span class="fu">spplot</span><span class="op">(</span><span class="va">species_richness_sp</span>, <span class="st">'species_richness'</span>, cuts<span class="op">=</span><span class="va">cuts</span>, col.regions<span class="op">=</span><span class="va">col</span>, sp.layout<span class="op">=</span><span class="va">pols</span>, pch<span class="op">=</span><span class="fl">20</span>, cex<span class="op">=</span><span class="fl">1.6</span>, key.space<span class="op">=</span><span class="st">"right"</span>, main <span class="op">=</span><span class="st">"Estimated species richness"</span><span class="op">)</span>

<span class="va">species_richness_obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>species_richness_obs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">PA</span><span class="op">)</span><span class="op">)</span>
<span class="va">species_richness_obs_sp</span> <span class="op">&lt;-</span> <span class="fu">SpatialPointsDataFrame</span><span class="op">(</span><span class="va">xy</span>, <span class="va">species_richness_obs</span><span class="op">)</span>
<span class="fu">spplot</span><span class="op">(</span><span class="va">species_richness_obs_sp</span>, <span class="st">'species_richness_obs'</span>, cuts<span class="op">=</span><span class="va">cuts</span>, col.regions<span class="op">=</span><span class="va">col</span>, sp.layout<span class="op">=</span><span class="va">pols</span>, pch<span class="op">=</span><span class="fl">20</span>, cex<span class="op">=</span><span class="fl">1.6</span>, key.space<span class="op">=</span><span class="st">"right"</span>, main <span class="op">=</span><span class="st">"Observed species richness"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">species_richness_obs</span><span class="op">$</span><span class="va">species_richness_obs</span>,<span class="va">species_richness</span><span class="op">$</span><span class="va">species_richness</span>, main<span class="op">=</span><span class="st">"Species richness"</span>, xlab<span class="op">=</span><span class="st">"observed"</span>, ylab<span class="op">=</span><span class="st">"estimated"</span>, cex.main<span class="op">=</span><span class="fl">1.4</span>, cex.lab<span class="op">=</span><span class="fl">1.3</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>,b<span class="op">=</span><span class="fl">1</span>,col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span></code></pre></div>
<p><img src="Madagascar_files/figure-html/species-richness-representation-1.png" width="50%"><img src="Madagascar_files/figure-html/species-richness-representation-2.png" width="50%"></p>
<p><img src="Madagascar_files/figure-html/species-richness-representation-3.png" width="50%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">params_species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"~/Documents/projet_BioSceneMada/Report/data/params_species.csv"</span><span class="op">)</span>
<span class="co"># for each species we compute TSS for 100 threshold</span>
<span class="va">thresholds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,length.out<span class="op">=</span><span class="fl">100</span><span class="op">)</span>
<span class="va">TSS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">thresholds</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">PA</span><span class="op">)</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">PA</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="co"># occurrence probabilities are simply converted into presence-absence</span>
  <span class="co"># according to the threshold t</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">t</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">thresholds</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>obs<span class="op">=</span><span class="va">PA</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span>, pred<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">theta_latent</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">&gt;=</span><span class="va">thresholds</span><span class="op">[</span><span class="va">t</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
    <span class="co"># Confusion matrix</span>
    <span class="va">n00</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="st">"pred"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="st">"obs"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>
    <span class="va">n10</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="st">"pred"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="st">"obs"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>
    <span class="va">n01</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="st">"pred"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="st">"obs"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
    <span class="va">n11</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="st">"pred"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="st">"obs"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
    <span class="co"># Accuracy indices</span>
    <span class="va">Sensitivity</span> <span class="op">=</span> <span class="va">n11</span> <span class="op">/</span> <span class="op">(</span><span class="va">n11</span> <span class="op">+</span> <span class="va">n01</span><span class="op">)</span>
    <span class="va">Specificity</span> <span class="op">=</span> <span class="va">n00</span> <span class="op">/</span> <span class="op">(</span><span class="va">n00</span> <span class="op">+</span> <span class="va">n10</span><span class="op">)</span>
    <span class="co"># compute TSS </span>
    <span class="va">TSS</span><span class="op">[</span><span class="va">t</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Sensitivity</span> <span class="op">+</span> <span class="va">Specificity</span> <span class="op">-</span><span class="fl">1</span>  
  <span class="op">}</span>
<span class="op">}</span>
<span class="va">TSS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">TSS</span>, <span class="va">thresholds</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">TSS</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/make.names.html">make.names</a></span><span class="op">(</span><span class="va">params_species</span><span class="op">$</span><span class="va">species</span><span class="op">)</span>, <span class="st">"thresholds"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">TSS</span>, file <span class="op">=</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/TSS.csv"</span>,row.names <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>

<span class="co"># Convert occurrence probabilities into presence-absence</span>
<span class="co"># according to the threshold wich maximize TSS for each species</span>
<span class="va">TSS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/TSS.csv"</span><span class="op">)</span>
<span class="va">PA_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">PA</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">PA</span><span class="op">)</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">PA</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
<span class="va">PA_pred</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">theta_latent</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&gt;=</span> <span class="va">thresholds</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span><span class="op">(</span><span class="va">TSS</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">PA_pred</span>,<span class="st">"~/Documents/projet_BioSceneMada/Report/data/PA_pred.csv"</span><span class="op">)</span>
<span class="co"># Compute absolute species richness </span>
<span class="va">abs_species_richness</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>species_richness<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">PA_pred</span><span class="op">)</span><span class="op">)</span>
<span class="va">abs_species_richness_sp</span> <span class="op">&lt;-</span> <span class="fu">SpatialPointsDataFrame</span><span class="op">(</span><span class="va">xy</span>, <span class="va">abs_species_richness</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="va">cuts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">8</span>,<span class="fl">12</span>,<span class="fl">16</span>,<span class="fl">20</span>,<span class="fl">24</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">theta_latent</span><span class="op">)</span><span class="op">)</span>
<span class="va">col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'red4'</span>,<span class="st">'red'</span>,<span class="st">'orange'</span>,<span class="st">'yellow'</span>, <span class="st">'yellow green'</span>, <span class="st">'green3'</span>, <span class="st">'forest green'</span>,<span class="st">'dark green'</span><span class="op">)</span>
<span class="va">pols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"sp.polygons"</span>, <span class="va">MADA</span>, fill <span class="op">=</span> <span class="st">"lightgray"</span><span class="op">)</span>
<span class="fu">spplot</span><span class="op">(</span><span class="va">abs_species_richness_sp</span>, <span class="st">'species_richness'</span>, cuts<span class="op">=</span><span class="va">cuts</span>, col.regions<span class="op">=</span><span class="va">col</span>, sp.layout<span class="op">=</span><span class="va">pols</span>, pch<span class="op">=</span><span class="fl">20</span>, cex<span class="op">=</span><span class="fl">1.6</span>, key.space<span class="op">=</span><span class="st">"right"</span>, main <span class="op">=</span><span class="st">"Estimated species richness"</span><span class="op">)</span>
<span class="fu">spplot</span><span class="op">(</span><span class="va">species_richness_obs_sp</span>, <span class="st">'species_richness_obs'</span>, cuts<span class="op">=</span><span class="va">cuts</span>, col.regions<span class="op">=</span><span class="va">col</span>, sp.layout<span class="op">=</span><span class="va">pols</span>, pch<span class="op">=</span><span class="fl">20</span>, cex<span class="op">=</span><span class="fl">1.6</span>, key.space<span class="op">=</span><span class="st">"right"</span>, main <span class="op">=</span><span class="st">"Observed species richness"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">species_richness_obs</span><span class="op">$</span><span class="va">species_richness_obs</span>, <span class="va">abs_species_richness</span><span class="op">$</span><span class="va">species_richness</span>, main<span class="op">=</span><span class="st">"Species richness"</span>, xlab<span class="op">=</span><span class="st">"observed"</span>, ylab<span class="op">=</span><span class="st">"estimated"</span>, cex.main<span class="op">=</span><span class="fl">1.4</span>, cex.lab<span class="op">=</span><span class="fl">1.3</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>,b<span class="op">=</span><span class="fl">1</span>,col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span></code></pre></div>
<p><img src="Madagascar_files/figure-html/abs-species-richness-representation-1.png" width="50%"><img src="Madagascar_files/figure-html/abs-species-richness-representation-2.png" width="50%"></p>
<p><img src="Madagascar_files/figure-html/abs-species-richness-representation-3.png" width="50%" style="display: block; margin: auto;"></p>
</div>
<div id="residual-correlation" class="section level2">
<h2 class="hasAnchor">
<a href="#residual-correlation" class="anchor"></a><span class="header-section-number">4.3</span> Residual correlation</h2>
<p>After fitting the JSDM with latent variables, the <strong>full species residual correlation matrix</strong> <span class="math inline">\(R=(R_{ij})^{i=1,\ldots, nspecies}_{j=1,\ldots, nspecies}\)</span> can be derived from the covariance in the latent variables such as :
<span class="math display">\[\Sigma_{ij} = \begin{cases}
 \lambda_i .\lambda_j^T &amp; \text{ if } i \neq j \\
  \lambda_i .\lambda_j^T + 1 &amp; \text{ if } i=j
 \end{cases}\]</span>, then we compute correlations from covariances :
<span class="math display">\[R_{i,j} = \frac{\Sigma_{ij}}{\sqrt{\Sigma _{ii}\Sigma _{jj}}}\]</span>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/mada_mod.RData"</span><span class="op">)</span>
<span class="va">n.species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">model_spec</span><span class="op">$</span><span class="va">presence_data</span><span class="op">)</span>
<span class="va">n.mcmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.latent</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="va">Tau.cor.arr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="va">n.mcmc</span>,<span class="va">n.species</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>

<span class="kw">for</span><span class="op">(</span><span class="va">t</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n.mcmc</span><span class="op">)</span> <span class="op">{</span> 
  <span class="va">lv.coefs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.sp</span>, <span class="st">"["</span>, <span class="va">t</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"lambda"</span>,<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.sp</span><span class="op">$</span><span class="va">sp_1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">Tau.mat</span> <span class="op">&lt;-</span> <span class="va">lv.coefs</span> <span class="op">%*%</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">lv.coefs</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">n.species</span><span class="op">)</span>
  <span class="va">Tau.cor.mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cov2cor</a></span><span class="op">(</span><span class="va">Tau.mat</span><span class="op">)</span>
  <span class="va">Tau.cor.arr</span><span class="op">[</span><span class="va">t</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="va">Tau.cor.mat</span><span class="op">)</span> 
<span class="op">}</span>
<span class="co">## Average over the MCMC samples</span>
<span class="va">R</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">Tau.cor.arr</span>,<span class="fl">2</span>,<span class="va">mean</span><span class="op">)</span>,<span class="va">n.species</span>,byrow<span class="op">=</span><span class="cn">F</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">R</span>, file <span class="op">=</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/R.csv"</span>, row.names <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Forest inventory </span>
<span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/PA.RData"</span><span class="op">)</span>
<span class="co"># Species parameters </span>
<span class="va">params_species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"~/Documents/projet_BioSceneMada/Report/data/params_species.csv"</span><span class="op">)</span>
<span class="co"># Residual correlation matrix R</span>
<span class="va">R</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/R.csv"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">R</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">R</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/make.names.html">make.names</a></span><span class="op">(</span><span class="va">params_species</span><span class="op">$</span><span class="va">species</span><span class="op">)</span>
<span class="va">R</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">R</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/">viridis</a></span><span class="op">)</span>
<span class="fu"><a href="../reference/plot_associations.html">plot_associations</a></span><span class="op">(</span><span class="va">R</span>, circleBreak<span class="op">=</span><span class="cn">TRUE</span>, occ<span class="op">=</span><span class="va">PA</span>, top<span class="op">=</span><span class="fl">20</span>,
                  main<span class="op">=</span><span class="st">"Species-species association sorted after their frequency"</span>,
                  cols_association<span class="op">=</span><span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">viridis</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>,
                  cols_occurrence<span class="op">=</span><span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">magma</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>,
                  species_order<span class="op">=</span><span class="st">"frequency"</span><span class="op">)</span>
<span class="co"># Average of MCMC samples of species effect beta except the intercept</span>
<span class="va">effects</span> <span class="op">=</span> <span class="va">params_species</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"beta"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">params_species</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="va">np</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">effects</span><span class="op">)</span>
<span class="co"># Add absolute quadratic and linear effects of each environmental variable</span>
<span class="va">effects</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">effects</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">np</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">effects</span><span class="op">[</span>,<span class="op">(</span><span class="va">np</span><span class="op">/</span><span class="fl">2</span> <span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="va">np</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">effects</span><span class="op">)</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"beta_"</span>, <span class="st">""</span>,<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">effects</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/plot_associations.html">plot_associations</a></span><span class="op">(</span><span class="va">R</span>, env_effect<span class="op">=</span><span class="va">effects</span>, top<span class="op">=</span><span class="fl">20</span>,
                  main<span class="op">=</span><span class="st">"Species-species association sorted after their main environmental effect"</span>,
                  cols_association<span class="op">=</span><span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">viridis</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>,
                  species_order<span class="op">=</span><span class="st">"main env_effect"</span><span class="op">)</span></code></pre></div>
<p><img src="Madagascar_files/figure-html/plot-associations-1.png" width="600" height="600" style="display: block; margin: auto;"><img src="Madagascar_files/figure-html/plot-associations-2.png" width="600" height="600" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="intrapolation-of-parameters-between-inventory-sites" class="section level1">
<h1 class="hasAnchor">
<a href="#intrapolation-of-parameters-between-inventory-sites" class="anchor"></a><span class="header-section-number">5</span> Intrapolation of parameters between inventory sites</h1>
<p>The presence of a spatial structure where observations close to each other are more similar than those far away (spatial auto-correlation) is a prerequisite for the application of geostatistics and from the previous spatial representations it seems to be satisfied.
Thus, it is possible to interpolate sites’ parameters for the whole island from those estimated for the inventory plots using the spatial interpolation method called regularized spline with tension (<strong>RST</strong>) from <a href="https://grass.osgeo.org/"><code>GRASS GIS</code></a> software via <code>rgrass7</code> R package.
This method is described in the article <span class="citation">(Mitášová &amp; Hofierka <a href="#ref-Mitasova1993" role="doc-biblioref">1993</a>)</span>.</p>
<div id="random-site-effect-alpha" class="section level2">
<h2 class="hasAnchor">
<a href="#random-site-effect-alpha" class="anchor"></a><span class="header-section-number">5.1</span> Random site effect <span class="math inline">\(\alpha\)</span>
</h2>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Initialize GRASS</span>
<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">setwd</a></span><span class="op">(</span><span class="st">"~/Documents/jSDM/vignettes"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html">Sys.setenv</a></span><span class="op">(</span>LD_LIBRARY_PATH<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"/usr/lib/grass78/lib"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span><span class="op">(</span><span class="st">"LD_LIBRARY_PATH"</span><span class="op">)</span>,sep<span class="op">=</span><span class="st">":"</span><span class="op">)</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">rgrass7</span><span class="op">)</span>
<span class="co"># use a georeferenced raster</span>
<span class="fu"><a href="https://rdrr.io/r/base/system.html">system</a></span><span class="op">(</span><span class="st">'grass -c ~/Documents/projet_BioSceneMada/Report/data/scaled_clim.tif grassdata/interpolation'</span><span class="op">)</span>
<span class="co"># connect to grass database</span>
<span class="fu">initGRASS</span><span class="op">(</span>gisBase<span class="op">=</span><span class="st">"/usr/lib/grass78"</span>, 
          gisDbase<span class="op">=</span><span class="st">"grassdata"</span>,
          location<span class="op">=</span><span class="st">"interpolation"</span>, mapset<span class="op">=</span><span class="st">"PERMANENT"</span>,
          override<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">rgrass7</span><span class="op">)</span>
<span class="co"># Import sites parameters</span>
<span class="va">params_sites</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/params_sites.csv"</span><span class="op">)</span>
<span class="va">longlat</span> <span class="op">&lt;-</span> <span class="fu">SpatialPoints</span><span class="op">(</span><span class="va">params_sites</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"long"</span>,<span class="st">"lat"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="fu">proj4string</span><span class="op">(</span><span class="va">longlat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">CRS</span><span class="op">(</span><span class="st">"+proj=longlat +ellps=clrk66 +units=m"</span><span class="op">)</span>
<span class="co"># latlong to UTM38S projection </span>
<span class="va">xy</span> <span class="op">=</span> <span class="fu">spTransform</span><span class="op">(</span><span class="va">longlat</span>, <span class="fu">CRS</span><span class="op">(</span><span class="st">"+proj=utm +zone=38 +south +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0"</span><span class="op">)</span><span class="op">)</span>
<span class="co"># alpha </span>
<span class="va">alpha_sp</span> <span class="op">&lt;-</span> <span class="fu">SpatialPointsDataFrame</span><span class="op">(</span><span class="va">xy</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>alpha<span class="op">=</span><span class="va">params_sites</span><span class="op">$</span><span class="va">alphas</span><span class="op">)</span><span class="op">)</span>
<span class="fu">use_sp</span><span class="op">(</span><span class="op">)</span>
<span class="fu">rgrass7</span><span class="fu">::</span><span class="fu">writeVECT</span><span class="op">(</span><span class="va">alpha_sp</span>, <span class="st">"alpha"</span>, v.in.ogr_flags<span class="op">=</span><span class="st">"overwrite"</span><span class="op">)</span>
<span class="co"># Import Madagascar shapefile</span>
<span class="va">clim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/stack.html">stack</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/current.tif"</span><span class="op">)</span>
<span class="va">Madagascar</span> <span class="op">&lt;-</span> <span class="fu">as</span><span class="op">(</span><span class="va">clim</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="st">'SpatialGridDataFrame'</span><span class="op">)</span>
<span class="fu">rgrass7</span><span class="fu">::</span><span class="fu">writeRAST</span><span class="op">(</span><span class="va">Madagascar</span>, <span class="st">"Madagascar"</span>, flags<span class="op">=</span><span class="st">"overwrite"</span><span class="op">)</span>
<span class="co"># Resample with RST</span>
<span class="co"># Note: use maskmap=Madagascar to save computation time</span>
<span class="co"># for pontual data use function v.surf.rst</span>
<span class="fu"><a href="https://rdrr.io/r/base/system.html">system</a></span><span class="op">(</span><span class="st">"v.surf.rst --overwrite --verbose -t tension=3 input=alpha zcolumn=alpha \\
       smooth=0.0 elevation=alpha_rst mask=Madagascar"</span><span class="op">)</span>
<span class="co"># Export</span>
<span class="fu"><a href="https://rdrr.io/r/base/system.html">system</a></span><span class="op">(</span><span class="st">"r.out.gdal --overwrite input=alpha_rst \\
             output=Madagascar_files/alpha_rst.tif type=Float32 \\
             createopt='compress=lzw,predictor=2'"</span><span class="op">)</span>
<span class="co"># Representation</span>
<span class="va">test_in</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="op">(</span><span class="st">"Madagascar_files/alpha_rst.tif"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">test_in</span><span class="op">)</span>
<span class="va">test_xy</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extract.html">extract</a></span><span class="op">(</span><span class="va">test_in</span>, <span class="va">xy</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">test_xy</span>, <span class="va">params_sites</span><span class="op">$</span><span class="va">alphas</span>, xlab<span class="op">=</span><span class="st">"alpha interpolated by RST"</span>, ylab<span class="op">=</span><span class="st">"alpha estimated by JSDM"</span>,
          main<span class="op">=</span><span class="st">"Random site effect"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>, b<span class="op">=</span><span class="fl">1</span>, col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span></code></pre></div>
</div>
<div id="latent-variables-w" class="section level2">
<h2 class="hasAnchor">
<a href="#latent-variables-w" class="anchor"></a><span class="header-section-number">5.2</span> Latent variables <span class="math inline">\(W\)</span>
</h2>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># W1 </span>
<span class="va">W1_sp</span> <span class="op">&lt;-</span> <span class="fu">SpatialPointsDataFrame</span><span class="op">(</span><span class="va">xy</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>W1<span class="op">=</span><span class="va">params_sites</span><span class="op">$</span><span class="va">W1</span><span class="op">)</span><span class="op">)</span>
<span class="fu">rgrass7</span><span class="fu">::</span><span class="fu">writeVECT</span><span class="op">(</span><span class="va">W1_sp</span>, <span class="st">"W1"</span>, v.in.ogr_flags<span class="op">=</span><span class="st">"overwrite"</span><span class="op">)</span>
<span class="co"># Resample with RST</span>
<span class="co"># Note: use maskmap=Madagascar to save computation time</span>
<span class="co"># for pontual data use function v.surf.rst</span>
<span class="fu"><a href="https://rdrr.io/r/base/system.html">system</a></span><span class="op">(</span><span class="st">"v.surf.rst --overwrite --verbose -t tension=3 input=W1 zcolumn=W1 \\
       smooth=0.0 elevation=W1_rst mask=Madagascar"</span><span class="op">)</span>
<span class="co"># Export</span>
<span class="fu"><a href="https://rdrr.io/r/base/system.html">system</a></span><span class="op">(</span><span class="st">"r.out.gdal --overwrite input=W1_rst \\
             output=Madagascar_files/W1_rst.tif type=Float32 \\
             createopt='compress=lzw,predictor=2'"</span><span class="op">)</span>
<span class="co"># Representation</span>
<span class="va">test_in</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="op">(</span><span class="st">"Madagascar_files/W1_rst.tif"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">test_in</span><span class="op">)</span>
<span class="va">test_xy</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extract.html">extract</a></span><span class="op">(</span><span class="va">test_in</span>, <span class="va">xy</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">test_xy</span>, <span class="va">params_sites</span><span class="op">$</span><span class="va">W1</span>,xlab<span class="op">=</span><span class="st">"W1 nterpolated by RST"</span>, ylab<span class="op">=</span><span class="st">"W1 estimated by JSDM"</span>, 
     main<span class="op">=</span><span class="st">"First latent axe"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>, b<span class="op">=</span><span class="fl">1</span>, col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># W2 </span>
<span class="va">W2_sp</span> <span class="op">&lt;-</span> <span class="fu">SpatialPointsDataFrame</span><span class="op">(</span><span class="va">xy</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>W2<span class="op">=</span><span class="va">params_sites</span><span class="op">$</span><span class="va">W2</span><span class="op">)</span><span class="op">)</span>
<span class="fu">rgrass7</span><span class="fu">::</span><span class="fu">writeVECT</span><span class="op">(</span><span class="va">W2_sp</span>, <span class="st">"W2"</span>, v.in.ogr_flags<span class="op">=</span><span class="st">"overwrite"</span><span class="op">)</span>
<span class="co"># Resample with RST</span>
<span class="co"># Note: use maskmap=Madagascar to save computation time</span>
<span class="co"># for pontual data use function v.surf.rst</span>
<span class="fu"><a href="https://rdrr.io/r/base/system.html">system</a></span><span class="op">(</span><span class="st">"v.surf.rst --overwrite --verbose -t tension=3 input=W2 zcolumn=W2 \\
       smooth=0.0 elevation=W2_rst mask=Madagascar"</span><span class="op">)</span>
<span class="co"># Export</span>
<span class="fu"><a href="https://rdrr.io/r/base/system.html">system</a></span><span class="op">(</span><span class="st">"r.out.gdal --overwrite input=W2_rst \\
             output=Madagascar_files/W2_rst.tif type=Float32 \\
             createopt='compress=lzw,predictor=2'"</span><span class="op">)</span>
<span class="co"># Representation</span>
<span class="va">test_in</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="op">(</span><span class="st">"Madagascar_files/W2_rst.tif"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">test_in</span><span class="op">)</span>
<span class="va">test_xy</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extract.html">extract</a></span><span class="op">(</span><span class="va">test_in</span>, <span class="va">xy</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">test_xy</span>, <span class="va">params_sites</span><span class="op">$</span><span class="va">W2</span>, xlab<span class="op">=</span><span class="st">"W2 nterpolated by RST"</span>, ylab<span class="op">=</span><span class="st">"W2 estimated by JSDM"</span>,
     main<span class="op">=</span><span class="st">"Second latent axe"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>, b<span class="op">=</span><span class="fl">1</span>, col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="species-distribution-at-madagascar-scale" class="section level1">
<h1 class="hasAnchor">
<a href="#species-distribution-at-madagascar-scale" class="anchor"></a><span class="header-section-number">6</span> Species distribution at Madagascar scale</h1>
<p>We calculate the probabilities of species presences between inventory sites using interpolated site’s parameters.</p>
<div id="current-species-distribution" class="section level2">
<h2 class="hasAnchor">
<a href="#current-species-distribution" class="anchor"></a><span class="header-section-number">6.1</span> Current species distribution</h2>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">params_species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"~/Documents/projet_BioSceneMada/Report/data/params_species.csv"</span><span class="op">)</span>
<span class="va">npart</span> <span class="op">&lt;-</span> <span class="fl">10</span>
<span class="va">first.species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">nsp</span>,by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">nsp</span><span class="op">/</span><span class="va">npart</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span>
<span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/stack.html">stack</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/RST_theta_1.tif"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/make.names.html">make.names</a></span><span class="op">(</span><span class="va">params_species</span><span class="op">$</span><span class="va">species</span><span class="op">[</span><span class="va">first.species</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">:</span><span class="op">(</span><span class="va">first.species</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">nsp</span><span class="op">/</span><span class="va">npart</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,oma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1.4</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">6</span><span class="op">)</span><span class="op">]</span><span class="op">]</span>,cex.main<span class="op">=</span><span class="fl">0.7</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/title.html">title</a></span><span class="op">(</span>main<span class="op">=</span><span class="st">"Interpolated current probabilities of presence"</span>,outer<span class="op">=</span><span class="cn">T</span>,cex.main<span class="op">=</span><span class="fl">0.9</span><span class="op">)</span></code></pre></div>
<p><img src="Madagascar_files/figure-html/plot-theta-1.png" width="800" style="display: block; margin: auto;"></p>
</div>
<div id="future-species-distribution" class="section level2">
<h2 class="hasAnchor">
<a href="#future-species-distribution" class="anchor"></a><span class="header-section-number">6.2</span> Future species distribution</h2>
<p><img src="Madagascar_files/figure-html/plot-theta-future-1.png" width="800" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="representation-of-current-and-future-plants-biodiversity-in-madagascar" class="section level1">
<h1 class="hasAnchor">
<a href="#representation-of-current-and-future-plants-biodiversity-in-madagascar" class="anchor"></a><span class="header-section-number">7</span> Representation of current and future plants biodiversity in Madagascar</h1>
<div id="predictive-maps-of-species-richness-diversity-alpha" class="section level2">
<h2 class="hasAnchor">
<a href="#predictive-maps-of-species-richness-diversity-alpha" class="anchor"></a><span class="header-section-number">7.1</span> Predictive maps of species richness (diversity <span class="math inline">\(\alpha\)</span>)</h2>
<div id="relative-current-species-richness" class="section level3">
<h3 class="hasAnchor">
<a href="#relative-current-species-richness" class="anchor"></a><span class="header-section-number">7.1.1</span> Relative current species richness</h3>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/stack.html">stack</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/RST_theta_1.tif"</span><span class="op">)</span>
<span class="va">species_richness</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span>
<span class="va">npart</span> <span class="op">&lt;-</span> <span class="fl">10</span>
<span class="kw">for</span><span class="op">(</span><span class="va">n</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">npart</span><span class="op">)</span><span class="op">{</span>
<span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/stack.html">stack</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/RST_theta_"</span>,<span class="va">n</span>,<span class="st">".tif"</span><span class="op">)</span><span class="op">)</span>
<span class="va">species_richness</span> <span class="op">&lt;-</span> <span class="va">species_richness</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu">writeRaster</span><span class="op">(</span><span class="va">species_richness</span>,file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/species_richness.tif"</span><span class="op">)</span>,
              format<span class="op">=</span><span class="st">"GTiff"</span>, options<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"COMPRESS=LZW"</span>, <span class="st">"PREDICTOR=2"</span><span class="op">)</span>, overwrite<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
<div id="relative-future-species-richness" class="section level3">
<h3 class="hasAnchor">
<a href="#relative-future-species-richness" class="anchor"></a><span class="header-section-number">7.1.2</span> Relative future species richness</h3>
<p><img src="Madagascar_files/figure-html/plot-species-richness-1.png" width="700" style="display: block; margin: auto;"></p>
</div>
<div id="relative-current-and-future-species-richness-restricted-to-forest-cover" class="section level3">
<h3 class="hasAnchor">
<a href="#relative-current-and-future-species-richness-restricted-to-forest-cover" class="anchor"></a><span class="header-section-number">7.1.3</span> Relative current and future species richness restricted to forest cover</h3>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidyverse/glue">glue</a></span><span class="op">)</span>
<span class="co"># raster of Madagascar's forest cover in 2000</span>
<span class="va">forest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/stack.html">stack</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/for2000.tif"</span><span class="op">)</span>
<span class="co"># change resolution of species richness rasters from 1000x1000m to 30x30m</span>
<span class="va">in_f</span> <span class="op">&lt;-</span> <span class="st">"~/Documents/projet_BioSceneMada/Report/data/species_richness.tif"</span>
<span class="va">out_f</span> <span class="op">&lt;-</span> <span class="st">"~/Documents/projet_BioSceneMada/Report/data/species_richness_30m.tif"</span>
<span class="va">cmd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">'gdalwarp -tr 30 30 -te {xmin(forest)} {ymin(forest)} {xmax(forest)} {ymax(forest)} -r near -co "COMPRESS=LZW" -co "PREDICTOR=2" -overwrite {in_f} {out_f}'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/system.html">system</a></span><span class="op">(</span><span class="va">cmd</span><span class="op">)</span>
<span class="va">in_f</span> <span class="op">&lt;-</span> <span class="st">"~/Documents/projet_BioSceneMada/Report/data/species_richness_future.tif"</span>
<span class="va">out_f</span> <span class="op">&lt;-</span> <span class="st">"~/Documents/projet_BioSceneMada/Report/data/species_richness_future_30m.tif"</span>
<span class="va">cmd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">'gdalwarp -tr 30 30 -te {xmin(forest)} {ymin(forest)} {xmax(forest)} {ymax(forest)} -r near -co "COMPRESS=LZW" -co "PREDICTOR=2" -overwrite {in_f} {out_f}'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/system.html">system</a></span><span class="op">(</span><span class="va">cmd</span><span class="op">)</span>

<span class="co"># remove species richness values where there was no forest in 2000s</span>
<span class="va">species_richness</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/stack.html">stack</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/species_richness_30m.tif"</span><span class="op">)</span>
<span class="va">species_richness_deforest</span> <span class="op">&lt;-</span> <span class="fu">mask</span><span class="op">(</span><span class="va">species_richness</span>,<span class="va">forest</span><span class="op">)</span>
<span class="fu">writeRaster</span><span class="op">(</span><span class="va">species_richness_deforest</span>,file<span class="op">=</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/species_richness_deforest.tif"</span>,
                format<span class="op">=</span><span class="st">"GTiff"</span>, options<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"COMPRESS=LZW"</span>, <span class="st">"PREDICTOR=2"</span><span class="op">)</span>, overwrite<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="va">species_richness_future</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/stack.html">stack</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/species_richness_future_30m.tif"</span><span class="op">)</span>
<span class="va">species_richness_future_deforest</span> <span class="op">&lt;-</span> <span class="fu">mask</span><span class="op">(</span><span class="va">species_richness_future</span>,<span class="va">forest</span><span class="op">)</span>
<span class="fu">writeRaster</span><span class="op">(</span><span class="va">species_richness_future_deforest</span>,<span class="st">"~/Documents/projet_BioSceneMada/Report/data/species_richness_future_deforest.tif"</span>,format<span class="op">=</span><span class="st">"GTiff"</span>, options<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"COMPRESS=LZW"</span>, <span class="st">"PREDICTOR=2"</span><span class="op">)</span>, overwrite<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="Madagascar_files/figure-html/plot-species-richness-deforest-1.png" width="800" style="display: block; margin: auto;"><img src="Madagascar_files/figure-html/plot-species-richness-deforest-2.png" width="800" style="display: block; margin: auto;"></p>
</div>
<div id="absolute-current-species-richness" class="section level3">
<h3 class="hasAnchor">
<a href="#absolute-current-species-richness" class="anchor"></a><span class="header-section-number">7.1.4</span> Absolute current species richness</h3>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Absolute species richness </span>
<span class="co"># load occurence data</span>
<span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/PA.RData"</span><span class="op">)</span>
<span class="co"># load species and sites parameters</span>
<span class="va">params_species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/params_species.csv"</span><span class="op">)</span>
<span class="va">params_sites</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/params_sites.csv"</span><span class="op">)</span>
<span class="co">## inventory sites coordinates</span>
<span class="va">longlat</span> <span class="op">&lt;-</span> <span class="fu">SpatialPoints</span><span class="op">(</span><span class="va">params_sites</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"long"</span>,<span class="st">"lat"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="fu">proj4string</span><span class="op">(</span><span class="va">longlat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">CRS</span><span class="op">(</span><span class="st">"+proj=longlat +ellps=clrk66 +units=m"</span><span class="op">)</span>
<span class="co"># latlong to UTM38S projection </span>
<span class="va">xy</span> <span class="op">=</span> <span class="fu">spTransform</span><span class="op">(</span><span class="va">longlat</span>, <span class="fu">CRS</span><span class="op">(</span><span class="st">"+proj=utm +zone=38 +south +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0"</span><span class="op">)</span><span class="op">)</span>
<span class="co"># load RST interpolation of occurence probabilities</span>
<span class="va">RST_theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/stack.html">stack</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/RST_theta_1.tif"</span><span class="op">)</span>
<span class="va">theta_pred</span> <span class="op">&lt;-</span> <span class="fu">extract</span><span class="op">(</span><span class="va">RST_theta</span>,<span class="va">xy</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">n</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">npart</span><span class="op">)</span><span class="op">{</span>
<span class="va">RST_theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/stack.html">stack</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/RST_theta_"</span>, <span class="va">n</span>, <span class="st">".tif"</span><span class="op">)</span><span class="op">)</span>
<span class="va">theta_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">theta_pred</span>, <span class="fu">extract</span><span class="op">(</span><span class="va">RST_theta</span>,<span class="va">xy</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="co"># for each species we compute TSS for 100 threshold</span>
<span class="va">thresholds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,length.out<span class="op">=</span><span class="fl">100</span><span class="op">)</span>
<span class="va">TSS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">thresholds</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">PA</span><span class="op">)</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">PA</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="co"># occurrence probabilities are simply converted into presence-absence</span>
  <span class="co"># according to the threshold t</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">t</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">thresholds</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>obs<span class="op">=</span><span class="va">PA</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span>, pred<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">theta_pred</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">&gt;=</span><span class="va">thresholds</span><span class="op">[</span><span class="va">t</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
    <span class="co"># Confusion matrix</span>
    <span class="va">n00</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="st">"pred"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="st">"obs"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>
    <span class="va">n10</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="st">"pred"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="st">"obs"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>
    <span class="va">n01</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="st">"pred"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="st">"obs"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
    <span class="va">n11</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="st">"pred"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="st">"obs"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
    <span class="co"># Accuracy indices</span>
    <span class="va">Sensitivity</span> <span class="op">=</span> <span class="va">n11</span> <span class="op">/</span> <span class="op">(</span><span class="va">n11</span> <span class="op">+</span> <span class="va">n01</span><span class="op">)</span>
    <span class="va">Specificity</span> <span class="op">=</span> <span class="va">n00</span> <span class="op">/</span> <span class="op">(</span><span class="va">n00</span> <span class="op">+</span> <span class="va">n10</span><span class="op">)</span>
    <span class="co"># compute TSS </span>
    <span class="va">TSS</span><span class="op">[</span><span class="va">t</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Sensitivity</span> <span class="op">+</span> <span class="va">Specificity</span> <span class="op">-</span><span class="fl">1</span>  
  <span class="op">}</span>
<span class="op">}</span>
<span class="va">TSS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">TSS</span>, <span class="va">thresholds</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">TSS</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/make.names.html">make.names</a></span><span class="op">(</span><span class="va">params_species</span><span class="op">$</span><span class="va">species</span><span class="op">)</span>, <span class="st">"thresholds"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">TSS</span>, file <span class="op">=</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/TSS.csv"</span>,row.names <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>

<span class="co"># Convert occurrence probabilities into presence-absence</span>
<span class="co"># according to the threshold wich maximize TSS for each species</span>
<span class="va">TSS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/TSS.csv"</span><span class="op">)</span>
<span class="va">npart</span> <span class="op">&lt;-</span> <span class="fl">10</span> 
<span class="va">sp</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="kw">for</span><span class="op">(</span><span class="va">n</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">npart</span><span class="op">)</span><span class="op">{</span>
  <span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/stack.html">stack</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/RST_theta_"</span>, <span class="va">n</span>, <span class="st">".tif"</span><span class="op">)</span><span class="op">)</span>
  <span class="va">PA_fitted</span> <span class="op">&lt;-</span> <span class="va">theta</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu">nlayers</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">PA_fitted</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">theta</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span> <span class="op">&gt;=</span> <span class="va">thresholds</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span><span class="op">(</span><span class="va">TSS</span><span class="op">[</span>,<span class="va">sp</span><span class="op">]</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
    <span class="va">sp</span> <span class="op">&lt;-</span> <span class="va">sp</span><span class="op">+</span><span class="fl">1</span>
  <span class="op">}</span>
  <span class="fu">writeRaster</span><span class="op">(</span><span class="va">PA_fitted</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/PA_"</span>,<span class="va">n</span>, <span class="st">".tif"</span><span class="op">)</span>,
              datatype<span class="op">=</span><span class="st">"INT1U"</span>, format<span class="op">=</span><span class="st">"GTiff"</span>, options<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"COMPRESS=LZW"</span>, <span class="st">"PREDICTOR=2"</span><span class="op">)</span>,  overwrite<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># Compute absolute species richness </span>
<span class="va">PA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/stack.html">stack</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/PA_1.tif"</span><span class="op">)</span>
<span class="va">abs_species_richness</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">PA</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">n</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">npart</span><span class="op">)</span><span class="op">{</span>
<span class="va">PA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/stack.html">stack</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/PA_"</span>, <span class="va">n</span>, <span class="st">".tif"</span><span class="op">)</span><span class="op">)</span>
<span class="va">abs_species_richness</span> <span class="op">&lt;-</span> <span class="va">abs_species_richness</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">PA</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu">writeRaster</span><span class="op">(</span><span class="va">abs_species_richness</span>,<span class="st">"~/Documents/projet_BioSceneMada/Report/data/abs_species_richness.tif"</span>, datatype<span class="op">=</span><span class="st">"INT1U"</span>, format<span class="op">=</span><span class="st">"GTiff"</span>, options<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"COMPRESS=LZW"</span>, <span class="st">"PREDICTOR=2"</span><span class="op">)</span>,  overwrite<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidyverse/glue">glue</a></span><span class="op">)</span>
<span class="co"># raster of Madagascar's forest cover in 2000</span>
<span class="va">forest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/stack.html">stack</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/for2000.tif"</span><span class="op">)</span>
<span class="co"># change resolution of species richness rasters from 1000x1000m to 30x30m</span>
<span class="va">in_f</span> <span class="op">&lt;-</span> <span class="st">"~/Documents/projet_BioSceneMada/Report/data/abs_species_richness.tif"</span>
<span class="va">out_f</span> <span class="op">&lt;-</span> <span class="st">"~/Documents/projet_BioSceneMada/Report/data/abs_species_richness_30m.tif"</span>
<span class="va">cmd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">'gdalwarp -tr 30 30 -te {xmin(forest)} {ymin(forest)} {xmax(forest)} {ymax(forest)} -r near -co "COMPRESS=LZW" -co "PREDICTOR=2" -overwrite {in_f} {out_f}'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/system.html">system</a></span><span class="op">(</span><span class="va">cmd</span><span class="op">)</span>
<span class="va">in_f</span> <span class="op">&lt;-</span> <span class="st">"~/Documents/projet_BioSceneMada/Report/data/abs_species_richness.tif"</span>
<span class="va">out_f</span> <span class="op">&lt;-</span> <span class="st">"~/Documents/projet_BioSceneMada/Report/data/abs_species_richness_30m.tif"</span>
<span class="va">cmd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">'gdalwarp -tr 30 30 -te {xmin(forest)} {ymin(forest)} {xmax(forest)} {ymax(forest)} -r near -co "COMPRESS=LZW" -co "PREDICTOR=2" -overwrite {in_f} {out_f}'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/system.html">system</a></span><span class="op">(</span><span class="va">cmd</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="predictive-maps-of-species-turnover-diversity-beta" class="section level2">
<h2 class="hasAnchor">
<a href="#predictive-maps-of-species-turnover-diversity-beta" class="anchor"></a><span class="header-section-number">7.2</span> Predictive maps of species turnover (diversity <span class="math inline">\(\beta\)</span>)</h2>
<p>Diversity <span class="math inline">\(\beta\)</span> is a measure of biodiversity that compares the diversity of species between ecosystems or along environmental gradients, using the number of taxa that are unique to each ecosystem.</p>
<p>In order to estimate this indicator, we proceed in the same way as in the <span class="citation">Allnutt <em>et al.</em> (<a href="#ref-Allnutt2008" role="doc-biblioref">2008</a>)</span> article by performing a standard PCA on the interpolated probabilities of occurrence of species for each pixel of the displayed image. We use the coordinates obtained for the first three axes of the PCA that reflect the composition of the species community likely to occupy the corresponding pixel. These coordinates are scaled <span class="math inline">\([0.255]\)</span> so that they can be represented by red colour levels for the first axis, green for the second and blue for the third. The combination of these three colour levels determines the colouring of each pixel in the displayed <span class="math inline">\(\beta\)</span> diversity map. Therefore, a colour difference between two pixels indicates that the species present are not the same, while pixels of identical colour host communities of similar species.</p>
<div id="current-species-turn-over" class="section level3">
<h3 class="hasAnchor">
<a href="#current-species-turn-over" class="anchor"></a><span class="header-section-number">7.2.1</span> Current species turn-over</h3>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Sample 10000 cells of presence probabilities raster</span>
<span class="va">npart</span> <span class="op">&lt;-</span> <span class="fl">10</span>
<span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/stack.html">stack</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/RST_theta_1.tif"</span><span class="op">)</span>
<span class="va">samp_theta</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/sampleRandom.html">sampleRandom</a></span><span class="op">(</span><span class="va">theta</span>, size<span class="op">=</span><span class="fl">10000</span>, ext<span class="op">=</span><span class="fu">extent</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span>, cells<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="va">samp_cells</span> <span class="op">&lt;-</span> <span class="va">samp_theta</span><span class="op">[</span>,<span class="st">"cell"</span><span class="op">]</span>
<span class="va">samp_theta</span> <span class="op">&lt;-</span> <span class="va">samp_theta</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span>
<span class="kw">for</span><span class="op">(</span><span class="va">n</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">npart</span><span class="op">)</span><span class="op">{</span>
  <span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/stack.html">stack</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/RST_theta_"</span>, <span class="va">n</span>, <span class="st">".tif"</span><span class="op">)</span><span class="op">)</span>
  <span class="va">samp_theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">samp_theta</span>, <span class="va">theta</span><span class="op">[</span><span class="va">samp_cells</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">params_species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"~/Documents/projet_BioSceneMada/Report/data/params_species.csv"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">samp_theta</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">params_species</span><span class="op">$</span><span class="va">species</span>

<span class="co"># Dataframe to compute PCA on pixels dissimilarity </span>
<span class="va">theta_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">samp_theta</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">ade4</span><span class="op">)</span>
<span class="va">pca_theta</span> <span class="op">&lt;-</span> <span class="fu">dudi.pca</span><span class="op">(</span><span class="va">theta_df</span>, center<span class="op">=</span><span class="cn">TRUE</span>, scale<span class="op">=</span><span class="cn">TRUE</span>, nf<span class="op">=</span><span class="fl">3</span>, scannf <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span><span class="va">pca_theta</span>, <span class="va">samp_cells</span>, file<span class="op">=</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/PCA_theta.RData"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">pca_theta</span><span class="op">)</span>

<span class="co"># Perform projections of PCA results on all raster's rows</span>
<span class="co"># Coordinates on the 3 axes retained in the PCA</span>
<span class="va">coords</span> <span class="op">&lt;-</span> <span class="va">theta</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">]</span><span class="op">]</span>
<span class="fu">values</span><span class="op">(</span><span class="va">coords</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">0</span> 
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">coords</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">pca_theta</span><span class="op">$</span><span class="va">li</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/stack.html">stack</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/RST_theta_1.tif"</span><span class="op">)</span>
  <span class="va">theta_k</span> <span class="op">&lt;-</span> <span class="fu">getValues</span><span class="op">(</span><span class="va">theta</span>, row<span class="op">=</span><span class="va">k</span><span class="op">)</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">n</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">npart</span><span class="op">)</span><span class="op">{</span>
  <span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/stack.html">stack</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/RST_theta_"</span>, <span class="va">n</span>, <span class="st">".tif"</span><span class="op">)</span><span class="op">)</span>
  <span class="va">theta_k</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">theta_k</span>, <span class="fu">getValues</span><span class="op">(</span><span class="va">theta</span>, row<span class="op">=</span><span class="va">k</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">theta_k</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">params_species</span><span class="op">$</span><span class="va">species</span>
  <span class="va">theta_k</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">theta_k</span><span class="op">)</span>
  <span class="va">coords</span><span class="op">[</span><span class="va">k</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="fu">suprow</span><span class="op">(</span><span class="va">pca_theta</span>,<span class="va">theta_k</span><span class="op">)</span><span class="op">$</span><span class="va">lisup</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">k</span>,<span class="st">"/"</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> 
<span class="op">}</span>
<span class="fu">writeRaster</span><span class="op">(</span><span class="va">coords</span>,file<span class="op">=</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/coords.tif"</span>,
                format<span class="op">=</span><span class="st">"GTiff"</span>, options<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"COMPRESS=LZW"</span>, <span class="st">"PREDICTOR=2"</span><span class="op">)</span>, overwrite<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>

<span class="co"># Change the coordinate scale for [0.255]. </span>
<span class="co">## Min reduced to 0</span>
<span class="va">Min</span> <span class="op">&lt;-</span> <span class="fu">minValue</span><span class="op">(</span><span class="va">coords</span><span class="op">)</span>
<span class="va">Min</span>
<span class="va">coords_RGB</span> <span class="op">&lt;-</span> <span class="va">coords</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">l</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">coords_RGB</span><span class="op">[[</span><span class="va">l</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">coords</span><span class="op">[[</span><span class="va">l</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="va">Min</span><span class="op">[</span><span class="va">l</span><span class="op">]</span>
<span class="op">}</span>

<span class="va">Min2</span> <span class="op">&lt;-</span> <span class="fu">minValue</span><span class="op">(</span><span class="va">coords_RGB</span><span class="op">)</span>
<span class="va">Min2</span>
<span class="co">## Max at 255</span>
<span class="fu"><a href="https://rdrr.io/r/base/rm.html">remove</a></span><span class="op">(</span><span class="va">coords</span><span class="op">)</span>
<span class="va">Max</span> <span class="op">&lt;-</span> <span class="fu">maxValue</span><span class="op">(</span><span class="va">coords_RGB</span><span class="op">)</span>
<span class="va">Max</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">l</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">coords_RGB</span><span class="op">[[</span><span class="va">l</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">coords_RGB</span><span class="op">[[</span><span class="va">l</span><span class="op">]</span><span class="op">]</span> <span class="op">/</span> <span class="va">Max</span><span class="op">[</span><span class="va">l</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="fl">255</span>
<span class="op">}</span>
<span class="va">Max2</span> <span class="op">&lt;-</span> <span class="fu">maxValue</span><span class="op">(</span><span class="va">coords_RGB</span><span class="op">)</span>
<span class="va">Max2</span>

<span class="co"># Coloration RGB</span>
<span class="fu">writeRaster</span><span class="op">(</span><span class="va">coords_RGB</span>,file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/species_turnover.tif"</span><span class="op">)</span>,
                format<span class="op">=</span><span class="st">"GTiff"</span>, options<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"COMPRESS=LZW"</span>, <span class="st">"PREDICTOR=2"</span><span class="op">)</span>, overwrite<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
<div id="future-species-turn-over" class="section level3">
<h3 class="hasAnchor">
<a href="#future-species-turn-over" class="anchor"></a><span class="header-section-number">7.2.2</span> Future species turn-over</h3>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">npart</span> <span class="op">&lt;-</span> <span class="fl">10</span>
<span class="co"># load results of PCA on present probabilities of presences </span>
<span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span>file<span class="op">=</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/PCA_theta.RData"</span><span class="op">)</span>
<span class="va">params_species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"~/Documents/projet_BioSceneMada/Report/data/params_species.csv"</span><span class="op">)</span>
<span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/stack.html">stack</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/RST_theta_future_"</span>, <span class="fl">1</span>, <span class="st">".tif"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Perform projections of PCA results on all raster's rows</span>
<span class="co"># Coordinates on the 3 axes retained in the PCA</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">ade4</span><span class="op">)</span>
<span class="va">coords</span> <span class="op">&lt;-</span> <span class="va">theta</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">]</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">coords</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/make.names.html">make.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">pca_theta</span><span class="op">$</span><span class="va">li</span><span class="op">)</span><span class="op">)</span>
<span class="fu">values</span><span class="op">(</span><span class="va">coords</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">0</span> 
<span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/stack.html">stack</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/RST_theta_future_1.tif"</span><span class="op">)</span>
  <span class="va">theta_k</span> <span class="op">&lt;-</span> <span class="fu">getValues</span><span class="op">(</span><span class="va">theta</span>, row<span class="op">=</span><span class="va">k</span><span class="op">)</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">n</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">npart</span><span class="op">)</span><span class="op">{</span>
  <span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/stack.html">stack</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/RST_theta_future_"</span>, <span class="va">n</span>, <span class="st">".tif"</span><span class="op">)</span><span class="op">)</span>
  <span class="va">theta_k</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">theta_k</span>, <span class="fu">getValues</span><span class="op">(</span><span class="va">theta</span>, row<span class="op">=</span><span class="va">k</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">theta_k</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">params_species</span><span class="op">$</span><span class="va">species</span>
  <span class="va">theta_k</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">theta_k</span><span class="op">)</span>
  <span class="va">coords</span><span class="op">[</span><span class="va">k</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="fu">suprow</span><span class="op">(</span><span class="va">pca_theta</span>,<span class="va">theta_k</span><span class="op">)</span><span class="op">$</span><span class="va">lisup</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># Change the coordinate scale for [0.255]. </span>
<span class="co">## Min reduced to 0</span>
<span class="va">Min</span> <span class="op">&lt;-</span> <span class="fu">minValue</span><span class="op">(</span><span class="va">coords</span><span class="op">)</span>
<span class="va">Min</span>
<span class="va">coords_RGB</span> <span class="op">&lt;-</span> <span class="va">coords</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">l</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">coords_RGB</span><span class="op">[[</span><span class="va">l</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">coords</span><span class="op">[[</span><span class="va">l</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="va">Min</span><span class="op">[</span><span class="va">l</span><span class="op">]</span>
<span class="op">}</span>

<span class="va">Min2</span> <span class="op">&lt;-</span> <span class="fu">minValue</span><span class="op">(</span><span class="va">coords_RGB</span><span class="op">)</span>
<span class="va">Min2</span>
<span class="co">## Max at 255</span>
<span class="fu"><a href="https://rdrr.io/r/base/rm.html">remove</a></span><span class="op">(</span><span class="va">coords</span><span class="op">)</span>
<span class="va">Max</span> <span class="op">&lt;-</span> <span class="fu">maxValue</span><span class="op">(</span><span class="va">coords_RGB</span><span class="op">)</span>
<span class="va">Max</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">l</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">coords_RGB</span><span class="op">[[</span><span class="va">l</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">coords_RGB</span><span class="op">[[</span><span class="va">l</span><span class="op">]</span><span class="op">]</span> <span class="op">/</span> <span class="va">Max</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="fl">255</span>
<span class="op">}</span>
<span class="va">Max2</span> <span class="op">&lt;-</span> <span class="fu">maxValue</span><span class="op">(</span><span class="va">coords_RGB</span><span class="op">)</span>
<span class="va">Max2</span>

<span class="co"># Coloration RGB</span>
<span class="fu">writeRaster</span><span class="op">(</span><span class="va">coords_RGB</span>,file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/species_turnover_future.tif"</span><span class="op">)</span>,
                format<span class="op">=</span><span class="st">"GTiff"</span>, options<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"COMPRESS=LZW"</span>, <span class="st">"PREDICTOR=2"</span><span class="op">)</span>, overwrite<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
<div id="current-and-future-species-turn-over-restricted-to-forest-cover" class="section level3">
<h3 class="hasAnchor">
<a href="#current-and-future-species-turn-over-restricted-to-forest-cover" class="anchor"></a><span class="header-section-number">7.2.3</span> Current and future species turn over restricted to forest cover</h3>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidyverse/glue">glue</a></span><span class="op">)</span>
<span class="co"># raster of Madagascar's forest cover in 2000</span>
<span class="va">forest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/stack.html">stack</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/for2000.tif"</span><span class="op">)</span>
<span class="co"># current species turnover</span>
<span class="co"># change resolution of species richness rasters from 1000x1000m to 30x30m</span>
<span class="va">in_f</span> <span class="op">&lt;-</span> <span class="st">"~/Documents/projet_BioSceneMada/Report/data/species_turnover.tif"</span>
<span class="va">out_f</span> <span class="op">&lt;-</span> <span class="st">"~/Documents/projet_BioSceneMada/Report/data/species_turnover_30m.tif"</span>
<span class="va">cmd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">'gdalwarp -tr 30 30 -te {xmin(forest)} {ymin(forest)} {xmax(forest)} {ymax(forest)} -r near -co "COMPRESS=LZW" -co "PREDICTOR=2" -overwrite {in_f} {out_f}'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/system.html">system</a></span><span class="op">(</span><span class="va">cmd</span><span class="op">)</span>
<span class="co"># remove species richness values where there was no forest in 2000s</span>
<span class="va">species_turnover</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/stack.html">stack</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/species_turnover_30m.tif"</span><span class="op">)</span>
<span class="va">species_turnover_deforest</span> <span class="op">&lt;-</span> <span class="fu">mask</span><span class="op">(</span><span class="va">species_turnover</span>,<span class="va">forest</span><span class="op">)</span>
<span class="fu">writeRaster</span><span class="op">(</span><span class="va">species_turnover_deforest</span>,file<span class="op">=</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/species_turnover_deforest.tif"</span>,
                format<span class="op">=</span><span class="st">"GTiff"</span>, options<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"COMPRESS=LZW"</span>, <span class="st">"PREDICTOR=2"</span><span class="op">)</span>, overwrite<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="co"># future species turnover</span>
<span class="co"># change resolution of species richness rasters from 1000x1000m to 30x30m</span>
<span class="va">in_f</span> <span class="op">&lt;-</span> <span class="st">"~/Documents/projet_BioSceneMada/Report/data/species_turnover_future.tif"</span>
<span class="va">out_f</span> <span class="op">&lt;-</span> <span class="st">"~/Documents/projet_BioSceneMada/Report/data/species_turnover_future_30m.tif"</span>
<span class="va">cmd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">'gdalwarp -tr 30 30 -te {xmin(forest)} {ymin(forest)} {xmax(forest)} {ymax(forest)} -r near -co "COMPRESS=LZW" -co "PREDICTOR=2" -overwrite {in_f} {out_f}'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/system.html">system</a></span><span class="op">(</span><span class="va">cmd</span><span class="op">)</span>
<span class="co"># remove species richness values where there was no forest in 2000s</span>
<span class="va">species_turnover_future</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/stack.html">stack</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/species_turnover_future_30m.tif"</span><span class="op">)</span>
<span class="va">species_turnover_future_deforest</span> <span class="op">&lt;-</span> <span class="fu">mask</span><span class="op">(</span><span class="va">species_turnover_future</span>,<span class="va">forest</span><span class="op">)</span>
<span class="fu">writeRaster</span><span class="op">(</span><span class="va">species_turnover_future_deforest</span>,<span class="st">"~/Documents/projet_BioSceneMada/Report/data/species_turnover_future_deforest.tif"</span>,format<span class="op">=</span><span class="st">"GTiff"</span>, options<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"COMPRESS=LZW"</span>, <span class="st">"PREDICTOR=2"</span><span class="op">)</span>, overwrite<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Representation of species turn over </span>
<span class="va">species_turnover_current</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/stack.html">stack</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/species_turnover.tif"</span><span class="op">)</span>
<span class="va">species_turnover_future</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/stack.html">stack</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/species_turnover_future.tif"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="fu">plotRGB</span><span class="op">(</span><span class="va">species_turnover_current</span>, margins<span class="op">=</span><span class="cn">T</span>, stretch<span class="op">=</span><span class="st">"hist"</span>, main<span class="op">=</span><span class="st">"Estimated current species turn over"</span><span class="op">)</span>
<span class="fu">plotRGB</span><span class="op">(</span><span class="va">species_turnover_future</span>, margins<span class="op">=</span><span class="cn">T</span>, stretch<span class="op">=</span><span class="st">"hist"</span>, main<span class="op">=</span><span class="st">"Estimated future species turn over"</span><span class="op">)</span>

<span class="co"># Representation of species turn over restricted to forest cover in 2000's </span>
<span class="va">species_turnover_deforest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/stack.html">stack</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/species_turnover_deforest.tif"</span><span class="op">)</span>
<span class="va">species_turnover_future_deforest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/stack.html">stack</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Report/data/species_turnover_future_deforest.tif"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="fu">plotRGB</span><span class="op">(</span><span class="va">species_turnover_deforest</span>,margins<span class="op">=</span><span class="cn">T</span>, stretch<span class="op">=</span><span class="st">"hist"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/title.html">title</a></span><span class="op">(</span>main<span class="op">=</span><span class="st">"Current species turn over restricted to forest cover"</span>,cex.main<span class="op">=</span><span class="fl">0.85</span><span class="op">)</span>
<span class="fu">plotRGB</span><span class="op">(</span><span class="va">species_turnover_future_deforest</span>,margins<span class="op">=</span><span class="cn">T</span>, stretch<span class="op">=</span><span class="st">"hist"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/title.html">title</a></span><span class="op">(</span>main<span class="op">=</span><span class="st">"Future species turn over restricted to forest cover"</span>,cex.main<span class="op">=</span><span class="fl">0.85</span><span class="op">)</span></code></pre></div>
<p><img src="Madagascar_files/figure-html/plot-diversity-beta-1.png" width="800" style="display: block; margin: auto;"><img src="Madagascar_files/figure-html/plot-diversity-beta-2.png" width="800" style="display: block; margin: auto;"></p>
</div>
</div>
</div>
<div id="evolution-of-biodiversity-in-madagascar-under-climate-change" class="section level1">
<h1 class="hasAnchor">
<a href="#evolution-of-biodiversity-in-madagascar-under-climate-change" class="anchor"></a><span class="header-section-number">8</span> Evolution of biodiversity in Madagascar under climate change</h1>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-Albert1993">
<p>Albert, J.H. &amp; Siddhartha, C. (1993) Bayesian analysis of binary and polychotomous response data. <em>Journal of the American Statistical Association</em>, <strong>88</strong>, 669–679.</p>
</div>
<div id="ref-Allnutt2008">
<p>Allnutt, T.F., Ferrier, S., Manion, G., Powell, G.V.N., Ricketts, T.H., Fisher, B.L., Harper, G.J., Irwin, M.E., Kremen, C., Labat, J.-N., Lees, D.C., Pearce, T.A. &amp; Rakotondrainibe, F. (2008) A method for quantifying biodiversity loss and its application to a 50-year record of deforestation across Madagascar. <em>Conservation Letters</em>, <strong>1</strong>, 173–181.</p>
</div>
<div id="ref-Mitasova1993">
<p>Mitášová, H. &amp; Hofierka, J. (1993) Interpolation by regularized spline with tension: II. Application to terrain modeling and surface geometry analysis. <em>Mathematical Geology</em>, <strong>25</strong>, 657–669.</p>
</div>
<div id="ref-Riahi2007">
<p>Riahi, K., Grubler, A. &amp; Nakicenovic, N. (2007) Scenarios of long-term socio-economic and environmental development under climate stabilization. <em>Technological Forecasting and Social Change</em>, <strong>74</strong>, 887–935.</p>
</div>
<div id="ref-Vieilledent2013">
<p>Vieilledent, G., Cornu, C., Cuní Sanchez, A., Leong Pock-Tsy, J.-M. &amp; Danthu, P. (2013) Vulnerability of baobab species to climate change and effectiveness of the protected area network in Madagascar: Towards new conservation priorities. <em>Biological Conservation</em>, <strong>166</strong>, 11–22.</p>
</div>
<div id="ref-Warton2015">
<p>Warton, D.I., Blanchet, F.G., O’Hara, R.B., Ovaskainen, O., Taskinen, S., Walker, S.C. &amp; Hui, F.K.C. (2015) So many variables: Joint modeling in community ecology. <em>Trends in Ecology &amp; Evolution</em>, <strong>30</strong>, 766–779.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jeanne Clément, <a href="https://ecology.ghislainv.fr">Ghislain Vieilledent</a>, <a href="https://www.cirad.fr"><img src="https://ecology.ghislainv.fr/images/logos/logo-cirad.svg" height="24"></a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>

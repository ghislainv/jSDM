<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Estimation of Madagascar's plant biodiversity • jSDM</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Estimation of Madagascar's plant biodiversity">
<meta property="og:description" content="jSDM">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">jSDM</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/jSDM.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Change log</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ghislainv/jSDM" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Estimation of Madagascar’s plant biodiversity</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ghislainv/jSDM/blob/HEAD/vignettes/Madagascar.Rmd" class="external-link"><code>vignettes/Madagascar.Rmd</code></a></small>
      <div class="hidden name"><code>Madagascar.Rmd</code></div>

    </div>

    
    
<p>We want to identify biodiversity refuge zones in Madagascar</p>
<div class="section level2" number="1">
<h2 id="load-librairies">
<span class="header-section-number">1</span> Load librairies<a class="anchor" aria-label="anchor" href="#load-librairies"></a>
</h2>
</div>
<div class="section level2" number="2">
<h2 id="datasets">
<span class="header-section-number">2</span> Datasets<a class="anchor" aria-label="anchor" href="#datasets"></a>
</h2>
<div class="section level3" number="2.1">
<h3 id="forest-inventory">
<span class="header-section-number">2.1</span> Forest inventory<a class="anchor" aria-label="anchor" href="#forest-inventory"></a>
</h3>
<p>National forest inventories carried out on <span class="math inline">\(753\)</span> sites on the island of Madagascar are available, listing the presence or absence of <span class="math inline">\(555\)</span> plant species on each of these sites between 1994 and 1996.
We use these forest inventories to calculate a matrix indicating the presence by a <span class="math inline">\(1\)</span> and the absence by a <span class="math inline">\(0\)</span> of the species at each site by removing observations for which the species is not identified. This matrix therefore records the occurrences of <span class="math inline">\(483\)</span> species at <span class="math inline">\(751\)</span> sites.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># forest inventory</span></span>
<span><span class="va">trees</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/forest_inventory_Madagascar.csv"</span><span class="op">)</span></span>
<span><span class="va">trees</span> <span class="op">&lt;-</span> <span class="va">trees</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">trees</span><span class="op">$</span><span class="va">sp</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">trees</span><span class="op">$</span><span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">trees</span><span class="op">$</span><span class="va">plot</span><span class="op">)</span></span>
<span><span class="va">plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">trees</span><span class="op">$</span><span class="va">plot</span><span class="op">)</span></span>
<span><span class="va">nplot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">plots</span><span class="op">)</span></span>
<span><span class="va">sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">trees</span><span class="op">$</span><span class="va">taxize</span><span class="op">)</span></span>
<span><span class="va">nsp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sp</span><span class="op">)</span></span>
<span><span class="co"># presence/absence of each species on each plot</span></span>
<span><span class="va">nplot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">trees</span><span class="op">$</span><span class="va">plot</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">trees</span><span class="op">$</span><span class="va">taxize</span><span class="op">)</span></span>
<span><span class="va">nsp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span></span>
<span><span class="co"># presence/absence of each species on each plot</span></span>
<span><span class="va">PA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">nplot</span>, <span class="va">nsp</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">PA</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">trees</span><span class="op">$</span><span class="va">plot</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">PA</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"sp_"</span>, <span class="fl">1</span><span class="op">:</span><span class="va">nsp</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nplot</span><span class="op">)</span><span class="op">{</span>    </span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nsp</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">trees</span><span class="op">$</span><span class="va">taxize</span> <span class="op">==</span> <span class="va">species</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">PA</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">trees</span><span class="op">$</span><span class="va">plot</span><span class="op">[</span><span class="va">idx</span><span class="op">]</span><span class="op">)</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> </span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">madagascar</span> <span class="op">&lt;-</span> <span class="va">PA</span></span>
<span><span class="co"># save presence/absence at inventory sites matrix</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">madagascar</span>, file<span class="op">=</span><span class="st">"~/Documents/jSDM/data/madagascar.rda"</span><span class="op">)</span></span></code></pre></div>
<p>We represent the presence-absence matrix obtained for the twenty first species.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">oldwd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">madagascar</span>, package<span class="op">=</span><span class="st">"jSDM"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">madagascar</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;   sp_1 sp_2 sp_3 sp_4 sp_5 sp_6 sp_7 sp_8 sp_9 sp_10 sp_11 sp_12 sp_13 sp_14</span></span>
<span><span class="co">#&gt; 1    0    0    0    0    0    0    0    0    0     0     0     0     0     0</span></span>
<span><span class="co">#&gt; 2    0    0    0    0    0    1    0    0    0     0     0     0     0     0</span></span>
<span><span class="co">#&gt; 3    0    0    0    0    0    0    0    0    1     0     0     0     0     0</span></span>
<span><span class="co">#&gt; 4    0    0    0    0    0    0    0    0    0     0     0     0     0     0</span></span>
<span><span class="co">#&gt; 5    0    0    0    0    0    0    0    0    0     0     0     0     0     0</span></span>
<span><span class="co">#&gt; 6    0    0    0    1    0    0    0    0    0     0     0     0     0     1</span></span>
<span><span class="co">#&gt;   sp_15 sp_16 sp_17 sp_18 sp_19 sp_20</span></span>
<span><span class="co">#&gt; 1     0     0     0     0     0     0</span></span>
<span><span class="co">#&gt; 2     0     0     0     0     0     0</span></span>
<span><span class="co">#&gt; 3     0     0     0     0     0     0</span></span>
<span><span class="co">#&gt; 4     0     0     0     0     0     0</span></span>
<span><span class="co">#&gt; 5     0     0     0     0     0     0</span></span>
<span><span class="co">#&gt; 6     0     0     0     0     0     0</span></span></code></pre></div>
</div>
<div class="section level3" number="2.2">
<h3 id="current-environmental-variables">
<span class="header-section-number">2.2</span> Current environmental variables<a class="anchor" aria-label="anchor" href="#current-environmental-variables"></a>
</h3>
<p>We use the function <a href="https://ecology.ghislainv.fr/gecevar/reference/get_chelsa_current.html" class="external-link"><code>get_chelsa_current</code></a> from the R package <a href="https://ecology.ghislainv.fr/gecevar" class="external-link"><code>gecevar</code></a> to download a set of climatic data for Madagascar Island from the website: .</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gecevar</span><span class="op">)</span></span>
<span><span class="va">name</span> <span class="op">&lt;-</span> <span class="st">"Madagascar"</span></span>
<span><span class="va">epsg</span> <span class="op">&lt;-</span> <span class="fl">32738</span></span>
<span><span class="va">output_file</span> <span class="op">&lt;-</span> <span class="st">"/home/clement/Documents/projet_BioSceneMada/Internship_Report/data"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="st">"/home/clement/Documents/jSDM/vignettes/Madagascar_files/"</span><span class="op">)</span></span>
<span><span class="co"># Get Madagascar extent in the specified coordinates system (EPSG)</span></span>
<span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu">transform_shp_country_extent</span><span class="op">(</span>EPSG <span class="op">=</span> <span class="va">epsg</span>,</span>
<span>                                       country_name <span class="op">=</span> <span class="va">name</span>, </span>
<span>                                       rm_download<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">output</span>, file<span class="op">=</span><span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/output.RData"</span><span class="op">)</span></span>
<span><span class="va">extent</span> <span class="op">&lt;-</span> <span class="va">output</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">extent_latlon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">output</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">clim_path</span> <span class="op">&lt;-</span> <span class="fu">get_chelsa_current</span><span class="op">(</span>extent_latlon <span class="op">=</span> <span class="va">extent_latlon</span>,</span>
<span>                                extent <span class="op">=</span> <span class="va">extent</span>,</span>
<span>                                EPSG <span class="op">=</span> <span class="va">epsg</span>,</span>
<span>                                destination <span class="op">=</span> <span class="va">output_file</span>,</span>
<span>                                resolution <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                                rm_download <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<table class="table table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:clim-data-table">Table 2.1: </span>Climate data downloaded from <a href="https://chelsa-climate.org/" class="external-link uri">https://chelsa-climate.org/</a>
</caption>
<thead><tr>
<th style="text-align:left;">
Variable
</th>
<th style="text-align:left;">
Unit
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Minimum monthly temperatures
</td>
<td style="text-align:left;">
°C x 10
</td>
</tr>
<tr>
<td style="text-align:left;">
Maximum monthly temperatures
</td>
<td style="text-align:left;">
°C x 10
</td>
</tr>
<tr>
<td style="text-align:left;">
Average monthly temperatures
</td>
<td style="text-align:left;">
°C x 10
</td>
</tr>
<tr>
<td style="text-align:left;">
Monthly precipitation
</td>
<td style="text-align:left;">
<span class="math inline">\(kg.m^{-2}.month^-1\)</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
Cloud cover
</td>
<td style="text-align:left;">
%
</td>
</tr>
<tr>
<td style="text-align:left;">
Climatic water deficit (Thornthwaite)
</td>
<td style="text-align:left;">
<span class="math inline">\(kg.m^{-2}\)</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
Potential evapotranspiration (Thornthwaite)
</td>
<td style="text-align:left;">
<span class="math inline">\(kg.m^{-2}.month^-1\)</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of dry months (Thornthwaite)
</td>
<td style="text-align:left;">
months
</td>
</tr>
<tr>
<td style="text-align:left;">
Climatic water deficit (Penman-Monteith)
</td>
<td style="text-align:left;">
<span class="math inline">\(kg.m^{-2}\)</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
Potential evapotranspiration (Penman-Monteith)
</td>
<td style="text-align:left;">
<span class="math inline">\(kg.m^{-2}.month^-1\)</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of dry months (Penman-Monteith)
</td>
<td style="text-align:left;">
months
</td>
</tr>
<tr>
<td style="text-align:left;">
Annual mean temperature (bio1 or temp)
</td>
<td style="text-align:left;">
°C x 10
</td>
</tr>
<tr>
<td style="text-align:left;">
Diurnal temperature range (bio2)
</td>
<td style="text-align:left;">
°C x 10
</td>
</tr>
<tr>
<td style="text-align:left;">
Isothermality (bio3=bio2/bio7)
</td>
<td style="text-align:left;">
°C x 10
</td>
</tr>
<tr>
<td style="text-align:left;">
Seasonality of temperatures (bio4 or sais_temp)
</td>
<td style="text-align:left;">
°C x 10
</td>
</tr>
<tr>
<td style="text-align:left;">
Maximum temperature of the warmest month (bio5)
</td>
<td style="text-align:left;">
°C x 10
</td>
</tr>
<tr>
<td style="text-align:left;">
Minimum temperature of the coldest month (bio6)
</td>
<td style="text-align:left;">
°C x 10
</td>
</tr>
<tr>
<td style="text-align:left;">
Annual temperature range (bio7=bio5-bio6)
</td>
<td style="text-align:left;">
°C x 10
</td>
</tr>
<tr>
<td style="text-align:left;">
Average temperature of the wettest quarter (bio8)
</td>
<td style="text-align:left;">
°C x 10
</td>
</tr>
<tr>
<td style="text-align:left;">
Average temperature of the driest quarter (bio9)
</td>
<td style="text-align:left;">
°C x 10
</td>
</tr>
<tr>
<td style="text-align:left;">
Average temperature of the warmest quarter (bio10)
</td>
<td style="text-align:left;">
°C x 10
</td>
</tr>
<tr>
<td style="text-align:left;">
Average temperature of the coldest quarter (bio11)
</td>
<td style="text-align:left;">
°C x 10
</td>
</tr>
<tr>
<td style="text-align:left;">
Cumulative annual precipitation (bio12 or prec)
</td>
<td style="text-align:left;">
<span class="math inline">\(kg.m^{-2}.year^{-1}\)</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
Cumulative precipitation of wettest month (bio13)
</td>
<td style="text-align:left;">
<span class="math inline">\(kg.m^{-2}.month^{-1}\)</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
Cumulative precipitation of the driest month (bio14)
</td>
<td style="text-align:left;">
<span class="math inline">\(kg.m^{-2}.month^{-1}\)</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
Seasonality of rainfall (bio15 or sais_prec)
</td>
<td style="text-align:left;">
<span class="math inline">\(kg.m^{-2}\)</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
Precipitation in wettest quarter (bio16)
</td>
<td style="text-align:left;">
<span class="math inline">\(kg.m^{-2}.month^{-1}\)</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
Precipitation of driest quarter (bio17)
</td>
<td style="text-align:left;">
<span class="math inline">\(kg.m^{-2}.month^{-1}\)</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
Warmest quarter precipitation (bio18)
</td>
<td style="text-align:left;">
<span class="math inline">\(kg.m^{-2}.month^{-1}\)</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
Coldest quarter precipitation (bio19)
</td>
<td style="text-align:left;">
<span class="math inline">\(kg.m^{-2}.month^{-1}\)</span>
</td>
</tr>
</tbody>
</table>
<p>Among the climatic data downloaded, concerning the whole island of Madagascar at present (interpolations of representative observed data from the years 1960-1990).
We choose to use the following variables because they have an ecological meaning which makes them easily interpretable and are little correlated between them according to the article <span class="citation">Vieilledent <em>et al.</em> (<a href="#ref-Vieilledent2013" role="doc-biblioref">2013</a>)</span> :</p>
<ul>
<li>
<strong>temp</strong>: the average annual temperature (<span class="math inline">\(^\circ C\times 10\)</span>).</li>
<li>
<strong>prec</strong>: the average annual precipitation (mm).</li>
<li>
<strong>sais_temp</strong>: the seasonality of temperatures corresponds to the standard deviation of monthly temperatures multiplied by <span class="math inline">\(100\)</span>.</li>
<li>
<strong>sais_prec</strong>: the seasonality of precipitation as a coefficient of variation.</li>
<li>
<strong>cwd</strong>: the annual climatic water deficit (mm) is based on monthly precipitation (<span class="math inline">\(prec\)</span>) and potential evapotranspiration (<span class="math inline">\(pet\)</span>) which is defined as the amount of evaporation that would occur in a month if a sufficient water source were available: <span class="math inline">\(\mathrm{cwd}= \sum_{m=1}^{12}\min(0, \ \mathrm{prec}_m-\ \mathrm{pet}_m)\)</span>.</li>
</ul>
<p>We consider also the quadratic effects of these climate variables to perform a quadratic regression, which is more suitable for fitting a niche model than a linear regression.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span>file<span class="op">=</span><span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/output.RData"</span><span class="op">)</span></span>
<span><span class="va">clim_path</span> <span class="op">&lt;-</span> <span class="st">"/home/clement/Documents/projet_BioSceneMada/Internship_Report/data/data_raw/current_chelsa.tif"</span></span>
<span><span class="co"># get interesting covariates among the climatic variables downloaded  </span></span>
<span><span class="va">clim_var</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">clim_path</span>,</span>
<span>                        lyrs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio1"</span>, <span class="st">"bio4"</span>, <span class="st">"bio12"</span>, <span class="st">"bio15"</span>, <span class="st">"cwd_penman"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">clim_var</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"temp"</span>, <span class="st">"sais_temp"</span>, <span class="st">"prec"</span>, <span class="st">"sais_prec"</span>, <span class="st">"cwd"</span><span class="op">)</span></span>
<span><span class="va">proj</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">clim_var</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Data restricted to Madagascar's borders</span></span>
<span><span class="va">borders</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">output</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, layer<span class="op">=</span><span class="st">"gadm36_MDG_0"</span><span class="op">)</span></span>
<span><span class="va">borders</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/project.html" class="external-link">project</a></span><span class="op">(</span><span class="va">borders</span>, <span class="va">proj</span><span class="op">)</span></span>
<span><span class="va">clim_var_mada</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/mask.html" class="external-link">mask</a></span><span class="op">(</span><span class="va">clim_var</span>, <span class="va">borders</span><span class="op">)</span></span>
<span><span class="co"># representation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>oma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">clim_var_mada</span>, legend<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Current bioclimatic variables"</span>, outer<span class="op">=</span><span class="cn">TRUE</span>, cex<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># spatial points of each plot</span></span>
<span><span class="va">coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">trees</span><span class="op">$</span><span class="va">long</span>,<span class="va">trees</span><span class="op">$</span><span class="va">lat</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">trees</span><span class="op">$</span><span class="va">plot</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">coords</span> <span class="op">&lt;-</span> <span class="va">coords</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">coords</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span>, index.return<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">$</span><span class="va">ix</span>,<span class="op">]</span></span>
<span><span class="va">longlat</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">coords</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, crs<span class="op">=</span><span class="st">"+proj=longlat +ellps=clrk66"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># lat long to UTM38S projection </span></span>
<span><span class="va">xy</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/project.html" class="external-link">project</a></span><span class="op">(</span><span class="va">longlat</span>, <span class="va">proj</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/writeVector.html" class="external-link">writeVector</a></span><span class="op">(</span><span class="va">xy</span>, overwrite<span class="op">=</span><span class="cn">TRUE</span>, </span>
<span>                   <span class="st">"/home/clement/Documents/projet_BioSceneMada/Internship_Report/data/coords.shp"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add squared data</span></span>
<span><span class="va">clim_var2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">clim_var_mada</span>, <span class="va">clim_var_mada</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">clim_var2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">clim_var</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">clim_var</span><span class="op">)</span>,</span>
<span>                                              <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"2"</span>, <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">clim_var</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># extract climatic data on each plot</span></span>
<span><span class="va">clim2</span> <span class="op">&lt;-</span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/extract.html" class="external-link">extract</a></span><span class="op">(</span><span class="va">clim_var2</span>,<span class="va">xy</span><span class="op">)</span></span>
<span><span class="va">pos</span> <span class="op">&lt;-</span> <span class="va">coords</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">pos</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"long"</span>,<span class="st">"lat"</span>,<span class="st">"site"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add squared data</span></span>
<span><span class="va">data_clim2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">clim2</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span>,<span class="va">pos</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">nparam</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">data_clim2</span><span class="op">)</span> <span class="op">-</span><span class="fl">3</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># reduced centered data</span></span>
<span><span class="va">scaled_data_clim2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">data_clim2</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="va">nparam</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">means</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">scaled_data_clim2</span>,<span class="st">"scaled:center"</span><span class="op">)</span></span>
<span><span class="va">sds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">scaled_data_clim2</span>,<span class="st">"scaled:scale"</span><span class="op">)</span></span>
<span><span class="va">scaled_data_clim2</span> <span class="op">&lt;-</span> <span class="fu">as_tibble</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>site<span class="op">=</span><span class="va">data_clim2</span><span class="op">$</span><span class="va">site</span>,</span>
<span>                                     <span class="va">scaled_data_clim2</span>,</span>
<span>                                     lat<span class="op">=</span><span class="va">data_clim2</span><span class="op">$</span><span class="va">lat</span>, </span>
<span>                                     long<span class="op">=</span><span class="va">data_clim2</span><span class="op">$</span><span class="va">long</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Design matrix</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>intercept<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">nplot</span><span class="op">)</span>,</span>
<span>                <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">scaled_data_clim2</span>,<span class="op">-</span><span class="va">lat</span>,<span class="op">-</span><span class="va">long</span>, <span class="op">-</span><span class="va">site</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">np</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">X</span>, file <span class="op">=</span> <span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/X.csv"</span>,</span>
<span>          row.names <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># save climatic data at inventory sites</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">scaled_data_clim2</span>, <span class="va">means</span>, <span class="va">sds</span>,</span>
<span>     file<span class="op">=</span><span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/scaled_data_clim.RData"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># save raster in .tif format</span></span>
<span><span class="co"># Center and reduce climatic variables </span></span>
<span><span class="co"># using means and standard deviations of climatic variables at inventory sites</span></span>
<span><span class="va">scaled_clim_var</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">clim_var2</span><span class="op">-</span><span class="va">means</span><span class="op">)</span><span class="op">/</span><span class="va">sds</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">scaled_clim_var</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">clim_var2</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/writeRaster.html" class="external-link">writeRaster</a></span><span class="op">(</span><span class="va">scaled_clim_var</span>,</span>
<span>                   <span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/scaled_clim.tif"</span>,</span>
<span>                   gdal<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"COMPRESS=LZW"</span>, <span class="st">"PREDICTOR=2"</span><span class="op">)</span>, overwrite<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="Madagascar_files/figure-html/current-environmental-variables-1.png" width="800" style="display: block; margin: auto;"></p>
<p>The values of these climate variables corresponding to the coordinates of the inventory plots are extracted and scaled to obtain the following data-set where coordinates of the sites will then be used for spatial interpolation and to spatially represent the results.</p>
<p><img src="Madagascar_files/scaled_data_clim.png" width="900" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2" number="3">
<h2 id="fitting-joint-species-distribution-model-jsdm">
<span class="header-section-number">3</span> Fitting joint species distribution model (JSDM)<a class="anchor" aria-label="anchor" href="#fitting-joint-species-distribution-model-jsdm"></a>
</h2>
<div class="section level3" number="3.1">
<h3 id="model-definition">
<span class="header-section-number">3.1</span> Model definition<a class="anchor" aria-label="anchor" href="#model-definition"></a>
</h3>
<p>Referring to the models used in the articles <span class="citation">Warton <em>et al.</em> (<a href="#ref-Warton2015" role="doc-biblioref">2015</a>)</span> and <span class="citation">Albert &amp; Siddhartha (<a href="#ref-Albert1993" role="doc-biblioref">1993</a>)</span>, we define the following latent variable model (LVM) to account for species co-occurrence on all sites :</p>
<p><span class="math display">\[ \mathrm{probit}(\theta_{ij}) =\alpha_i + \beta_{0j}+X_i.\beta_j+ W_i.\lambda_j \]</span></p>
<ul>
<li><p>Link function probit: <span class="math inline">\(\mathrm{probit}: q \rightarrow \Phi^{-1}(q)\)</span> where <span class="math inline">\(\Phi\)</span> correspond to the distribution function of the reduced centered normal distribution.</p></li>
<li><p>Response variable: <span class="math inline">\(Y=(y_{ij})^{i=1,\ldots, n_{site}}_{j=1,\ldots,n_{species}}\)</span> with:</p></li>
</ul>
<p><span class="math display">\[y_{ij}=\begin{cases}
0 &amp; \text{ if species $j$ is absent on the site $i$}\\
1 &amp;  \text{ if species  $j$ is present on the site $i$}.
\end{cases}\]</span></p>
<ul>
<li>Latent variable <span class="math inline">\(z_{ij} = \alpha_i + \beta_{0j} + X_i.\beta_j + W_i.\lambda_j + \epsilon_{i,j}\)</span>, with <span class="math inline">\(\forall (i,j) \ \epsilon_{ij} \sim \mathcal{N}(0,1)\)</span> and such that:</li>
</ul>
<p><span class="math display">\[y_{ij}=\begin{cases}
1 &amp; \text{if} \ z_{ij} &gt; 0 \\
0 &amp;  \text{otherwise.}
\end{cases}\]</span></p>
<p>It can be easily shown that: <span class="math inline">\(y_{ij} \sim \mathcal{B}ernoulli(\theta_{ij})\)</span>.</p>
<ul>
<li><p>Latent variables: <span class="math inline">\(W_i=(W_i^1,\ldots,W_i^q)\)</span> where <span class="math inline">\(q\)</span> is the number of latent variables considered, which has to be fixed by the user (by default <span class="math inline">\(q=2\)</span>).
We assume that <span class="math inline">\(W_i \sim \mathcal{N}(0,I_q)\)</span> and we define the associated coefficients <span class="math inline">\(\lambda_j=(\lambda_j^1,\ldots, \lambda_j^q)'\)</span>, also known as “factor loadings” <span class="citation">(<a href="#ref-Warton2015" role="doc-biblioref">Warton <em>et al.</em> 2015</a>)</span>. We use a prior distribution <span class="math inline">\(\mathcal{N}(0,1)\)</span> for all lambda not concerned by constraints to <span class="math inline">\(0\)</span> on upper diagonal and to strictly positive values on diagonal.</p></li>
<li><p>Explanatory variables: bioclimatic data about each site. <span class="math inline">\(X=(X_i)_{i=1,\ldots,n_{site}}\)</span> with <span class="math inline">\(X_i=(x_i^1,\ldots,x_i^p)\in \mathbb{R}^p\)</span> where <span class="math inline">\(p\)</span> is the number of bioclimatic variables considered.
The corresponding regression coefficients for each species <span class="math inline">\(j\)</span> are noted : <span class="math inline">\(\beta_j=(\beta_j^1,\ldots,\beta_j^p)'\)</span>. We use a prior distribution <span class="math inline">\(\mathcal{N}(0,1)\)</span> for all beta.</p></li>
<li><p><span class="math inline">\(\beta_{0j}\)</span> correspond to the intercept for species <span class="math inline">\(j\)</span> which is assumed to be a fixed effect. We use a prior distribution <span class="math inline">\(\mathcal{N}(0,10)\)</span> for the species intercept.</p></li>
<li><p><span class="math inline">\(\alpha_i\)</span> represents the random effect of site <span class="math inline">\(i\)</span> such as <span class="math inline">\(\alpha_i \sim \mathcal{N}(0,V_{\alpha})\)</span> and we assume that <span class="math inline">\(V_{\alpha} \sim \mathcal {IG}(\text{shape}=0.1, \text{rate}=0.1)\)</span> as prior distribution by default.</p></li>
</ul>
<p>This model is equivalent to a multivariate GLMM <span class="math inline">\(\mathrm{g}(\theta_{ij}) = \alpha_i + X_i.\beta_j + u_{ij}\)</span>, where <span class="math inline">\(u_{ij} \sim \mathcal{N}(0, \Sigma)\)</span> with the constraint that the variance-covariance matrix <span class="math inline">\(\Sigma = \Lambda \Lambda^{\prime}\)</span>, where <span class="math inline">\(\Lambda\)</span> is the full matrix of factor loadings, with the <span class="math inline">\(\lambda_j\)</span> as its columns.</p>
</div>
<div class="section level3" number="3.2">
<h3 id="parameters-inference">
<span class="header-section-number">3.2</span> Parameters inference<a class="anchor" aria-label="anchor" href="#parameters-inference"></a>
</h3>
<p>We fit a binomial joint species distribution model, including two latent variables and random site effect using the <code><a href="../reference/jSDM_binomial_probit.html">jSDM_binomial_probit()</a></code> function to perform binomial probit regression considering all the species from the data described above, by performing <span class="math inline">\(80 000\)</span> iterations including <span class="math inline">\(40 000\)</span> of burn-in and we retain <span class="math inline">\(N_{samp}=1 000\)</span> values for each parameter of the model.
We use species’s prevalence as starting values for species intercept <span class="math inline">\(\beta_0\)</span>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/scaled_data_clim.RData"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">madagascar</span>, package<span class="op">=</span><span class="st">"jSDM"</span><span class="op">)</span></span>
<span><span class="va">PA</span> <span class="op">&lt;-</span> <span class="va">madagascar</span></span>
<span><span class="co"># Prevalence of species </span></span>
<span><span class="va">np</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">scaled_data_clim2</span>, <span class="op">-</span><span class="va">site</span>, <span class="op">-</span><span class="va">lat</span>, <span class="op">-</span><span class="va">long</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span><span class="fl">1</span></span>
<span><span class="va">prevalence</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">PA</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">PA</span><span class="op">)</span></span>
<span><span class="va">beta_start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">np</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">PA</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">beta_start</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="va">prevalence</span><span class="op">)</span></span>
<span><span class="co"># </span></span>
<span><span class="va">T1</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">mod_all</span> <span class="op">&lt;-</span> <span class="fu">jSDM</span><span class="fu">::</span><span class="fu"><a href="../reference/jSDM_binomial_probit.html">jSDM_binomial_probit</a></span><span class="op">(</span></span>
<span>  <span class="co"># Response variable </span></span>
<span>  presence_data <span class="op">=</span> <span class="va">PA</span>, </span>
<span>  <span class="co"># Explanatory variables </span></span>
<span>  site_formula <span class="op">=</span> <span class="op">~</span> <span class="va">temp</span> <span class="op">+</span> <span class="va">prec</span> <span class="op">+</span> <span class="va">sais_temp</span> <span class="op">+</span> <span class="va">sais_prec</span> <span class="op">+</span> <span class="va">cwd</span> <span class="op">+</span> <span class="va">temp2</span> <span class="op">+</span> <span class="va">prec2</span> <span class="op">+</span> <span class="va">sais_temp2</span> <span class="op">+</span> <span class="va">sais_prec2</span> <span class="op">+</span> <span class="va">cwd2</span>,   </span>
<span>  site_data<span class="op">=</span><span class="va">scaled_data_clim2</span>, </span>
<span>  n_latent<span class="op">=</span><span class="fl">2</span>,</span>
<span>  site_effect<span class="op">=</span><span class="st">"random"</span>, </span>
<span>  <span class="co"># Chains</span></span>
<span>  burnin<span class="op">=</span> <span class="fl">40000</span>, mcmc<span class="op">=</span><span class="fl">40000</span>, thin<span class="op">=</span><span class="fl">40</span>,</span>
<span>  <span class="co"># Starting values</span></span>
<span>  alpha_start<span class="op">=</span><span class="fl">0</span>, beta_start<span class="op">=</span><span class="va">beta_start</span>,</span>
<span>  lambda_start<span class="op">=</span><span class="fl">0</span>, W_start<span class="op">=</span><span class="fl">0</span>,</span>
<span>  V_alpha<span class="op">=</span><span class="fl">1</span>, </span>
<span>  <span class="co"># Priors</span></span>
<span>  shape_Valpha<span class="op">=</span><span class="fl">0.1</span>,</span>
<span>  rate_Valpha<span class="op">=</span><span class="fl">0.1</span>,</span>
<span>  mu_beta<span class="op">=</span><span class="fl">0</span>, V_beta<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">np</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  mu_lambda<span class="op">=</span><span class="fl">0</span>, V_lambda<span class="op">=</span><span class="fl">1</span>,</span>
<span>  <span class="co"># Various </span></span>
<span>  seed<span class="op">=</span><span class="fl">1234</span>, verbose<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">T2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">T_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">T2</span>,<span class="va">T1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">mod_all</span>,<span class="va">T_all</span>,file<span class="op">=</span><span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/mada_mod.RData"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Madagascar_files/mod_mada.png" width="900" style="display: block; margin: auto;"></p>
<p>The MCMC algorithm is used to obtain draws from the posterior distribution of the parameters. We use as estimator for each parameter the mean of the <span class="math inline">\(N_{samp}\)</span> values estimated in corresponding MCMC chain and we save the estimated parameters in .csv format.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/mada_mod.RData"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/scaled_data_clim.RData"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">model_spec</span><span class="op">$</span><span class="va">presence_data</span><span class="op">)</span></span>
<span><span class="va">nplot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">model_spec</span><span class="op">$</span><span class="va">presence_data</span><span class="op">)</span></span>
<span><span class="va">nsp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">model_spec</span><span class="op">$</span><span class="va">presence_data</span><span class="op">)</span></span>
<span><span class="va">n_latent</span> <span class="op">&lt;-</span> <span class="va">mod_all</span><span class="op">$</span><span class="va">model_spec</span><span class="op">$</span><span class="va">n_latent</span></span>
<span><span class="va">np</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">model_spec</span><span class="op">$</span><span class="va">beta_start</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Save parameters </span></span>
<span><span class="co">### alphas</span></span>
<span><span class="va">alphas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.alpha</span>,<span class="fl">2</span>,<span class="va">mean</span><span class="op">)</span></span>
<span><span class="co">### V_alpha</span></span>
<span><span class="va">V_alpha</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.V_alpha</span><span class="op">)</span></span>
<span><span class="co">### latent variables </span></span>
<span><span class="va">W1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.latent</span><span class="op">[[</span><span class="st">"lv_1"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">W2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.latent</span><span class="op">[[</span><span class="st">"lv_2"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">params_sites</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>plot <span class="op">=</span> <span class="va">scaled_data_clim2</span><span class="op">$</span><span class="va">site</span>,</span>
<span>                           lat <span class="op">=</span> <span class="va">scaled_data_clim2</span><span class="op">$</span><span class="va">lat</span>,</span>
<span>                           long <span class="op">=</span> <span class="va">scaled_data_clim2</span><span class="op">$</span><span class="va">long</span>,</span>
<span>                           <span class="va">alphas</span>, V_alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">V_alpha</span>,<span class="va">nplot</span><span class="op">)</span>,<span class="va">W1</span>,<span class="va">W2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">params_sites</span>, file <span class="op">=</span> <span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/params_sites.csv"</span>,row.names <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span></span>
<span><span class="co">### fixed species effect lambdas and betas </span></span>
<span><span class="va">lambdas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">nsp</span>,<span class="va">n_latent</span><span class="op">)</span></span>
<span><span class="va">betas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">nsp</span>,<span class="va">np</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nsp</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">l</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_latent</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">lambdas</span><span class="op">[</span><span class="va">j</span>,<span class="va">l</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.sp</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">np</span><span class="op">+</span><span class="va">l</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">p</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">np</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">betas</span><span class="op">[</span><span class="va">j</span>,<span class="va">p</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.sp</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">p</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">betas</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.sp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">np</span><span class="op">]</span></span>
<span><span class="va">params_species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>species<span class="op">=</span><span class="va">species</span>, Id_species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">nsp</span><span class="op">)</span>,</span>
<span>                             <span class="va">betas</span>, lambda_1 <span class="op">=</span> <span class="va">lambdas</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, lambda_2 <span class="op">=</span> <span class="va">lambdas</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">params_species</span>,</span>
<span>          file <span class="op">=</span><span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/params_species.csv"</span>,</span>
<span>          row.names <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## probit_theta_latent</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">probit_theta_latent</span>,</span>
<span>          file <span class="op">=</span> <span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/probit_theta_latent.csv"</span>,</span>
<span>          row.names <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span><span class="co">## theta_latent</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">theta_latent</span>, file <span class="op">=</span> <span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/theta_latent.csv"</span>, row.names <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3" number="3.3">
<h3 id="evaluation-of-mcmc-convergence">
<span class="header-section-number">3.3</span> Evaluation of MCMC convergence<a class="anchor" aria-label="anchor" href="#evaluation-of-mcmc-convergence"></a>
</h3>
<p>We visually evaluate the convergence of MCMCs by representing the trace and density <em>a posteriori</em> of the estimated parameters.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/mada_mod.RData"</span><span class="op">)</span></span>
<span><span class="va">np</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">model_spec</span><span class="op">$</span><span class="va">beta_start</span><span class="op">)</span></span>
<span><span class="va">species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">model_spec</span><span class="op">$</span><span class="va">presence_data</span><span class="op">)</span></span>
<span><span class="co">## alpha_i of the first site</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,oma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1.4</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/traceplot.html" class="external-link">traceplot</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.alpha</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,main<span class="op">=</span><span class="st">"Trace of alpha_1"</span>,cex.main<span class="op">=</span><span class="fl">1.6</span><span class="op">)</span></span>
<span><span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/densplot.html" class="external-link">densplot</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.alpha</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,main<span class="op">=</span><span class="st">"Density of alpha_1"</span>, cex.main<span class="op">=</span><span class="fl">1.6</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.alpha</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>,col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span>main<span class="op">=</span><span class="st">"Random site effect alpha_1"</span>,outer<span class="op">=</span><span class="cn">T</span>,cex.main<span class="op">=</span><span class="fl">1.8</span><span class="op">)</span></span>
<span><span class="co">## V_alpha</span></span>
<span><span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/traceplot.html" class="external-link">traceplot</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.V_alpha</span>,main<span class="op">=</span><span class="st">"Trace of V_alpha"</span>,cex.main<span class="op">=</span><span class="fl">1.6</span><span class="op">)</span></span>
<span><span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/densplot.html" class="external-link">densplot</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.V_alpha</span>,main<span class="op">=</span><span class="st">"Density of V_alpha"</span>, cex.main<span class="op">=</span><span class="fl">1.6</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.V_alpha</span><span class="op">)</span>,col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span>main<span class="op">=</span><span class="st">" Variance of random site effects"</span>,outer<span class="op">=</span><span class="cn">T</span>, cex.main<span class="op">=</span><span class="fl">1.8</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## beta_j of the first two species</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>,oma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1.4</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">p</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">np</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/traceplot.html" class="external-link">traceplot</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.sp</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">p</span><span class="op">]</span>,</span>
<span>                    main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Trace of"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.sp</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="va">p</span><span class="op">]</span><span class="op">)</span>,cex.main<span class="op">=</span><span class="fl">1.3</span><span class="op">)</span></span>
<span>    <span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/densplot.html" class="external-link">densplot</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.sp</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">p</span><span class="op">]</span>, </span>
<span>                   main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Density of"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.sp</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="va">p</span><span class="op">]</span><span class="op">)</span>,cex.main<span class="op">=</span><span class="fl">1.3</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.sp</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">p</span><span class="op">]</span><span class="op">)</span>,col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">p</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span>main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Fixed species effect beta for species"</span>, <span class="va">species</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span>, outer<span class="op">=</span><span class="cn">T</span>, cex.main<span class="op">=</span><span class="fl">1.6</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## lambda_j of the first two species</span></span>
<span><span class="va">n_latent</span> <span class="op">&lt;-</span> <span class="va">mod_all</span><span class="op">$</span><span class="va">model_spec</span><span class="op">$</span><span class="va">n_latent</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_latent</span>,<span class="fl">2</span><span class="op">)</span>,oma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1.4</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">l</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_latent</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/traceplot.html" class="external-link">traceplot</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.sp</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">np</span><span class="op">+</span><span class="va">l</span><span class="op">]</span>,</span>
<span>                    main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Trace of"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.sp</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="va">np</span><span class="op">+</span><span class="va">l</span><span class="op">]</span><span class="op">)</span>,cex.main<span class="op">=</span><span class="fl">1.6</span><span class="op">)</span></span>
<span>    <span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/densplot.html" class="external-link">densplot</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.sp</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">np</span><span class="op">+</span><span class="va">l</span><span class="op">]</span>,</span>
<span>                   main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Density of"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.sp</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="va">np</span><span class="op">+</span><span class="va">l</span><span class="op">]</span><span class="op">)</span>,cex.main<span class="op">=</span><span class="fl">1.6</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.sp</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">np</span><span class="op">+</span><span class="va">l</span><span class="op">]</span><span class="op">)</span>,col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span>main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Factor loadings lambda for species "</span>, <span class="va">species</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span>,outer<span class="op">=</span><span class="cn">T</span>,cex.main<span class="op">=</span><span class="fl">1.8</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## Latent variables W_i for one site</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>,oma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1.4</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">l</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_latent</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/traceplot.html" class="external-link">traceplot</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.latent</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"lv_"</span>,<span class="va">l</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>                  main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">" Trace of W_1"</span>, <span class="va">l</span><span class="op">)</span>,cex.main<span class="op">=</span><span class="fl">1.6</span><span class="op">)</span></span>
<span>  <span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/densplot.html" class="external-link">densplot</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.latent</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"lv_"</span>,<span class="va">l</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>                 main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">" Density of W_1"</span>, <span class="va">l</span><span class="op">)</span>,cex.main<span class="op">=</span><span class="fl">1.6</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.latent</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"lv_"</span>,<span class="va">l</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>,col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span>main<span class="op">=</span><span class="st">"Latentes variables W_1"</span>, outer<span class="op">=</span><span class="cn">T</span>,cex.main<span class="op">=</span><span class="fl">1.8</span><span class="op">)</span></span>
<span><span class="co">## Deviance</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,oma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1.5</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/traceplot.html" class="external-link">traceplot</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.Deviance</span>,main<span class="op">=</span><span class="st">"Trace"</span>,cex.main<span class="op">=</span><span class="fl">1.6</span><span class="op">)</span></span>
<span><span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/densplot.html" class="external-link">densplot</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.Deviance</span>,main<span class="op">=</span><span class="st">"Density"</span>,cex.main<span class="op">=</span><span class="fl">1.6</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.Deviance</span><span class="op">)</span>,col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span>main <span class="op">=</span> <span class="st">"Deviance"</span>,outer<span class="op">=</span><span class="cn">T</span>,cex.main<span class="op">=</span><span class="fl">1.8</span><span class="op">)</span></span>
<span><span class="co"># theta</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">probit_theta_latent</span>,col<span class="op">=</span><span class="st">"light blue"</span>,  main <span class="op">=</span> <span class="st">"probit(theta) estimated"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">theta_latent</span>, breaks<span class="op">=</span><span class="va">pretty</span>, col<span class="op">=</span><span class="st">"light blue"</span>, main <span class="op">=</span> <span class="st">"theta estimated"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Madagascar_files/figure-html/results-Mada-1.png" width="700" style="display: block; margin: auto;"><img src="Madagascar_files/figure-html/results-Mada-2.png" width="700" style="display: block; margin: auto;"><img src="Madagascar_files/figure-html/results-Mada-3.png" width="700" style="display: block; margin: auto;"><img src="Madagascar_files/figure-html/results-Mada-4.png" width="700" style="display: block; margin: auto;"><img src="Madagascar_files/figure-html/results-Mada-5.png" width="700" style="display: block; margin: auto;"><img src="Madagascar_files/figure-html/results-Mada-6.png" width="700" style="display: block; margin: auto;"><img src="Madagascar_files/figure-html/results-Mada-7.png" width="700" style="display: block; margin: auto;"><img src="Madagascar_files/figure-html/results-Mada-8.png" width="700" style="display: block; margin: auto;"><img src="Madagascar_files/figure-html/results-Mada-9.png" width="700" style="display: block; margin: auto;"><img src="Madagascar_files/figure-html/results-Mada-10.png" width="700" style="display: block; margin: auto;"><img src="Madagascar_files/figure-html/results-Mada-11.png" width="700" style="display: block; margin: auto;"><img src="Madagascar_files/figure-html/results-Mada-12.png" width="700" style="display: block; margin: auto;"><img src="Madagascar_files/figure-html/results-Mada-13.png" width="700" style="display: block; margin: auto;"><img src="Madagascar_files/figure-html/results-Mada-14.png" width="700" style="display: block; margin: auto;"><img src="Madagascar_files/figure-html/results-Mada-15.png" width="700" style="display: block; margin: auto;"><img src="Madagascar_files/figure-html/results-Mada-16.png" width="700" style="display: block; margin: auto;"><img src="Madagascar_files/figure-html/results-Mada-17.png" width="700" style="display: block; margin: auto;"><img src="Madagascar_files/figure-html/results-Mada-18.png" width="700" style="display: block; margin: auto;"></p>
<p>Overall, the traces and densities of the parameters indicate the convergence of the algorithm. Indeed, we observe on the traces that the values oscillate around averages without showing any upward or downward trend and we see that the densities are quite smooth and for most of them of Gaussian form.</p>
</div>
</div>
<div class="section level2" number="4">
<h2 id="representation-of-results-at-inventory-sites">
<span class="header-section-number">4</span> Representation of results at inventory sites<a class="anchor" aria-label="anchor" href="#representation-of-results-at-inventory-sites"></a>
</h2>
<div class="section level3" number="4.1">
<h3 id="presence-probabilities">
<span class="header-section-number">4.1</span> Presence probabilities<a class="anchor" aria-label="anchor" href="#presence-probabilities"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span>file<span class="op">=</span><span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/output.RData"</span><span class="op">)</span></span>
<span><span class="va">theta_latent</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/theta_latent.csv"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">madagascar</span>, package<span class="op">=</span><span class="st">"jSDM"</span><span class="op">)</span></span>
<span><span class="va">PA</span> <span class="op">&lt;-</span> <span class="va">madagascar</span></span>
<span><span class="va">xy</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="st">"/home/clement/Documents/projet_BioSceneMada/Internship_Report/data/coords.shp"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Madagascar borders</span></span>
<span><span class="va">Mada_borders</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">output</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, layer <span class="op">=</span> <span class="st">"gadm36_MDG_0"</span><span class="op">)</span></span>
<span><span class="va">Mada_borders</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/project.html" class="external-link">project</a></span><span class="op">(</span><span class="va">Mada_borders</span>, <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">xy</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Observed presence absence</span></span>
<span><span class="va">id_pres</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">PA</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">id_abs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">PA</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">obs_pres</span> <span class="op">&lt;-</span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/coords.html" class="external-link">crds</a></span><span class="op">(</span><span class="va">xy</span><span class="op">[</span><span class="va">id_pres</span>,<span class="op">]</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"point"</span>, crs<span class="op">=</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">xy</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">obs_abs</span> <span class="op">&lt;-</span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/coords.html" class="external-link">crds</a></span><span class="op">(</span><span class="va">xy</span><span class="op">[</span><span class="va">id_abs</span>,<span class="op">]</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"point"</span>, crs<span class="op">=</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">xy</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Representation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Mada_borders</span>, col<span class="op">=</span><span class="st">"lightgray"</span>,</span>
<span>            main <span class="op">=</span><span class="st">"Observed occurences of Ocotea laevis"</span>,</span>
<span>            cex.main<span class="op">=</span><span class="fl">1.4</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">obs_pres</span>, pch<span class="op">=</span><span class="fl">16</span>, cex<span class="op">=</span><span class="fl">1.1</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">obs_abs</span>, pch<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"right"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"presence"</span>,<span class="st">"absence"</span><span class="op">)</span>, pch<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">16</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Estimated probabilities of presence</span></span>
<span><span class="va">theta_latent_sp</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/coords.html" class="external-link">crds</a></span><span class="op">(</span><span class="va">xy</span><span class="op">)</span>, <span class="va">theta_latent</span><span class="op">)</span>,</span>
<span>                               geom<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span>, crs<span class="op">=</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">xy</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Representation</span></span>
<span><span class="co"># define groups for mapping</span></span>
<span><span class="va">cuts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.1</span>,<span class="fl">0.2</span>,<span class="fl">0.3</span>,<span class="fl">0.4</span>,<span class="fl">0.5</span>,<span class="fl">0.7</span>,<span class="fl">0.8</span>,<span class="fl">0.9</span><span class="op">)</span></span>
<span><span class="va">col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'red3'</span>,<span class="st">'red'</span>,<span class="st">'orange'</span>,<span class="st">'yellow'</span>, <span class="st">'yellow green'</span>, <span class="st">'green3'</span>, <span class="st">'forest green'</span>,<span class="st">'dark green'</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Mada_borders</span>, col<span class="op">=</span><span class="st">"lightgray"</span>,</span>
<span>            main <span class="op">=</span><span class="st">"Estimated probabilities of presence for Ocotea laevis"</span>,</span>
<span>            cex.main<span class="op">=</span><span class="fl">1.4</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">theta_latent_sp</span>, y<span class="op">=</span><span class="fl">1</span>, pch<span class="op">=</span><span class="fl">20</span>, cex<span class="op">=</span><span class="fl">1.1</span>,</span>
<span>            legend<span class="op">=</span><span class="st">"topright"</span>, plg<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cex<span class="op">=</span><span class="fl">1.01</span><span class="op">)</span>, add<span class="op">=</span><span class="cn">TRUE</span>, col<span class="op">=</span><span class="va">col</span>,</span>
<span>            type<span class="op">=</span><span class="st">"interval"</span>, breaks<span class="op">=</span><span class="va">cuts</span><span class="op">)</span></span></code></pre></div>
<p><img src="Madagascar_files/figure-html/proba_representation-1.png" width="50%"><img src="Madagascar_files/figure-html/proba_representation-2.png" width="50%"></p>
<p>It can be observed that the inventory sites where this species was observed match those for which a high probability of presence was estimated by the JSDM.</p>
</div>
<div class="section level3" number="4.2">
<h3 id="species-richness">
<span class="header-section-number">4.2</span> Species richness<a class="anchor" aria-label="anchor" href="#species-richness"></a>
</h3>
<p>Species richness also called diversity <span class="math inline">\(\alpha\)</span> reflects the number of species coexisting in a given environment and is computed by summing the number of species present on each site.</p>
<p>We spatially represent the species richness observed at each inventory site defined by <span class="math inline">\(R_i=\sum\limits_ {j=1}^{n_{species}} y_{ij}\)</span> and the species richness estimated, following <span class="citation">Scherrer, Mod &amp; Guisan (<a href="#ref-Scherrer2020" role="doc-biblioref">2020</a>)</span>, by summing the estimated occurrence probabilities of all species on each site: <span class="math inline">\(\widehat{R}_i=\sum\limits_ {j=1}^{n_{species}} \widehat{\theta}_{ij}\)</span>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Madagascar borders</span></span>
<span><span class="va">Mada_borders</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">output</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, layer <span class="op">=</span> <span class="st">"gadm36_MDG_0"</span><span class="op">)</span></span>
<span><span class="va">Mada_borders</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/project.html" class="external-link">project</a></span><span class="op">(</span><span class="va">Mada_borders</span>, <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">xy</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Representation of observed species richness </span></span>
<span></span>
<span><span class="va">species_richness_obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>species_richness_obs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">PA</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">species_richness_obs_sp</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/coords.html" class="external-link">crds</a></span><span class="op">(</span><span class="va">xy</span><span class="op">)</span>, <span class="va">species_richness_obs</span><span class="op">)</span>,</span>
<span>                                       geom<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="st">"y"</span><span class="op">)</span>, crs<span class="op">=</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">xy</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cuts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">8</span>,<span class="fl">12</span>,<span class="fl">16</span>,<span class="fl">20</span>,<span class="fl">24</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">theta_latent</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'red4'</span>,<span class="st">'red'</span>,<span class="st">'orange'</span>,<span class="st">'yellow'</span>, <span class="st">'yellow green'</span>, <span class="st">'green3'</span>, <span class="st">'forest green'</span>,<span class="st">'dark green'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Mada_borders</span>, col<span class="op">=</span><span class="st">"lightgray"</span>,</span>
<span>            main <span class="op">=</span><span class="st">"Observed species richness"</span>,</span>
<span>            cex.main<span class="op">=</span><span class="fl">1.4</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">species_richness_obs_sp</span>, <span class="st">'species_richness_obs'</span>, breaks<span class="op">=</span><span class="va">cuts</span>, col<span class="op">=</span><span class="va">col</span>,</span>
<span>            pch<span class="op">=</span><span class="fl">20</span>, cex<span class="op">=</span><span class="fl">1.1</span>, add<span class="op">=</span><span class="cn">TRUE</span>, </span>
<span>           legend<span class="op">=</span><span class="st">"topright"</span>, plg<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cex<span class="op">=</span><span class="fl">1.01</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"interval"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Representation of estimated species richness </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">species_richness</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>species_richness<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">theta_latent</span>,<span class="fl">1</span>,<span class="va">sum</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">species_richness_sp</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/coords.html" class="external-link">crds</a></span><span class="op">(</span><span class="va">xy</span><span class="op">)</span>,</span>
<span>                                         <span class="va">species_richness</span><span class="op">)</span>, </span>
<span>                                   geom<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="st">"y"</span><span class="op">)</span>, crs<span class="op">=</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">xy</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Mada_borders</span>, col<span class="op">=</span><span class="st">"lightgray"</span>,</span>
<span>            main <span class="op">=</span><span class="st">"Estimated species richness"</span>,</span>
<span>            cex.main<span class="op">=</span><span class="fl">1.4</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">species_richness_sp</span>, <span class="st">'species_richness'</span>, col<span class="op">=</span><span class="va">col</span>,</span>
<span>           breaks<span class="op">=</span><span class="va">cuts</span>, pch<span class="op">=</span><span class="fl">20</span>, cex<span class="op">=</span><span class="fl">1.1</span>, add<span class="op">=</span><span class="cn">TRUE</span>, </span>
<span>           legend<span class="op">=</span><span class="st">"topright"</span>, plg<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cex<span class="op">=</span><span class="fl">1.01</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"interval"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Comparison between observed and estimated species richness at inventory sites</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">species_richness_obs</span><span class="op">$</span><span class="va">species_richness_obs</span>,</span>
<span>     <span class="va">species_richness</span><span class="op">$</span><span class="va">species_richness</span>,</span>
<span>     main<span class="op">=</span><span class="st">"Species richness"</span>,</span>
<span>     xlab<span class="op">=</span><span class="st">"observed"</span>, ylab<span class="op">=</span><span class="st">"estimated"</span>,</span>
<span>     cex.main<span class="op">=</span><span class="fl">1.6</span>, cex.lab<span class="op">=</span><span class="fl">1.4</span>, cex.axis<span class="op">=</span><span class="fl">1.2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>,b<span class="op">=</span><span class="fl">1</span>,col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span></span></code></pre></div>
<p><img src="Madagascar_files/figure-html/species-richness-representation-2.png" width="50%"><img src="Madagascar_files/figure-html/species-richness-representation-1.png" width="50%"></p>
<p><img src="Madagascar_files/figure-html/species-richness-representation-3.png" width="50%" style="display: block; margin: auto;"></p>
<p>It can be seen that the observed species richness on the inventory sites corresponds fairly well to that estimated by summing the estimated probabilities of occurrence of all species on each site.</p>
<p>Moreover, we can see that the observed species richness is greater in the moist forest of the north-east of the island, particularly in the Masoala peninsula.</p>
</div>
<div class="section level3" number="4.3">
<h3 id="residual-correlation">
<span class="header-section-number">4.3</span> Residual correlation<a class="anchor" aria-label="anchor" href="#residual-correlation"></a>
</h3>
<p>After fitting the JSDM with latent variables, the <strong>full species residual correlation matrix</strong> <span class="math inline">\(R=(R_{ij})^{i=1,\ldots, n_{site}}_{j=1,\ldots, n_{species}}\)</span> can be derived from the covariance in the latent variables such as :
<span class="math display">\[\Sigma_{ij} = \lambda_i^T .\lambda_j \]</span>, then we compute correlations from covariances :
<span class="math display">\[R_{i,j} = \frac{\Sigma_{ij}}{\sqrt{\Sigma _{ii}\Sigma _{jj}}}\]</span>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/mada_mod.RData"</span><span class="op">)</span></span>
<span><span class="va">n.species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">model_spec</span><span class="op">$</span><span class="va">presence_data</span><span class="op">)</span></span>
<span><span class="va">n.mcmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.latent</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">Tau.cor.arr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="va">n.mcmc</span>,<span class="va">n.species</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">t</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n.mcmc</span><span class="op">)</span> <span class="op">{</span> </span>
<span>  <span class="va">lv.coefs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.sp</span>, <span class="st">"["</span>, <span class="va">t</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"lambda"</span>,<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mod_all</span><span class="op">$</span><span class="va">mcmc.sp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">Tau.mat</span> <span class="op">&lt;-</span> <span class="va">lv.coefs</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">lv.coefs</span><span class="op">)</span> </span>
<span>  <span class="va">Tau.cor.mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov2cor</a></span><span class="op">(</span><span class="va">Tau.mat</span><span class="op">)</span></span>
<span>  <span class="va">Tau.cor.arr</span><span class="op">[</span><span class="va">t</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">Tau.cor.mat</span><span class="op">)</span> </span>
<span><span class="op">}</span></span>
<span><span class="co">## Average over the MCMC samples</span></span>
<span><span class="va">R</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">Tau.cor.arr</span>,<span class="fl">2</span>,<span class="va">mean</span><span class="op">)</span>,<span class="va">n.species</span>,byrow<span class="op">=</span><span class="cn">F</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">R</span>, file <span class="op">=</span><span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/R.csv"</span>, row.names <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre></div>
<p>We plot the top 50 estimated residual correlations between species based on their number of observed occurrences and environmental preferences.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Forest inventory </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">madagascar</span>, package<span class="op">=</span><span class="st">"jSDM"</span><span class="op">)</span></span>
<span><span class="va">PA</span> <span class="op">&lt;-</span> <span class="va">madagascar</span></span>
<span><span class="co"># Species parameters </span></span>
<span><span class="va">params_species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/params_species.csv"</span><span class="op">)</span></span>
<span><span class="co"># Residual correlation matrix R</span></span>
<span><span class="va">R</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/R.csv"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">R</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">R</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/make.names.html" class="external-link">make.names</a></span><span class="op">(</span><span class="va">params_species</span><span class="op">$</span><span class="va">species</span><span class="op">)</span></span>
<span><span class="va">R</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">R</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/" class="external-link">viridis</a></span><span class="op">)</span></span>
<span><span class="fu">jSDM</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_associations.html">plot_associations</a></span><span class="op">(</span><span class="va">R</span>, circleBreak<span class="op">=</span><span class="cn">TRUE</span>, occ<span class="op">=</span><span class="va">PA</span>, top<span class="op">=</span><span class="fl">50</span>,</span>
<span>                        main<span class="op">=</span><span class="st">"Species-species association sorted after their frequency"</span>,</span>
<span>                        cols_association<span class="op">=</span><span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>                        cols_occurrence<span class="op">=</span><span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">magma</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>                        species_order<span class="op">=</span><span class="st">"frequency"</span><span class="op">)</span></span>
<span><span class="co"># Average of MCMC samples of species effect beta except the intercept</span></span>
<span><span class="va">effects</span> <span class="op">=</span> <span class="va">params_species</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"beta"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">params_species</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">np</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">effects</span><span class="op">)</span></span>
<span><span class="co"># Add absolute quadratic and linear effects of each environmental variable</span></span>
<span><span class="va">effects</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">effects</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">np</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">effects</span><span class="op">[</span>,<span class="op">(</span><span class="va">np</span><span class="op">/</span><span class="fl">2</span> <span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="va">np</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">effects</span><span class="op">)</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"beta_"</span>, <span class="st">""</span>,<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">effects</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">jSDM</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_associations.html">plot_associations</a></span><span class="op">(</span><span class="va">R</span>, env_effect<span class="op">=</span><span class="va">effects</span>, top<span class="op">=</span><span class="fl">50</span>,</span>
<span>                        main<span class="op">=</span><span class="st">"Species-species association sorted after their main environmental effect"</span>,</span>
<span>                        cols_association<span class="op">=</span><span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>                        species_order<span class="op">=</span><span class="st">"main env_effect"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Madagascar_files/figure-html/plot-associations-1.png" width="500" height="555" style="display: block; margin: auto;"></p>
<p>The figure above shows the correlations between species, with the 483 species sorted according to the number of sites where they occur out of the 751 inventoried.</p>
<p><img src="Madagascar_files/figure-html/plot-associations-2.png" width="500" height="555" style="display: block; margin: auto;"></p>
<p>The figure above shows the same covariance structure but with the species sorted according to their largest environmental coefficients (<span class="math inline">\(\beta\)</span>) (the outer ring shows the distribution of environmental effect for species within the sample).</p>
<p>This representation of associations between species allows us to observe the positive or negative correlations between species which can be interpreted in terms of positive or negative influence of the presence of a species on the probability of occurrence of another.</p>
</div>
</div>
<div class="section level2" number="5">
<h2 id="intrapolation-of-parameters-between-inventory-sites">
<span class="header-section-number">5</span> Intrapolation of parameters between inventory sites<a class="anchor" aria-label="anchor" href="#intrapolation-of-parameters-between-inventory-sites"></a>
</h2>
<p>The presence of a spatial structure where observations close to each other are more similar than those far away (spatial auto-correlation) is a prerequisite for the application of geostatistics and from the previous spatial representations it seems to be satisfied.</p>
<p>Thus, it is possible to interpolate sites’ parameters for the whole island from those estimated for the inventory plots using the spatial interpolation method called regularized spline with tension (<strong>RST</strong>) from <a href="https://grass.osgeo.org/" class="external-link"><code>GRASS GIS</code></a> software via <code>rgrass7</code> R package.
This method is described in the article <span class="citation">(<a href="#ref-Mitasova1993" role="doc-biblioref">Mitášová &amp; Hofierka 1993</a>)</span>.</p>
<div class="section level3" number="5.1">
<h3 id="random-site-effect-alpha">
<span class="header-section-number">5.1</span> Random site effect <span class="math inline">\(\alpha\)</span><a class="anchor" aria-label="anchor" href="#random-site-effect-alpha"></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Initialize GRASS</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="st">"~/Documents/jSDM/vignettes"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span>LD_LIBRARY_PATH<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"/usr/lib/grass78/lib"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"LD_LIBRARY_PATH"</span><span class="op">)</span>,sep<span class="op">=</span><span class="st">":"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://grass.osgeo.org/" class="external-link">rgrass7</a></span><span class="op">)</span></span>
<span><span class="co"># use a georeferenced raster</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="st">'grass -c ~/Documents/projet_BioSceneMada/Internship_Report/data/scaled_clim.tif grassdata/interpolation'</span><span class="op">)</span></span>
<span><span class="co"># connect to grass database</span></span>
<span><span class="fu">initGRASS</span><span class="op">(</span>gisBase<span class="op">=</span><span class="st">"/usr/lib/grass78"</span>, </span>
<span>          gisDbase<span class="op">=</span><span class="st">"grassdata"</span>,</span>
<span>          location<span class="op">=</span><span class="st">"interpolation"</span>, mapset<span class="op">=</span><span class="st">"PERMANENT"</span>,</span>
<span>          override<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>We interpolate the random site effect at Madagascar scale using RST method.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://grass.osgeo.org/" class="external-link">rgrass7</a></span><span class="op">)</span></span>
<span><span class="co"># Import sites parameters</span></span>
<span><span class="va">params_sites</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/params_sites.csv"</span><span class="op">)</span></span>
<span><span class="co"># inventory sites coordinates in UTM38S projection </span></span>
<span><span class="va">xy</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="st">"/home/clement/Documents/projet_BioSceneMada/Internship_Report/data/coords.shp"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># alpha </span></span>
<span><span class="va">alpha_sp</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>alpha<span class="op">=</span><span class="va">params_sites</span><span class="op">$</span><span class="va">alphas</span>, <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/coords.html" class="external-link">crds</a></span><span class="op">(</span><span class="va">xy</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                        geom<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="st">"y"</span><span class="op">)</span>, crs<span class="op">=</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">xy</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">rgrass7</span><span class="fu">::</span><span class="fu">write_VECT</span><span class="op">(</span><span class="va">alpha_sp</span>, <span class="st">"alpha"</span>, flags<span class="op">=</span><span class="st">"overwrite"</span><span class="op">)</span></span>
<span><span class="co"># Re-sample with RST</span></span>
<span><span class="co"># for punctual data use function v.surf.rst</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="st">"v.surf.rst --overwrite --verbose -t tension=3 input=alpha zcolumn=alpha \\</span></span>
<span><span class="st">       smooth=0.0 elevation=alpha_rst"</span><span class="op">)</span></span>
<span><span class="co"># Export</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="st">"r.out.gdal --overwrite input=alpha_rst \\</span></span>
<span><span class="st">             output=Madagascar_cache/alpha_rst.tif type=Float32 \\</span></span>
<span><span class="st">             createopt='compress=lzw,predictor=2'"</span><span class="op">)</span></span>
<span><span class="co"># Representation</span></span>
<span><span class="va">alpha_rst</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="st">"/home/clement/Documents/jSDM/vignettes/Madagascar_cache/alpha_rst.tif"</span><span class="op">)</span></span>
<span><span class="co"># Data restricted to Madagascar's borders</span></span>
<span><span class="va">borders</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">output</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, layer<span class="op">=</span><span class="st">"gadm36_MDG_0"</span><span class="op">)</span></span>
<span><span class="va">borders</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/project.html" class="external-link">project</a></span><span class="op">(</span><span class="va">borders</span>, <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">alpha_rst</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">alpha_rst</span>  <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/mask.html" class="external-link">mask</a></span><span class="op">(</span><span class="va">alpha_rst</span>, <span class="va">borders</span><span class="op">)</span></span>
<span><span class="co"># terra::writeRaster(alpha_rst, </span></span>
<span><span class="co">#                    filename="/home/clement/Documents/jSDM/vignettes/Madagascar_cache/alpha_rst.tif",</span></span>
<span><span class="co">#                    gdal=c("COMPRESS=LZW", "PREDICTOR=2"), overwrite=TRUE)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">alpha_rst</span>, main<span class="op">=</span><span class="st">"Site effect alpha interpolated by RST"</span><span class="op">)</span></span>
<span><span class="va">alpha_rst_xy</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/extract.html" class="external-link">extract</a></span><span class="op">(</span><span class="va">alpha_rst</span>, <span class="va">xy</span><span class="op">)</span><span class="op">[</span>,<span class="st">"alpha_rst"</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">alpha_rst_xy</span>, <span class="va">params_sites</span><span class="op">$</span><span class="va">alphas</span>,</span>
<span>     xlab<span class="op">=</span><span class="st">"alpha interpolated by RST"</span>,</span>
<span>     ylab<span class="op">=</span><span class="st">"alpha estimated by JSDM"</span>,</span>
<span>     main<span class="op">=</span><span class="st">"Random site effect"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>, b<span class="op">=</span><span class="fl">1</span>, col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Center interpolated site effect </span></span>
<span><span class="va">alpha_rst_centered</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/app.html" class="external-link">app</a></span><span class="op">(</span><span class="va">alpha_rst</span>, fun<span class="op">=</span><span class="va">scale</span>, scale<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">alpha_rst_centered</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">alpha_rst</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">alpha_rst_centered</span>, main<span class="op">=</span><span class="st">"Site effect alpha interpolated by RST"</span><span class="op">)</span></span>
<span><span class="va">alpha_rst_centered_xy</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/extract.html" class="external-link">extract</a></span><span class="op">(</span><span class="va">alpha_rst_centered</span>, <span class="va">xy</span><span class="op">)</span><span class="op">[</span>,<span class="st">"alpha_rst"</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">alpha_rst_centered_xy</span>, <span class="va">params_sites</span><span class="op">$</span><span class="va">alphas</span>,</span>
<span>     xlab<span class="op">=</span><span class="st">"alpha interpolated by RST"</span>,</span>
<span>     ylab<span class="op">=</span><span class="st">"alpha estimated by JSDM"</span>,</span>
<span>     main<span class="op">=</span><span class="st">"Random site effect"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>, b<span class="op">=</span><span class="fl">1</span>, col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/writeRaster.html" class="external-link">writeRaster</a></span><span class="op">(</span><span class="va">alpha_rst_centered</span>, <span class="st">"Madagascar_cache/alpha_rst_centered.tif"</span>,</span>
<span>                   gdal<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"COMPRESS=LZW"</span>, <span class="st">"PREDICTOR=2"</span><span class="op">)</span>, overwrite<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>We represent the random site effect interpolated at Madagascar scale.</p>
<p><img src="Madagascar_files/figure-html/RST_alpha-1.png" width="800" style="display: block; margin: auto;"></p>
</div>
<div class="section level3" number="5.2">
<h3 id="latent-variables-w">
<span class="header-section-number">5.2</span> Latent variables <span class="math inline">\(W\)</span><a class="anchor" aria-label="anchor" href="#latent-variables-w"></a>
</h3>
<p>We interpolate the first axis of latent variables at the Madagascar scale using the RST method.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># W1 </span></span>
<span><span class="va">W1_sp</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>W1<span class="op">=</span><span class="va">params_sites</span><span class="op">$</span><span class="va">W1</span>, <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/coords.html" class="external-link">crds</a></span><span class="op">(</span><span class="va">xy</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                     geom<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="st">"y"</span><span class="op">)</span>, crs<span class="op">=</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">xy</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">rgrass7</span><span class="fu">::</span><span class="fu">write_VECT</span><span class="op">(</span><span class="va">W1_sp</span>, <span class="st">"W1"</span>, flags<span class="op">=</span><span class="st">"overwrite"</span><span class="op">)</span></span>
<span><span class="co"># Re-sample with RST</span></span>
<span><span class="co"># Note: use mask=Madagascar to save computation time</span></span>
<span><span class="co"># for punctual data use function v.surf.rst</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="st">"v.surf.rst --overwrite --verbose -t tension=3 input=W1 zcolumn=W1 \\</span></span>
<span><span class="st">       smooth=0.0 elevation=W1_rst"</span><span class="op">)</span></span>
<span><span class="co"># Export</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="st">"r.out.gdal --overwrite input=W1_rst \\</span></span>
<span><span class="st">             output=Madagascar_cache/W1_rst.tif type=Float32 \\</span></span>
<span><span class="st">             createopt='compress=lzw,predictor=2'"</span><span class="op">)</span></span>
<span><span class="co"># Representation</span></span>
<span><span class="va">W1_rst</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="st">"Madagascar_cache/W1_rst.tif"</span><span class="op">)</span></span>
<span><span class="co"># Data restricted to Madagascar's borders</span></span>
<span><span class="va">borders</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">output</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, layer<span class="op">=</span><span class="st">"gadm36_MDG_0"</span><span class="op">)</span></span>
<span><span class="va">borders</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/project.html" class="external-link">project</a></span><span class="op">(</span><span class="va">borders</span>, <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">W1_rst</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">W1_rst</span>  <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/mask.html" class="external-link">mask</a></span><span class="op">(</span><span class="va">W1_rst</span>, <span class="va">borders</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">W1_rst</span>, main<span class="op">=</span><span class="st">"Latent variable W1 interpolated by RST"</span><span class="op">)</span></span>
<span><span class="va">W1_rst_xy</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/extract.html" class="external-link">extract</a></span><span class="op">(</span><span class="va">W1_rst</span>, <span class="va">xy</span><span class="op">)</span><span class="op">[</span>, <span class="st">"W1_rst"</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">W1_rst_xy</span>, <span class="va">params_sites</span><span class="op">$</span><span class="va">W1</span>,</span>
<span>     xlab<span class="op">=</span><span class="st">"W1 interpolated by RST"</span>,</span>
<span>     ylab<span class="op">=</span><span class="st">"W1 estimated by JSDM"</span>, </span>
<span>     main<span class="op">=</span><span class="st">"First latent axis"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>, b<span class="op">=</span><span class="fl">1</span>, col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Center interpolated first latent axis </span></span>
<span><span class="va">W1_rst_centered</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/app.html" class="external-link">app</a></span><span class="op">(</span><span class="va">W1_rst</span>, <span class="va">scale</span>, scale<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">W1_rst_centered</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">W1_rst</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">W1_rst_centered</span>, main<span class="op">=</span><span class="st">"First latent axis interpolated by RST"</span><span class="op">)</span></span>
<span><span class="va">W1_rst_centered_xy</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/extract.html" class="external-link">extract</a></span><span class="op">(</span><span class="va">W1_rst_centered</span>, <span class="va">xy</span><span class="op">)</span><span class="op">[</span>,<span class="st">"W1_rst"</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">W1_rst_centered_xy</span>, <span class="va">params_sites</span><span class="op">$</span><span class="va">W1</span>,</span>
<span>     xlab<span class="op">=</span><span class="st">"W1 interpolated by RST"</span>,</span>
<span>     ylab<span class="op">=</span><span class="st">"W1 estimated by JSDM"</span>,</span>
<span>     main<span class="op">=</span><span class="st">"First latent axis"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>, b<span class="op">=</span><span class="fl">1</span>, col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/writeRaster.html" class="external-link">writeRaster</a></span><span class="op">(</span><span class="va">W1_rst_centered</span>, <span class="st">"Madagascar_cache/W1_rst_centered.tif"</span>,</span>
<span>                   gdal<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"COMPRESS=LZW"</span>, <span class="st">"PREDICTOR=2"</span><span class="op">)</span>, overwrite<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>We represent the first latent variable interpolated at Madagascar scale.</p>
<p><img src="Madagascar_files/figure-html/RST-W1-1.png" width="800" style="display: block; margin: auto;"></p>
<p>We interpolate the second axis of latent variables at the Madagascar scale using the RST method.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># W2 </span></span>
<span><span class="va">W2_sp</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>W2<span class="op">=</span><span class="va">params_sites</span><span class="op">$</span><span class="va">W2</span>, <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/coords.html" class="external-link">crds</a></span><span class="op">(</span><span class="va">xy</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                     geom<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="st">"y"</span><span class="op">)</span>, crs<span class="op">=</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">xy</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">rgrass7</span><span class="fu">::</span><span class="fu">write_VECT</span><span class="op">(</span><span class="va">W2_sp</span>, <span class="st">"W2"</span>, flags<span class="op">=</span><span class="st">"overwrite"</span><span class="op">)</span></span>
<span><span class="co"># Re-sample with RST</span></span>
<span><span class="co"># Note: use mask=Madagascar to save computation time</span></span>
<span><span class="co"># for punctual data use function v.surf.rst</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="st">"v.surf.rst --overwrite --verbose -t tension=3 input=W2 zcolumn=W2 \\</span></span>
<span><span class="st">       smooth=0.0 elevation=W2_rst"</span><span class="op">)</span></span>
<span><span class="co"># Export</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="st">"r.out.gdal --overwrite input=W2_rst \\</span></span>
<span><span class="st">             output=Madagascar_cache/W2_rst.tif type=Float32 \\</span></span>
<span><span class="st">             createopt='compress=lzw,predictor=2'"</span><span class="op">)</span></span>
<span><span class="co"># Representation</span></span>
<span><span class="va">W2_rst</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="st">"Madagascar_cache/W2_rst.tif"</span><span class="op">)</span></span>
<span><span class="co"># Data restricted to Madagascar's borders</span></span>
<span><span class="va">borders</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">output</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, layer<span class="op">=</span><span class="st">"gadm36_MDG_0"</span><span class="op">)</span></span>
<span><span class="va">borders</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/project.html" class="external-link">project</a></span><span class="op">(</span><span class="va">borders</span>, <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">W2_rst</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">W2_rst</span>  <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/mask.html" class="external-link">mask</a></span><span class="op">(</span><span class="va">W2_rst</span>, <span class="va">borders</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">W2_rst</span>, main<span class="op">=</span><span class="st">"Latent variable W2 interpolated by RST"</span><span class="op">)</span></span>
<span><span class="va">W2_rst_xy</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/extract.html" class="external-link">extract</a></span><span class="op">(</span><span class="va">W2_rst</span>, <span class="va">xy</span><span class="op">)</span><span class="op">[</span>, <span class="st">"W2_rst"</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">W2_rst_xy</span>, <span class="va">params_sites</span><span class="op">$</span><span class="va">W2</span>,</span>
<span>     xlab<span class="op">=</span><span class="st">"W2 interpolated by RST"</span>,</span>
<span>     ylab<span class="op">=</span><span class="st">"W2 estimated by JSDM"</span>, </span>
<span>     main<span class="op">=</span><span class="st">"Second latent axis"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>, b<span class="op">=</span><span class="fl">1</span>, col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Center interpolated first latent axis </span></span>
<span><span class="va">W2_rst_centered</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/app.html" class="external-link">app</a></span><span class="op">(</span><span class="va">W2_rst</span>, <span class="va">scale</span>, scale<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">W2_rst_centered</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">W2_rst</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">W2_rst_centered</span>, main<span class="op">=</span><span class="st">"Second latent axis interpolated by RST"</span><span class="op">)</span></span>
<span><span class="va">W2_rst_centered_xy</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/extract.html" class="external-link">extract</a></span><span class="op">(</span><span class="va">W2_rst_centered</span>, <span class="va">xy</span><span class="op">)</span><span class="op">[</span>,<span class="st">"W2_rst"</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">W2_rst_centered_xy</span>, <span class="va">params_sites</span><span class="op">$</span><span class="va">W2</span>,</span>
<span>     xlab<span class="op">=</span><span class="st">"W2 interpolated by RST"</span>,</span>
<span>     ylab<span class="op">=</span><span class="st">"W2 estimated by JSDM"</span>,</span>
<span>     main<span class="op">=</span><span class="st">"Second latent axis"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>, b<span class="op">=</span><span class="fl">1</span>, col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/writeRaster.html" class="external-link">writeRaster</a></span><span class="op">(</span><span class="va">W2_rst_centered</span>, <span class="st">"Madagascar_cache/W2_rst_centered.tif"</span>,</span>
<span>                   gdal<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"COMPRESS=LZW"</span>, <span class="st">"PREDICTOR=2"</span><span class="op">)</span>, overwrite<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>We represent the second latent variable interpolated at Madagascar scale.</p>
<p><img src="Madagascar_files/figure-html/RST-W2-1.png" width="800" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2" number="6">
<h2 id="representation-of-results-at-the-madagascar-scale">
<span class="header-section-number">6</span> Representation of results at the Madagascar scale<a class="anchor" aria-label="anchor" href="#representation-of-results-at-the-madagascar-scale"></a>
</h2>
<div class="section level3" number="6.1">
<h3 id="predictives-maps-of-presence-probabilities">
<span class="header-section-number">6.1</span> Predictives maps of presence probabilities<a class="anchor" aria-label="anchor" href="#predictives-maps-of-presence-probabilities"></a>
</h3>
<p>We calculate the probabilities of species presences between inventory sites using interpolated site’s parameters.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">remove</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># RST interpolation of sites parameters </span></span>
<span><span class="va">rst_alpha</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="st">"~/Documents/jSDM/vignettes/Madagascar_cache/alpha_rst_centered.tif"</span><span class="op">)</span></span>
<span><span class="va">rst_W1</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="st">"~/Documents/jSDM/vignettes/Madagascar_cache/W1_rst_centered.tif"</span><span class="op">)</span></span>
<span><span class="va">rst_W2</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="st">"~/Documents/jSDM/vignettes/Madagascar_cache/W2_rst_centered.tif"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Species parameters </span></span>
<span><span class="va">params_species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/params_species.csv"</span><span class="op">)</span></span>
<span><span class="va">nsp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">params_species</span><span class="op">)</span></span>
<span><span class="co"># Current climatic variables </span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/X.csv"</span><span class="op">)</span></span>
<span><span class="va">scaled_clim_var</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/scaled_clim.tif"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">scaled_clim_var</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="va">scaled_clim_var</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="va">rst_alpha</span><span class="op">)</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">scaled_clim_var</span><span class="op">)</span> <span class="op">!=</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">rst_alpha</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">scaled_clim_var</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/project.html" class="external-link">project</a></span><span class="op">(</span><span class="va">scaled_clim_var</span>, <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">rst_alpha</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Function to compute probit_theta at Madagascar scale </span></span>
<span><span class="va">predfun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">scaled_clim_var</span>, <span class="va">params_species</span>, <span class="va">rst_alpha</span>, <span class="va">rst_W1</span>, <span class="va">rst_W2</span>, <span class="va">species.range</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">lambda_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">params_species</span><span class="op">[</span>,<span class="st">"lambda_1"</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">lambda_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span> <span class="va">params_species</span><span class="op">[</span>,<span class="st">"lambda_2"</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">params_species</span><span class="op">[</span>,<span class="fl">3</span><span class="op">:</span><span class="fl">13</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">## Xbeta_1</span></span>
<span>  <span class="va">np</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html" class="external-link">nlyr</a></span><span class="op">(</span><span class="va">scaled_clim_var</span><span class="op">)</span></span>
<span>  <span class="va">Xbeta_1</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span>ncols<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">rst_alpha</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, nrows<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">rst_alpha</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>                         ext<span class="op">=</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="va">rst_alpha</span><span class="op">)</span>, crs<span class="op">=</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">rst_alpha</span><span class="op">)</span>,</span>
<span>                         resolution<span class="op">=</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html" class="external-link">res</a></span><span class="op">(</span><span class="va">rst_alpha</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">Xbeta_1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">beta</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html" class="external-link">ncell</a></span><span class="op">(</span><span class="va">Xbeta_1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">p</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">np</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">Xbeta_1</span> <span class="op">&lt;-</span> <span class="va">Xbeta_1</span> <span class="op">+</span> <span class="va">scaled_clim_var</span><span class="op">[[</span><span class="va">p</span><span class="op">]</span><span class="op">]</span><span class="op">*</span><span class="va">beta</span><span class="op">[</span><span class="fl">1</span>,<span class="va">p</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> </span>
<span>  <span class="op">}</span></span>
<span>  <span class="co">## Wlambda_1</span></span>
<span>  <span class="va">Wlambda_1</span> <span class="op">&lt;-</span> <span class="va">rst_W1</span><span class="op">*</span><span class="va">lambda_1</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">rst_W2</span><span class="op">*</span><span class="va">lambda_2</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="co">## probit_theta_1</span></span>
<span>  <span class="va">probit_theta_1</span> <span class="op">&lt;-</span> <span class="va">Xbeta_1</span> <span class="op">+</span> <span class="va">Wlambda_1</span> <span class="op">+</span> <span class="va">rst_alpha</span></span>
<span>  <span class="va">probit_theta</span> <span class="op">&lt;-</span> <span class="va">probit_theta_1</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">remove</a></span><span class="op">(</span>list<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"probit_theta_1"</span>,<span class="st">"Wlambda_1"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co">## Other species</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="op">(</span><span class="va">species.range</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="va">species.range</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co">## Xbeta_j</span></span>
<span>    <span class="va">Xbeta_j</span> <span class="op">&lt;-</span> <span class="va">Xbeta_1</span></span>
<span>    <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">Xbeta_j</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">beta</span><span class="op">[</span><span class="va">j</span>,<span class="fl">1</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html" class="external-link">ncell</a></span><span class="op">(</span><span class="va">Xbeta_j</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">p</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">np</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">Xbeta_j</span> <span class="op">&lt;-</span> <span class="va">Xbeta_j</span> <span class="op">+</span> <span class="va">scaled_clim_var</span><span class="op">[[</span><span class="va">p</span><span class="op">]</span><span class="op">]</span><span class="op">*</span><span class="va">beta</span><span class="op">[</span><span class="va">j</span>,<span class="va">p</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> </span>
<span>    <span class="op">}</span></span>
<span>    <span class="co">## Wlambda_j</span></span>
<span>    <span class="va">Wlambda_j</span> <span class="op">&lt;-</span> <span class="va">rst_W1</span><span class="op">*</span><span class="va">lambda_1</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">+</span> <span class="va">rst_W2</span><span class="op">*</span><span class="va">lambda_2</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>  </span>
<span>    <span class="co">## probit_theta_j</span></span>
<span>    <span class="va">probit_theta_j</span> <span class="op">&lt;-</span> <span class="va">Xbeta_j</span> <span class="op">+</span> <span class="va">Wlambda_j</span> <span class="op">+</span> <span class="va">rst_alpha</span></span>
<span>    <span class="va">probit_theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">probit_theta</span>, <span class="va">probit_theta_j</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">remove</a></span><span class="op">(</span>list<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"probit_theta_j"</span>, <span class="st">"Xbeta_j"</span>, <span class="st">"Wlambda_j"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">probit_theta</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/make.names.html" class="external-link">make.names</a></span><span class="op">(</span><span class="va">params_species</span><span class="op">$</span><span class="va">species</span><span class="op">[</span><span class="va">species.range</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">:</span><span class="va">species.range</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">probit_theta</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Compute theta in ten parts because it's too large</span></span>
<span><span class="va">npart</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">first.species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">nsp</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">nsp</span><span class="op">/</span><span class="va">npart</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">n</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">npart</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">probit_theta</span> <span class="op">&lt;-</span> <span class="fu">predfun</span><span class="op">(</span><span class="va">scaled_clim_var</span>, <span class="va">params_species</span>,</span>
<span>                          <span class="va">rst_alpha</span>, <span class="va">rst_W1</span>, <span class="va">rst_W2</span>,</span>
<span>                          species.range<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">first.species</span><span class="op">[</span><span class="va">n</span><span class="op">]</span>,</span>
<span>                                          <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">nsp</span>,<span class="va">first.species</span><span class="op">[</span><span class="va">n</span><span class="op">]</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">nsp</span><span class="op">/</span><span class="va">npart</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/writeRaster.html" class="external-link">writeRaster</a></span><span class="op">(</span><span class="va">probit_theta</span>,</span>
<span>                     filename<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/RST_centered_probit_theta_"</span>, <span class="va">n</span>, <span class="st">".tif"</span><span class="op">)</span>,</span>
<span>                     filetype<span class="op">=</span><span class="st">"GTiff"</span>,</span>
<span>                     gdal<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"COMPRESS=LZW"</span>, <span class="st">"PREDICTOR=2"</span><span class="op">)</span>, overwrite<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="co"># Compute and save SpatRaster of probabilities of presence theta</span></span>
<span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/app.html" class="external-link">app</a></span><span class="op">(</span><span class="va">probit_theta</span>, <span class="va">pnorm</span>, cores<span class="op">=</span><span class="fl">2</span>,</span>
<span>             filename<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/RST_centered_theta_"</span>,<span class="va">n</span>,<span class="st">".tif"</span><span class="op">)</span>, overwrite<span class="op">=</span><span class="cn">TRUE</span>, wopt<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>gdal<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"COMPRESS=LZW"</span>, <span class="st">"PREDICTOR=2"</span><span class="op">)</span>, filetype<span class="op">=</span><span class="st">"GTiff"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">remove</a></span><span class="op">(</span><span class="va">probit_theta</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We represent the presence probabilities of two species interpolated at the scale of Madagascar as well as their observed occurrences at the inventory sites represented by black crosses.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params_species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/params_species.csv"</span><span class="op">)</span></span>
<span><span class="va">nsp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">params_species</span><span class="op">)</span></span>
<span><span class="va">xy</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="st">"/home/clement/Documents/projet_BioSceneMada/Internship_Report/data/coords.shp"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">madagascar</span>, package<span class="op">=</span><span class="st">"jSDM"</span><span class="op">)</span></span>
<span><span class="va">PA</span> <span class="op">&lt;-</span> <span class="va">madagascar</span></span>
<span><span class="co"># Observed presence absence</span></span>
<span><span class="va">id_pres_Ocotea</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">PA</span><span class="op">[</span>,<span class="st">"sp_1"</span><span class="op">]</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">obs_pres_Ocotea</span> <span class="op">&lt;-</span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/coords.html" class="external-link">crds</a></span><span class="op">(</span><span class="va">xy</span><span class="op">[</span><span class="va">id_pres_Ocotea</span>,<span class="op">]</span><span class="op">)</span>,</span>
<span>                                type<span class="op">=</span><span class="st">"point"</span>, crs<span class="op">=</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">xy</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">id_pres_Manilkara</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">PA</span><span class="op">[</span>,<span class="st">"sp_6"</span><span class="op">]</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">obs_pres_Manilkara</span> <span class="op">&lt;-</span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/coords.html" class="external-link">crds</a></span><span class="op">(</span><span class="va">xy</span><span class="op">[</span><span class="va">id_pres_Manilkara</span>,<span class="op">]</span><span class="op">)</span>,</span>
<span>                                   type<span class="op">=</span><span class="st">"point"</span>, crs<span class="op">=</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">xy</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Representation</span></span>
<span><span class="va">npart</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">first.species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">nsp</span>,by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">nsp</span><span class="op">/</span><span class="va">npart</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/RST_theta_1.tif"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"sp_"</span>, <span class="va">first.species</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">:</span><span class="op">(</span><span class="va">first.species</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">nsp</span><span class="op">/</span><span class="va">npart</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, oma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>, mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">4</span>, <span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">theta</span><span class="op">$</span><span class="va">sp_1</span>,</span>
<span>            main<span class="op">=</span><span class="st">"Ocotea.laevis"</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">obs_pres_Ocotea</span>, pch<span class="op">=</span><span class="fl">3</span>, cex<span class="op">=</span><span class="fl">0.7</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">theta</span><span class="op">$</span><span class="va">sp_6</span>,</span>
<span>            main<span class="op">=</span><span class="st">"Manilkara.hexandra"</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">obs_pres_Manilkara</span>, pch<span class="op">=</span><span class="fl">3</span>, cex<span class="op">=</span><span class="fl">0.7</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span>main<span class="op">=</span><span class="st">"Interpolated current probabilities of presence"</span>,</span>
<span>      outer<span class="op">=</span><span class="cn">T</span>, cex.main<span class="op">=</span><span class="fl">1.3</span><span class="op">)</span></span></code></pre></div>
<p><img src="Madagascar_files/figure-html/plot-theta-1.png" width="800" style="display: block; margin: auto;"></p>
<p>We can see that the areas with high estimated probabilities of occurrence for these species correspond well to the inventory sites where these species have been observed.</p>
</div>
<div class="section level3" number="6.2">
<h3 id="predictive-maps-of-species-richness-diversity-alpha">
<span class="header-section-number">6.2</span> Predictive maps of species richness (diversity <span class="math inline">\(\alpha\)</span>)<a class="anchor" aria-label="anchor" href="#predictive-maps-of-species-richness-diversity-alpha"></a>
</h3>
<p>Species richness also called diversity <span class="math inline">\(\alpha\)</span> reflects the number of species coexisting in a given environment and is computed by summing the number of species present on each site.</p>
<div class="section level4" number="6.2.1">
<h4 id="current-species-richness">
<span class="header-section-number">6.2.1</span> Current species richness<a class="anchor" aria-label="anchor" href="#current-species-richness"></a>
</h4>
<p>We compute at Madagascar scale the species richness by summing the interpolated probabilities of occurrence for each map’s cell <span class="math inline">\(i\)</span> : <span class="math inline">\(\widehat{R}_i=\sum\limits_ {j=1}^{n_{species}} \widehat{\theta}_{ij}\)</span>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/RST_theta_1.tif"</span><span class="op">)</span></span>
<span><span class="va">species_richness</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/app.html" class="external-link">app</a></span><span class="op">(</span><span class="va">theta</span>, <span class="va">sum</span><span class="op">)</span></span>
<span><span class="va">npart</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">n</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">npart</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/RST_theta_"</span>,</span>
<span>                              <span class="va">n</span>, <span class="st">".tif"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">species_richness</span> <span class="op">&lt;-</span> <span class="va">species_richness</span> <span class="op">+</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/app.html" class="external-link">app</a></span><span class="op">(</span><span class="va">theta</span>, <span class="va">sum</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">species_richness</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"species_richness"</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/writeRaster.html" class="external-link">writeRaster</a></span><span class="op">(</span><span class="va">species_richness</span>,</span>
<span>                   filename<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/species_richness.tif"</span><span class="op">)</span>, </span>
<span>                   filetype<span class="op">=</span><span class="st">"GTiff"</span>, gdal<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"COMPRESS=LZW"</span>, <span class="st">"PREDICTOR=2"</span><span class="op">)</span>, overwrite<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4" number="6.2.2">
<h4 id="current-species-richness-restricted-to-forest-cover">
<span class="header-section-number">6.2.2</span> Current species richness restricted to forest cover<a class="anchor" aria-label="anchor" href="#current-species-richness-restricted-to-forest-cover"></a>
</h4>
<p>However, the model used does not take into account human presence, which is manifested in particular by the deforestation of the island, so we use data on remaining forest cover in 2000 from the article <span class="citation">Vieilledent <em>et al.</em> (<a href="#ref-Vieilledent2018" role="doc-biblioref">2018</a>)</span> in order to replace with zero values the interpolated species richness at locations where forest is known to have been removed.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidyverse/glue" class="external-link">glue</a></span><span class="op">)</span></span>
<span><span class="co"># raster of Madagascar's forest cover in 2000</span></span>
<span><span class="va">forest</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/for2000.tif"</span><span class="op">)</span></span>
<span><span class="co"># change resolution of species richness raster from 1000x1000m to 30x30m</span></span>
<span><span class="va">in_f</span> <span class="op">&lt;-</span> <span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/species_richness.tif"</span></span>
<span><span class="va">out_f</span> <span class="op">&lt;-</span> <span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/species_richness_30m.tif"</span></span>
<span><span class="va">cmd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">'gdalwarp -tr 30 30 -te {xmin(forest)} {ymin(forest)} {xmax(forest)} {ymax(forest)} -r near -co "COMPRESS=LZW" -co "PREDICTOR=2" -overwrite {in_f} {out_f}'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="va">cmd</span><span class="op">)</span></span>
<span><span class="co"># remove species richness values where there was no forest in 2000s</span></span>
<span><span class="va">species_richness</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/species_richness_30m.tif"</span><span class="op">)</span></span>
<span><span class="va">species_richness_deforest</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/mask.html" class="external-link">mask</a></span><span class="op">(</span><span class="va">species_richness</span>, <span class="va">forest</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/writeRaster.html" class="external-link">writeRaster</a></span><span class="op">(</span><span class="va">species_richness_deforest</span>,</span>
<span>                   filename<span class="op">=</span><span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/species_richness_deforest.tif"</span>,</span>
<span>                   filetype<span class="op">=</span><span class="st">"GTiff"</span>, gdal<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"COMPRESS=LZW"</span>, <span class="st">"PREDICTOR=2"</span><span class="op">)</span>, overwrite<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="Madagascar_files/figure-html/plot-species-richness-deforest-1.png" width="800" style="display: block; margin: auto;"><img src="Madagascar_files/figure-html/plot-species-richness-deforest-2.png" width="800" style="display: block; margin: auto;"></p>
<p>We can see that the species richness, computed from interpolated occurrence probabilities, is greater in the moist forest of the north-east of the island, particularly in the Masoala peninsula as expected given the observed species richness on inventory sites.<br>
It can be explained by the fact that this area is located close to the
Equator and is receiving the highest level of precipitation in
Madagascar. As a consequence, this area benefits from high levels of
resources (light and water) and is characterized by a low environmental
stress and a long growing season <span class="citation">(<a href="#ref-Vieilledent2013" role="doc-biblioref">Vieilledent <em>et al.</em> 2013</a>)</span>.</p>
<p>Note that the estimated species richness does not necessarily stand for
a ‘true’ number of present species but represent a relative species
richness between sites (one site is richer in species than another site).</p>
</div>
</div>
<div class="section level3" number="6.3">
<h3 id="predictive-maps-of-species-turnover-diversity-beta">
<span class="header-section-number">6.3</span> Predictive maps of species turnover (diversity <span class="math inline">\(\beta\)</span>)<a class="anchor" aria-label="anchor" href="#predictive-maps-of-species-turnover-diversity-beta"></a>
</h3>
<p>Diversity <span class="math inline">\(\beta\)</span> is a measure of biodiversity that compares the diversity of species between ecosystems or along environmental gradients, using the number of taxa that are unique to each ecosystem.</p>
<p>In order to estimate this indicator, we proceed in the same way as in the article <span class="citation">Allnutt <em>et al.</em> (<a href="#ref-Allnutt2008" role="doc-biblioref">2008</a>)</span> by performing a standard PCA on the interpolated probabilities of occurrence of species for each pixel of the displayed image. We use the coordinates obtained for the first three axes of the PCA that reflect the composition of the species community likely to occupy the corresponding pixel. These coordinates are scaled <span class="math inline">\([0.255]\)</span> so that they can be represented by red color levels for the first axis, green for the second and blue for the third. The combination of these three color levels determines the coloring of each pixel in the displayed <span class="math inline">\(\beta\)</span> diversity map. Therefore, a color difference between two pixels indicates that the species present are not the same, while pixels of identical color host communities of similar species.</p>
<div class="section level4" number="6.3.1">
<h4 id="current-species-turn-over">
<span class="header-section-number">6.3.1</span> Current species turn-over<a class="anchor" aria-label="anchor" href="#current-species-turn-over"></a>
</h4>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Sample 10000 cells of presence probabilities raster</span></span>
<span><span class="va">npart</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/RST_theta_1.tif"</span><span class="op">)</span></span>
<span><span class="va">samp_theta</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/sample.html" class="external-link">spatSample</a></span><span class="op">(</span><span class="va">theta</span>, size<span class="op">=</span><span class="fl">10000</span>, method<span class="op">=</span><span class="st">"random"</span>,</span>
<span>                                ext<span class="op">=</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span>, cells<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">samp_cells</span> <span class="op">&lt;-</span> <span class="va">samp_theta</span><span class="op">[</span>,<span class="st">"cell"</span><span class="op">]</span></span>
<span><span class="va">samp_theta</span> <span class="op">&lt;-</span> <span class="va">samp_theta</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">n</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">npart</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/RST_theta_"</span>, <span class="va">n</span>, <span class="st">".tif"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">samp_theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">samp_theta</span>, <span class="va">theta</span><span class="op">[</span><span class="va">samp_cells</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">params_species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/params_species.csv"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">samp_theta</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">params_species</span><span class="op">$</span><span class="va">species</span></span>
<span></span>
<span><span class="co"># Data frame to compute PCA on pixels dissimilarity </span></span>
<span><span class="va">theta_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">samp_theta</span><span class="op">)</span></span>
<span><span class="va">pca_theta</span> <span class="op">&lt;-</span> <span class="fu">ade4</span><span class="fu">::</span><span class="fu">dudi.pca</span><span class="op">(</span><span class="va">theta_df</span>, center<span class="op">=</span><span class="cn">TRUE</span>, scale<span class="op">=</span><span class="cn">TRUE</span>, nf<span class="op">=</span><span class="fl">3</span>, scannf <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">pca_theta</span>, <span class="va">samp_cells</span>, file<span class="op">=</span><span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/PCA_theta.RData"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">pca_theta</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Perform projections of PCA results on all raster's rows in parallel</span></span>
<span><span class="co"># Coordinates on the 3 axes retained in the PCA</span></span>
<span><span class="va">coords</span> <span class="op">&lt;-</span> <span class="va">theta</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">coords</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">0</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">coords</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">pca_theta</span><span class="op">$</span><span class="va">li</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">k</span>, <span class="st">"/"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span>,<span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/RST_theta_1.tif"</span><span class="op">)</span></span>
<span>  <span class="co">## Make a cluster for parallel computation</span></span>
<span>  <span class="co"># detect the number of CPU cores on the current host</span></span>
<span>  <span class="va">ncores</span> <span class="op">&lt;-</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">clust</span> <span class="op">&lt;-</span> <span class="fu">makeCluster</span><span class="op">(</span><span class="va">ncores</span><span class="op">)</span></span>
<span>  <span class="fu">registerDoParallel</span><span class="op">(</span><span class="va">clust</span><span class="op">)</span></span>
<span>  <span class="va">theta_k</span> <span class="op">&lt;-</span> <span class="fu">foreach</span><span class="op">(</span>n<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="va">npart</span>, .combine <span class="op">=</span> <span class="st">"cbind"</span><span class="op">)</span> <span class="op">%dopar%</span><span class="op">{</span></span>
<span>    <span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/RST_theta_"</span>,</span>
<span>                                <span class="va">n</span>, <span class="st">".tif"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">theta_k</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">theta</span>, row<span class="op">=</span><span class="va">k</span>, nrows<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">theta_k</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu">stopCluster</span><span class="op">(</span><span class="va">clust</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">theta_k</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">params_species</span><span class="op">$</span><span class="va">species</span></span>
<span>  <span class="va">theta_k</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">theta_k</span><span class="op">)</span></span>
<span>  <span class="va">coords</span><span class="op">[</span><span class="va">k</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu">ade4</span><span class="fu">::</span><span class="fu">suprow</span><span class="op">(</span><span class="va">pca_theta</span>,<span class="va">theta_k</span><span class="op">)</span><span class="op">$</span><span class="va">lisup</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/writeRaster.html" class="external-link">writeRaster</a></span><span class="op">(</span><span class="va">coords</span>,</span>
<span>                   filename<span class="op">=</span><span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/coords.tif"</span>,</span>
<span>                   filetype<span class="op">=</span><span class="st">"GTiff"</span>, gdal<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"COMPRESS=LZW"</span>, <span class="st">"PREDICTOR=2"</span><span class="op">)</span>, overwrite<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Change the coordinate scale for [0.255]. </span></span>
<span><span class="co">## Min reduced to 0</span></span>
<span><span class="va">Min</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/minmax.html" class="external-link">minmax</a></span><span class="op">(</span><span class="va">coords</span><span class="op">)</span><span class="op">[</span><span class="st">"min"</span>,<span class="op">]</span></span>
<span><span class="va">Min</span></span>
<span><span class="va">coords_RGB</span> <span class="op">&lt;-</span> <span class="va">coords</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">l</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">coords_RGB</span><span class="op">[[</span><span class="va">l</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">coords</span><span class="op">[[</span><span class="va">l</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="va">Min</span><span class="op">[</span><span class="va">l</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">Min2</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/minmax.html" class="external-link">minmax</a></span><span class="op">(</span><span class="va">coords_RGB</span><span class="op">)</span><span class="op">[</span><span class="st">"min"</span>,<span class="op">]</span></span>
<span><span class="va">Min2</span></span>
<span><span class="co">## Max at 255</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">remove</a></span><span class="op">(</span><span class="va">coords</span><span class="op">)</span></span>
<span><span class="va">Max</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/minmax.html" class="external-link">minmax</a></span><span class="op">(</span><span class="va">coords_RGB</span><span class="op">)</span><span class="op">[</span><span class="st">"max"</span>,<span class="op">]</span></span>
<span><span class="va">Max</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">l</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">coords_RGB</span><span class="op">[[</span><span class="va">l</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">coords_RGB</span><span class="op">[[</span><span class="va">l</span><span class="op">]</span><span class="op">]</span> <span class="op">/</span> <span class="va">Max</span><span class="op">[</span><span class="va">l</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="fl">255</span></span>
<span><span class="op">}</span></span>
<span><span class="va">Max2</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/minmax.html" class="external-link">minmax</a></span><span class="op">(</span><span class="va">coords_RGB</span><span class="op">)</span><span class="op">[</span><span class="st">"max"</span>,<span class="op">]</span></span>
<span><span class="va">Max2</span></span>
<span></span>
<span><span class="co"># Coloration RGB</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/writeRaster.html" class="external-link">writeRaster</a></span><span class="op">(</span><span class="va">coords_RGB</span>,</span>
<span>                   filename<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/species_turnover.tif"</span><span class="op">)</span>,</span>
<span>                   filetype<span class="op">=</span><span class="st">"GTiff"</span>, gdal<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"COMPRESS=LZW"</span>, <span class="st">"PREDICTOR=2"</span><span class="op">)</span>, overwrite<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4" number="6.3.2">
<h4 id="current-species-turn-over-restricted-to-forest-cover">
<span class="header-section-number">6.3.2</span> Current species turn over restricted to forest cover<a class="anchor" aria-label="anchor" href="#current-species-turn-over-restricted-to-forest-cover"></a>
</h4>
<p>In the same way as above, we restrict the values obtained for diversity <span class="math inline">\(\beta\)</span> to the forest cover remaining in 2000.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidyverse/glue" class="external-link">glue</a></span><span class="op">)</span></span>
<span><span class="co"># raster of Madagascar's forest cover in 2000</span></span>
<span><span class="va">forest</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/for2000.tif"</span><span class="op">)</span></span>
<span><span class="co"># current species turnover</span></span>
<span><span class="co"># change resolution of species richness raster from 1000x1000m to 30x30m</span></span>
<span><span class="va">in_f</span> <span class="op">&lt;-</span> <span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/species_turnover.tif"</span></span>
<span><span class="va">out_f</span> <span class="op">&lt;-</span> <span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/species_turnover_30m.tif"</span></span>
<span><span class="va">cmd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">'gdalwarp -tr 30 30 -te {xmin(forest)} {ymin(forest)} {xmax(forest)} {ymax(forest)} -r near -co "COMPRESS=LZW" -co "PREDICTOR=2" -overwrite {in_f} {out_f}'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="va">cmd</span><span class="op">)</span></span>
<span><span class="co"># remove species richness values where there was no forest in 2000s</span></span>
<span><span class="va">species_turnover</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/species_turnover_30m.tif"</span><span class="op">)</span></span>
<span><span class="va">species_turnover_deforest</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/mask.html" class="external-link">mask</a></span><span class="op">(</span><span class="va">species_turnover</span>,<span class="va">forest</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/writeRaster.html" class="external-link">writeRaster</a></span><span class="op">(</span><span class="va">species_turnover_deforest</span>,</span>
<span>                   filename<span class="op">=</span><span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/species_turnover_deforest.tif"</span>,</span>
<span>                   filetype<span class="op">=</span><span class="st">"GTiff"</span>, gdal<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"COMPRESS=LZW"</span>, <span class="st">"PREDICTOR=2"</span><span class="op">)</span>, overwrite<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Representation of species turn over restricted to forest cover in 2000's</span></span>
<span><span class="va">species_turnover_current</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/species_turnover_30m.tif"</span><span class="op">)</span></span>
<span><span class="va">species_turnover_deforest</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="st">"~/Documents/projet_BioSceneMada/Internship_Report/data/species_turnover_deforest.tif"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plotRGB.html" class="external-link">plotRGB</a></span><span class="op">(</span><span class="va">species_turnover_current</span>, stretch<span class="op">=</span><span class="st">"hist"</span>,</span>
<span>               mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>        main<span class="op">=</span><span class="st">"Estimated current species turn over"</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plotRGB.html" class="external-link">plotRGB</a></span><span class="op">(</span><span class="va">species_turnover_deforest</span>, stretch<span class="op">=</span><span class="st">"hist"</span>,</span>
<span>               mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, </span>
<span>               main<span class="op">=</span><span class="st">"Current species turn over on forest cover"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Madagascar_files/figure-html/plot-diversity-beta-1.png" width="800" style="display: block; margin: auto;"></p>

<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:plot-forest-type"></span>
<img src="Madagascar_files/figure-html/mada_forest_type.jpg" alt="Forest types in Madagascar (Vieilledent et al. 2018)." width="280"><p class="caption">
Figure 6.1: <strong><em>Forest types in Madagascar</em></strong> <span class="citation">(<a href="#ref-Vieilledent2018" role="doc-biblioref">Vieilledent <em>et al.</em> 2018</a>)</span>.
</p>
</div>
<p>We can see that the estimated map of <span class="math inline">\(\beta\)</span>-diversity agrees with the map of Madagascar’s forest types from the article <span class="citation">Vieilledent <em>et al.</em> (<a href="#ref-Vieilledent2018" role="doc-biblioref">2018</a>)</span>.</p>
<p>Indeed, communities of species represented by shades of blue and green correspond to the eastern moist forest, communities represented by shades of red match the western dry forest and communities in magenta correspond to the southern spiny forest.</p>
<p>Moreover, the <span class="math inline">\(\beta\)</span>-diversity map we obtain allows to identify substantially different species communities within these three forest types. For example, we can clearly identify three different tree communities (in blue, green, and black) within the eastern moist forest.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Albert1993" class="csl-entry">
Albert, J.H. &amp; Siddhartha, C. (1993) <a href="https://doi.org/10.1080/01621459.1993.10476321" class="external-link">Bayesian analysis of binary and polychotomous response data</a>. <em>Journal of the American Statistical Association</em>, <strong>88</strong>, 669–679.
</div>
<div id="ref-Allnutt2008" class="csl-entry">
Allnutt, T.F., Ferrier, S., Manion, G., Powell, G.V.N., Ricketts, T.H., Fisher, B.L., Harper, G.J., Irwin, M.E., Kremen, C., Labat, J.-N., Lees, D.C., Pearce, T.A. &amp; Rakotondrainibe, F. (2008) <a href="https://doi.org/10.1111/j.1755-263X.2008.00027.x" class="external-link">A method for quantifying biodiversity loss and its application to a 50-year record of deforestation across <span>Madagascar</span></a>. <em>Conservation Letters</em>, <strong>1</strong>, 173–181.
</div>
<div id="ref-Mitasova1993" class="csl-entry">
Mitášová, H. &amp; Hofierka, J. (1993) <a href="https://doi.org/10.1007/BF00893172" class="external-link">Interpolation by regularized spline with tension: <span>II</span>. <span>Application</span> to terrain modeling and surface geometry analysis</a>. <em>Mathematical Geology</em>, <strong>25</strong>, 657–669.
</div>
<div id="ref-Scherrer2020" class="csl-entry">
Scherrer, D., Mod, H.K. &amp; Guisan, A. (2020) <a href="https://doi.org/10.1111/2041-210X.13312" class="external-link">How to evaluate community predictions without thresholding?</a> <em>Methods in Ecology and Evolution</em>, <strong>11</strong>, 51–63.
</div>
<div id="ref-Vieilledent2013" class="csl-entry">
Vieilledent, G., Cornu, C., Cuní Sanchez, A., Leong Pock-Tsy, J.-M. &amp; Danthu, P. (2013) <a href="https://doi.org/10.1016/j.biocon.2013.06.007" class="external-link">Vulnerability of baobab species to climate change and effectiveness of the protected area network in <span>Madagascar</span>: <span>Towards</span> new conservation priorities</a>. <em>Biological Conservation</em>, <strong>166</strong>, 11–22.
</div>
<div id="ref-Vieilledent2018" class="csl-entry">
Vieilledent, G., Grinand, C., Rakotomalala, F.A., Ranaivosoa, R., Rakotoarijaona, J.-R., Allnutt, T.F. &amp; Achard, F. (2018) <a href="https://doi.org/10.1016/j.biocon.2018.04.008" class="external-link">Combining global tree cover loss data with historical national forest cover maps to look at six decades of deforestation and forest fragmentation in <span>Madagascar</span></a>. <em>Biological Conservation</em>, <strong>222</strong>, 189–197.
</div>
<div id="ref-Warton2015" class="csl-entry">
Warton, D.I., Blanchet, F.G., O’Hara, R.B., Ovaskainen, O., Taskinen, S., Walker, S.C. &amp; Hui, F.K.C. (2015) <a href="https://doi.org/10.1016/j.tree.2015.09.007" class="external-link">So many variables: Joint modeling in community ecology</a>. <em>Trends in Ecology &amp; Evolution</em>, <strong>30</strong>, 766–779.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://jeanneclement.github.io/" class="external-link">Jeanne Clément</a>, <a href="https://ecology.ghislainv.fr" class="external-link">Ghislain Vieilledent</a>, <a href="https://www.cirad.fr" class="external-link"><img src="https://ecology.ghislainv.fr/jSDM/logos/logo-cirad.png"></a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>

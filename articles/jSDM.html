<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Get started with jSDM • jSDM</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Get started with jSDM">
<meta property="og:description" content="jSDM">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">jSDM</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/jSDM.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Change log</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ghislainv/jSDM" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Get started with jSDM</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ghislainv/jSDM/blob/HEAD/vignettes/jSDM.Rmd" class="external-link"><code>vignettes/jSDM.Rmd</code></a></small>
      <div class="hidden name"><code>jSDM.Rmd</code></div>

    </div>

    
    
<div class="section level2" number="1">
<h2 id="jsdm-package">
<span class="header-section-number">1</span> jSDM package<a class="anchor" aria-label="anchor" href="#jsdm-package"></a>
</h2>
<p><code>jSDM</code> is an R package for fitting joint species distribution models (JSDM) in a hierarchical Bayesian framework.</p>
<p>The Gibbs sampler is written in C++. It uses Rcpp, Armadillo and GSL to maximize computation efficiency.</p>
<table class="table">
<thead><tr class="header">
<th align="left">Package:</th>
<th align="left">jSDM</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Type:</td>
<td align="left">Package</td>
</tr>
<tr class="even">
<td align="left">Version:</td>
<td align="left">0.2.1</td>
</tr>
<tr class="odd">
<td align="left">Date:</td>
<td align="left">2019-01-11</td>
</tr>
<tr class="even">
<td align="left">License:</td>
<td align="left">GPL-3</td>
</tr>
<tr class="odd">
<td align="left">LazyLoad:</td>
<td align="left">yes</td>
</tr>
</tbody>
</table>
<p>The package includes the following functions to fit various species distribution models :</p>
<table class="table">
<thead><tr class="header">
<th align="left">function</th>
<th align="left">data type</th>
<th align="center">data format</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code><a href="../reference/jSDM_binomial_logit.html">jSDM_binomial_logit()</a></code></td>
<td align="left">presence-absence</td>
<td align="center">wide</td>
</tr>
<tr class="even">
<td align="left"><code><a href="../reference/jSDM_binomial_probit.html">jSDM_binomial_probit()</a></code></td>
<td align="left">presence-absence</td>
<td align="center">wide</td>
</tr>
<tr class="odd">
<td align="left"><code><a href="../reference/jSDM_binomial_probit_sp_constrained.html">jSDM_binomial_probit_sp_constrained()</a></code></td>
<td align="left">presence-absence</td>
<td align="center">wide</td>
</tr>
<tr class="even">
<td align="left"><code><a href="../reference/jSDM_binomial_probit_long_format.html">jSDM_binomial_probit_long_format()</a></code></td>
<td align="left">presence-absence</td>
<td align="center">long</td>
</tr>
<tr class="odd">
<td align="left"><code><a href="../reference/jSDM_poisson_log.html">jSDM_poisson_log()</a></code></td>
<td align="left">abundance</td>
<td align="center">wide</td>
</tr>
<tr class="even">
<td align="left"><code><a href="../reference/jSDM_gaussian.html">jSDM_gaussian()</a></code></td>
<td align="left">continuous</td>
<td align="center">wide</td>
</tr>
</tbody>
</table>
<ul>
<li>
<p><code><a href="../reference/jSDM_binomial_probit.html">jSDM_binomial_probit()</a></code> :</p>
<p><strong>Ecological process:</strong></p>
<p><span class="math display">\[y_{ij} \sim \mathcal{B}ernoulli(\theta_{ij}),\]</span>
where</p>
<table class="table">
<colgroup>
<col width="47%">
<col width="52%">
</colgroup>
<thead><tr class="header">
<th align="left">conditions</th>
<th align="left">model specification</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">if <code>n_latent=0</code> and <code>site_effect="none"</code>
</td>
<td align="left">probit<span class="math inline">\((\theta_{ij}) = \beta_{0j} + X_i \beta_j\)</span>
</td>
</tr>
<tr class="even">
<td align="left">if <code>n_latent&gt;0</code> and <code>site_effect="none"</code>
</td>
<td align="left">probit<span class="math inline">\((\theta_{ij}) = \beta_{0j} + X_i \beta_j + W_i \lambda_j\)</span>
</td>
</tr>
<tr class="odd">
<td align="left">if <code>n_latent=0</code> and <code>site_effect="random"</code>
</td>
<td align="left">probit<span class="math inline">\((\theta_{ij}) = \beta_{0j} + X_i \beta_j + \alpha_i\)</span> and <span class="math inline">\(\alpha_i \sim \mathcal{N}(0,V_\alpha)\)</span>
</td>
</tr>
<tr class="even">
<td align="left">if <code>n_latent&gt;0</code> and <code>site_effect="fixed"</code>
</td>
<td align="left">probit<span class="math inline">\((\theta_{ij}) = \beta_{0j} + X_i \beta_j + W_i \lambda_j + \alpha_i\)</span>
</td>
</tr>
<tr class="odd">
<td align="left">if <code>n_latent=0</code> and <code>site_effect="fixed"</code>
</td>
<td align="left">probit<span class="math inline">\((\theta_{ij}) = \beta_{0j} + X_i \beta_j + \alpha_i\)</span>
</td>
</tr>
<tr class="even">
<td align="left">if <code>n_latent&gt;0</code> and <code>site_effect="random"</code>
</td>
<td align="left">probit<span class="math inline">\((\theta_{ij}) = \beta_{0j} + X_i \beta_j + W_i \lambda_j + \alpha_i\)</span> and <span class="math inline">\(\alpha_i \sim \mathcal{N}(0,V_\alpha)\)</span>
</td>
</tr>
</tbody>
</table>
</li>
<li>
<p><code><a href="../reference/jSDM_binomial_probit_sp_constrained.html">jSDM_binomial_probit_sp_constrained()</a></code> :</p>
<p>This function allows to fit the same models than the function <code>jSDM_binomial_probit</code> except for models not including latent variables, indeed <code>n_latent</code> must be greater than zero in this function.<br>
At first, the function fit a JSDM with the constrained species arbitrarily chosen as the first ones in the presence-absence data-set.<br>
Then, the function evaluates the convergence of MCMC <span class="math inline">\(\lambda\)</span> chains using the Gelman-Rubin convergence diagnostic <span class="citation">(<a href="#ref-Gelman1992" role="doc-biblioref">Gelman &amp; Rubin 1992</a>)</span> (<span class="math inline">\(\hat{R}\)</span>). It identifies the species (<span class="math inline">\(\hat{j}_l\)</span>) having the higher <span class="math inline">\(\hat{R}\)</span> for <span class="math inline">\(\lambda_{\hat{j}_l}\)</span>. These species drive the structure of the latent axis <span class="math inline">\(l\)</span>. The <span class="math inline">\(\lambda\)</span> corresponding to this species are constrained to be positive and placed on the diagonal of the <span class="math inline">\(\Lambda\)</span> matrix for fitting a second model.<br>
This usually improves the convergence of the latent variables and factor loadings. The function returns the parameter posterior distributions for this second model.</p>
</li>
<li>
<p><code><a href="../reference/jSDM_binomial_logit.html">jSDM_binomial_logit()</a></code> :</p>
<p><strong>Ecological process : </strong></p>
<p><span class="math display">\[y_{ij} \sim \mathcal{B}inomial(\theta_{ij},t_i),\]</span>
where</p>
<table class="table">
<colgroup>
<col width="43%">
<col width="56%">
</colgroup>
<thead><tr class="header">
<th align="left">conditions</th>
<th align="left">model specification</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">if <code>n_latent=0</code> and <code>site_effect="none"</code>
</td>
<td align="left">logit<span class="math inline">\((\theta_{ij}) = \beta_{0j} + X_i \beta_j\)</span>
</td>
</tr>
<tr class="even">
<td align="left">if <code>n_latent&gt;0</code> and <code>site_effect="none"</code>
</td>
<td align="left">logit<span class="math inline">\((\theta_{ij}) = \beta_{0j} + X_i \beta_j + W_i \lambda_j\)</span>
</td>
</tr>
<tr class="odd">
<td align="left">if <code>n_latent=0</code> and <code>site_effect="fixed"</code>
</td>
<td align="left">logit<span class="math inline">\((\theta_{ij}) = \beta_{0j} + X_i \beta_j + \alpha_i\)</span>
</td>
</tr>
<tr class="even">
<td align="left">if <code>n_latent&gt;0</code> and <code>site_effect="fixed"</code>
</td>
<td align="left">logit<span class="math inline">\((\theta_{ij}) = \beta_{0j} + X_i \beta_j + W_i \lambda_j + \alpha_i\)</span>
</td>
</tr>
<tr class="odd">
<td align="left">if <code>n_latent=0</code> and <code>site_effect="random"</code>
</td>
<td align="left">logit<span class="math inline">\((\theta_{ij}) = \beta_{0j} + X_i \beta_j + \alpha_i\)</span> and <span class="math inline">\(\alpha_i \sim \mathcal{N}(0,V_{\alpha})\)</span>
</td>
</tr>
<tr class="even">
<td align="left">if <code>n_latent&gt;0</code> and <code>site_effect="random"</code>
</td>
<td align="left">logit<span class="math inline">\((\theta_{ij}) = \beta_{0j} + X_i \beta_j + W_i \lambda_j + \alpha_i\)</span> and <span class="math inline">\(\alpha_i \sim \mathcal{N}(0,V_\alpha)\)</span>
</td>
</tr>
</tbody>
</table>
</li>
<li>
<p><code><a href="../reference/jSDM_poisson_log.html">jSDM_poisson_log()</a></code> :</p>
<p><strong>Ecological process : </strong></p>
<p><span class="math display">\[y_{ij} \sim \mathcal{P}oisson(\theta_{ij}),\]</span></p>
<p>where</p>
<table class="table">
<colgroup>
<col width="43%">
<col width="56%">
</colgroup>
<thead><tr class="header">
<th align="left">conditions</th>
<th align="left">model specification</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">if <code>n_latent=0</code> and <code>site_effect="none"</code>
</td>
<td align="left">log<span class="math inline">\((\theta_{ij}) = \beta_{0j} + X_i \beta_j\)</span>
</td>
</tr>
<tr class="even">
<td align="left">if <code>n_latent&gt;0</code> and <code>site_effect="none"</code>
</td>
<td align="left">log<span class="math inline">\((\theta_{ij}) = \beta_{0j} + X_i \beta_j + W_i \lambda_j\)</span>
</td>
</tr>
<tr class="odd">
<td align="left">if <code>n_latent=0</code> and <code>site_effect="fixed"</code>
</td>
<td align="left">log<span class="math inline">\((\theta_{ij}) = \beta_{0j} + X_i \beta_j + \alpha_i\)</span>
</td>
</tr>
<tr class="even">
<td align="left">if <code>n_latent&gt;0</code> and <code>site_effect="fixed"</code>
</td>
<td align="left">log<span class="math inline">\((\theta_{ij}) = \beta_{0j} + X_i \beta_j + W_i \lambda_j + \alpha_i\)</span>
</td>
</tr>
<tr class="odd">
<td align="left">if <code>n_latent=0</code> and <code>site_effect="random"</code>
</td>
<td align="left">log<span class="math inline">\((\theta_{ij}) = \beta_{0j} + X_i \beta_j + \alpha_i\)</span> and <span class="math inline">\(\alpha_i \sim \mathcal{N}(0,V_\alpha)\)</span>
</td>
</tr>
<tr class="even">
<td align="left">if <code>n_latent&gt;0</code> and <code>site_effect="random"</code>
</td>
<td align="left">log<span class="math inline">\((\theta_{ij}) = \beta_{0j} + X_i \beta_j + W_i \lambda_j + \alpha_i\)</span> and <span class="math inline">\(\alpha_i \sim \mathcal{N}(0,V_\alpha)\)</span>
</td>
</tr>
</tbody>
</table>
</li>
<li>
<p><code><a href="../reference/jSDM_binomial_probit_long_format.html">jSDM_binomial_probit_long_format()</a></code> :</p>
<p><strong>Ecological process:</strong></p>
<p><span class="math display">\[y_{n} \sim \mathcal{B}ernoulli(\theta_n),\]</span>
such as <span class="math inline">\(species_n=j\)</span> and <span class="math inline">\(site_n=i\)</span>,
where</p>
<table class="table">
<colgroup>
<col width="47%">
<col width="52%">
</colgroup>
<thead><tr class="header">
<th align="left">conditions</th>
<th align="left">model specification</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">if <code>n_latent=0</code> and <code>site_effect="none"</code>
</td>
<td align="left">probit<span class="math inline">\((\theta_n) = D_n \gamma + X_n \beta_j\)</span>
</td>
</tr>
<tr class="even">
<td align="left">if <code>n_latent&gt;0</code> and <code>site_effect="none"</code>
</td>
<td align="left">probit<span class="math inline">\((\theta_n) = D_n \gamma + X_n \beta_j + W_i \lambda_j\)</span>
</td>
</tr>
<tr class="odd">
<td align="left">if <code>n_latent=0</code> and <code>site_effect="random"</code>
</td>
<td align="left">probit<span class="math inline">\((\theta_n) = D_n \gamma + X_n \beta_j + \alpha_i\)</span> and <span class="math inline">\(\alpha_i \sim \mathcal{N}(0,V_\alpha)\)</span>
</td>
</tr>
<tr class="even">
<td align="left">if <code>n_latent&gt;0</code> and <code>site_effect="fixed"</code>
</td>
<td align="left">probit<span class="math inline">\((\theta_n) = D_n \gamma + X_n \beta_j + W_i \lambda_j + \alpha_i\)</span>
</td>
</tr>
<tr class="odd">
<td align="left">if <code>n_latent=0</code> and <code>site_effect="fixed"</code>
</td>
<td align="left">probit<span class="math inline">\((\theta_n) = D_n \gamma + X_n \beta_j + \alpha_i\)</span>
</td>
</tr>
<tr class="even">
<td align="left">if <code>n_latent&gt;0</code> and <code>site_effect="random"</code>
</td>
<td align="left">probit<span class="math inline">\((\theta_n) = D_n \gamma + X_n \beta_j + W_i \lambda_j + \alpha_i\)</span> and <span class="math inline">\(\alpha_i \sim \mathcal{N}(0,V_\alpha)\)</span>
</td>
</tr>
</tbody>
</table>
</li>
<li>
<p><code><a href="../reference/jSDM_gaussian.html">jSDM_gaussian()</a></code> :</p>
<p><strong>Ecological process:</strong></p>
<p><span class="math display">\[y_{ij} \sim \mathcal{N}(\theta_{ij}, V),\]</span>
where</p>
<table class="table">
<colgroup>
<col width="47%">
<col width="52%">
</colgroup>
<thead><tr class="header">
<th align="left">conditions</th>
<th align="left">model specification</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">if <code>n_latent=0</code> and <code>site_effect="none"</code>
</td>
<td align="left"><span class="math inline">\(\theta_{ij} = \beta_{0j} + X_i \beta_j\)</span></td>
</tr>
<tr class="even">
<td align="left">if <code>n_latent&gt;0</code> and <code>site_effect="none"</code>
</td>
<td align="left"><span class="math inline">\(\theta_{ij} = \beta_{0j} + X_i \beta_j + W_i \lambda_j\)</span></td>
</tr>
<tr class="odd">
<td align="left">if <code>n_latent=0</code> and <code>site_effect="random"</code>
</td>
<td align="left">
<span class="math inline">\(\theta_{ij} = \beta_{0j} + X_i \beta_j + \alpha_i\)</span> and <span class="math inline">\(\alpha_i \sim \mathcal{N}(0,V_\alpha)\)</span>
</td>
</tr>
<tr class="even">
<td align="left">if <code>n_latent&gt;0</code> and <code>site_effect="fixed"</code>
</td>
<td align="left"><span class="math inline">\(\theta_{ij} = \beta_{0j} + X_i \beta_j + W_i \lambda_j + \alpha_i\)</span></td>
</tr>
<tr class="odd">
<td align="left">if <code>n_latent=0</code> and <code>site_effect="fixed"</code>
</td>
<td align="left"><span class="math inline">\(\theta_{ij} = \beta_{0j} + X_i \beta_j + \alpha_i\)</span></td>
</tr>
<tr class="even">
<td align="left">if <code>n_latent&gt;0</code> and <code>site_effect="random"</code>
</td>
<td align="left">
<span class="math inline">\(\theta_{ij} = \beta_{0j} + X_i \beta_j + W_i \lambda_j + \alpha_i\)</span> and <span class="math inline">\(\alpha_i \sim \mathcal{N}(0,V_\alpha)\)</span>
</td>
</tr>
</tbody>
</table>
<p>Joint Species distribution models (jSDM) are useful tools to explain or predict species range and abundance from various environmental factors and species correlations <span class="citation">(<a href="#ref-Warton2015" role="doc-biblioref">Warton <em>et al.</em> 2015</a>)</span>. jSDM is becoming an increasingly popular statistical method in conservation biology.</p>
</li>
</ul>
<p>In this vignette, we illustrate the use of the <code>jSDM</code> R package which aims at providing user-friendly statistical functions using field observations (occurrence or abundance data) to fit jSDMs models.</p>
<p>Package’s functions are developed in a hierarchical Bayesian framework and use adaptive rejection Metropolis sampling algorithms or conjugate priors within Gibbs sampling to estimate model’s parameters. Using compiled C++ code for the Gibbs sampler reduce drastically the computation time. By making these new statistical tools available to the scientific community, we hope to democratize the use of more complex, but more realistic, statistical models for increasing knowledge in ecology and conserving biodiversity.</p>
<center>
<strong>Directed Acyclic Graph (DAG)</strong>
</center>

<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:plot-DAG"></span>
<img src="figures/DAG-jSDM-rand.png" alt="A graphical summary of the jSDM-package statistical framework. In this Directed Acyclic Graph (DAG), the orange boxes refer to data, the blue ellipses to parameters to be estimated, and the arrows to functional relationships described with the help of statistical distributions." width="500"><p class="caption">
Figure 1.1: A graphical summary of the <code>jSDM-package</code> statistical framework. In this Directed Acyclic Graph (DAG), the orange boxes refer to data, the blue ellipses to parameters to be estimated, and the arrows to functional relationships described with the help of statistical distributions.
</p>
</div>
<p>Model types available in <code>jSDM</code> R package are not limited to those described in this example. <code>jSDM</code> includes various model types for occurrence and abundance data, you can find more examples of use on the <a href="https://ecology.ghislainv.fr/jSDM/" class="external-link">jSDM website</a>.</p>
</div>
<div class="section level2" number="2">
<h2 id="load-librairies">
<span class="header-section-number">2</span> Load librairies<a class="anchor" aria-label="anchor" href="#load-librairies"></a>
</h2>
<p>We first load the <code>jSDM</code> library.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ecology.ghislainv.fr/jSDM/" class="external-link">jSDM</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; ##</span></span>
<span><span class="co">#&gt; ## jSDM R package </span></span>
<span><span class="co">#&gt; ## For joint species distribution models </span></span>
<span><span class="co">#&gt; ## https://ecology.ghislainv.fr/jSDM </span></span>
<span><span class="co">#&gt; ##</span></span></code></pre></div>
</div>
<div class="section level2" number="3">
<h2 id="bernoulli-probit-regression">
<span class="header-section-number">3</span> Bernoulli probit regression<a class="anchor" aria-label="anchor" href="#bernoulli-probit-regression"></a>
</h2>
<p>Below, we show an example of the use of <code>jSDM-package</code> for fitting species distribution model to occurence data for 9 frog’s species.</p>
<div class="section level3" number="3.1">
<h3 id="definition-of-the-model">
<span class="header-section-number">3.1</span> Definition of the model<a class="anchor" aria-label="anchor" href="#definition-of-the-model"></a>
</h3>
<p>Referring to the models used in the articles <span class="citation">Warton <em>et al.</em> (<a href="#ref-Warton2015" role="doc-biblioref">2015</a>)</span> and <span class="citation">Albert &amp; Siddhartha (<a href="#ref-Albert1993" role="doc-biblioref">1993</a>)</span>, we define the following model :</p>
<p><span class="math display">\[ \mathrm{probit}(\theta_{ij}) =\alpha_i + \beta_{0j}+X_i.\beta_j+ W_i.\lambda_j \]</span></p>
<ul>
<li><p>Link function probit: <span class="math inline">\(\mathrm{probit}: q \rightarrow \Phi^{-1}(q)\)</span> where <span class="math inline">\(\Phi\)</span> correspond to the repartition function of the reduced centred normal distribution.</p></li>
<li><p>Response variable: <span class="math inline">\(Y=(y_{ij})^{i=1,\ldots,nsite}_{j=1,\ldots,nsp}\)</span> with:</p></li>
</ul>
<p><span class="math display">\[y_{ij}=\begin{cases}
0 &amp; \text{ if species $j$ is absent on the site $i$}\\
1 &amp;  \text{ if species  $j$ is present on the site $i$}.
\end{cases}\]</span></p>
<ul>
<li>Latent variable <span class="math inline">\(z_{ij} = \alpha_i + \beta_{0j} + X_i.\beta_j + W_i.\lambda_j + \epsilon_{i,j}\)</span>, with <span class="math inline">\(\forall (i,j) \ \epsilon_{ij} \sim \mathcal{N}(0,1)\)</span> and such that:</li>
</ul>
<p><span class="math display">\[y_{ij}=\begin{cases}
1 &amp; \text{if} \ z_{ij} &gt; 0 \\
0 &amp;  \text{otherwise.}
\end{cases}\]</span></p>
<p>It can be easily shown that: <span class="math inline">\(y_{ij} \sim \mathcal{B}ernoulli(\theta_{ij})\)</span>.</p>
<ul>
<li><p>Latent variables: <span class="math inline">\(W_i=(W_i^1,\ldots,W_i^q)\)</span> where <span class="math inline">\(q\)</span> is the number of latent variables considered, which has to be fixed by the user (by default q=2).
We assume that <span class="math inline">\(W_i \sim \mathcal{N}(0,I_q)\)</span> and we define the associated coefficients: <span class="math inline">\(\lambda_j=(\lambda_j^1,\ldots, \lambda_j^q)'\)</span>. We use a prior distribution <span class="math inline">\(\mathcal{N}(0,1)\)</span> for all lambdas not concerned by constraints to <span class="math inline">\(0\)</span> on upper diagonal and to strictly positive values on diagonal.</p></li>
<li><p>Explanatory variables: bioclimatic data about each site. <span class="math inline">\(X=(X_i)_{i=1,\ldots,nsite}\)</span> with <span class="math inline">\(X_i=(x_i^1,\ldots,x_i^p)\in \mathbb{R}^p\)</span> where <span class="math inline">\(p\)</span> is the number of bioclimatic variables considered.
The corresponding regression coefficients for each species <span class="math inline">\(j\)</span> are noted : <span class="math inline">\(\beta_j=(\beta_j^1,\ldots,\beta_j^p)'\)</span>.</p></li>
<li><p><span class="math inline">\(\beta_{0j}\)</span> correspond to the intercept for species <span class="math inline">\(j\)</span> which is assume to be a fixed effect. We use a prior distribution <span class="math inline">\(\mathcal{N}(0,1)\)</span> for all betas.</p></li>
<li><p><span class="math inline">\(\alpha_i\)</span> represents the random effect of site <span class="math inline">\(i\)</span> such as <span class="math inline">\(\alpha_i \sim \mathcal{N}(0,V_{\alpha})\)</span> and we assumed that <span class="math inline">\(V_{\alpha} \sim \mathcal {IG}(\text{shape}=0.1, \text{rate}=0.1)\)</span> as prior distribution by default.</p></li>
</ul>
</div>
<div class="section level3" number="3.2">
<h3 id="occurrence-data-set">
<span class="header-section-number">3.2</span> Occurrence data-set<a class="anchor" aria-label="anchor" href="#occurrence-data-set"></a>
</h3>

<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:frog-picture"></span>
<img src="figures/Litoria_ewingii.jpg" alt="Litoria ewingii (Wilkinson et al. 2019)." width="400" height="300"><p class="caption">
Figure 3.1: <strong><em>Litoria ewingii</em></strong> <span class="citation">(<a href="#ref-Wilkinson2019" role="doc-biblioref">Wilkinson <em>et al.</em> 2019</a>)</span>.
</p>
</div>
<p>This data-set is available in <a href="https://ecology.ghislainv.fr/jSDM/reference/jSDM-package.html" class="external-link"><code>jSDM-package</code></a>. It can be loaded with the <code><a href="https://rdrr.io/r/utils/data.html" class="external-link">data()</a></code> command. The <a href="https://ecology.ghislainv.fr/jSDM/reference/frogs.html" class="external-link"><code>frogs</code></a> dataset is in “wide” format: each line is a site and the occurrence data (from Species_1 to Species_9) are in columns. A site is characterized by its x-y geographical coordinates, one discrete covariate and two other continuous covariates.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># frogs data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">frogs</span>, package<span class="op">=</span><span class="st">"jSDM"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">frogs</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Covariate_1 Covariate_2 Covariate_3 Species_1 Species_2 Species_3 Species_4</span></span>
<span><span class="co">#&gt; 1    3.870111           0    0.045334         1         0         0         0</span></span>
<span><span class="co">#&gt; 2    3.326950           1    0.115903         0         0         0         0</span></span>
<span><span class="co">#&gt; 3    2.856729           1    0.147034         0         0         0         0</span></span>
<span><span class="co">#&gt; 4    1.623249           1    0.124283         0         0         0         0</span></span>
<span><span class="co">#&gt; 5    4.629685           1    0.081655         0         0         0         0</span></span>
<span><span class="co">#&gt; 6    0.698970           1    0.107048         0         0         0         0</span></span>
<span><span class="co">#&gt;   Species_5 Species_6 Species_7 Species_8 Species_9        y        x</span></span>
<span><span class="co">#&gt; 1         0         0         0         0         0 66.41479 9.256424</span></span>
<span><span class="co">#&gt; 2         0         1         0         0         0 67.03841 9.025588</span></span>
<span><span class="co">#&gt; 3         0         1         0         0         0 67.03855 9.029416</span></span>
<span><span class="co">#&gt; 4         0         1         0         0         0 67.04200 9.029745</span></span>
<span><span class="co">#&gt; 5         0         1         0         0         0 67.04439 9.026514</span></span>
<span><span class="co">#&gt; 6         0         0         0         0         0 67.03894 9.023580</span></span></code></pre></div>
<p>We rearrange the data in two data-sets: a first one for the presence-absence observations for each species (columns) at each site (rows), and a second one for the site characteristics.</p>
<p>We also normalize the continuous explanatory variables to facilitate MCMC convergence.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># data.obs</span></span>
<span><span class="va">PA_frogs</span> <span class="op">&lt;-</span> <span class="va">frogs</span><span class="op">[</span>,<span class="fl">4</span><span class="op">:</span><span class="fl">12</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Normalized continuous variables</span></span>
<span><span class="va">Env_frogs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">frogs</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>,<span class="va">frogs</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,<span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">frogs</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">Env_frogs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">frogs</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3" number="3.3">
<h3 id="parameter-inference">
<span class="header-section-number">3.3</span> Parameter inference<a class="anchor" aria-label="anchor" href="#parameter-inference"></a>
</h3>
<p>We use the <code><a href="../reference/jSDM_binomial_probit.html">jSDM_binomial_probit()</a></code> function to fit the jSDM (increase the number of iterations to achieve convergence).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod_frogs_jSDM_probit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/jSDM_binomial_probit.html">jSDM_binomial_probit</a></span><span class="op">(</span></span>
<span>  <span class="co"># Chains</span></span>
<span>  burnin<span class="op">=</span><span class="fl">1000</span>, mcmc<span class="op">=</span><span class="fl">1000</span>, thin<span class="op">=</span><span class="fl">1</span>,</span>
<span>  <span class="co"># Response variable </span></span>
<span>  presence_data <span class="op">=</span> <span class="va">PA_frogs</span>, </span>
<span>  <span class="co"># Explanatory variables </span></span>
<span>  site_formula <span class="op">=</span> <span class="op">~</span><span class="va">.</span>,   </span>
<span>  site_data <span class="op">=</span> <span class="va">Env_frogs</span>,</span>
<span>  <span class="co"># Model specification </span></span>
<span>  n_latent<span class="op">=</span><span class="fl">2</span>, site_effect<span class="op">=</span><span class="st">"random"</span>,</span>
<span>  <span class="co"># Starting values</span></span>
<span>  alpha_start<span class="op">=</span><span class="fl">0</span>, beta_start<span class="op">=</span><span class="fl">0</span>,</span>
<span>  lambda_start<span class="op">=</span><span class="fl">0</span>, W_start<span class="op">=</span><span class="fl">0</span>,</span>
<span>  V_alpha<span class="op">=</span><span class="fl">1</span>, </span>
<span>  <span class="co"># Priors</span></span>
<span>  shape_Valpha<span class="op">=</span><span class="fl">0.1</span>,</span>
<span>  rate_Valpha<span class="op">=</span><span class="fl">0.1</span>,</span>
<span>  mu_beta<span class="op">=</span><span class="fl">0</span>, V_beta<span class="op">=</span><span class="fl">1</span>,</span>
<span>  mu_lambda<span class="op">=</span><span class="fl">0</span>, V_lambda<span class="op">=</span><span class="fl">1</span>,</span>
<span>  <span class="co"># Various </span></span>
<span>  seed<span class="op">=</span><span class="fl">1234</span>, verbose<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Running the Gibbs sampler. It may be long, please keep cool :)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **********:10.0% </span></span>
<span><span class="co">#&gt; **********:20.0% </span></span>
<span><span class="co">#&gt; **********:30.0% </span></span>
<span><span class="co">#&gt; **********:40.0% </span></span>
<span><span class="co">#&gt; **********:50.0% </span></span>
<span><span class="co">#&gt; **********:60.0% </span></span>
<span><span class="co">#&gt; **********:70.0% </span></span>
<span><span class="co">#&gt; **********:80.0% </span></span>
<span><span class="co">#&gt; **********:90.0% </span></span>
<span><span class="co">#&gt; **********:100.0%</span></span></code></pre></div>
</div>
<div class="section level3" number="3.4">
<h3 id="analysis-of-the-results">
<span class="header-section-number">3.4</span> Analysis of the results<a class="anchor" aria-label="anchor" href="#analysis-of-the-results"></a>
</h3>
<p>We visually evaluate the convergence of MCMCs by representing the trace and density <em>a posteriori</em> of some estimated parameters.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">np</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mod_frogs_jSDM_probit</span><span class="op">$</span><span class="va">model_spec</span><span class="op">$</span><span class="va">beta_start</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## beta_j of the first two species</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">p</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">np</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/traceplot.html" class="external-link">traceplot</a></span><span class="op">(</span><span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html" class="external-link">as.mcmc</a></span><span class="op">(</span><span class="va">mod_frogs_jSDM_probit</span><span class="op">$</span><span class="va">mcmc.sp</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">p</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/densplot.html" class="external-link">densplot</a></span><span class="op">(</span><span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html" class="external-link">as.mcmc</a></span><span class="op">(</span><span class="va">mod_frogs_jSDM_probit</span><span class="op">$</span><span class="va">mcmc.sp</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">p</span><span class="op">]</span><span class="op">)</span>, </span>
<span>                   main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mod_frogs_jSDM_probit</span><span class="op">$</span><span class="va">mcmc.sp</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="va">p</span><span class="op">]</span>,</span>
<span>                                <span class="st">", species : "</span>,<span class="va">j</span><span class="op">)</span>, cex.main<span class="op">=</span><span class="fl">0.9</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="jSDM_files/figure-html/plot-results-probit-1.png" style="display: block; margin: auto;"><img src="jSDM_files/figure-html/plot-results-probit-2.png" style="display: block; margin: auto;"><img src="jSDM_files/figure-html/plot-results-probit-3.png" style="display: block; margin: auto;"><img src="jSDM_files/figure-html/plot-results-probit-4.png" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">## lambda_j of the first two species</span></span>
<span><span class="va">n_latent</span> <span class="op">&lt;-</span> <span class="va">mod_frogs_jSDM_probit</span><span class="op">$</span><span class="va">model_spec</span><span class="op">$</span><span class="va">n_latent</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">l</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_latent</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/traceplot.html" class="external-link">traceplot</a></span><span class="op">(</span><span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html" class="external-link">as.mcmc</a></span><span class="op">(</span><span class="va">mod_frogs_jSDM_probit</span><span class="op">$</span><span class="va">mcmc.sp</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">np</span><span class="op">+</span><span class="va">l</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/densplot.html" class="external-link">densplot</a></span><span class="op">(</span><span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html" class="external-link">as.mcmc</a></span><span class="op">(</span><span class="va">mod_frogs_jSDM_probit</span><span class="op">$</span><span class="va">mcmc.sp</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">np</span><span class="op">+</span><span class="va">l</span><span class="op">]</span><span class="op">)</span>, </span>
<span>                   main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mod_frogs_jSDM_probit</span><span class="op">$</span><span class="va">mcmc.sp</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>                                <span class="op">[</span><span class="va">np</span><span class="op">+</span><span class="va">l</span><span class="op">]</span>,<span class="st">", species : "</span>,<span class="va">j</span><span class="op">)</span>, cex.main<span class="op">=</span><span class="fl">0.9</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="jSDM_files/figure-html/plot-results-probit-5.png" style="display: block; margin: auto;"><img src="jSDM_files/figure-html/plot-results-probit-6.png" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">## Latent variables W_i for the first two sites</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">l</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_latent</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/traceplot.html" class="external-link">traceplot</a></span><span class="op">(</span><span class="va">mod_frogs_jSDM_probit</span><span class="op">$</span><span class="va">mcmc.latent</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"lv_"</span>,<span class="va">l</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>,</span>
<span>                  main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Latent variable W_"</span>, <span class="va">l</span>, <span class="st">", site "</span>, <span class="va">i</span><span class="op">)</span>,</span>
<span>                  cex.main<span class="op">=</span><span class="fl">0.9</span><span class="op">)</span></span>
<span>  <span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/densplot.html" class="external-link">densplot</a></span><span class="op">(</span><span class="va">mod_frogs_jSDM_probit</span><span class="op">$</span><span class="va">mcmc.latent</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"lv_"</span>,<span class="va">l</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>,</span>
<span>                 main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Latent variable W_"</span>, <span class="va">l</span>, <span class="st">", site "</span>, <span class="va">i</span><span class="op">)</span>,</span>
<span>                 cex.main<span class="op">=</span><span class="fl">0.9</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="jSDM_files/figure-html/plot-results-probit-7.png" style="display: block; margin: auto;"><img src="jSDM_files/figure-html/plot-results-probit-8.png" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">## alpha_i of the first two sites</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html" class="external-link">as.mcmc</a></span><span class="op">(</span><span class="va">mod_frogs_jSDM_probit</span><span class="op">$</span><span class="va">mcmc.alpha</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="jSDM_files/figure-html/plot-results-probit-9.png" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">## V_alpha</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/traceplot.html" class="external-link">traceplot</a></span><span class="op">(</span><span class="va">mod_frogs_jSDM_probit</span><span class="op">$</span><span class="va">mcmc.V_alpha</span><span class="op">)</span></span>
<span><span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/densplot.html" class="external-link">densplot</a></span><span class="op">(</span><span class="va">mod_frogs_jSDM_probit</span><span class="op">$</span><span class="va">mcmc.V_alpha</span><span class="op">)</span></span>
<span><span class="co">## Deviance</span></span>
<span><span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/traceplot.html" class="external-link">traceplot</a></span><span class="op">(</span><span class="va">mod_frogs_jSDM_probit</span><span class="op">$</span><span class="va">mcmc.Deviance</span><span class="op">)</span></span>
<span><span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/densplot.html" class="external-link">densplot</a></span><span class="op">(</span><span class="va">mod_frogs_jSDM_probit</span><span class="op">$</span><span class="va">mcmc.Deviance</span><span class="op">)</span></span></code></pre></div>
<p><img src="jSDM_files/figure-html/plot-results-probit-10.png" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">## probit_theta</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span> <span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">mod_frogs_jSDM_probit</span><span class="op">$</span><span class="va">probit_theta_latent</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Predicted probit theta"</span>,</span>
<span>     xlab <span class="op">=</span><span class="st">"predicted probit theta"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">mod_frogs_jSDM_probit</span><span class="op">$</span><span class="va">theta_latent</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Predicted theta"</span>, </span>
<span>     xlab <span class="op">=</span><span class="st">"predicted theta"</span><span class="op">)</span></span></code></pre></div>
<p><img src="jSDM_files/figure-html/plot-results-probit-11.png" style="display: block; margin: auto;"></p>
<p>Overall, the traces and the densities of the parameters indicate the convergence of the algorithm. Indeed, we observe on the traces that the values oscillate around averages without showing an upward or downward trend and we see that the densities are quite smooth and for the most part of Gaussian form.</p>
</div>
<div class="section level3" number="3.5">
<h3 id="matrice-of-correlations">
<span class="header-section-number">3.5</span> Matrice of correlations<a class="anchor" aria-label="anchor" href="#matrice-of-correlations"></a>
</h3>
<p>After fitting the jSDM with latent variables, the <strong>full species residual correlation matrix</strong> <span class="math inline">\(R=(R_{ij})^{i=1,\ldots, n_{species}}_{j=1,\ldots, n_{species}}\)</span> can be derived from the covariance in the latent variables such as :
<span class="math display">\[\Sigma_{ij} = \lambda_i^T .\lambda_j \]</span>, then we compute correlations from covariances :
<span class="math display">\[R_{i,j} = \frac{\Sigma_{ij}}{\sqrt{\Sigma _{ii}\Sigma _{jj}}}\]</span>.</p>
<p>We use the function <code><a href="../reference/plot_residual_cor.html">plot_residual_cor()</a></code> to compute and display the residual correlation matrix between species :</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_residual_cor.html">plot_residual_cor</a></span><span class="op">(</span><span class="va">mod_frogs_jSDM_probit</span><span class="op">)</span></span></code></pre></div>
<p><img src="jSDM_files/figure-html/correlation-matrix-probit-1.png" style="display: block; margin: auto;"></p>
</div>
<div class="section level3" number="3.6">
<h3 id="predictions">
<span class="header-section-number">3.6</span> Predictions<a class="anchor" aria-label="anchor" href="#predictions"></a>
</h3>
<p>We use the <code><a href="../reference/predict.jSDM.html">predict.jSDM()</a></code> S3 method on the <code>mod_frogs_jSDM_probit</code> object of class <code>jSDM</code> to compute the mean (or expectation) of the posterior distributions obtained and get the expected values of model’s parameters.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Sites and species concerned by predictions :</span></span>
<span><span class="co">## 50 sites among the 104</span></span>
<span><span class="va">Id_sites</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">PA_frogs</span><span class="op">)</span>, <span class="fl">50</span><span class="op">)</span></span>
<span><span class="co">## All species </span></span>
<span><span class="va">Id_species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">PA_frogs</span><span class="op">)</span></span>
<span><span class="co"># Simulate new observations of covariates on those sites </span></span>
<span><span class="va">simdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>nrow<span class="op">=</span><span class="fl">50</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">mod_frogs_jSDM_probit</span><span class="op">$</span><span class="va">model_spec</span><span class="op">$</span><span class="va">site_data</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">simdata</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mod_frogs_jSDM_probit</span><span class="op">$</span><span class="va">model_spec</span><span class="op">$</span><span class="va">site_data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">simdata</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">Id_sites</span></span>
<span><span class="va">simdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">simdata</span><span class="op">)</span></span>
<span><span class="va">simdata</span><span class="op">$</span><span class="va">Covariate_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">50</span><span class="op">)</span></span>
<span><span class="va">simdata</span><span class="op">$</span><span class="va">Covariate_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">50</span><span class="op">)</span></span>
<span><span class="va">simdata</span><span class="op">$</span><span class="va">Covariate_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">50</span>,<span class="fl">1</span>,<span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Predictions </span></span>
<span><span class="va">theta_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">mod_frogs_jSDM_probit</span>, newdata<span class="op">=</span><span class="va">simdata</span>, Id_species<span class="op">=</span><span class="va">Id_species</span>,</span>
<span>                      Id_sites<span class="op">=</span><span class="va">Id_sites</span>, type<span class="op">=</span><span class="st">"mean"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">theta_pred</span>, main<span class="op">=</span><span class="st">"Predicted theta with simulated data"</span>, xlab<span class="op">=</span><span class="st">"predicted theta"</span><span class="op">)</span></span></code></pre></div>
<p><img src="jSDM_files/figure-html/predictions-probit-1.png" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Albert1993" class="csl-entry">
Albert, J.H. &amp; Siddhartha, C. (1993) <a href="https://doi.org/10.1080/01621459.1993.10476321" class="external-link">Bayesian analysis of binary and polychotomous response data</a>. <em>Journal of the American Statistical Association</em>, <strong>88</strong>, 669–679.
</div>
<div id="ref-Gelman1992" class="csl-entry">
Gelman, A. &amp; Rubin, D.B. (1992) <a href="https://doi.org/10.1214/ss/1177011136" class="external-link">Inference from <span>Iterative</span> <span>Simulation</span> <span>Using</span> <span>Multiple</span> <span>Sequences</span></a>. <em>Statistical Science</em>, <strong>7</strong>, 457–472.
</div>
<div id="ref-Warton2015" class="csl-entry">
Warton, D.I., Blanchet, F.G., O’Hara, R.B., Ovaskainen, O., Taskinen, S., Walker, S.C. &amp; Hui, F.K.C. (2015) <a href="https://doi.org/10.1016/j.tree.2015.09.007" class="external-link">So many variables: Joint modeling in community ecology</a>. <em>Trends in Ecology &amp; Evolution</em>, <strong>30</strong>, 766–779.
</div>
<div id="ref-Wilkinson2019" class="csl-entry">
Wilkinson, D.P., Golding, N., Guillera-Arroita, G., Tingley, R. &amp; McCarthy, M.A. (2019) <a href="https://doi.org/10.1111/2041-210X.13106" class="external-link">A comparison of joint species distribution models for presence-absence data</a>. <em>Methods in Ecology and Evolution</em>, <strong>10</strong>, 198–211.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://jeanneclement.github.io/" class="external-link">Jeanne Clément</a>, <a href="https://ecology.ghislainv.fr" class="external-link">Ghislain Vieilledent</a>, <a href="https://www.cirad.fr" class="external-link"><img src="https://ecology.ghislainv.fr/gecevar/articles/logos/logo-cirad.svg" height="24" style="height:24px;"></a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>

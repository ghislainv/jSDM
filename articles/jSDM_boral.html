<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Comparison jSDM-boral • jSDM</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Comparison jSDM-boral">
<meta property="og:description" content="jSDM">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">jSDM</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/jSDM.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Change log</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ghislainv/jSDM" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Comparison jSDM-boral</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ghislainv/jSDM/blob/HEAD/vignettes/jSDM_boral.Rmd" class="external-link"><code>vignettes/jSDM_boral.Rmd</code></a></small>
      <div class="hidden name"><code>jSDM_boral.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="models-definition">
<span class="header-section-number">1</span> Models definition<a class="anchor" aria-label="anchor" href="#models-definition"></a>
</h2>
<div class="section level3">
<h3 id="binomial-models-for-presence-absence-data">
<span class="header-section-number">1.1</span> Binomial models for presence-absence data<a class="anchor" aria-label="anchor" href="#binomial-models-for-presence-absence-data"></a>
</h3>
<p>We consider a latent variable model (LVM) to account for species co-occurrence <span class="citation">(Warton <em>et al.</em> <a href="#ref-Warton2015" role="doc-biblioref">2015</a>)</span> on all sites .</p>
<p><span class="math display">\[y_{ij} \sim \mathcal{B}iniomial(t_i, \theta_{ij})\]</span></p>
<p><span class="math display">\[ \mathrm{g}(\theta_{ij}) = \alpha_i + X_i\beta_j + W_i\lambda_j \]</span>
- <span class="math inline">\(\theta_{ij}\)</span>: occurrence probability of the species <span class="math inline">\(j\)</span> on site <span class="math inline">\(i\)</span>.
- <span class="math inline">\(t_i\)</span>: number of visits at site <span class="math inline">\(i\)</span>
- <span class="math inline">\(\mathrm{g}(\cdot)\)</span>: Link function (eg. logit or probit).</p>
<p>The inference method is able to handle only one visit by site with a <strong>probit</strong> link function so <span class="math inline">\(\forall i, \ t_i=1\)</span> and <span class="math display">\[y_{ij} \sim \mathcal{B}ernoulli(\theta_{ij})\]</span>.</p>
<ul>
<li><p><span class="math inline">\(\alpha_i\)</span>: Random effect of site <span class="math inline">\(i\)</span> such as <span class="math inline">\(\alpha_i \sim \mathcal{N}(0, V_{\alpha})\)</span>, corresponds to a mean suitability for site <span class="math inline">\(i\)</span>. We assumed that <span class="math inline">\(V_{\alpha} \sim \mathcal{IG}(\text{shape}=0.1, \text{rate}=0.1)\)</span> as prior distribution in <code>jSDM</code> package and that <span class="math inline">\(V_{\alpha} \sim \mathcal{U}(0,30)\)</span> in <code>boral</code> package.</p></li>
<li><p><span class="math inline">\(X_i\)</span>: Vector of explanatory variables for site <span class="math inline">\(i\)</span> with <span class="math inline">\(X_i=(x_i^1,\ldots,x_i^p)\in \mathbb{R}^p\)</span> where <span class="math inline">\(p\)</span> is the number of bio-climatic variables considered (including intercept <span class="math inline">\(\forall i, x_i^1=1\)</span>).</p></li>
<li><p><span class="math inline">\(\beta_j\)</span>: Effects of the explanatory variables on the probability of presence of species <span class="math inline">\(j\)</span> including species intercept (<span class="math inline">\(\beta_{0j}\)</span>). We use a prior distribution <span class="math inline">\(\beta_j \sim \mathcal{N}_p(0,\Sigma_{\beta})\)</span> with <span class="math inline">\(\Sigma_{\beta}\)</span> a diagonal matrix of size <span class="math inline">\(p \times p\)</span> whose values on the diagonal are fixed at <span class="math inline">\(10\)</span>.</p></li>
<li><p><span class="math inline">\(W_i\)</span>: Vector of random latent variables for site <span class="math inline">\(i\)</span>. <span class="math inline">\(W_i \sim N(0, 1)\)</span>. The number of latent variables <span class="math inline">\(q\)</span> must be fixed by the user (default to <span class="math inline">\(q=2\)</span>).</p></li>
<li><p><span class="math inline">\(\lambda_j\)</span>: Effects of the latent variables on the probability of presence of species <span class="math inline">\(j\)</span> also known as “factor loadings” <span class="citation">(Warton <em>et al.</em> <a href="#ref-Warton2015" role="doc-biblioref">2015</a>)</span>. We use the following prior distribution in both packages to constraint values to <span class="math inline">\(0\)</span> on upper diagonal and to strictly positive values on diagonal, for <span class="math inline">\(j=1,\ldots,J\)</span> and <span class="math inline">\(l=1,\ldots,q\)</span> : <span class="math display">\[\lambda_{jl} \sim \begin{cases}
\mathcal{N}(0,10) &amp; \text{if } l &lt; j \\
\mathcal{N}(0,10) \text{ left truncated by } 0 &amp; \text{if } l=j \\
P \text{ such as } \mathbb{P}(\lambda_{jl} = 0)=1  &amp; \text{if } l&gt;j
\end{cases}\]</span>.</p></li>
</ul>
<p>This model is equivalent to a multivariate GLMM <span class="math inline">\(\mathrm{g}(\theta_{ij}) =\alpha_i + X_i.\beta_j + u_{ij}\)</span>, where <span class="math inline">\(u_{ij} \sim \mathcal{N}(0, \Sigma)\)</span> with the constraint that the variance-covariance matrix <span class="math inline">\(\Sigma = \Lambda \Lambda^{\prime}\)</span>, where <span class="math inline">\(\Lambda\)</span> is the full matrix of factor loadings, with the <span class="math inline">\(\lambda_j\)</span> as its columns.</p>
</div>
<div class="section level3">
<h3 id="poisson-model-for-abundance-data">
<span class="header-section-number">1.2</span> Poisson model for abundance data<a class="anchor" aria-label="anchor" href="#poisson-model-for-abundance-data"></a>
</h3>
<p>Referring to the models used in the articles <span class="citation">(Hui <a href="#ref-Hui2016" role="doc-biblioref">2016</a>)</span>, we define the following model to account for species abundances on all sites.</p>
<p><span class="math display">\[y_{ij} \sim \mathcal{P}oisson(\theta_{ij})\]</span>.</p>
<p><span class="math display">\[ \mathrm{log}(\theta_{ij}) =\alpha_i + \beta_{0j} + X_i\beta_j + W_i\lambda_j \]</span></p>
<p>Using this models we can compute the <strong>full species residual correlation matrix</strong> <span class="math inline">\(R=(R_{ij})^{i=1,\ldots, nsp}_{j=1,\ldots, nsp}\)</span> from the covariance in the latent variables such as :
<span class="math display">\[\Sigma_{ij} = \begin{cases}
 \lambda_i .\lambda_j^T &amp; \text{ if } i \neq j \\
  \lambda_i .\lambda_j^T + 1 &amp; \text{ if } i=j
 \end{cases}\]</span>, then we compute correlations from covariances :
<span class="math display">\[R_{i,j} = \frac{\Sigma_{ij}}{\sqrt{\Sigma _{ii}\Sigma _{jj}}}\]</span>.</p>
</div>
</div>
<div class="section level2">
<h2 id="data-sets">
<span class="header-section-number">2</span> Data-sets<a class="anchor" aria-label="anchor" href="#data-sets"></a>
</h2>
<div class="section level3">
<h3 id="data-simulation">
<span class="header-section-number">2.1</span> Data simulation<a class="anchor" aria-label="anchor" href="#data-simulation"></a>
</h3>
<p>We start by simulating the dataset that we will then analyze among other real datasets.</p>
<p>We generate a data-set following the previous model with <span class="math inline">\(300\)</span> sites, <span class="math inline">\(100\)</span> species and as parameters :</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#==================</span>
<span class="co">#== Data simulation</span>
<span class="co">#==================</span>
<span class="co">#= Number of species</span>
<span class="va">nsp</span> <span class="op">&lt;-</span> <span class="fl">100</span>
<span class="co">#= Number of sites</span>
<span class="va">nsite</span> <span class="op">&lt;-</span> <span class="fl">300</span>
<span class="co">#= Number of latent variables</span>
<span class="va">nl</span> <span class="op">&lt;-</span> <span class="fl">2</span>
<span class="co">#= Set seed for repeatability</span>
<span class="va">seed</span> <span class="op">&lt;-</span> <span class="fl">1234</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="va">seed</span><span class="op">)</span>

<span class="co"># Ecological process (suitability)</span>
<span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">nsite</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>
<span class="va">x2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">nsite</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>
<span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">nsite</span><span class="op">)</span>,<span class="va">x1</span>,<span class="va">x2</span><span class="op">)</span>
<span class="va">np</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>
<span class="co">#= Latent variables W</span>
<span class="va">W</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">nsite</span><span class="op">*</span><span class="va">nl</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, nrow<span class="op">=</span><span class="va">nsite</span>, ncol<span class="op">=</span><span class="va">nl</span><span class="op">)</span>
<span class="co">#= Fixed species effect beta </span>
<span class="va">beta.target</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">nsp</span><span class="op">*</span><span class="va">np</span>,<span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, byrow<span class="op">=</span><span class="cn">TRUE</span>, nrow<span class="op">=</span><span class="va">nsp</span><span class="op">)</span><span class="op">)</span>
<span class="co">#= Factor loading lambda  </span>
<span class="va">mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">nsp</span><span class="op">*</span><span class="va">nl</span>,<span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, byrow<span class="op">=</span><span class="cn">TRUE</span>, nrow<span class="op">=</span><span class="va">nsp</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">nl</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>
<span class="va">lambda.target</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">nl</span>,<span class="va">nsp</span><span class="op">)</span>
<span class="va">lambda.target</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lower.tri.html" class="external-link">upper.tri</a></span><span class="op">(</span><span class="va">mat</span>,diag<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lower.tri.html" class="external-link">upper.tri</a></span><span class="op">(</span><span class="va">mat</span>, diag<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span>
<span class="co">#= Variance of random site effect </span>
<span class="va">V_alpha.target</span> <span class="op">&lt;-</span> <span class="fl">0.5</span>
<span class="co">#= Random site effect alpha</span>
<span class="va">alpha.target</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">nsite</span>,<span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">V_alpha.target</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Simulation of response data with probit link</span>
<span class="va">probit_theta</span> <span class="op">&lt;-</span> <span class="va">X</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta.target</span> <span class="op">+</span> <span class="va">W</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">lambda.target</span> <span class="op">+</span> <span class="va">alpha.target</span>
<span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="va">probit_theta</span><span class="op">)</span>
<span class="va">e</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">nsp</span><span class="op">*</span><span class="va">nsite</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,<span class="va">nsite</span>,<span class="va">nsp</span><span class="op">)</span>
<span class="co"># Latent variable Z </span>
<span class="va">Z_true</span> <span class="op">&lt;-</span> <span class="va">probit_theta</span> <span class="op">+</span> <span class="va">e</span>
<span class="co"># Presence-absence matrix Y</span>
<span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span> <span class="op">(</span><span class="cn">NA</span>, <span class="va">nsite</span>,<span class="va">nsp</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nsite</span><span class="op">)</span><span class="op">{</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nsp</span><span class="op">)</span><span class="op">{</span>
    <span class="kw">if</span> <span class="op">(</span> <span class="va">Z_true</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span><span class="va">Y</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">}</span>
    <span class="kw">else</span> <span class="op">{</span><span class="va">Y</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span><span class="op">}</span>
  <span class="op">}</span>
<span class="op">}</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="data-sets-description">
<span class="header-section-number">2.2</span> Data-sets description<a class="anchor" aria-label="anchor" href="#data-sets-description"></a>
</h3>
<p>Among the following data-sets, the presence-absence data are from the <span class="citation">(Wilkinson <em>et al.</em> <a href="#ref-Wilkinson2019" role="doc-biblioref">2019</a>)</span> article in which they are used to compare joint species distribution models for presence-absence data, the data-set that records the presence or absence of <code>birds</code> during several visits to each site is from the <span class="citation">(Kéry &amp; Schmid <a href="#ref-Kery2006" role="doc-biblioref">2006</a>)</span> article and the <code>mites</code> abundance data-set is from the <span class="citation">(Borcard &amp; Legendre <a href="#ref-Borcard1994" role="doc-biblioref">1994</a>)</span> article.</p>
<pre><code><span class="co">#&gt; ##</span>
<span class="co">#&gt; ## jSDM R package </span>
<span class="co">#&gt; ## For joint species distribution models </span>
<span class="co">#&gt; ## https://ecology.ghislainv.fr/jSDM </span>
<span class="co">#&gt; ##</span>
<span class="co">#&gt; Loading required package: coda</span>
<span class="co">#&gt; This is boral version 2.0. If you recently updated boral, please check news(package = "boral") for the updates in the latest version.</span></code></pre>
<table class="table table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
Simulated
</th>
<th style="text-align:left;">
Mosquitos
</th>
<th style="text-align:left;">
Eucalypts
</th>
<th style="text-align:left;">
Frogs
</th>
<th style="text-align:left;">
Fungi
</th>
<th style="text-align:left;">
Birds
</th>
<th style="text-align:left;">
Mites
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
data type
</td>
<td style="text-align:left;">
presence-absence
</td>
<td style="text-align:left;">
presence-absence
</td>
<td style="text-align:left;">
presence-absence
</td>
<td style="text-align:left;">
presence-absence
</td>
<td style="text-align:left;">
presence-absence
</td>
<td style="text-align:left;">
presence-absence
</td>
<td style="text-align:left;">
abundance
</td>
</tr>
<tr>
<td style="text-align:left;">
distribution
</td>
<td style="text-align:left;">
bernoulli
</td>
<td style="text-align:left;">
bernoulli
</td>
<td style="text-align:left;">
bernoulli
</td>
<td style="text-align:left;">
bernoulli
</td>
<td style="text-align:left;">
bernoulli
</td>
<td style="text-align:left;">
binomial
</td>
<td style="text-align:left;">
poisson
</td>
</tr>
<tr>
<td style="text-align:left;">
n.site
</td>
<td style="text-align:left;">
300
</td>
<td style="text-align:left;">
167
</td>
<td style="text-align:left;">
455
</td>
<td style="text-align:left;">
104
</td>
<td style="text-align:left;">
438
</td>
<td style="text-align:left;">
266
</td>
<td style="text-align:left;">
70
</td>
</tr>
<tr>
<td style="text-align:left;">
n.species
</td>
<td style="text-align:left;">
100
</td>
<td style="text-align:left;">
16
</td>
<td style="text-align:left;">
12
</td>
<td style="text-align:left;">
9
</td>
<td style="text-align:left;">
11
</td>
<td style="text-align:left;">
110
</td>
<td style="text-align:left;">
30
</td>
</tr>
<tr>
<td style="text-align:left;">
n.latent
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
n.X.coefs
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
14
</td>
<td style="text-align:left;">
8
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
13
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
12
</td>
</tr>
<tr>
<td style="text-align:left;">
n.obs
</td>
<td style="text-align:left;">
30000
</td>
<td style="text-align:left;">
2672
</td>
<td style="text-align:left;">
5460
</td>
<td style="text-align:left;">
936
</td>
<td style="text-align:left;">
4818
</td>
<td style="text-align:left;">
29260
</td>
<td style="text-align:left;">
2100
</td>
</tr>
<tr>
<td style="text-align:left;">
n.param
</td>
<td style="text-align:left;">
1400
</td>
<td style="text-align:left;">
757
</td>
<td style="text-align:left;">
1485
</td>
<td style="text-align:left;">
366
</td>
<td style="text-align:left;">
1479
</td>
<td style="text-align:left;">
1458
</td>
<td style="text-align:left;">
630
</td>
</tr>
<tr>
<td style="text-align:left;">
n.mcmc
</td>
<td style="text-align:left;">
15000
</td>
<td style="text-align:left;">
15000
</td>
<td style="text-align:left;">
15000
</td>
<td style="text-align:left;">
15000
</td>
<td style="text-align:left;">
15000
</td>
<td style="text-align:left;">
15000
</td>
<td style="text-align:left;">
15000
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
<img src="figures/des.jpg" width="100" height="100">
</td>
<td style="text-align:left;">
<img src="figures/Mosquitos_.jpg" width="100" height="100">
</td>
<td style="text-align:left;">
<img src="figures/Eucalyptus_.jpg" width="100" height="100">
</td>
<td style="text-align:left;">
<img src="figures/Frogs_.jpg" width="100" height="100">
</td>
<td style="text-align:left;">
<img src="figures/Fungi_.jpg" width="100" height="100">
</td>
<td style="text-align:left;">
<img src="figures/birds.jpg" width="100" height="100">
</td>
<td style="text-align:left;">
<img src="figures/oribatid-mites.png" width="100" height="100">
</td>
</tr>
</tbody>
</table>
<p>In the article <span class="citation">(Warton <em>et al.</em> <a href="#ref-Warton2015" role="doc-biblioref">2015</a>)</span> the fitting of joint species distributions models is performed using the package <code>boral</code> which runs with <code>JAGS</code> (Just Another Gibbs Sampler) a simulation program from hierarchical Bayesian models using MCMC methods implemented in C++.
This package and the package <code>jSDM</code> allow to fit the model defined previously, so we can compare the results obtained by each of them on different data-sets.</p>
</div>
</div>
<div class="section level2">
<h2 id="package-boral">
<span class="header-section-number">3</span> Package <code>boral</code><a class="anchor" aria-label="anchor" href="#package-boral"></a>
</h2>
<p>In a first step, we fit joint species distribution models from previous data-sets using the <code>boral()</code> function from package of the same name whose functionalities are developed in the article <span class="citation">(Hui <a href="#ref-Hui2016" role="doc-biblioref">2016</a>)</span>.</p>
<div class="section level3">
<h3 id="simulated-dataset">
<span class="header-section-number">3.1</span> Simulated dataset<a class="anchor" aria-label="anchor" href="#simulated-dataset"></a>
</h3>
<p>We fit a binomial joint species distribution model, including random site effect and latent variables, from the simulated data-set using the <code>boral()</code> function to perform binomial probit regression.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw">library</span>(boral)</span>
<span id="cb3-2"><a href="#cb3-2"></a>T1&lt;-<span class="kw">Sys.time</span>() </span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="kw">setwd</span>(<span class="kw">paste0</span>(<span class="kw">dirname</span>(rstudioapi<span class="op">::</span><span class="kw">getSourceEditorContext</span>()<span class="op">$</span>path),<span class="st">"/jSDM_boral_cache"</span>))</span>
<span id="cb3-4"><a href="#cb3-4"></a>mod_boral_sim &lt;-<span class="st"> </span><span class="kw">boral</span>(<span class="dt">y=</span>Y, <span class="dt">X=</span>X[,<span class="op">-</span><span class="dv">1</span>], <span class="dt">lv.control=</span><span class="kw">list</span>(<span class="dt">num.lv=</span>nl),</span>
<span id="cb3-5"><a href="#cb3-5"></a>                       <span class="dt">family=</span><span class="st">"binomial"</span>, <span class="dt">row.eff=</span><span class="st">"random"</span>,</span>
<span id="cb3-6"><a href="#cb3-6"></a>                       <span class="dt">prior.control =</span> <span class="kw">list</span>(<span class="dt">type =</span> <span class="kw">c</span>(<span class="st">"normal"</span>,<span class="st">"normal"</span>,<span class="st">"normal"</span>,<span class="st">"uniform"</span>),</span>
<span id="cb3-7"><a href="#cb3-7"></a>                                            <span class="dt">hypparams =</span> <span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">30</span>))</span>
<span id="cb3-8"><a href="#cb3-8"></a>                       <span class="dt">save.model=</span><span class="ot">TRUE</span>, <span class="dt">model.name=</span><span class="st">"sim_jagsboralmodel.txt"</span>, </span>
<span id="cb3-9"><a href="#cb3-9"></a>                       <span class="dt">mcmc.control=</span><span class="kw">list</span>(<span class="dt">n.burnin=</span><span class="dv">10000</span>, <span class="dt">n.iteration=</span><span class="dv">15000</span>,</span>
<span id="cb3-10"><a href="#cb3-10"></a>                                         <span class="dt">n.thin=</span><span class="dv">5</span>,<span class="dt">seed=</span><span class="dv">123</span>))</span>
<span id="cb3-11"><a href="#cb3-11"></a>T2&lt;-<span class="kw">Sys.time</span>() </span>
<span id="cb3-12"><a href="#cb3-12"></a>T_boral_sim=<span class="kw">difftime</span>(T2, T1)</span>
<span id="cb3-13"><a href="#cb3-13"></a></span>
<span id="cb3-14"><a href="#cb3-14"></a><span class="co"># Predicted probit(theta) </span></span>
<span id="cb3-15"><a href="#cb3-15"></a>probit_theta_latent_sim &lt;-<span class="st"> </span>mod_boral_sim<span class="op">$</span>row.coefs<span class="op">$</span>ID1<span class="op">$</span>mean <span class="op">+</span><span class="st"> </span></span>
<span id="cb3-16"><a href="#cb3-16"></a><span class="st">  </span>X[,<span class="op">-</span><span class="dv">1</span>] <span class="op">%*%</span><span class="st"> </span><span class="kw">t</span>(mod_boral_sim<span class="op">$</span>X.coefs.mean) <span class="op">+</span><span class="st"> </span></span>
<span id="cb3-17"><a href="#cb3-17"></a><span class="st">  </span><span class="kw">matrix</span>(mod_boral_sim<span class="op">$</span>lv.coefs.mean[,<span class="st">"beta0"</span>],<span class="dt">nrow=</span>nsite,<span class="dt">ncol=</span>nsp,<span class="dt">byrow=</span><span class="ot">TRUE</span>) <span class="op">+</span></span>
<span id="cb3-18"><a href="#cb3-18"></a><span class="st">  </span>mod_boral_sim<span class="op">$</span>lv.mean<span class="op">%*%</span><span class="kw">t</span>(mod_boral_sim<span class="op">$</span>lv.coefs.mean[,<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb3-19"><a href="#cb3-19"></a></span>
<span id="cb3-20"><a href="#cb3-20"></a>theta_latent_sim &lt;-<span class="st"> </span><span class="kw">pnorm</span>(probit_theta_latent_sim)</span>
<span id="cb3-21"><a href="#cb3-21"></a></span>
<span id="cb3-22"><a href="#cb3-22"></a><span class="co"># RMSE</span></span>
<span id="cb3-23"><a href="#cb3-23"></a>SE=(<span class="kw">pnorm</span>(probit_theta)<span class="op">-</span>theta_latent_sim)<span class="op">^</span><span class="dv">2</span></span>
<span id="cb3-24"><a href="#cb3-24"></a>RMSE_boral_sim=<span class="kw">sqrt</span>(<span class="kw">sum</span>(SE<span class="op">/</span>(nsite<span class="op">*</span>nsp)))</span>
<span id="cb3-25"><a href="#cb3-25"></a><span class="co"># Deviance </span></span>
<span id="cb3-26"><a href="#cb3-26"></a>logL=<span class="dv">0</span></span>
<span id="cb3-27"><a href="#cb3-27"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nsite){</span>
<span id="cb3-28"><a href="#cb3-28"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nsp){</span>
<span id="cb3-29"><a href="#cb3-29"></a>    logL=logL <span class="op">+</span><span class="st"> </span><span class="kw">dbinom</span>(Y[i,j],<span class="dv">1</span>,theta_latent_sim[i,j],<span class="dv">1</span>)  </span>
<span id="cb3-30"><a href="#cb3-30"></a>  }</span>
<span id="cb3-31"><a href="#cb3-31"></a>}</span>
<span id="cb3-32"><a href="#cb3-32"></a>Deviance_boral_sim &lt;-<span class="st"> </span><span class="dv">-2</span><span class="op">*</span>logL</span>
<span id="cb3-33"><a href="#cb3-33"></a></span>
<span id="cb3-34"><a href="#cb3-34"></a><span class="kw">save</span>(np, nl, nsp, nsite, beta.target, lambda.target, alpha.target, </span>
<span id="cb3-35"><a href="#cb3-35"></a>     V_alpha.target, X, W, probit_theta, Z_true, Y, T_boral_sim,</span>
<span id="cb3-36"><a href="#cb3-36"></a>     mod_boral_sim, probit_theta_latent_sim,</span>
<span id="cb3-37"><a href="#cb3-37"></a>     RMSE_boral_sim, Deviance_boral_sim,</span>
<span id="cb3-38"><a href="#cb3-38"></a>     <span class="dt">file=</span><span class="st">"boral_simulation.RData"</span>)</span></code></pre></div>
<p>We visually evaluate the convergence of MCMCs by representing the trace and density <em>a posteriori</em> of some estimated parameters using the <code>boral</code> package and we plot the estimated parameters according to the expected ones to assess the accuracy of the package <code>boral</code> results.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span>file<span class="op">=</span><span class="st">"jSDM_boral_cache/boral_simulation.RData"</span><span class="op">)</span>
<span class="va">mcmcsamps</span> <span class="op">&lt;-</span> <span class="fu">boral</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/boral/man/get.mcmcsamples.html" class="external-link">get.mcmcsamples</a></span><span class="op">(</span><span class="va">mod_boral_sim</span><span class="op">)</span>
<span class="va">boral_mcmc_beta0</span> <span class="op">&lt;-</span> <span class="va">mcmcsamps</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"lv.coefs\\[[1-9][0-9]?[0-9]?,1\\]"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mcmcsamps</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">boral_mcmc_beta0</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">",1\\]"</span>,<span class="st">",0\\]"</span>,
                                   <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"lv.coefs"</span>, <span class="st">"X.coefs"</span>,
                                        <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">boral_mcmc_beta0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">boral_mcmc_beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">boral_mcmc_beta0</span>,
                         <span class="va">mcmcsamps</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"X.coefs"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mcmcsamps</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="va">boral_mcmc_lambda</span> <span class="op">&lt;-</span> <span class="va">mcmcsamps</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"lv.coefs\\[[1-9][0-9]?[0-9]?,1\\]"</span>,
                                           <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"lv.coefs"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mcmcsamps</span><span class="op">)</span>,
                                                value<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>, invert<span class="op">=</span><span class="cn">TRUE</span>, value<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span>

<span class="co">## Fixed species effect beta for first two species </span>
<span class="va">np</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">p</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/traceplot.html" class="external-link">traceplot</a></span><span class="op">(</span><span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html" class="external-link">as.mcmc</a></span><span class="op">(</span><span class="va">boral_mcmc_beta</span><span class="op">[</span>,<span class="va">j</span> <span class="op">+</span> <span class="va">nsp</span><span class="op">*</span><span class="op">(</span><span class="va">p</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
    <span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/densplot.html" class="external-link">densplot</a></span><span class="op">(</span><span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html" class="external-link">as.mcmc</a></span><span class="op">(</span><span class="va">boral_mcmc_beta</span><span class="op">[</span>,<span class="va">j</span> <span class="op">+</span> <span class="va">nsp</span><span class="op">*</span><span class="op">(</span><span class="va">p</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, 
                   main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">boral_mcmc_beta</span><span class="op">)</span><span class="op">[</span><span class="va">j</span> <span class="op">+</span> <span class="va">nsp</span><span class="op">*</span><span class="op">(</span><span class="va">p</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="va">beta.target</span><span class="op">[</span><span class="va">p</span>,<span class="va">j</span><span class="op">]</span>,col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span>

<span class="co">## Factor loadings lambda for first two species </span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">nl</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">l</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nl</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/traceplot.html" class="external-link">traceplot</a></span><span class="op">(</span><span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html" class="external-link">as.mcmc</a></span><span class="op">(</span><span class="va">boral_mcmc_lambda</span><span class="op">[</span>,<span class="va">j</span> <span class="op">+</span> <span class="va">nsp</span><span class="op">*</span><span class="op">(</span><span class="va">l</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
    <span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/densplot.html" class="external-link">densplot</a></span><span class="op">(</span><span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html" class="external-link">as.mcmc</a></span><span class="op">(</span><span class="va">boral_mcmc_lambda</span><span class="op">[</span>,<span class="va">j</span> <span class="op">+</span> <span class="va">nsp</span><span class="op">*</span><span class="op">(</span><span class="va">l</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, 
                   main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">boral_mcmc_lambda</span><span class="op">)</span><span class="op">[</span><span class="va">j</span> <span class="op">+</span> <span class="va">nsp</span><span class="op">*</span><span class="op">(</span><span class="va">l</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="va">lambda.target</span><span class="op">[</span><span class="va">l</span>,<span class="va">j</span><span class="op">]</span>,col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span>
<span class="co">## Fixed species effect beta</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">beta.target</span><span class="op">)</span>,
     <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">mod_boral_sim</span><span class="op">$</span><span class="va">lv.coefs.mean</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,<span class="va">mod_boral_sim</span><span class="op">$</span><span class="va">X.coefs.mean</span><span class="op">)</span>,
     xlab<span class="op">=</span><span class="st">"obs"</span>, ylab<span class="op">=</span><span class="st">"fitted"</span>, main<span class="op">=</span><span class="st">"Fixed species effect beta"</span><span class="op">)</span> 
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>,b<span class="op">=</span><span class="fl">1</span>,col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span>
<span class="co">## factor loadings lambda_j</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">lambda.target</span><span class="op">)</span>,<span class="va">mod_boral_sim</span><span class="op">$</span><span class="va">lv.coefs.mean</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span>,
     xlab<span class="op">=</span><span class="st">"obs"</span>, ylab<span class="op">=</span><span class="st">"fitted"</span>, main<span class="op">=</span><span class="st">"Loading factors lambda"</span><span class="op">)</span> 
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>,b<span class="op">=</span><span class="fl">1</span>,col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span>
<span class="co">## Latent variable W </span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">l</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nl</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">W</span><span class="op">[</span>,<span class="va">l</span><span class="op">]</span>,<span class="va">mod_boral_sim</span><span class="op">$</span><span class="va">lv.mean</span><span class="op">[</span>,<span class="va">l</span><span class="op">]</span>,
       main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Latent variable W_"</span>, <span class="va">l</span><span class="op">)</span>,
       xlab<span class="op">=</span><span class="st">"obs"</span>, ylab<span class="op">=</span><span class="st">"fitted"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>,b<span class="op">=</span><span class="fl">1</span>,col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span>
<span class="op">}</span>
<span class="co">## alpha </span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">alpha.target</span>, <span class="va">mod_boral_sim</span><span class="op">$</span><span class="va">row.coefs</span><span class="op">$</span><span class="va">ID1</span><span class="op">$</span><span class="va">mean</span>,
     xlab<span class="op">=</span><span class="st">"obs"</span>, ylab<span class="op">=</span><span class="st">"fitted"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>,b<span class="op">=</span><span class="fl">1</span>,col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">V_alpha.target</span>, <span class="va">mod_boral_sim</span><span class="op">$</span><span class="va">row.sigma</span><span class="op">$</span><span class="va">ID1</span><span class="op">[</span><span class="st">"mean"</span><span class="op">]</span>,
       pch<span class="op">=</span><span class="fl">17</span>, col<span class="op">=</span><span class="st">'red'</span>, cex<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, legend<span class="op">=</span><span class="st">"V_alpha"</span>, pch<span class="op">=</span><span class="fl">17</span>, col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Random site effect alpha and its variance"</span><span class="op">)</span>

<span class="co">## Prediction</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="co"># probit_theta_latent </span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">probit_theta</span>,<span class="va">probit_theta_latent_sim</span>,
     main<span class="op">=</span><span class="st">"probit(theta)"</span>, xlab <span class="op">=</span><span class="st">"obs"</span>, ylab<span class="op">=</span><span class="st">"fitted"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>,b<span class="op">=</span><span class="fl">1</span>,col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span>
<span class="co"># theta_latent</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="va">probit_theta</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="va">probit_theta_latent_sim</span><span class="op">)</span>,
     main<span class="op">=</span><span class="st">"theta"</span>, xlab <span class="op">=</span><span class="st">"obs"</span>, ylab<span class="op">=</span><span class="st">"fitted"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>,b<span class="op">=</span><span class="fl">1</span>,col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span></code></pre></div>
<p><img src="jSDM_boral_files/figure-html/boral-simulation-plot-1.png" width="800" style="display: block; margin: auto;"><img src="jSDM_boral_files/figure-html/boral-simulation-plot-2.png" width="800" style="display: block; margin: auto;"><img src="jSDM_boral_files/figure-html/boral-simulation-plot-3.png" width="800" style="display: block; margin: auto;"><img src="jSDM_boral_files/figure-html/boral-simulation-plot-4.png" width="800" style="display: block; margin: auto;"><img src="jSDM_boral_files/figure-html/boral-simulation-plot-5.png" width="800" style="display: block; margin: auto;"><img src="jSDM_boral_files/figure-html/boral-simulation-plot-6.png" width="800" style="display: block; margin: auto;"><img src="jSDM_boral_files/figure-html/boral-simulation-plot-7.png" width="800" style="display: block; margin: auto;"></p>
<p>Overall, the traces and the densities of the parameters indicate the convergence of the algorithm. Indeed, we observe on the traces that the values oscillate around averages without showing an upward or downward trend and we see that the densities are quite smooth and for the most part of Gaussian form.<br>
On the above figures, the estimated parameters are close to the expected values if the points are near the red line representing the identity function (<span class="math inline">\(y=x\)</span>).</p>
</div>
<div class="section level3">
<h3 id="mosquitos-dataset">
<span class="header-section-number">3.2</span> Mosquitos dataset<a class="anchor" aria-label="anchor" href="#mosquitos-dataset"></a>
</h3>
<p>We fit a binomial joint species distribution model, including random site effect and latent variables, from the <a href="https://ecology.ghislainv.fr/jSDM/reference/mosquitos.html" class="external-link"><code>mosquitos</code></a> data-set using <code>boral()</code> function to perform binomial probit regression.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">setwd</span>(<span class="kw">paste0</span>(<span class="kw">dirname</span>(rstudioapi<span class="op">::</span><span class="kw">getSourceEditorContext</span>()<span class="op">$</span>path),<span class="st">"/jSDM_boral_cache"</span>))</span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="co"># Import center and reduce Mosquito data-set</span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="kw">data</span>(mosquitos, <span class="dt">package=</span><span class="st">"jSDM"</span>)</span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="kw">head</span>(mosquitos)</span>
<span id="cb5-5"><a href="#cb5-5"></a>Env_Mosquitos &lt;-<span class="st"> </span>mosquitos[,<span class="dv">17</span><span class="op">:</span><span class="dv">29</span>]</span>
<span id="cb5-6"><a href="#cb5-6"></a>Env_Mosquitos &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="kw">scale</span>(Env_Mosquitos[,<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>]), Env_Mosquitos[,<span class="dv">5</span><span class="op">:</span><span class="dv">13</span>])</span>
<span id="cb5-7"><a href="#cb5-7"></a>PA_Mosquitos &lt;-<span class="st"> </span>mosquitos[,<span class="dv">1</span><span class="op">:</span><span class="dv">16</span>]</span>
<span id="cb5-8"><a href="#cb5-8"></a></span>
<span id="cb5-9"><a href="#cb5-9"></a><span class="co"># Fit the model </span></span>
<span id="cb5-10"><a href="#cb5-10"></a>T1 &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()</span>
<span id="cb5-11"><a href="#cb5-11"></a>mod_boral_Mosquitos &lt;-<span class="st"> </span><span class="kw">boral</span>(<span class="dt">y=</span>PA_Mosquitos, <span class="dt">X=</span>Env_Mosquitos,</span>
<span id="cb5-12"><a href="#cb5-12"></a>                             <span class="dt">save.model=</span><span class="ot">TRUE</span>, <span class="dt">model.name=</span><span class="st">"Mosquitos_jagsboralmodel.txt"</span>, </span>
<span id="cb5-13"><a href="#cb5-13"></a>                             <span class="dt">lv.control=</span><span class="kw">list</span>(<span class="dt">num.lv=</span><span class="dv">2</span>), <span class="dt">family=</span><span class="st">"binomial"</span>,</span>
<span id="cb5-14"><a href="#cb5-14"></a>                             <span class="dt">prior.control =</span> <span class="kw">list</span>(<span class="dt">type=</span><span class="kw">c</span>(<span class="st">"normal"</span>,<span class="st">"normal"</span>,</span>
<span id="cb5-15"><a href="#cb5-15"></a>                                                         <span class="st">"normal"</span>,<span class="st">"uniform"</span>),</span>
<span id="cb5-16"><a href="#cb5-16"></a>                                            <span class="dt">hypparams =</span> <span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">30</span>))</span>
<span id="cb5-17"><a href="#cb5-17"></a>                             <span class="dt">row.eff=</span><span class="st">"random"</span>,</span>
<span id="cb5-18"><a href="#cb5-18"></a>                             <span class="dt">mcmc.control=</span><span class="kw">list</span>(<span class="dt">n.burnin=</span><span class="dv">10000</span>,<span class="dt">n.iteration=</span><span class="dv">15000</span>,</span>
<span id="cb5-19"><a href="#cb5-19"></a>                                               <span class="dt">n.thin=</span><span class="dv">5</span>,<span class="dt">seed=</span><span class="dv">123</span>))</span>
<span id="cb5-20"><a href="#cb5-20"></a>T2 &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()</span>
<span id="cb5-21"><a href="#cb5-21"></a>T_boral_Mosquitos &lt;-<span class="st"> </span><span class="kw">difftime</span>(T2,T1)</span>
<span id="cb5-22"><a href="#cb5-22"></a></span>
<span id="cb5-23"><a href="#cb5-23"></a><span class="co"># Predicted probit(theta) </span></span>
<span id="cb5-24"><a href="#cb5-24"></a>probit_theta_latent_Mosquitos &lt;-<span class="st"> </span>mod_boral_Mosquitos<span class="op">$</span>row.coefs[[<span class="dv">1</span>]]<span class="op">$</span>mean <span class="op">+</span></span>
<span id="cb5-25"><a href="#cb5-25"></a><span class="st">  </span><span class="kw">as.matrix</span>(Env_Mosquitos) <span class="op">%*%</span><span class="st"> </span><span class="kw">t</span>(mod_boral_Mosquitos<span class="op">$</span>X.coefs.mean) <span class="op">+</span></span>
<span id="cb5-26"><a href="#cb5-26"></a><span class="st">  </span><span class="kw">matrix</span>(<span class="dv">1</span>,<span class="dt">nrow=</span><span class="kw">nrow</span>(PA_Mosquitos), <span class="dt">ncol=</span><span class="dv">1</span>)<span class="op">%*%</span>mod_boral_Mosquitos<span class="op">$</span>lv.coefs.mean[,<span class="st">"beta0"</span>] <span class="op">+</span><span class="st"> </span></span>
<span id="cb5-27"><a href="#cb5-27"></a><span class="st">  </span>mod_boral_Mosquitos<span class="op">$</span>lv.mean<span class="op">%*%</span><span class="st"> </span><span class="kw">t</span>(mod_boral_Mosquitos<span class="op">$</span>lv.coefs.mean[,<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb5-28"><a href="#cb5-28"></a><span class="co"># theta_latent</span></span>
<span id="cb5-29"><a href="#cb5-29"></a>theta_latent_Mosquitos &lt;-<span class="st"> </span><span class="kw">pnorm</span>(probit_theta_latent_Mosquitos)</span>
<span id="cb5-30"><a href="#cb5-30"></a><span class="co"># Deviance</span></span>
<span id="cb5-31"><a href="#cb5-31"></a>logL=<span class="dv">0</span></span>
<span id="cb5-32"><a href="#cb5-32"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(PA_Mosquitos)){</span>
<span id="cb5-33"><a href="#cb5-33"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(PA_Mosquitos)){</span>
<span id="cb5-34"><a href="#cb5-34"></a>    logL=logL <span class="op">+</span><span class="st"> </span><span class="kw">dbinom</span>(PA_Mosquitos[i,j],<span class="dv">1</span>,theta_latent_Mosquitos[i,j],<span class="dv">1</span>)  </span>
<span id="cb5-35"><a href="#cb5-35"></a>  }</span>
<span id="cb5-36"><a href="#cb5-36"></a>}</span>
<span id="cb5-37"><a href="#cb5-37"></a>Deviance_boral_Mosquitos &lt;-<span class="st"> </span><span class="dv">-2</span><span class="op">*</span>logL</span>
<span id="cb5-38"><a href="#cb5-38"></a></span>
<span id="cb5-39"><a href="#cb5-39"></a><span class="kw">save</span>(T_boral_Mosquitos, mod_boral_Mosquitos,</span>
<span id="cb5-40"><a href="#cb5-40"></a>     probit_theta_latent_Mosquitos, Deviance_boral_Mosquitos,</span>
<span id="cb5-41"><a href="#cb5-41"></a>     <span class="dt">file=</span><span class="st">"boral_Mosquitos.RData"</span>)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="eucalypts-dataset">
<span class="header-section-number">3.3</span> Eucalypts dataset<a class="anchor" aria-label="anchor" href="#eucalypts-dataset"></a>
</h3>
<p>We fit a binomial joint species distribution model, including random site effect and latent variables, from the <a href="https://ecology.ghislainv.fr/jSDM/reference/eucalypts.html" class="external-link"><code>eucalypts</code></a> data-set using <code>boral()</code> function to perform binomial probit regression.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># Import center and reduce Eucalypts data-set</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="kw">data</span>(eucalypts, <span class="dt">package=</span><span class="st">"jSDM"</span>)</span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="kw">head</span>(eucalypts)</span>
<span id="cb6-4"><a href="#cb6-4"></a>Env_Eucalypts &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="kw">scale</span>(eucalypts[,<span class="kw">c</span>(<span class="st">"Rockiness"</span>,<span class="st">"VallyBotFlat"</span>,<span class="st">"PPTann"</span>, <span class="st">"cvTemp"</span>,<span class="st">"T0"</span>)]),eucalypts[,<span class="kw">c</span>(<span class="st">"Sandiness"</span>,<span class="st">"Loaminess"</span>)])</span>
<span id="cb6-5"><a href="#cb6-5"></a>PA_Eucalypts &lt;-<span class="st"> </span>eucalypts[,<span class="dv">1</span><span class="op">:</span><span class="dv">12</span>]</span>
<span id="cb6-6"><a href="#cb6-6"></a>Env_Eucalypts &lt;-<span class="st"> </span>Env_Eucalypts[<span class="kw">rowSums</span>(PA_Eucalypts) <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>,]</span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="co"># Remove sites where none species was recorded</span></span>
<span id="cb6-8"><a href="#cb6-8"></a>PA_Eucalypts &lt;-<span class="st"> </span>PA_Eucalypts[<span class="kw">rowSums</span>(PA_Eucalypts) <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>,]</span>
<span id="cb6-9"><a href="#cb6-9"></a></span>
<span id="cb6-10"><a href="#cb6-10"></a><span class="co"># Fit the model </span></span>
<span id="cb6-11"><a href="#cb6-11"></a>T1 &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()</span>
<span id="cb6-12"><a href="#cb6-12"></a>mod_boral_Eucalypts &lt;-<span class="st"> </span><span class="kw">boral</span>(<span class="dt">y=</span>PA_Eucalypts, <span class="dt">X=</span>Env_Eucalypts,</span>
<span id="cb6-13"><a href="#cb6-13"></a>                             <span class="dt">save.model=</span><span class="ot">TRUE</span>, <span class="dt">model.name=</span><span class="st">"Eucalypts_jagsboralmodel.txt"</span>,</span>
<span id="cb6-14"><a href="#cb6-14"></a>                             <span class="dt">lv.control=</span><span class="kw">list</span>(<span class="dt">num.lv=</span><span class="dv">2</span>), <span class="dt">family=</span><span class="st">"binomial"</span>,</span>
<span id="cb6-15"><a href="#cb6-15"></a>                             <span class="dt">prior.control=</span><span class="kw">list</span>(<span class="dt">type=</span><span class="kw">c</span>(<span class="st">"normal"</span>,<span class="st">"normal"</span>,</span>
<span id="cb6-16"><a href="#cb6-16"></a>                                                       <span class="st">"normal"</span>,<span class="st">"uniform"</span>),</span>
<span id="cb6-17"><a href="#cb6-17"></a>                                                <span class="dt">hypparams =</span> <span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">30</span>))</span>
<span id="cb6-18"><a href="#cb6-18"></a>                             <span class="dt">row.eff=</span><span class="st">"random"</span>,</span>
<span id="cb6-19"><a href="#cb6-19"></a>                             <span class="dt">mcmc.control=</span><span class="kw">list</span>(<span class="dt">n.burnin=</span><span class="dv">10000</span>,</span>
<span id="cb6-20"><a href="#cb6-20"></a>                                               <span class="dt">n.iteration=</span><span class="dv">15000</span>,</span>
<span id="cb6-21"><a href="#cb6-21"></a>                                               <span class="dt">n.thin=</span><span class="dv">5</span>, <span class="dt">seed=</span><span class="dv">123</span>))</span>
<span id="cb6-22"><a href="#cb6-22"></a>T2 &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()</span>
<span id="cb6-23"><a href="#cb6-23"></a>T_boral_Eucalypts &lt;-<span class="st"> </span><span class="kw">difftime</span>(T2,T1)</span>
<span id="cb6-24"><a href="#cb6-24"></a></span>
<span id="cb6-25"><a href="#cb6-25"></a><span class="co"># Predicted probit(theta) </span></span>
<span id="cb6-26"><a href="#cb6-26"></a>probit_theta_latent_Eucalypts &lt;-<span class="st"> </span>mod_boral_Eucalypts<span class="op">$</span>row.coefs[[<span class="dv">1</span>]]<span class="op">$</span>mean <span class="op">+</span><span class="st"> </span></span>
<span id="cb6-27"><a href="#cb6-27"></a><span class="st">  </span><span class="kw">as.matrix</span>(Env_Eucalypts) <span class="op">%*%</span><span class="st"> </span><span class="kw">t</span>(mod_boral_Eucalypts<span class="op">$</span>X.coefs.mean) <span class="op">+</span><span class="st"> </span></span>
<span id="cb6-28"><a href="#cb6-28"></a><span class="st">  </span><span class="kw">matrix</span>(<span class="dv">1</span>,<span class="dt">nrow=</span><span class="kw">nrow</span>(PA_Eucalypts),<span class="dt">ncol=</span><span class="dv">1</span>)<span class="op">%*%</span>mod_boral_Eucalypts<span class="op">$</span>lv.coefs.mean[,<span class="st">"beta0"</span>] <span class="op">+</span><span class="st"> </span></span>
<span id="cb6-29"><a href="#cb6-29"></a><span class="st">  </span>mod_boral_Eucalypts<span class="op">$</span>lv.mean<span class="op">%*%</span><span class="kw">t</span>(mod_boral_Eucalypts<span class="op">$</span>lv.coefs.mean[,<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb6-30"><a href="#cb6-30"></a><span class="co"># theta_latent</span></span>
<span id="cb6-31"><a href="#cb6-31"></a>theta_latent_Eucalypts &lt;-<span class="st"> </span><span class="kw">pnorm</span>(probit_theta_latent_Eucalypts)</span>
<span id="cb6-32"><a href="#cb6-32"></a><span class="co"># Deviance</span></span>
<span id="cb6-33"><a href="#cb6-33"></a>logL=<span class="dv">0</span></span>
<span id="cb6-34"><a href="#cb6-34"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(PA_Eucalypts)){</span>
<span id="cb6-35"><a href="#cb6-35"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(PA_Eucalypts)){</span>
<span id="cb6-36"><a href="#cb6-36"></a>    logL=logL <span class="op">+</span><span class="st"> </span><span class="kw">dbinom</span>(PA_Eucalypts[i,j],<span class="dv">1</span>,theta_latent_Eucalypts[i,j],<span class="dv">1</span>)  </span>
<span id="cb6-37"><a href="#cb6-37"></a>  }</span>
<span id="cb6-38"><a href="#cb6-38"></a>}</span>
<span id="cb6-39"><a href="#cb6-39"></a>Deviance_boral_Eucalypts &lt;-<span class="st"> </span><span class="dv">-2</span><span class="op">*</span>logL</span>
<span id="cb6-40"><a href="#cb6-40"></a></span>
<span id="cb6-41"><a href="#cb6-41"></a><span class="kw">save</span>(T_boral_Eucalypts, mod_boral_Eucalypts,</span>
<span id="cb6-42"><a href="#cb6-42"></a>     probit_theta_latent_Eucalypts, Deviance_boral_Eucalypts,</span>
<span id="cb6-43"><a href="#cb6-43"></a>     <span class="dt">file=</span><span class="st">"boral_Eucalypts.RData"</span>)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="frogs-dataset">
<span class="header-section-number">3.4</span> Frogs dataset<a class="anchor" aria-label="anchor" href="#frogs-dataset"></a>
</h3>
<p>We fit a binomial joint species distribution model, including random site effect and latent variables, from the <a href="https://ecology.ghislainv.fr/jSDM/reference/frogs.html" class="external-link"><code>frogs</code></a> data-set using <code>boral()</code> function to perform binomial probit regression.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># Import center and reduce Frogs data-set</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="kw">data</span>(frogs, <span class="dt">package=</span><span class="st">"jSDM"</span>)</span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="kw">head</span>(frogs)</span>
<span id="cb7-4"><a href="#cb7-4"></a>Env_Frogs &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="kw">scale</span>(frogs[,<span class="st">"Covariate_1"</span>]),frogs[,<span class="st">"Covariate_2"</span>],</span>
<span id="cb7-5"><a href="#cb7-5"></a>                   <span class="kw">scale</span>(frogs[,<span class="st">"Covariate_3"</span>]))</span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="kw">colnames</span>(Env_Frogs) &lt;-<span class="st"> </span><span class="kw">colnames</span>(frogs[,<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>])</span>
<span id="cb7-7"><a href="#cb7-7"></a>PA_Frogs &lt;-<span class="st"> </span>frogs[,<span class="dv">4</span><span class="op">:</span><span class="dv">12</span>]</span>
<span id="cb7-8"><a href="#cb7-8"></a></span>
<span id="cb7-9"><a href="#cb7-9"></a><span class="co"># Fit the model</span></span>
<span id="cb7-10"><a href="#cb7-10"></a>T1 &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()</span>
<span id="cb7-11"><a href="#cb7-11"></a>mod_boral_Frogs &lt;-<span class="st"> </span><span class="kw">boral</span>(<span class="dt">y=</span>PA_Frogs, <span class="dt">X=</span>Env_Frogs,</span>
<span id="cb7-12"><a href="#cb7-12"></a>                         <span class="dt">save.model=</span><span class="ot">TRUE</span>, <span class="dt">model.name=</span><span class="st">"Frogs_jagsboralmodel.txt"</span>,</span>
<span id="cb7-13"><a href="#cb7-13"></a>                         <span class="dt">lv.control=</span><span class="kw">list</span>(<span class="dt">num.lv=</span><span class="dv">2</span>), <span class="dt">family=</span><span class="st">"binomial"</span>,</span>
<span id="cb7-14"><a href="#cb7-14"></a>                         <span class="dt">prior.control=</span><span class="kw">list</span>(<span class="dt">type=</span><span class="kw">c</span>(<span class="st">"normal"</span>,<span class="st">"normal"</span>,</span>
<span id="cb7-15"><a href="#cb7-15"></a>                                                   <span class="st">"normal"</span>,<span class="st">"uniform"</span>),</span>
<span id="cb7-16"><a href="#cb7-16"></a>                                            <span class="dt">hypparams =</span> <span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">30</span>))</span>
<span id="cb7-17"><a href="#cb7-17"></a>                         <span class="dt">row.eff=</span><span class="st">"random"</span>,</span>
<span id="cb7-18"><a href="#cb7-18"></a>                         <span class="dt">mcmc.control=</span><span class="kw">list</span>(<span class="dt">n.burnin=</span><span class="dv">10000</span>,</span>
<span id="cb7-19"><a href="#cb7-19"></a>                                           <span class="dt">n.iteration=</span><span class="dv">15000</span>,</span>
<span id="cb7-20"><a href="#cb7-20"></a>                                           <span class="dt">n.thin=</span><span class="dv">5</span>, <span class="dt">seed=</span><span class="dv">123</span>))</span>
<span id="cb7-21"><a href="#cb7-21"></a>T2 &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()</span>
<span id="cb7-22"><a href="#cb7-22"></a>T_boral_Frogs &lt;-<span class="st"> </span><span class="kw">difftime</span>(T2,T1)</span>
<span id="cb7-23"><a href="#cb7-23"></a></span>
<span id="cb7-24"><a href="#cb7-24"></a><span class="co"># Predicted probit(theta) </span></span>
<span id="cb7-25"><a href="#cb7-25"></a>probit_theta_latent_Frogs &lt;-<span class="st"> </span>mod_boral_Frogs<span class="op">$</span>row.coefs[[<span class="dv">1</span>]]<span class="op">$</span>mean <span class="op">+</span><span class="st"> </span></span>
<span id="cb7-26"><a href="#cb7-26"></a><span class="st">  </span><span class="kw">as.matrix</span>(Env_Frogs) <span class="op">%*%</span><span class="st"> </span><span class="kw">t</span>(mod_boral_Frogs<span class="op">$</span>X.coefs.mean) <span class="op">+</span></span>
<span id="cb7-27"><a href="#cb7-27"></a><span class="st">  </span><span class="kw">matrix</span>(<span class="dv">1</span>,<span class="dt">nrow=</span><span class="kw">nrow</span>(PA_Frogs), <span class="dt">ncol=</span><span class="dv">1</span>)<span class="op">%*%</span>mod_boral_Frogs<span class="op">$</span>lv.coefs.mean[,<span class="st">"beta0"</span>] <span class="op">+</span><span class="st"> </span></span>
<span id="cb7-28"><a href="#cb7-28"></a><span class="st">  </span>mod_boral_Frogs<span class="op">$</span>lv.mean<span class="op">%*%</span><span class="kw">t</span>(mod_boral_Frogs<span class="op">$</span>lv.coefs.mean[,<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb7-29"><a href="#cb7-29"></a><span class="co"># theta_latent</span></span>
<span id="cb7-30"><a href="#cb7-30"></a>theta_latent_Frogs &lt;-<span class="st"> </span><span class="kw">pnorm</span>(probit_theta_latent_Frogs)</span>
<span id="cb7-31"><a href="#cb7-31"></a><span class="co"># Deviance</span></span>
<span id="cb7-32"><a href="#cb7-32"></a>logL=<span class="dv">0</span></span>
<span id="cb7-33"><a href="#cb7-33"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(PA_Frogs)){</span>
<span id="cb7-34"><a href="#cb7-34"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(PA_Frogs)){</span>
<span id="cb7-35"><a href="#cb7-35"></a>    logL=logL <span class="op">+</span><span class="st"> </span><span class="kw">dbinom</span>(PA_Frogs[i,j],<span class="dv">1</span>,theta_latent_Frogs[i,j],<span class="dv">1</span>)  </span>
<span id="cb7-36"><a href="#cb7-36"></a>  }</span>
<span id="cb7-37"><a href="#cb7-37"></a>}</span>
<span id="cb7-38"><a href="#cb7-38"></a>Deviance_boral_Frogs &lt;-<span class="st"> </span><span class="dv">-2</span><span class="op">*</span>logL</span>
<span id="cb7-39"><a href="#cb7-39"></a></span>
<span id="cb7-40"><a href="#cb7-40"></a><span class="kw">save</span>(T_boral_Frogs, mod_boral_Frogs,</span>
<span id="cb7-41"><a href="#cb7-41"></a>     probit_theta_latent_Frogs, Deviance_boral_Frogs,</span>
<span id="cb7-42"><a href="#cb7-42"></a>     <span class="dt">file=</span><span class="st">"boral_Frogs.RData"</span>)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fungi-dataset">
<span class="header-section-number">3.5</span> Fungi dataset<a class="anchor" aria-label="anchor" href="#fungi-dataset"></a>
</h3>
<p>We fit a binomial joint species distribution model, including random site effect and latent variables, from the <a href="https://ecology.ghislainv.fr/jSDM/reference/fungi.html" class="external-link"><code>fungi</code></a> data-set using <code>boral()</code> function to perform binomial probit regression.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="co"># Import center and reduce fungi data-set</span></span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="kw">data</span>(fungi, <span class="dt">package=</span><span class="st">"jSDM"</span>)</span>
<span id="cb8-4"><a href="#cb8-4"></a>Env_Fungi &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="kw">scale</span>(fungi[,<span class="kw">c</span>(<span class="st">"diam"</span>,<span class="st">"epi"</span>,<span class="st">"bark"</span>)]),</span>
<span id="cb8-5"><a href="#cb8-5"></a>                   fungi[,<span class="kw">c</span>(<span class="st">"dc1"</span>,<span class="st">"dc2"</span>,<span class="st">"dc3"</span>,<span class="st">"dc4"</span>,<span class="st">"dc5"</span>,</span>
<span id="cb8-6"><a href="#cb8-6"></a>                            <span class="st">"quality3"</span>,<span class="st">"quality4"</span>,<span class="st">"ground3"</span>,<span class="st">"ground4"</span>)])</span>
<span id="cb8-7"><a href="#cb8-7"></a><span class="kw">colnames</span>(Env_Fungi) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"diam"</span>,<span class="st">"epi"</span>,<span class="st">"bark"</span>,<span class="st">"dc1"</span>,<span class="st">"dc2"</span>,<span class="st">"dc3"</span>,<span class="st">"dc4"</span>,<span class="st">"dc5"</span>,</span>
<span id="cb8-8"><a href="#cb8-8"></a>                         <span class="st">"quality3"</span>,<span class="st">"quality4"</span>,<span class="st">"ground3"</span>,<span class="st">"ground4"</span>)</span>
<span id="cb8-9"><a href="#cb8-9"></a>PA_Fungi &lt;-<span class="st"> </span>fungi[,<span class="kw">c</span>(<span class="st">"antser"</span>,<span class="st">"antsin"</span>,<span class="st">"astfer"</span>,<span class="st">"fompin"</span>,<span class="st">"hetpar"</span>,<span class="st">"junlut"</span>,</span>
<span id="cb8-10"><a href="#cb8-10"></a>                     <span class="st">"phefer"</span>,<span class="st">"phenig"</span>,<span class="st">"phevit"</span>,<span class="st">"poscae"</span>,<span class="st">"triabi"</span>)]</span>
<span id="cb8-11"><a href="#cb8-11"></a>Env_Fungi &lt;-<span class="st"> </span>Env_Fungi[<span class="kw">rowSums</span>(PA_Fungi) <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>,]</span>
<span id="cb8-12"><a href="#cb8-12"></a><span class="co"># Remove sites where none species was recorded</span></span>
<span id="cb8-13"><a href="#cb8-13"></a>PA_Fungi&lt;-<span class="st"> </span>PA_Fungi[<span class="kw">rowSums</span>(PA_Fungi) <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>,]</span>
<span id="cb8-14"><a href="#cb8-14"></a></span>
<span id="cb8-15"><a href="#cb8-15"></a><span class="co"># Fit the model </span></span>
<span id="cb8-16"><a href="#cb8-16"></a>T1 &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()</span>
<span id="cb8-17"><a href="#cb8-17"></a>mod_boral_Fungi &lt;-<span class="st"> </span><span class="kw">boral</span>(<span class="dt">y=</span>PA_Fungi, <span class="dt">X=</span>Env_Fungi,</span>
<span id="cb8-18"><a href="#cb8-18"></a>                         <span class="dt">save.model=</span><span class="ot">TRUE</span>, <span class="dt">model.name=</span><span class="st">"Fungi_jagsboralmodel.txt"</span>,</span>
<span id="cb8-19"><a href="#cb8-19"></a>                         <span class="dt">lv.control=</span><span class="kw">list</span>(<span class="dt">num.lv=</span><span class="dv">2</span>), <span class="dt">family=</span><span class="st">"binomial"</span>,</span>
<span id="cb8-20"><a href="#cb8-20"></a>                         <span class="dt">prior.control=</span><span class="kw">list</span>(<span class="dt">type=</span><span class="kw">c</span>(<span class="st">"normal"</span>,<span class="st">"normal"</span>,</span>
<span id="cb8-21"><a href="#cb8-21"></a>                                                   <span class="st">"normal"</span>,<span class="st">"uniform"</span>),</span>
<span id="cb8-22"><a href="#cb8-22"></a>                                            <span class="dt">hypparams =</span> <span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">30</span>))</span>
<span id="cb8-23"><a href="#cb8-23"></a>                         <span class="dt">row.eff=</span><span class="st">"random"</span>,</span>
<span id="cb8-24"><a href="#cb8-24"></a>                         <span class="dt">mcmc.control=</span><span class="kw">list</span>(<span class="dt">n.burnin=</span><span class="dv">10000</span>,</span>
<span id="cb8-25"><a href="#cb8-25"></a>                                           <span class="dt">n.iteration=</span><span class="dv">15000</span>,</span>
<span id="cb8-26"><a href="#cb8-26"></a>                                           <span class="dt">n.thin=</span><span class="dv">5</span>, <span class="dt">seed=</span><span class="dv">123</span>))</span>
<span id="cb8-27"><a href="#cb8-27"></a>T2 &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()</span>
<span id="cb8-28"><a href="#cb8-28"></a>T_boral_Fungi &lt;-<span class="st"> </span><span class="kw">difftime</span>(T2,T1)</span>
<span id="cb8-29"><a href="#cb8-29"></a></span>
<span id="cb8-30"><a href="#cb8-30"></a><span class="co"># Predicted probit(theta) </span></span>
<span id="cb8-31"><a href="#cb8-31"></a>probit_theta_latent_Fungi &lt;-<span class="st"> </span>mod_boral_Fungi<span class="op">$</span>row.coefs[[<span class="dv">1</span>]]<span class="op">$</span>mean <span class="op">+</span></span>
<span id="cb8-32"><a href="#cb8-32"></a><span class="st">  </span><span class="kw">as.matrix</span>(Env_Fungi) <span class="op">%*%</span><span class="st"> </span><span class="kw">t</span>(mod_boral_Fungi<span class="op">$</span>X.coefs.mean) <span class="op">+</span><span class="st"> </span></span>
<span id="cb8-33"><a href="#cb8-33"></a><span class="st">  </span><span class="kw">matrix</span>(<span class="dv">1</span>,<span class="dt">nrow=</span><span class="kw">nrow</span>(PA_Fungi), <span class="dt">ncol=</span><span class="dv">1</span>)<span class="op">%*%</span>mod_boral_Fungi<span class="op">$</span>lv.coefs.mean[,<span class="st">"beta0"</span>] <span class="op">+</span><span class="st"> </span></span>
<span id="cb8-34"><a href="#cb8-34"></a><span class="st">  </span>mod_boral_Fungi<span class="op">$</span>lv.mean<span class="op">%*%</span><span class="kw">t</span>(mod_boral_Fungi<span class="op">$</span>lv.coefs.mean[,<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb8-35"><a href="#cb8-35"></a><span class="co"># theta_latent</span></span>
<span id="cb8-36"><a href="#cb8-36"></a>theta_latent_Fungi &lt;-<span class="st"> </span><span class="kw">pnorm</span>(probit_theta_latent_Fungi)</span>
<span id="cb8-37"><a href="#cb8-37"></a><span class="co"># Deviance</span></span>
<span id="cb8-38"><a href="#cb8-38"></a>logL=<span class="dv">0</span></span>
<span id="cb8-39"><a href="#cb8-39"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(PA_Fungi)){</span>
<span id="cb8-40"><a href="#cb8-40"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(PA_Fungi)){</span>
<span id="cb8-41"><a href="#cb8-41"></a>    logL=logL <span class="op">+</span><span class="st"> </span><span class="kw">dbinom</span>(PA_Fungi[i,j],<span class="dv">1</span>,theta_latent_Fungi[i,j],<span class="dv">1</span>)  </span>
<span id="cb8-42"><a href="#cb8-42"></a>  }</span>
<span id="cb8-43"><a href="#cb8-43"></a>}</span>
<span id="cb8-44"><a href="#cb8-44"></a>Deviance_boral_Fungi &lt;-<span class="st"> </span><span class="dv">-2</span><span class="op">*</span>logL</span>
<span id="cb8-45"><a href="#cb8-45"></a></span>
<span id="cb8-46"><a href="#cb8-46"></a><span class="kw">save</span>(T_boral_Fungi, mod_boral_Fungi,</span>
<span id="cb8-47"><a href="#cb8-47"></a>     probit_theta_latent_Fungi, Deviance_boral_Fungi,</span>
<span id="cb8-48"><a href="#cb8-48"></a>     <span class="dt">file=</span><span class="st">"boral_Fungi.RData"</span>)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="birds-dataset">
<span class="header-section-number">3.6</span> Birds dataset<a class="anchor" aria-label="anchor" href="#birds-dataset"></a>
</h3>
<p>We fit a binomial joint species distribution model with multiple visit by site, including random site effect and latent variables, from the <a href="https://ecology.ghislainv.fr/jSDM/reference/birds.html" class="external-link"><code>birds</code></a> data-set using <code>boral()</code> function to perform binomial logistic regression.</p>
<p>We have to specify the <code>JAGS</code> model in the <code>jagsboralmodel.txt</code> file because the default <code>JAGS</code> model generated by <code>boral</code> function doesn’t allow to indicate different number of trials for each site as it is the case in <a href="https://ecology.ghislainv.fr/jSDM/reference/birds.html" class="external-link"><code>birds</code></a> data-set.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Import center and reduce birds data-set</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">birds</span>, package<span class="op">=</span><span class="st">"jSDM"</span><span class="op">)</span>
<span class="co"># data.obs</span>
<span class="va">PA_Birds</span> <span class="op">&lt;-</span> <span class="va">birds</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">158</span><span class="op">]</span>
<span class="co"># Remove species with less than 5 presences</span>
<span class="va">rare_sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">&gt;</span><span class="fl">0</span>, <span class="fl">2</span>, <span class="va">sum</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">5</span><span class="op">)</span> 
<span class="va">PA_Birds</span> <span class="op">&lt;-</span> <span class="va">PA_Birds</span><span class="op">[</span>, <span class="op">-</span><span class="va">rare_sp</span><span class="op">]</span>
<span class="co"># Normalized continuous variables</span>
<span class="va">Env_Birds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">birds</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"elev"</span>,<span class="st">"rlength"</span>,<span class="st">"forest"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,
                              <span class="va">birds</span><span class="op">[</span>,<span class="st">"nsurvey"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">Env_Birds</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"elev"</span>,<span class="st">"rlength"</span>,<span class="st">"forest"</span>,<span class="st">"nsurvey"</span><span class="op">)</span>
<span class="co"># Compute design matrix</span>
<span class="va">mf.suit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.frame.html" class="external-link">model.frame</a></span><span class="op">(</span>formula<span class="op">=</span><span class="op">~</span><span class="va">elev</span><span class="op">+</span><span class="va">rlength</span><span class="op">+</span><span class="va">forest</span><span class="op">-</span><span class="fl">1</span>, data<span class="op">=</span><span class="va">Env_Birds</span><span class="op">)</span>
<span class="va">X_Birds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">mf.suit</span>,<span class="st">"terms"</span><span class="op">)</span>, data<span class="op">=</span><span class="va">mf.suit</span><span class="op">)</span>
<span class="co"># Number of latent variables </span>
<span class="va">num.lv</span> <span class="op">&lt;-</span> <span class="fl">2</span>
<span class="co"># Fit the model </span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/kenkellner/jagsUI" class="external-link">jagsUI</a></span><span class="op">)</span>
<span class="va">T1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="co"># Number of trials by site impossible to specify with boral,</span>
<span class="co"># trial.size either equal to a single element</span>
<span class="co"># or a vector of length equal to the number of columns in y</span>
<span class="co"># mod_boral_Birds &lt;- boral(y=PA_Birds, X=X_Birds,</span>
<span class="co">#                          lv.control=list(num.lv=2), family="binomial",</span>
<span class="co">#                          save.model=TRUE, model.name="Birds_jagsboralmodel.txt",</span>
<span class="co">#                          trial.size=max(Env_Birds$nsurvey),</span>
<span class="co">#                          prior.control=list(type=c("normal","normal",</span>
<span class="co">#                                                    "normal","uniform"),</span>
<span class="co">#                                             hypparams = c(10, 10, 10, 30))</span>
<span class="co">#                          row.eff="random",</span>
<span class="co">#                          mcmc.control=list(n.burnin=10000,</span>
<span class="co">#                                            n.iteration=15000,</span>
<span class="co">#                                            n.thin=5,seed=123))</span>
<span class="co"># JAGS model in vignettes/jSDM_boral_cache/Birds_jagsboralmodel.txt</span>
<span class="co"># modified to specify the number of trials by site</span>
<span class="co"># Data needed to fit the model </span>
<span class="va">jags.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">)</span>, n<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">)</span>, p<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">)</span>,
                  X<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">X_Birds</span><span class="op">)</span>, visits<span class="op">=</span><span class="va">Env_Birds</span><span class="op">$</span><span class="va">nsurvey</span>, num.lv <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="co"># Starting values </span>
<span class="va">gen.inits</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>  
    <span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">)</span><span class="op">)</span>
    <span class="va">Valpha</span> <span class="op">&lt;-</span> <span class="fl">1</span>
    <span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X_Birds</span><span class="op">)</span><span class="op">)</span>
    <span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">)</span>,<span class="va">num.lv</span> <span class="op">+</span><span class="fl">1</span><span class="op">)</span>
    <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
      <span class="kw">for</span> <span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">num.lv</span><span class="op">)</span><span class="op">{</span>
        <span class="va">lambda</span><span class="op">[</span><span class="va">k</span>,<span class="va">k</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>
        <span class="kw">if</span><span class="op">(</span><span class="va">j</span><span class="op">&lt;</span><span class="va">k</span><span class="op">)</span> <span class="op">{</span>
          <span class="va">lambda</span><span class="op">[</span><span class="va">j</span>,<span class="va">k</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
        <span class="op">}</span>
      <span class="op">}</span>
    <span class="op">}</span>
    <span class="va">W</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">)</span>, <span class="va">num.lv</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"X.coefs"</span><span class="op">=</span><span class="va">beta</span>,<span class="st">"row.coefs"</span><span class="op">=</span><span class="va">alpha</span>,<span class="st">"row.sigma"</span><span class="op">=</span><span class="va">Valpha</span>,<span class="st">"lvs"</span><span class="op">=</span><span class="va">W</span>, <span class="st">"lv.coefs"</span> <span class="op">=</span> <span class="va">lambda</span><span class="op">)</span> 
    <span class="op">}</span>
<span class="co"># Fit JAGS model </span>
<span class="va">mod_boral_Birds</span> <span class="op">&lt;-</span> <span class="fu">jagsUI</span><span class="fu">::</span><span class="fu">jags</span><span class="op">(</span>data <span class="op">=</span> <span class="va">jags.data</span>, <span class="va">inits</span> <span class="op">&lt;-</span> <span class="va">gen.inits</span>,
                                parameters.to.save <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X.coefs"</span>,<span class="st">"row.coefs"</span>,
                                                       <span class="st">"row.sigma"</span>,<span class="st">"lvs"</span>, <span class="st">"lv.coefs"</span><span class="op">)</span>,
                                model.file <span class="op">=</span> <span class="st">"Birds_jagsboralmodel.txt"</span>,
                                n.chains <span class="op">=</span> <span class="fl">1</span>, n.iter<span class="op">=</span><span class="fl">15000</span>, n.burnin <span class="op">=</span> <span class="fl">10000</span>, n.thin <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="va">T2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">T_boral_Birds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">T2</span>,<span class="va">T1</span><span class="op">)</span>

<span class="co"># Predicted logit(theta) </span>
<span class="va">logit_theta_latent_Birds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mod_boral_Birds</span><span class="op">$</span><span class="va">mean</span><span class="op">$</span><span class="va">row.coefs</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">X_Birds</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">mod_boral_Birds</span><span class="op">$</span><span class="va">mean</span><span class="op">$</span><span class="va">X.coefs</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>,nrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">mod_boral_Birds</span><span class="op">$</span><span class="va">mean</span><span class="op">$</span><span class="va">lv.coefs</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">+</span> 
  <span class="va">mod_boral_Birds</span><span class="op">$</span><span class="va">mean</span><span class="op">$</span><span class="va">lvs</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">mod_boral_Birds</span><span class="op">$</span><span class="va">mean</span><span class="op">$</span><span class="va">lv.coefs</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="co"># theta_latent</span>
<span class="va">theta_latent_Birds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inv_logit.html">inv_logit</a></span><span class="op">(</span><span class="va">logit_theta_latent_Birds</span><span class="op">)</span>
<span class="co"># Deviance</span>
<span class="va">logL</span><span class="op">=</span><span class="fl">0</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">logL</span><span class="op">=</span> <span class="va">logL</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">dbinom</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span>,<span class="va">Env_Birds</span><span class="op">$</span><span class="va">nsurvey</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,<span class="va">theta_latent_Birds</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span>,<span class="fl">1</span><span class="op">)</span>  
  <span class="op">}</span>
<span class="op">}</span>
<span class="va">Deviance_boral_Birds</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">2</span><span class="op">*</span><span class="va">logL</span>
<span class="co"># mod_boral_Birds$mean$deviance</span>
<span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">T_boral_Birds</span>, <span class="va">mod_boral_Birds</span>,
     <span class="va">logit_theta_latent_Birds</span>, <span class="va">Deviance_boral_Birds</span>,
     file<span class="op">=</span><span class="st">"boral_Birds.RData"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="mites-dataset">
<span class="header-section-number">3.7</span> Mites dataset<a class="anchor" aria-label="anchor" href="#mites-dataset"></a>
</h3>
<p>We fit a joint species distribution model, including random site effect and latent variables, from the <a href="https://ecology.ghislainv.fr/jSDM/reference/mites.html" class="external-link"><code>mites</code></a> abundance data-set using <code>boral()</code> function to perform a poisson log-linear regression.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># Import center and reduce mites data-set</span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="kw">data</span>(mites, <span class="dt">package=</span><span class="st">"jSDM"</span>)</span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="co"># data.obs</span></span>
<span id="cb10-4"><a href="#cb10-4"></a>PA_Mites &lt;-<span class="st"> </span>mites[,<span class="dv">1</span><span class="op">:</span><span class="dv">35</span>]</span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="co"># Remove species with less than 10 presences</span></span>
<span id="cb10-6"><a href="#cb10-6"></a>rare_sp &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">apply</span>(PA_Mites<span class="op">&gt;</span><span class="dv">0</span>, <span class="dv">2</span>, sum) <span class="op">&lt;</span><span class="st"> </span><span class="dv">10</span>) </span>
<span id="cb10-7"><a href="#cb10-7"></a>PA_Mites &lt;-<span class="st"> </span>PA_Mites[, <span class="op">-</span>rare_sp]</span>
<span id="cb10-8"><a href="#cb10-8"></a><span class="co"># Normalized continuous variables</span></span>
<span id="cb10-9"><a href="#cb10-9"></a>Env_Mites  &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="kw">scale</span>(mites[,<span class="kw">c</span>(<span class="st">"density"</span>,<span class="st">"water"</span>)]),</span>
<span id="cb10-10"><a href="#cb10-10"></a>                    mites[,<span class="kw">c</span>(<span class="st">"substrate"</span>, <span class="st">"shrubs"</span>, <span class="st">"topo"</span>)])</span>
<span id="cb10-11"><a href="#cb10-11"></a>mf.suit &lt;-<span class="st"> </span><span class="kw">model.frame</span>(<span class="dt">formula=</span><span class="op">~</span>., <span class="dt">data=</span><span class="kw">as.data.frame</span>(Env_Mites))</span>
<span id="cb10-12"><a href="#cb10-12"></a>X_Mites &lt;-<span class="st"> </span><span class="kw">model.matrix</span>(<span class="kw">attr</span>(mf.suit,<span class="st">"terms"</span>), <span class="dt">data=</span>mf.suit)</span>
<span id="cb10-13"><a href="#cb10-13"></a><span class="co"># Fit the model </span></span>
<span id="cb10-14"><a href="#cb10-14"></a>T1 &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()</span>
<span id="cb10-15"><a href="#cb10-15"></a>mod_boral_Mites &lt;-<span class="st"> </span><span class="kw">boral</span>(<span class="dt">y=</span>PA_Mites, <span class="dt">X=</span>X_Mites[,<span class="op">-</span><span class="dv">1</span>],</span>
<span id="cb10-16"><a href="#cb10-16"></a>                         <span class="dt">save.model=</span><span class="ot">TRUE</span>, <span class="dt">model.name=</span><span class="st">"Mites_jagsboralmodel.txt"</span>, </span>
<span id="cb10-17"><a href="#cb10-17"></a>                         <span class="dt">lv.control=</span><span class="kw">list</span>(<span class="dt">num.lv=</span><span class="dv">2</span>), <span class="dt">family=</span><span class="st">"poisson"</span>,</span>
<span id="cb10-18"><a href="#cb10-18"></a>                         <span class="dt">prior.control=</span><span class="kw">list</span>(<span class="dt">type=</span><span class="kw">c</span>(<span class="st">"normal"</span>,<span class="st">"normal"</span>,</span>
<span id="cb10-19"><a href="#cb10-19"></a>                                                   <span class="st">"normal"</span>,<span class="st">"uniform"</span>),</span>
<span id="cb10-20"><a href="#cb10-20"></a>                                            <span class="dt">hypparams =</span> <span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">30</span>))</span>
<span id="cb10-21"><a href="#cb10-21"></a>                         <span class="dt">row.eff=</span><span class="st">"random"</span>, </span>
<span id="cb10-22"><a href="#cb10-22"></a>                         <span class="dt">mcmc.control=</span><span class="kw">list</span>(<span class="dt">n.burnin=</span><span class="dv">10000</span>,</span>
<span id="cb10-23"><a href="#cb10-23"></a>                                           <span class="dt">n.iteration=</span><span class="dv">15000</span>,</span>
<span id="cb10-24"><a href="#cb10-24"></a>                                           <span class="dt">n.thin=</span><span class="dv">5</span>, <span class="dt">seed=</span><span class="dv">123</span>))</span>
<span id="cb10-25"><a href="#cb10-25"></a>T2 &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()</span>
<span id="cb10-26"><a href="#cb10-26"></a>T_boral_Mites &lt;-<span class="st"> </span><span class="kw">difftime</span>(T2,T1)</span>
<span id="cb10-27"><a href="#cb10-27"></a></span>
<span id="cb10-28"><a href="#cb10-28"></a><span class="co"># Predicted probit(theta) </span></span>
<span id="cb10-29"><a href="#cb10-29"></a>log_theta_latent_Mites &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(X_Mites[,<span class="op">-</span><span class="dv">1</span>]) <span class="op">%*%</span><span class="st"> </span><span class="kw">t</span>(mod_boral_Mites<span class="op">$</span>X.coefs.mean) <span class="op">+</span></span>
<span id="cb10-30"><a href="#cb10-30"></a><span class="st">  </span><span class="kw">matrix</span>(<span class="dv">1</span>,<span class="dt">nrow=</span><span class="kw">nrow</span>(PA_Mites), <span class="dt">ncol=</span><span class="dv">1</span>)<span class="op">%*%</span>mod_boral_Mites<span class="op">$</span>lv.coefs.mean[,<span class="st">"beta0"</span>] <span class="op">+</span><span class="st"> </span></span>
<span id="cb10-31"><a href="#cb10-31"></a><span class="st">  </span>mod_boral_Mites<span class="op">$</span>lv.mean<span class="op">%*%</span><span class="kw">t</span>(mod_boral_Mites<span class="op">$</span>lv.coefs.mean[,<span class="op">-</span><span class="dv">1</span>]) <span class="op">+</span></span>
<span id="cb10-32"><a href="#cb10-32"></a><span class="st">  </span><span class="kw">c</span>(mod_boral_Mites<span class="op">$</span>row.coefs[[<span class="dv">1</span>]]<span class="op">$</span>mean)</span>
<span id="cb10-33"><a href="#cb10-33"></a><span class="co"># theta_latent</span></span>
<span id="cb10-34"><a href="#cb10-34"></a>theta_latent_Mites &lt;-<span class="st"> </span><span class="kw">exp</span>(log_theta_latent_Mites)</span>
<span id="cb10-35"><a href="#cb10-35"></a><span class="co"># Deviance</span></span>
<span id="cb10-36"><a href="#cb10-36"></a>logL=<span class="dv">0</span></span>
<span id="cb10-37"><a href="#cb10-37"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(PA_Mites)){</span>
<span id="cb10-38"><a href="#cb10-38"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(PA_Mites)){</span>
<span id="cb10-39"><a href="#cb10-39"></a>    logL=logL <span class="op">+</span><span class="st"> </span><span class="kw">dpois</span>(PA_Mites[i,j],theta_latent_Mites[i,j],<span class="dv">1</span>)  </span>
<span id="cb10-40"><a href="#cb10-40"></a>  }</span>
<span id="cb10-41"><a href="#cb10-41"></a>}</span>
<span id="cb10-42"><a href="#cb10-42"></a>Deviance_boral_Mites &lt;-<span class="st"> </span><span class="dv">-2</span><span class="op">*</span>logL</span>
<span id="cb10-43"><a href="#cb10-43"></a></span>
<span id="cb10-44"><a href="#cb10-44"></a><span class="kw">save</span>(T_boral_Mites, mod_boral_Mites,</span>
<span id="cb10-45"><a href="#cb10-45"></a>     log_theta_latent_Mites, Deviance_boral_Mites,</span>
<span id="cb10-46"><a href="#cb10-46"></a>     <span class="dt">file=</span><span class="st">"boral_Mites.RData"</span>)</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="package-jsdm">
<span class="header-section-number">4</span> Package <code>jSDM</code><a class="anchor" aria-label="anchor" href="#package-jsdm"></a>
</h2>
<p>In a second step, we fit the same joint species distribution models from each of the previous data-sets using the <code>jSDM</code> package.</p>
<div class="section level3">
<h3 id="simulated-dataset-1">
<span class="header-section-number">4.1</span> Simulated dataset<a class="anchor" aria-label="anchor" href="#simulated-dataset-1"></a>
</h3>
<p>We fit a binomial joint species distribution model, including random site effect and latent variables, from the simulated data-set using the <code><a href="../reference/jSDM_binomial_probit.html">jSDM_binomial_probit()</a></code> function to perform binomial probit regression.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">dirname</a></span><span class="op">(</span><span class="fu">rstudioapi</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rstudioapi/man/rstudio-editors.html" class="external-link">getSourceEditorContext</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">path</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span>file<span class="op">=</span><span class="st">"jSDM_boral_cache/boral_simulation.RData"</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ecology.ghislainv.fr/jSDM/" class="external-link">jSDM</a></span><span class="op">)</span>
<span class="co"># Fit the model</span>
<span class="va">T1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span> 
<span class="va">mod_jSDM_sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/jSDM_binomial_probit.html">jSDM_binomial_probit</a></span><span class="op">(</span>
  <span class="co"># Chains</span>
  burnin<span class="op">=</span><span class="fl">10000</span>, mcmc<span class="op">=</span><span class="fl">5000</span>, thin<span class="op">=</span><span class="fl">5</span>,
  <span class="co"># Response variable</span>
  presence_data<span class="op">=</span><span class="va">Y</span>, 
  <span class="co"># Explanatory variables </span>
  site_formula<span class="op">=</span><span class="op">~</span><span class="va">x1</span><span class="op">+</span><span class="va">x2</span>,   
  site_data<span class="op">=</span><span class="va">X</span>,
  <span class="co"># Model specification</span>
  n_latent<span class="op">=</span><span class="fl">2</span>, site_effect<span class="op">=</span><span class="st">"random"</span>,
  <span class="co"># Starting values</span>
  alpha_start<span class="op">=</span><span class="fl">0</span>, beta_start<span class="op">=</span><span class="fl">0</span>,
  lambda_start<span class="op">=</span><span class="fl">0</span>, W_start<span class="op">=</span><span class="fl">0</span>,
  V_alpha<span class="op">=</span><span class="fl">1</span>, 
  <span class="co"># Priors </span>
  shape<span class="op">=</span><span class="fl">0.1</span>, rate<span class="op">=</span><span class="fl">0.1</span>,
  mu_beta<span class="op">=</span><span class="fl">0</span>, V_beta<span class="op">=</span><span class="fl">10</span>,
  mu_lambda<span class="op">=</span><span class="fl">0</span>, V_lambda<span class="op">=</span><span class="fl">10</span>,
  <span class="co"># Various </span>
  seed<span class="op">=</span><span class="fl">123</span>, verbose<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
<span class="va">T2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span> 
<span class="va">T_jSDM_sim</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">T2</span>, <span class="va">T1</span><span class="op">)</span>

<span class="co"># RMSE</span>
<span class="va">SE</span><span class="op">=</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="va">probit_theta</span><span class="op">)</span><span class="op">-</span><span class="va">mod_jSDM_sim</span><span class="op">$</span><span class="va">theta_latent</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>
<span class="va">RMSE_jSDM_sim</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">SE</span><span class="op">/</span><span class="op">(</span><span class="va">nsite</span><span class="op">*</span><span class="va">nsp</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">T_jSDM_sim</span>, <span class="va">mod_jSDM_sim</span>, <span class="va">RMSE_jSDM_sim</span>,
     file<span class="op">=</span><span class="st">"jSDM_boral_cache/jSDM_simulation.RData"</span><span class="op">)</span></code></pre></div>
<p>We visually evaluate the convergence of MCMCs by representing the trace and density <em>a posteriori</em> of some estimated parameters using the <code>jSDM</code> package and we plot the estimated parameters according to the expected ones to assess the accuracy of the package <code>jSDM</code> results.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span>file<span class="op">=</span><span class="st">"jSDM_boral_cache/jSDM_simulation.RData"</span><span class="op">)</span>
<span class="co"># ===================================================</span>
<span class="co"># Result analysis</span>
<span class="co"># ===================================================</span>

<span class="co">## Fixed species effect beta for first two species </span>
<span class="va">np</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>
<span class="va">mean_beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">nsp</span>,<span class="va">np</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nsp</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">p</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">mean_beta</span><span class="op">[</span><span class="va">j</span>,<span class="va">p</span><span class="op">]</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mod_jSDM_sim</span><span class="op">$</span><span class="va">mcmc.sp</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">p</span><span class="op">]</span><span class="op">)</span>
    <span class="kw">if</span> <span class="op">(</span><span class="va">j</span> <span class="op">&lt;</span> <span class="fl">3</span><span class="op">)</span><span class="op">{</span>
      <span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/traceplot.html" class="external-link">traceplot</a></span><span class="op">(</span><span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html" class="external-link">as.mcmc</a></span><span class="op">(</span><span class="va">mod_jSDM_sim</span><span class="op">$</span><span class="va">mcmc.sp</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">p</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
      <span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/densplot.html" class="external-link">densplot</a></span><span class="op">(</span><span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html" class="external-link">as.mcmc</a></span><span class="op">(</span><span class="va">mod_jSDM_sim</span><span class="op">$</span><span class="va">mcmc.sp</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">p</span><span class="op">]</span><span class="op">)</span>, 
                     main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mod_jSDM_sim</span><span class="op">$</span><span class="va">mcmc.sp</span>
                                         <span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="va">p</span><span class="op">]</span>,<span class="st">", species : "</span>,<span class="va">j</span><span class="op">)</span><span class="op">)</span>
      <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="va">beta.target</span><span class="op">[</span><span class="va">p</span>,<span class="va">j</span><span class="op">]</span>,col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span>
    <span class="op">}</span>
  <span class="op">}</span>
<span class="op">}</span>

<span class="co">## Factor loadings lambda_j for first two species </span>
<span class="va">mean_lambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">nsp</span>,<span class="va">nl</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">nl</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nsp</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">l</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nl</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">mean_lambda</span><span class="op">[</span><span class="va">j</span>,<span class="va">l</span><span class="op">]</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mod_jSDM_sim</span><span class="op">$</span><span class="va">mcmc.sp</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">+</span><span class="va">l</span><span class="op">]</span><span class="op">)</span>
    
    <span class="kw">if</span> <span class="op">(</span><span class="va">j</span> <span class="op">&lt;</span> <span class="fl">3</span><span class="op">)</span><span class="op">{</span>
      <span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/traceplot.html" class="external-link">traceplot</a></span><span class="op">(</span><span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html" class="external-link">as.mcmc</a></span><span class="op">(</span><span class="va">mod_jSDM_sim</span><span class="op">$</span><span class="va">mcmc.sp</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">+</span><span class="va">l</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
      <span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/densplot.html" class="external-link">densplot</a></span><span class="op">(</span><span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html" class="external-link">as.mcmc</a></span><span class="op">(</span><span class="va">mod_jSDM_sim</span><span class="op">$</span><span class="va">mcmc.sp</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">+</span><span class="va">l</span><span class="op">]</span><span class="op">)</span>, 
                     main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mod_jSDM_sim</span><span class="op">$</span><span class="va">mcmc.sp</span>
                                         <span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">+</span><span class="va">l</span><span class="op">]</span>,<span class="st">", species : "</span>,<span class="va">j</span><span class="op">)</span><span class="op">)</span>
      <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="va">lambda.target</span><span class="op">[</span><span class="va">l</span>,<span class="va">j</span><span class="op">]</span>,col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span>
    <span class="op">}</span>
  <span class="op">}</span>
<span class="op">}</span>

<span class="co"># Fixed species effects </span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">beta.target</span><span class="op">)</span>,<span class="va">mean_beta</span>, xlab<span class="op">=</span><span class="st">"obs"</span>, ylab<span class="op">=</span><span class="st">"fitted"</span>, 
     main<span class="op">=</span><span class="st">"Fixed species effect beta"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>,b<span class="op">=</span><span class="fl">1</span>,col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">lambda.target</span><span class="op">)</span>,<span class="va">mean_lambda</span>, xlab<span class="op">=</span><span class="st">"obs"</span>, ylab<span class="op">=</span><span class="st">"fitted"</span>, 
     main<span class="op">=</span><span class="st">"Loading factors lambda"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>,b<span class="op">=</span><span class="fl">1</span>,col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span>

<span class="co">## W latent variables</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">l</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nl</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">W</span><span class="op">[</span>,<span class="va">l</span><span class="op">]</span>,<span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">mod_jSDM_sim</span><span class="op">$</span><span class="va">mcmc.latent</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"lv_"</span>,<span class="va">l</span><span class="op">)</span><span class="op">]</span><span class="op">]</span>,<span class="fl">2</span>,<span class="va">mean</span><span class="op">)</span>,
       main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Latent variable W_"</span>, <span class="va">l</span><span class="op">)</span>, xlab<span class="op">=</span><span class="st">"obs"</span>, ylab<span class="op">=</span><span class="st">"fitted"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>,b<span class="op">=</span><span class="fl">1</span>,col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span>
<span class="op">}</span>

<span class="co">## V_alpha</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/traceplot.html" class="external-link">traceplot</a></span><span class="op">(</span><span class="va">mod_jSDM_sim</span><span class="op">$</span><span class="va">mcmc.V_alpha</span>, main<span class="op">=</span><span class="st">"V_alpha"</span><span class="op">)</span>
<span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/densplot.html" class="external-link">densplot</a></span><span class="op">(</span><span class="va">mod_jSDM_sim</span><span class="op">$</span><span class="va">mcmc.V_alpha</span>, main<span class="op">=</span><span class="st">"V_alpha"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="va">V_alpha.target</span>,col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span>

<span class="co">## alpha</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">alpha.target</span>,<span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">mod_jSDM_sim</span><span class="op">$</span><span class="va">mcmc.alpha</span>,<span class="fl">2</span>,<span class="va">mean</span><span class="op">)</span>,
     xlab<span class="op">=</span> <span class="st">"obs"</span>, ylab<span class="op">=</span><span class="st">"fitted"</span>, main<span class="op">=</span><span class="st">"Random site effect alpha"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>,b<span class="op">=</span><span class="fl">1</span>,col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span>

<span class="co">## Deviance</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mod_jSDM_sim</span><span class="op">$</span><span class="va">mcmc.Deviance</span>, main<span class="op">=</span><span class="st">"Deviance"</span><span class="op">)</span>

<span class="co">#= Predictions</span>
<span class="co">## probit_theta</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">probit_theta</span>,<span class="va">mod_jSDM_sim</span><span class="op">$</span><span class="va">probit_theta_latent</span>,
     xlab<span class="op">=</span><span class="st">"obs"</span>,ylab<span class="op">=</span><span class="st">"fitted"</span>, main<span class="op">=</span><span class="st">"probit(theta)"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>,b<span class="op">=</span><span class="fl">1</span>,col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span>
<span class="co">## theta</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="va">probit_theta</span><span class="op">)</span>,<span class="va">mod_jSDM_sim</span><span class="op">$</span><span class="va">theta_latent</span>,
     xlab<span class="op">=</span><span class="st">"obs"</span>,ylab<span class="op">=</span><span class="st">"fitted"</span>, main<span class="op">=</span><span class="st">"theta"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>,b<span class="op">=</span><span class="fl">1</span>,col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span></code></pre></div>
<p><img src="jSDM_boral_files/figure-html/jSDM-simulation-plot-1.png" width="800" style="display: block; margin: auto;"><img src="jSDM_boral_files/figure-html/jSDM-simulation-plot-2.png" width="800" style="display: block; margin: auto;"><img src="jSDM_boral_files/figure-html/jSDM-simulation-plot-3.png" width="800" style="display: block; margin: auto;"><img src="jSDM_boral_files/figure-html/jSDM-simulation-plot-4.png" width="800" style="display: block; margin: auto;"><img src="jSDM_boral_files/figure-html/jSDM-simulation-plot-5.png" width="800" style="display: block; margin: auto;"><img src="jSDM_boral_files/figure-html/jSDM-simulation-plot-6.png" width="800" style="display: block; margin: auto;"><img src="jSDM_boral_files/figure-html/jSDM-simulation-plot-7.png" width="800" style="display: block; margin: auto;"><img src="jSDM_boral_files/figure-html/jSDM-simulation-plot-8.png" width="800" style="display: block; margin: auto;"><img src="jSDM_boral_files/figure-html/jSDM-simulation-plot-9.png" width="800" style="display: block; margin: auto;"><img src="jSDM_boral_files/figure-html/jSDM-simulation-plot-10.png" width="800" style="display: block; margin: auto;"></p>
<p>Overall, the traces and the densities of the parameters indicate the convergence of the algorithm. Indeed, we observe on the traces that the values oscillate around averages without showing an upward or downward trend and we see that the densities are quite smooth and for the most part of Gaussian form.<br>
On the above figures, the estimated parameters are close to the expected values if the points are near the red line representing the identity function (<span class="math inline">\(y=x\)</span>).</p>
</div>
<div class="section level3">
<h3 id="mosquitos-dataset-1">
<span class="header-section-number">4.2</span> Mosquitos dataset<a class="anchor" aria-label="anchor" href="#mosquitos-dataset-1"></a>
</h3>
<p>We fit a binomial joint species distribution model, including random site effect and latent variables, from the <a href="https://ecology.ghislainv.fr/jSDM/reference/mosquitos.html" class="external-link"><code>mosquitos</code></a> data-set using <code><a href="../reference/jSDM_binomial_probit.html">jSDM_binomial_probit()</a></code> function to perform binomial probit regression.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Fit the model</span>
<span class="va">T1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">mod_jSDM_Mosquitos</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/jSDM_binomial_probit.html">jSDM_binomial_probit</a></span><span class="op">(</span>
  <span class="co"># Chains </span>
  burnin<span class="op">=</span><span class="fl">10000</span>, mcmc<span class="op">=</span><span class="fl">5000</span>, thin<span class="op">=</span><span class="fl">5</span>,
  <span class="co"># Response variable </span>
  presence_data<span class="op">=</span><span class="va">PA_Mosquitos</span>, 
  <span class="co"># Explanatory variables </span>
  site_formula<span class="op">=</span><span class="op">~</span><span class="va">.</span>,   
  site_data<span class="op">=</span><span class="va">Env_Mosquitos</span>,
  <span class="co"># Model specification</span>
  site_effect<span class="op">=</span><span class="st">"random"</span>, n_latent<span class="op">=</span><span class="fl">2</span>,
  <span class="co"># Starting values </span>
  alpha_start<span class="op">=</span><span class="fl">0</span>, beta_start<span class="op">=</span><span class="fl">0</span>,
  lambda_start<span class="op">=</span><span class="fl">0</span>, W_start<span class="op">=</span><span class="fl">0</span>,
  V_alpha<span class="op">=</span><span class="fl">1</span>,
  <span class="co"># Priors </span>
  shape<span class="op">=</span><span class="fl">0.1</span>, rate<span class="op">=</span><span class="fl">0.1</span>,
  mu_beta<span class="op">=</span><span class="fl">0</span>, V_beta<span class="op">=</span><span class="fl">10</span> ,
  mu_lambda<span class="op">=</span><span class="fl">0</span>, V_lambda<span class="op">=</span><span class="fl">10</span>,
  <span class="co"># Various </span>
  seed<span class="op">=</span><span class="fl">123</span>, verbose<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
<span class="va">T2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">T_jSDM_Mosquitos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">T2</span>,<span class="va">T1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">T_jSDM_Mosquitos</span>, <span class="va">mod_jSDM_Mosquitos</span>,
     file<span class="op">=</span><span class="st">"jSDM_boral_cache/jSDM_Mosquitos.RData"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="eucalypts-dataset-1">
<span class="header-section-number">4.3</span> Eucalypts dataset<a class="anchor" aria-label="anchor" href="#eucalypts-dataset-1"></a>
</h3>
<p>We fit a binomial joint species distribution model, including random site effect and latent variables, from the <a href="https://ecology.ghislainv.fr/jSDM/reference/eucalypts.html" class="external-link"><code>eucalypts</code></a> data-set using <code><a href="../reference/jSDM_binomial_probit.html">jSDM_binomial_probit()</a></code> function to perform binomial probit regression.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Fit the model</span>
<span class="va">T1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">mod_jSDM_Eucalypts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/jSDM_binomial_probit.html">jSDM_binomial_probit</a></span><span class="op">(</span>
  <span class="co"># Chains</span>
  burnin<span class="op">=</span><span class="fl">10000</span>, mcmc<span class="op">=</span><span class="fl">5000</span>, thin<span class="op">=</span><span class="fl">5</span>,
  <span class="co"># Response variable </span>
  presence_data<span class="op">=</span><span class="va">PA_Eucalypts</span>,
  <span class="co"># Explanatory variables </span>
  site_formula<span class="op">=</span><span class="op">~</span><span class="va">.</span>,   
  site_data<span class="op">=</span><span class="va">Env_Eucalypts</span>,
  <span class="co"># Model specification</span>
  n_latent<span class="op">=</span><span class="fl">2</span>, site_effect<span class="op">=</span><span class="st">"random"</span>,
  <span class="co"># Starting values </span>
  alpha_start<span class="op">=</span><span class="fl">0</span>, beta_start<span class="op">=</span><span class="fl">0</span>,
  lambda_start<span class="op">=</span><span class="fl">0</span>, W_start<span class="op">=</span><span class="fl">0</span>,
  V_alpha<span class="op">=</span><span class="fl">1</span>,
  <span class="co"># Priors </span>
  shape<span class="op">=</span><span class="fl">0.1</span>, rate<span class="op">=</span><span class="fl">0.1</span>,
  mu_beta<span class="op">=</span><span class="fl">0</span>, V_beta<span class="op">=</span><span class="fl">10</span> ,
  mu_lambda<span class="op">=</span><span class="fl">0</span>, V_lambda<span class="op">=</span><span class="fl">10</span>,
  <span class="co"># Various </span>
  seed<span class="op">=</span><span class="fl">123</span>, verbose<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
<span class="va">T2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">T_jSDM_Eucalypts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">T2</span>,<span class="va">T1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">T_jSDM_Eucalypts</span>, <span class="va">mod_jSDM_Eucalypts</span>,
     file<span class="op">=</span><span class="st">"jSDM_boral_cache/jSDM_Eucalypts.RData"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="frogs-dataset-1">
<span class="header-section-number">4.4</span> Frogs dataset<a class="anchor" aria-label="anchor" href="#frogs-dataset-1"></a>
</h3>
<p>We fit a binomial joint species distribution model, including random site effect and latent variables, from the <a href="https://ecology.ghislainv.fr/jSDM/reference/frogs.html" class="external-link"><code>frogs</code></a> data-set using <code><a href="../reference/jSDM_binomial_probit.html">jSDM_binomial_probit()</a></code> function to perform binomial probit regression.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Fit the model </span>
<span class="va">T1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">mod_jSDM_Frogs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/jSDM_binomial_probit.html">jSDM_binomial_probit</a></span><span class="op">(</span>
  <span class="co"># Chains</span>
  burnin<span class="op">=</span><span class="fl">10000</span>, mcmc<span class="op">=</span><span class="fl">5000</span>, thin<span class="op">=</span><span class="fl">5</span>,
  <span class="co"># Response variable </span>
  presence_data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">PA_Frogs</span><span class="op">)</span>, 
  <span class="co"># Explanatory variables </span>
  site_formula<span class="op">=</span><span class="op">~</span><span class="va">.</span>,   
  site_data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">Env_Frogs</span><span class="op">)</span>,
  <span class="co"># Model specification </span>
  n_latent<span class="op">=</span><span class="fl">2</span>, site_effect<span class="op">=</span><span class="st">"random"</span>,
  <span class="co"># Starting values </span>
  alpha_start<span class="op">=</span><span class="fl">0</span>, beta_start<span class="op">=</span><span class="fl">0</span>,
  lambda_start<span class="op">=</span><span class="fl">0</span>, W_start<span class="op">=</span><span class="fl">0</span>,
  V_alpha<span class="op">=</span><span class="fl">1</span>,
  <span class="co"># Priors </span>
  shape<span class="op">=</span><span class="fl">0.1</span>, rate<span class="op">=</span><span class="fl">0.1</span>,
  mu_beta<span class="op">=</span><span class="fl">0</span>, V_beta<span class="op">=</span><span class="fl">10</span>,
  mu_lambda<span class="op">=</span><span class="fl">0</span>, V_lambda<span class="op">=</span><span class="fl">10</span>,
  <span class="co"># Various </span>
  seed<span class="op">=</span><span class="fl">123</span>, verbose<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
<span class="va">T2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">T_jSDM_Frogs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">T2</span>,<span class="va">T1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">T_jSDM_Frogs</span>, <span class="va">mod_jSDM_Frogs</span>,
     file<span class="op">=</span><span class="st">"jSDM_boral_cache/jSDM_Frogs.RData"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fungi-dataset-1">
<span class="header-section-number">4.5</span> Fungi dataset<a class="anchor" aria-label="anchor" href="#fungi-dataset-1"></a>
</h3>
<p>We fit a binomial joint species distribution model, including random site effect and latent variables, from the <a href="https://ecology.ghislainv.fr/jSDM/reference/fungi.html" class="external-link"><code>fungi</code></a> data-set using <code><a href="../reference/jSDM_binomial_probit.html">jSDM_binomial_probit()</a></code> function to perform binomial probit regression.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Fit the model</span>
<span class="va">T1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">mod_jSDM_Fungi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/jSDM_binomial_probit.html">jSDM_binomial_probit</a></span><span class="op">(</span>
  <span class="co"># Chains </span>
  burnin<span class="op">=</span><span class="fl">10000</span>, mcmc<span class="op">=</span><span class="fl">5000</span>, thin<span class="op">=</span><span class="fl">5</span>,
  <span class="co"># Response variable </span>
  presence_data<span class="op">=</span><span class="va">PA_Fungi</span>, 
  <span class="co"># Explanatory variables </span>
  site_formula<span class="op">=</span><span class="op">~</span><span class="va">.</span>,   
  site_data<span class="op">=</span><span class="va">Env_Fungi</span>,
  <span class="co"># Model specification</span>
  n_latent<span class="op">=</span><span class="fl">2</span>, site_effect<span class="op">=</span><span class="st">"random"</span>,
  <span class="co"># Starting values </span>
  alpha_start<span class="op">=</span><span class="fl">0</span>, beta_start<span class="op">=</span><span class="fl">0</span>,
  lambda_start<span class="op">=</span><span class="fl">0</span>, W_start<span class="op">=</span><span class="fl">0</span>,
  V_alpha<span class="op">=</span><span class="fl">1</span>,
  <span class="co"># Priors </span>
  shape<span class="op">=</span><span class="fl">0.1</span>, rate<span class="op">=</span><span class="fl">0.1</span>,
  mu_beta<span class="op">=</span><span class="fl">0</span>, V_beta<span class="op">=</span><span class="fl">10</span>,
  mu_lambda<span class="op">=</span><span class="fl">0</span>, V_lambda<span class="op">=</span><span class="fl">10</span>,
  <span class="co"># Various </span>
  seed<span class="op">=</span><span class="fl">123</span>, verbose<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
<span class="va">T2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">T_jSDM_Fungi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">T2</span>,<span class="va">T1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">T_jSDM_Fungi</span>, <span class="va">mod_jSDM_Fungi</span>,
     file<span class="op">=</span><span class="st">"jSDM_boral_cache/jSDM_Fungi.RData"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="birds-dataset-1">
<span class="header-section-number">4.6</span> Birds dataset<a class="anchor" aria-label="anchor" href="#birds-dataset-1"></a>
</h3>
<p>We fit a binomial joint species distribution model with multiple visit by site, including random site effect and latent variables, from the <a href="https://ecology.ghislainv.fr/jSDM/reference/birds.html" class="external-link"><code>birds</code></a> data-set using <code><a href="../reference/jSDM_binomial_logit.html">jSDM_binomial_logit()</a></code> function to perform binomial logistic regression.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Fit the model</span>
<span class="va">T1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">mod_jSDM_Birds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/jSDM_binomial_logit.html">jSDM_binomial_logit</a></span><span class="op">(</span>
  <span class="co"># Chains </span>
  burnin<span class="op">=</span><span class="fl">10000</span>, mcmc<span class="op">=</span><span class="fl">5000</span>, thin<span class="op">=</span><span class="fl">5</span>,
  <span class="co"># Response variable </span>
  presence_data<span class="op">=</span><span class="va">PA_Birds</span>, 
  <span class="co"># Explanatory variables </span>
  site_formula<span class="op">=</span><span class="op">~</span><span class="va">elev</span><span class="op">+</span><span class="va">rlength</span><span class="op">+</span><span class="va">forest</span>,   
  site_data<span class="op">=</span><span class="va">Env_Birds</span>,
  trials<span class="op">=</span> <span class="va">Env_Birds</span><span class="op">$</span><span class="va">nsurvey</span>, 
  <span class="co"># Model specification</span>
  n_latent<span class="op">=</span><span class="fl">2</span>, site_effect<span class="op">=</span><span class="st">"random"</span>,
  <span class="co"># Starting values </span>
  alpha_start<span class="op">=</span><span class="fl">0</span>, beta_start<span class="op">=</span><span class="fl">0</span>,
  lambda_start<span class="op">=</span><span class="fl">0</span>, W_start<span class="op">=</span><span class="fl">0</span>,
  V_alpha<span class="op">=</span><span class="fl">1</span>,
  <span class="co"># Priors </span>
  shape<span class="op">=</span><span class="fl">0.1</span>, rate<span class="op">=</span><span class="fl">0.1</span>,
  mu_beta<span class="op">=</span><span class="fl">0</span>, V_beta<span class="op">=</span><span class="fl">10</span> ,
  mu_lambda<span class="op">=</span><span class="fl">0</span>, V_lambda<span class="op">=</span><span class="fl">10</span>,
  <span class="co"># Various </span>
  ropt<span class="op">=</span><span class="fl">0.44</span>,
  seed<span class="op">=</span><span class="fl">123</span>, verbose<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
<span class="va">T2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">T_jSDM_Birds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">T2</span>,<span class="va">T1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">T_jSDM_Birds</span>, <span class="va">mod_jSDM_Birds</span>,
     file<span class="op">=</span><span class="st">"jSDM_boral_cache/jSDM_Birds.RData"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="mites-dataset-1">
<span class="header-section-number">4.7</span> Mites dataset<a class="anchor" aria-label="anchor" href="#mites-dataset-1"></a>
</h3>
<p>We fit a joint species distribution model, including random site effect and latent variables, from the <a href="https://ecology.ghislainv.fr/jSDM/reference/mites.html" class="external-link"><code>mites</code></a> abundance data-set using <code><a href="../reference/jSDM_poisson_log.html">jSDM_poisson_log()</a></code> function to perform a poisson log-linear regression.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Fit the model</span>
<span class="va">T1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">mod_jSDM_Mites</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/jSDM_poisson_log.html">jSDM_poisson_log</a></span><span class="op">(</span>
  <span class="co"># Chains </span>
  burnin<span class="op">=</span><span class="fl">10000</span>, mcmc<span class="op">=</span><span class="fl">5000</span>, thin<span class="op">=</span><span class="fl">5</span>,
  <span class="co"># Response variable </span>
  count_data<span class="op">=</span><span class="va">PA_Mites</span>, 
  <span class="co"># Explanatory variables </span>
  site_formula<span class="op">=</span><span class="op">~</span><span class="va">.</span>,   
  site_data<span class="op">=</span><span class="va">Env_Mites</span>,
  <span class="co"># Model specification</span>
  n_latent<span class="op">=</span><span class="fl">2</span>, site_effect<span class="op">=</span><span class="st">"random"</span>,
  <span class="co"># Starting values </span>
  alpha_start<span class="op">=</span><span class="fl">0</span>, beta_start<span class="op">=</span><span class="fl">0</span>,
  lambda_start<span class="op">=</span><span class="fl">0</span>, W_start<span class="op">=</span><span class="fl">0</span>,
  V_alpha<span class="op">=</span><span class="fl">1</span>,
  <span class="co"># Priors </span>
  shape<span class="op">=</span><span class="fl">0.1</span>, rate<span class="op">=</span><span class="fl">0.1</span>,
  mu_beta<span class="op">=</span><span class="fl">0</span>, V_beta<span class="op">=</span><span class="fl">10</span> ,
  mu_lambda<span class="op">=</span><span class="fl">0</span>, V_lambda<span class="op">=</span><span class="fl">10</span>,
  <span class="co"># Various </span>
  ropt<span class="op">=</span><span class="fl">0.44</span>,
  seed<span class="op">=</span><span class="fl">123</span>, verbose<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
<span class="va">T2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">T_jSDM_Mites</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">T2</span>,<span class="va">T1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">T_jSDM_Mites</span>, <span class="va">mod_jSDM_Mites</span>,
     file<span class="op">=</span><span class="st">"jSDM_boral_cache/jSDM_Mites.RData"</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="comparison">
<span class="header-section-number">5</span> Comparison<a class="anchor" aria-label="anchor" href="#comparison"></a>
</h2>
<p>Then we compare the compilation time and the results obtained with each package.</p>
<div class="section level3">
<h3 id="compilation-time-and-deviance">
<span class="header-section-number">5.1</span> Compilation time and deviance<a class="anchor" aria-label="anchor" href="#compilation-time-and-deviance"></a>
</h3>
<table class="table table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
Simulated
</th>
<th style="text-align:left;">
Mosquitos
</th>
<th style="text-align:left;">
Eucalypts
</th>
<th style="text-align:left;">
Frogs
</th>
<th style="text-align:left;">
Fungi
</th>
<th style="text-align:left;">
Birds
</th>
<th style="text-align:left;">
Mites
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Compilation time boral (secondes)
</td>
<td style="text-align:left;">
35546
</td>
<td style="text-align:left;">
2175
</td>
<td style="text-align:left;">
1439
</td>
<td style="text-align:left;">
83
</td>
<td style="text-align:left;">
2369
</td>
<td style="text-align:left;">
3909
</td>
<td style="text-align:left;">
533
</td>
</tr>
<tr>
<td style="text-align:left;">
Compilation time jSDM (secondes)
</td>
<td style="text-align:left;">
133
</td>
<td style="text-align:left;">
17
</td>
<td style="text-align:left;">
33
</td>
<td style="text-align:left;">
6
</td>
<td style="text-align:left;">
32
</td>
<td style="text-align:left;">
1164
</td>
<td style="text-align:left;">
109
</td>
</tr>
<tr>
<td style="text-align:left;">
Deviance boral
</td>
<td style="text-align:left;">
23255
</td>
<td style="text-align:left;">
1079
</td>
<td style="text-align:left;">
1703
</td>
<td style="text-align:left;">
120
</td>
<td style="text-align:left;">
1220
</td>
<td style="text-align:left;">
30193
</td>
<td style="text-align:left;">
6127
</td>
</tr>
<tr>
<td style="text-align:left;">
Deviance jSDM
</td>
<td style="text-align:left;">
23164
</td>
<td style="text-align:left;">
996
</td>
<td style="text-align:left;">
1598
</td>
<td style="text-align:left;">
101
</td>
<td style="text-align:left;">
1155
</td>
<td style="text-align:left;">
30133
</td>
<td style="text-align:left;">
6089
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
<img src="figures/des.jpg" width="80" height="80">
</td>
<td style="text-align:left;">
<img src="figures/Mosquitos_.jpg" width="80" height="80">
</td>
<td style="text-align:left;">
<img src="figures/Eucalyptus_.jpg" width="80" height="80">
</td>
<td style="text-align:left;">
<img src="figures/Frogs_.jpg" width="80" height="80">
</td>
<td style="text-align:left;">
<img src="figures/Fungi_.jpg" width="80" height="80">
</td>
<td style="text-align:left;">
<img src="figures/birds.jpg" width="80" height="80">
</td>
<td style="text-align:left;">
<img src="figures/oribatid-mites.png" width="80" height="80">
</td>
</tr>
</tbody>
</table>
<p>jSDM is <strong>3 to 268</strong> times faster than boral/jags.</p>
</div>
<div class="section level3">
<h3 id="root-mean-square-error-rmse-for-simulated-data">
<span class="header-section-number">5.2</span> Root-Mean-Square Error (RMSE) for simulated data<a class="anchor" aria-label="anchor" href="#root-mean-square-error-rmse-for-simulated-data"></a>
</h3>
<p>Computed for or the probabilities of presences <span class="math inline">\(\theta_{ij}\)</span> with the simulated data-set.</p>
<table class="table table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
boral
</th>
<th style="text-align:right;">
jSDM
</th>
</tr></thead>
<tbody><tr>
<td style="text-align:left;">
RMSE
</td>
<td style="text-align:right;">
0.089
</td>
<td style="text-align:right;">
0.087
</td>
</tr></tbody>
</table>
</div>
<div class="section level3">
<h3 id="estimated-parameters">
<span class="header-section-number">5.3</span> Estimated Parameters<a class="anchor" aria-label="anchor" href="#estimated-parameters"></a>
</h3>
<p>We plot the parameters estimated with <code>jSDM</code> against those estimated with <code>boral</code> to compare the results obtained with both packages.</p>
<div class="section level4">
<h4 id="simulated-dataset-2">
<span class="header-section-number">5.3.1</span> Simulated dataset<a class="anchor" aria-label="anchor" href="#simulated-dataset-2"></a>
</h4>
<p><img src="jSDM_boral_files/figure-html/jSDM-boral-simulation-1.png" width="800" style="display: block; margin: auto;"><img src="jSDM_boral_files/figure-html/jSDM-boral-simulation-2.png" width="800" style="display: block; margin: auto;"><img src="jSDM_boral_files/figure-html/jSDM-boral-simulation-3.png" width="800" style="display: block; margin: auto;"><img src="jSDM_boral_files/figure-html/jSDM-boral-simulation-4.png" width="800" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="mosquitos-dataset-2">
<span class="header-section-number">5.3.2</span> Mosquitos dataset<a class="anchor" aria-label="anchor" href="#mosquitos-dataset-2"></a>
</h4>
<p><img src="jSDM_boral_files/figure-html/jSDM-boral-mosquitos-1.png" width="800" style="display: block; margin: auto;"><img src="jSDM_boral_files/figure-html/jSDM-boral-mosquitos-2.png" width="800" style="display: block; margin: auto;"><img src="jSDM_boral_files/figure-html/jSDM-boral-mosquitos-3.png" width="800" style="display: block; margin: auto;"><img src="jSDM_boral_files/figure-html/jSDM-boral-mosquitos-4.png" width="800" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="eucalypts-dataset-2">
<span class="header-section-number">5.3.3</span> Eucalypts dataset<a class="anchor" aria-label="anchor" href="#eucalypts-dataset-2"></a>
</h4>
<p><img src="jSDM_boral_files/figure-html/jSDM-boral-Eucalypts-1.png" width="800" style="display: block; margin: auto;"><img src="jSDM_boral_files/figure-html/jSDM-boral-Eucalypts-2.png" width="800" style="display: block; margin: auto;"><img src="jSDM_boral_files/figure-html/jSDM-boral-Eucalypts-3.png" width="800" style="display: block; margin: auto;"><img src="jSDM_boral_files/figure-html/jSDM-boral-Eucalypts-4.png" width="800" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="frogs-dataset-2">
<span class="header-section-number">5.3.4</span> Frogs dataset<a class="anchor" aria-label="anchor" href="#frogs-dataset-2"></a>
</h4>
<p><img src="jSDM_boral_files/figure-html/jSDM-boral-frogs-1.png" width="800" style="display: block; margin: auto;"><img src="jSDM_boral_files/figure-html/jSDM-boral-frogs-2.png" width="800" style="display: block; margin: auto;"><img src="jSDM_boral_files/figure-html/jSDM-boral-frogs-3.png" width="800" style="display: block; margin: auto;"><img src="jSDM_boral_files/figure-html/jSDM-boral-frogs-4.png" width="800" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="fungi-dataset-2">
<span class="header-section-number">5.3.5</span> Fungi dataset<a class="anchor" aria-label="anchor" href="#fungi-dataset-2"></a>
</h4>
<p><img src="jSDM_boral_files/figure-html/jSDM-boral-fungi-1.png" width="800" style="display: block; margin: auto;"><img src="jSDM_boral_files/figure-html/jSDM-boral-fungi-2.png" width="800" style="display: block; margin: auto;"><img src="jSDM_boral_files/figure-html/jSDM-boral-fungi-3.png" width="800" style="display: block; margin: auto;"><img src="jSDM_boral_files/figure-html/jSDM-boral-fungi-4.png" width="800" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="birds-dataset-2">
<span class="header-section-number">5.3.6</span> Birds dataset<a class="anchor" aria-label="anchor" href="#birds-dataset-2"></a>
</h4>
<p><img src="jSDM_boral_files/figure-html/jSDM-boral-birds-1.png" width="800" style="display: block; margin: auto;"><img src="jSDM_boral_files/figure-html/jSDM-boral-birds-2.png" width="800" style="display: block; margin: auto;"><img src="jSDM_boral_files/figure-html/jSDM-boral-birds-3.png" width="800" style="display: block; margin: auto;"><img src="jSDM_boral_files/figure-html/jSDM-boral-birds-4.png" width="800" style="display: block; margin: auto;"><img src="jSDM_boral_files/figure-html/jSDM-boral-birds-5.png" width="800" style="display: block; margin: auto;"><img src="jSDM_boral_files/figure-html/jSDM-boral-birds-6.png" width="800" style="display: block; margin: auto;"></p>
<p>We can see an inversion of the order and signs of the latent axes estimated between <code>jSDM</code> and <code>boral</code>, indeed the first latent axis fitted with <code>jSDM</code> <span class="math inline">\(W_1\)</span> corresponds to the second axis <span class="math inline">\(W_2\)</span> in the results of <code>boral</code>, with opposite signs. Nevertheless, the presence probabilities and residual correlations predicted by the two packages are very close.</p>
</div>
<div class="section level4">
<h4 id="mites-dataset-2">
<span class="header-section-number">5.3.7</span> Mites dataset<a class="anchor" aria-label="anchor" href="#mites-dataset-2"></a>
</h4>
<p><img src="jSDM_boral_files/figure-html/jSDM-boral-mites-1.png" width="800" style="display: block; margin: auto;"><img src="jSDM_boral_files/figure-html/jSDM-boral-mites-2.png" width="800" style="display: block; margin: auto;"><img src="jSDM_boral_files/figure-html/jSDM-boral-mites-3.png" width="800" style="display: block; margin: auto;"><img src="jSDM_boral_files/figure-html/jSDM-boral-mites-4.png" width="800" style="display: block; margin: auto;"></p>
<p>On the figures above, the parameters estimated with <code>jSDM</code> are close to those obtained with <code>boral</code> if the points are near the red line representing the identity function (<span class="math inline">\(y=x\)</span>).</p>
<div id="refs" class="references">
<div id="ref-Borcard1994">
<p>Borcard, D. &amp; Legendre, P. (1994) Environmental control and spatial structure in ecological communities: An example using oribatid mites (Acari, Oribatei). <em>Environmental and Ecological Statistics</em>, <strong>1</strong>, 37–61.</p>
</div>
<div id="ref-Hui2016">
<p>Hui, F.K.C. (2016) Boral – Bayesian Ordination and Regression Analysis of Multivariate Abundance Data in r. <em>Methods in Ecology and Evolution</em>, <strong>7</strong>, 744–750.</p>
</div>
<div id="ref-Kery2006">
<p>Kéry, M. &amp; Schmid, H. (2006) Estimating species richness: Calibrating a large avian monitoring programme. <em>Journal of Applied Ecology</em>, <strong>43</strong>, 101–110.</p>
</div>
<div id="ref-Warton2015">
<p>Warton, D.I., Blanchet, F.G., O’Hara, R.B., Ovaskainen, O., Taskinen, S., Walker, S.C. &amp; Hui, F.K.C. (2015) So many variables: Joint modeling in community ecology. <em>Trends in Ecology &amp; Evolution</em>, <strong>30</strong>, 766–779.</p>
</div>
<div id="ref-Wilkinson2019">
<p>Wilkinson, D.P., Golding, N., Guillera-Arroita, G., Tingley, R. &amp; McCarthy, M.A. (2019) A comparison of joint species distribution models for presence-absence data. <em>Methods in Ecology and Evolution</em>, <strong>10</strong>, 198–211.</p>
</div>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="http://amap-collaboratif.cirad.fr/pages-chercheurs/?page_id=31876" class="external-link">Jeanne Clément</a>, <a href="https://ecology.ghislainv.fr" class="external-link">Ghislain Vieilledent</a>, <a href="https://www.cirad.fr" class="external-link"><img src="https://ecology.ghislainv.fr/images/logos/logo-cirad.svg" height="24"></a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>

<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Comparison jSDM-Hmsc • jSDM</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Comparison jSDM-Hmsc">
<meta property="og:description" content="jSDM">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">jSDM</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.7</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/jSDM.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Change log</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ghislainv/jSDM" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Comparison jSDM-Hmsc</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ghislainv/jSDM/blob/HEAD/vignettes/jSDM_Hmsc.Rmd" class="external-link"><code>vignettes/jSDM_Hmsc.Rmd</code></a></small>
      <div class="hidden name"><code>jSDM_Hmsc.Rmd</code></div>

    </div>

    
    
<p>Hierarchical Modelling of Species Communities (HMSC) is a model-based approach for analyzing community ecological data (<span class="citation">(<a href="#ref-Ovaskainen2017" role="doc-biblioref">Ovaskainen <em>et al.</em> 2017</a>)</span>). The obligatory data for HMSC-analyses includes a matrix of species occurrences or abundances and a matrix of environmental covariates. Additional and optional data include information about species traits and phylogenetic relationships, and information about the spatiotemporal context of the sampling design. HMSC partitions variation in species occurrences to components that relate to environmental filtering, species interactions, and random processes. <code>Hmsc</code> yields inference both at species and community levels.
This package and the package <code>jSDM</code> allow to fit the models defined below, so we can compare the results obtained by each of them on different data-sets.</p>
<div class="section level2" number="1">
<h2 id="models-definition">
<span class="header-section-number">1</span> Models definition<a class="anchor" aria-label="anchor" href="#models-definition"></a>
</h2>
<div class="section level3" number="1.1">
<h3 id="binomial-model-for-presence-absence-data">
<span class="header-section-number">1.1</span> Binomial model for presence-absence data<a class="anchor" aria-label="anchor" href="#binomial-model-for-presence-absence-data"></a>
</h3>
<p>We consider a latent variable model (LVM) to account for species co-occurrence <span class="citation">(<a href="#ref-Warton2015" role="doc-biblioref">Warton <em>et al.</em> 2015</a>)</span> on all sites .</p>
<p><span class="math display">\[y_{ij} \sim \mathcal{B}inomial(t_i, \theta_{ij})\]</span></p>
<p><span class="math display">\[ \mathrm{g}(\theta_{ij}) = X_i\beta_j + W_i\lambda_j \]</span></p>
<ul>
<li>
<span class="math inline">\(\theta_{ij}\)</span>: occurrence probability of the species <span class="math inline">\(j\)</span> on site <span class="math inline">\(i\)</span>.</li>
<li>
<span class="math inline">\(t_i\)</span>: number of visits at site <span class="math inline">\(i\)</span>
</li>
<li>
<span class="math inline">\(\mathrm{g}(\cdot)\)</span>: Link function (eg. logit or probit).</li>
</ul>
<p>The inference method is able to handle only one visit by site with a <strong>probit</strong> link function so <span class="math inline">\(\forall i, \ t_i=1\)</span> and <span class="math display">\[y_{ij} \sim \mathcal{B}ernoulli(\theta_{ij})\]</span>.</p>
<ul>
<li><p><span class="math inline">\(X_i\)</span>: Vector of explanatory variables for site <span class="math inline">\(i\)</span> with <span class="math inline">\(X_i=(x_i^1,\ldots,x_i^p)\in \mathbb{R}^p\)</span> where <span class="math inline">\(p\)</span> is the number of bio-climatic variables considered (including intercept <span class="math inline">\(\forall i, x_i^1=1\)</span>).</p></li>
<li><p><span class="math inline">\(\beta_j\)</span>: Effects of the explanatory variables on the probability of presence of species <span class="math inline">\(j\)</span> including species intercept (<span class="math inline">\(\beta_{0j}\)</span>). We use a prior distribution <span class="math inline">\(\beta_j \sim \mathcal{N}_p(0,\Sigma_{\beta})\)</span> with <span class="math inline">\(\Sigma_{\beta}\)</span> a specified diagonal matrix of size <span class="math inline">\(p \times p\)</span>.</p></li>
<li><p><span class="math inline">\(W_i\)</span>: Vector of random latent variables for site <span class="math inline">\(i\)</span>. <span class="math inline">\(W_i \sim N(0, 1)\)</span>. The number of latent variables <span class="math inline">\(q\)</span> must be fixed by the user (default to <span class="math inline">\(q=2\)</span>).</p></li>
<li><p><span class="math inline">\(\lambda_j\)</span>: Effects of the latent variables on the probability of presence of species <span class="math inline">\(j\)</span> also known as “factor loadings” <span class="citation">(<a href="#ref-Warton2015" role="doc-biblioref">Warton <em>et al.</em> 2015</a>)</span>. We use the following prior distribution in the <code>jSDM</code> package to constraint values to <span class="math inline">\(0\)</span> on upper diagonal and to strictly positive values on diagonal, for <span class="math inline">\(j=1,\ldots,J\)</span> and <span class="math inline">\(l=1,\ldots,q\)</span> : <span class="math display">\[\lambda_{jl} \sim \begin{cases}
\mathcal{N}(0,1) &amp; \text{if } l &lt; j \\
\mathcal{N}(0,1) \text{ left truncated by } 0 &amp; \text{if } l=j \\
P \text{ such as } \mathbb{P}(\lambda_{jl} = 0)=1  &amp; \text{if } l&gt;j
\end{cases}\]</span>.</p></li>
</ul>
<p>This model is equivalent to a multivariate GLMM <span class="math inline">\(\mathrm{g}(\theta_{ij}) = X_i.\beta_j + u_{ij}\)</span>, where <span class="math inline">\(u_{ij} \sim \mathcal{N}(0, \Sigma)\)</span> with the constraint that the variance-covariance matrix <span class="math inline">\(\Sigma = \Lambda \Lambda^{\prime}\)</span>, where <span class="math inline">\(\Lambda\)</span> is the full matrix of factor loadings, with the <span class="math inline">\(\lambda_j\)</span> as its columns.</p>
<p>Using this model we can compute the <strong>full species residual correlation matrix</strong> <span class="math inline">\(R=(R_{ij})^{i=1,\ldots, nspecies}_{j=1,\ldots, nspecies}\)</span> from the covariance in the latent variables such as :
<span class="math display">\[\Sigma_{ij} = \lambda_i .\lambda_j^T\]</span>, then we compute correlations from covariances :
<span class="math display">\[R_{i,j} = \frac{\Sigma_{ij}}{\sqrt{\Sigma _{ii}\Sigma _{jj}}}\]</span>.</p>
</div>
<div class="section level3" number="1.2">
<h3 id="poisson-model-for-abundance-data">
<span class="header-section-number">1.2</span> Poisson model for abundance data<a class="anchor" aria-label="anchor" href="#poisson-model-for-abundance-data"></a>
</h3>
<p>Referring to the models used in the articles <span class="citation">(<a href="#ref-Hui2016" role="doc-biblioref">Hui 2016</a>)</span>, we define the following model to account for species abundances on all sites.</p>
<p><span class="math display">\[y_{ij} \sim \mathcal{P}oisson(\theta_{ij})\]</span>.</p>
<p><span class="math display">\[ \mathrm{log}(\theta_{ij}) = \beta_{0j} + X_i\beta_j + W_i\lambda_j \]</span></p>
</div>
</div>
<div class="section level2" number="2">
<h2 id="data-sets">
<span class="header-section-number">2</span> Data-sets<a class="anchor" aria-label="anchor" href="#data-sets"></a>
</h2>
<div class="section level3" number="2.1">
<h3 id="data-simulation">
<span class="header-section-number">2.1</span> Data simulation<a class="anchor" aria-label="anchor" href="#data-simulation"></a>
</h3>
<p>We start by simulating the data-set that we will then analyze among real data-sets.</p>
<p>We generate a data-set, following the previous model, with <span class="math inline">\(300\)</span> sites, <span class="math inline">\(100\)</span> species and as parameters :</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#==================</span></span>
<span><span class="co">#== Data simulation</span></span>
<span><span class="co">#==================</span></span>
<span><span class="co">#= Number of species</span></span>
<span><span class="va">nsp</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="co">#= Number of sites</span></span>
<span><span class="va">nsite</span> <span class="op">&lt;-</span> <span class="fl">300</span></span>
<span><span class="co">#= Number of latent variables</span></span>
<span><span class="va">nl</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="co">#= Set seed for repeatability</span></span>
<span><span class="va">seed</span> <span class="op">&lt;-</span> <span class="fl">123</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="va">seed</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Ecological process (suitability)</span></span>
<span><span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">nsite</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">x2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">nsite</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">nsite</span><span class="op">)</span>,<span class="va">x1</span>,<span class="va">x2</span><span class="op">)</span></span>
<span><span class="va">np</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span><span class="co">#= Latent variables W</span></span>
<span><span class="va">W</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">nsite</span><span class="op">*</span><span class="va">nl</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, nrow<span class="op">=</span><span class="va">nsite</span>, ncol<span class="op">=</span><span class="va">nl</span><span class="op">)</span></span>
<span><span class="co">#= Fixed species effect beta </span></span>
<span><span class="va">beta.target</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">nsp</span><span class="op">*</span><span class="va">np</span>,<span class="op">-</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, byrow<span class="op">=</span><span class="cn">TRUE</span>, nrow<span class="op">=</span><span class="va">nsp</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#= Factor loading lambda  </span></span>
<span><span class="va">mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">nsp</span><span class="op">*</span><span class="va">nl</span>,<span class="op">-</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, byrow<span class="op">=</span><span class="cn">TRUE</span>, nrow<span class="op">=</span><span class="va">nsp</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">nl</span>,<span class="fl">0</span>,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">lambda.target</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">nl</span>,<span class="va">nsp</span><span class="op">)</span></span>
<span><span class="va">lambda.target</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lower.tri.html" class="external-link">upper.tri</a></span><span class="op">(</span><span class="va">mat</span>,diag<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lower.tri.html" class="external-link">upper.tri</a></span><span class="op">(</span><span class="va">mat</span>, diag<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co"># Simulation of response data with probit link</span></span>
<span><span class="va">probit_theta</span> <span class="op">&lt;-</span> <span class="va">X</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta.target</span> <span class="op">+</span> <span class="va">W</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">lambda.target</span></span>
<span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="va">probit_theta</span><span class="op">)</span></span>
<span><span class="va">e</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">nsp</span><span class="op">*</span><span class="va">nsite</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,<span class="va">nsite</span>,<span class="va">nsp</span><span class="op">)</span></span>
<span><span class="co"># Latent variable Z </span></span>
<span><span class="va">Z_true</span> <span class="op">&lt;-</span> <span class="va">probit_theta</span> <span class="op">+</span> <span class="va">e</span></span>
<span><span class="co"># Presence-absence matrix Y</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">nsite</span>,<span class="va">nsp</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nsite</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nsp</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span> <span class="va">Z_true</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span><span class="va">Y</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">}</span></span>
<span>    <span class="kw">else</span> <span class="op">{</span><span class="va">Y</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span><span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3" number="2.2">
<h3 id="data-sets-description">
<span class="header-section-number">2.2</span> Data-sets description<a class="anchor" aria-label="anchor" href="#data-sets-description"></a>
</h3>
<p>Among the following datasets, the presence-absence data are from the <span class="citation">(<a href="#ref-Wilkinson2019" role="doc-biblioref">Wilkinson <em>et al.</em> 2019</a>)</span> article in which they are used to compare joint species distribution models for presence-absence data, the dataset that records the presence or absence of <code>birds</code> is from the <span class="citation">(<a href="#ref-Kery2006" role="doc-biblioref">Kéry &amp; Schmid 2006</a>)</span> article and the <code>mites</code> abundance data-set is from the <span class="citation">(<a href="#ref-Borcard1994" role="doc-biblioref">Borcard &amp; Legendre 1994</a>)</span> article.</p>
<pre><code><span><span class="co">#&gt; ##</span></span>
<span><span class="co">#&gt; ## jSDM R package </span></span>
<span><span class="co">#&gt; ## For joint species distribution models </span></span>
<span><span class="co">#&gt; ## https://ecology.ghislainv.fr/jSDM </span></span>
<span><span class="co">#&gt; ##</span></span>
<span><span class="co">#&gt; Loading required package: coda</span></span>
<span><span class="co">#&gt; The legacy packages maptools, rgdal, and rgeos, underpinning the sp package,</span></span>
<span><span class="co">#&gt; which was just loaded, will retire in October 2023.</span></span>
<span><span class="co">#&gt; Please refer to R-spatial evolution reports for details, especially</span></span>
<span><span class="co">#&gt; https://r-spatial.org/r/2023/05/15/evolution4.html.</span></span>
<span><span class="co">#&gt; It may be desirable to make the sf package available;</span></span>
<span><span class="co">#&gt; package maintainers should consider adding sf to Suggests:.</span></span>
<span><span class="co">#&gt; The sp package is now running under evolution status 2</span></span>
<span><span class="co">#&gt;      (status 2 uses the sf package in place of rgdal)</span></span></code></pre>
<table class="table table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
Simulated
</th>
<th style="text-align:left;">
Mosquitos
</th>
<th style="text-align:left;">
Eucalypts
</th>
<th style="text-align:left;">
Frogs
</th>
<th style="text-align:left;">
Fungi
</th>
<th style="text-align:left;">
Birds
</th>
<th style="text-align:left;">
Mites
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
data type
</td>
<td style="text-align:left;">
presence-absence
</td>
<td style="text-align:left;">
presence-absence
</td>
<td style="text-align:left;">
presence-absence
</td>
<td style="text-align:left;">
presence-absence
</td>
<td style="text-align:left;">
presence-absence
</td>
<td style="text-align:left;">
presence-absence
</td>
<td style="text-align:left;">
abundance
</td>
</tr>
<tr>
<td style="text-align:left;">
distribution
</td>
<td style="text-align:left;">
bernoulli
</td>
<td style="text-align:left;">
bernoulli
</td>
<td style="text-align:left;">
bernoulli
</td>
<td style="text-align:left;">
bernoulli
</td>
<td style="text-align:left;">
bernoulli
</td>
<td style="text-align:left;">
bernoulli
</td>
<td style="text-align:left;">
poisson
</td>
</tr>
<tr>
<td style="text-align:left;">
n.site
</td>
<td style="text-align:left;">
300
</td>
<td style="text-align:left;">
167
</td>
<td style="text-align:left;">
455
</td>
<td style="text-align:left;">
104
</td>
<td style="text-align:left;">
438
</td>
<td style="text-align:left;">
266
</td>
<td style="text-align:left;">
70
</td>
</tr>
<tr>
<td style="text-align:left;">
n.species
</td>
<td style="text-align:left;">
100
</td>
<td style="text-align:left;">
16
</td>
<td style="text-align:left;">
12
</td>
<td style="text-align:left;">
9
</td>
<td style="text-align:left;">
11
</td>
<td style="text-align:left;">
110
</td>
<td style="text-align:left;">
30
</td>
</tr>
<tr>
<td style="text-align:left;">
n.latent
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
n.X.coefs
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
14
</td>
<td style="text-align:left;">
8
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
13
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
12
</td>
</tr>
<tr>
<td style="text-align:left;">
n.obs
</td>
<td style="text-align:left;">
30000
</td>
<td style="text-align:left;">
2672
</td>
<td style="text-align:left;">
5460
</td>
<td style="text-align:left;">
936
</td>
<td style="text-align:left;">
4818
</td>
<td style="text-align:left;">
29260
</td>
<td style="text-align:left;">
2100
</td>
</tr>
<tr>
<td style="text-align:left;">
n.param
</td>
<td style="text-align:left;">
1400
</td>
<td style="text-align:left;">
757
</td>
<td style="text-align:left;">
1485
</td>
<td style="text-align:left;">
366
</td>
<td style="text-align:left;">
1479
</td>
<td style="text-align:left;">
1458
</td>
<td style="text-align:left;">
630
</td>
</tr>
<tr>
<td style="text-align:left;">
n.mcmc
</td>
<td style="text-align:left;">
15000
</td>
<td style="text-align:left;">
15000
</td>
<td style="text-align:left;">
15000
</td>
<td style="text-align:left;">
15000
</td>
<td style="text-align:left;">
15000
</td>
<td style="text-align:left;">
15000
</td>
<td style="text-align:left;">
15000
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
<img src="figures/des.jpg" width="100" height="100">
</td>
<td style="text-align:left;">
<img src="figures/Mosquitos_.jpg" width="100" height="100">
</td>
<td style="text-align:left;">
<img src="figures/Eucalyptus_.jpg" width="100" height="100">
</td>
<td style="text-align:left;">
<img src="figures/Frogs_.jpg" width="100" height="100">
</td>
<td style="text-align:left;">
<img src="figures/Fungi_.jpg" width="100" height="100">
</td>
<td style="text-align:left;">
<img src="figures/birds.jpg" width="100" height="100">
</td>
<td style="text-align:left;">
<img src="figures/oribatid-mites.png" width="100" height="100">
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2" number="3">
<h2 id="package-hmsc">
<span class="header-section-number">3</span> Package <code>Hmsc</code><a class="anchor" aria-label="anchor" href="#package-hmsc"></a>
</h2>
<p>In a first step, we fit joint species distribution models from previous data-sets using the <code><a href="https://rdrr.io/pkg/Hmsc/man/Hmsc.html" class="external-link">Hmsc()</a></code> function from package of the same name whose features are developed in the article <span class="citation">(<a href="#ref-Ovaskainen2017" role="doc-biblioref">Ovaskainen <em>et al.</em> 2017</a>)</span>.</p>
<div class="section level3" number="3.1">
<h3 id="simulated-dataset">
<span class="header-section-number">3.1</span> Simulated dataset<a class="anchor" aria-label="anchor" href="#simulated-dataset"></a>
</h3>
<p>We fit a binomial joint species distribution model, including latent variables, from the simulated dataset using the <code><a href="https://rdrr.io/pkg/Hmsc/man/Hmsc.html" class="external-link">Hmsc()</a></code> function to perform binomial probit regression.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.helsinki.fi/en/researchgroups/statistical-ecology/software/hmsc" class="external-link">Hmsc</a></span><span class="op">)</span></span>
<span><span class="va">studyDesign</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>sample<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Hmsc/man/HmscRandomLevel.html" class="external-link">HmscRandomLevel</a></span><span class="op">(</span>units<span class="op">=</span><span class="va">studyDesign</span><span class="op">$</span><span class="va">sample</span><span class="op">)</span></span>
<span><span class="va">rL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Hmsc/man/setPriors.html" class="external-link">setPriors</a></span><span class="op">(</span><span class="va">rL</span>, nfMax<span class="op">=</span><span class="fl">2</span>, nfMin<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">T1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Hmsc/man/Hmsc.html" class="external-link">Hmsc</a></span><span class="op">(</span>Y<span class="op">=</span><span class="va">Y</span>, XData<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>, XFormula<span class="op">=</span><span class="op">~</span><span class="va">x1</span><span class="op">+</span><span class="va">x2</span>, XScale <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>            distr<span class="op">=</span><span class="st">"probit"</span>, studyDesign<span class="op">=</span><span class="va">studyDesign</span>,</span>
<span>            ranLevels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"sample"</span><span class="op">=</span><span class="va">rL</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mod_Hmsc_sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Hmsc/man/sampleMcmc.html" class="external-link">sampleMcmc</a></span><span class="op">(</span><span class="va">mod</span>, thin<span class="op">=</span><span class="fl">5</span>, samples<span class="op">=</span><span class="fl">1000</span>, transient <span class="op">=</span> <span class="fl">10000</span>, nChains <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">T2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="va">T_Hmsc_sim</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">T2</span>,<span class="va">T1</span>, units<span class="op">=</span><span class="st">"secs"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Predicted probit(theta) </span></span>
<span><span class="va">theta_latent_sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Hmsc/man/computePredictedValues.html" class="external-link">computePredictedValues</a></span><span class="op">(</span><span class="va">mod_Hmsc_sim</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,<span class="va">mean</span><span class="op">)</span></span>
<span><span class="va">probit_theta_latent_sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="va">theta_latent_sim</span><span class="op">)</span></span>
<span><span class="co"># RMSE</span></span>
<span><span class="co">#res &lt;- evaluateModelFit(hM=mod_Hmsc_sim, predY=preds)</span></span>
<span><span class="va">SE</span><span class="op">=</span><span class="op">(</span><span class="va">theta</span><span class="op">-</span><span class="va">theta_latent_sim</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span>
<span><span class="va">RMSE_Hmsc_sim</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">SE</span><span class="op">/</span><span class="op">(</span><span class="va">nsite</span><span class="op">*</span><span class="va">nsp</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Deviance </span></span>
<span><span class="va">logL</span><span class="op">=</span><span class="fl">0</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nsite</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nsp</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">logL</span><span class="op">=</span><span class="va">logL</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">dbinom</a></span><span class="op">(</span><span class="va">Y</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span>,<span class="fl">1</span>,<span class="va">theta_latent_sim</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span>,<span class="fl">1</span><span class="op">)</span>  </span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">Deviance_Hmsc_sim</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">2</span><span class="op">*</span><span class="va">logL</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">np</span>, <span class="va">nl</span>, <span class="va">nsp</span>, <span class="va">nsite</span>, <span class="va">beta.target</span>, <span class="va">lambda.target</span>, <span class="va">X</span>, <span class="va">W</span>, <span class="va">theta</span>, <span class="va">probit_theta</span>, <span class="va">Z_true</span>, <span class="va">Y</span>, <span class="va">T_Hmsc_sim</span>,</span>
<span>     <span class="va">mod_Hmsc_sim</span>, <span class="va">rL</span>, <span class="va">probit_theta_latent_sim</span>,</span>
<span>     <span class="va">RMSE_Hmsc_sim</span>, <span class="va">Deviance_Hmsc_sim</span>,</span>
<span>     file<span class="op">=</span><span class="st">"jSDM_Hmsc_cache/Hmsc_simulation.RData"</span><span class="op">)</span></span></code></pre></div>
<p>We visually evaluate the convergence of MCMCs by representing the trace and density <em>a posteriori</em> of some estimated parameters and we evaluate the accuracy of the estimated parameters by plotting them against the parameters used to simulate the data-set.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span>file<span class="op">=</span><span class="st">"jSDM_Hmsc_cache/Hmsc_simulation.RData"</span><span class="op">)</span></span>
<span><span class="va">codaObject</span> <span class="op">&lt;-</span> <span class="fu">Hmsc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Hmsc/man/convertToCodaObject.html" class="external-link">convertToCodaObject</a></span><span class="op">(</span><span class="va">mod_Hmsc_sim</span>, start<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Trace and density plot of MCMC chains of parameters to visually evaluate convergence </span></span>
<span><span class="co">## Fixed species effect beta</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">MCMC.betaj</span> <span class="op">&lt;-</span> <span class="va">codaObject</span><span class="op">$</span><span class="va">Beta</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"sp0"</span>,<span class="va">j</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">codaObject</span><span class="op">$</span><span class="va">Beta</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">p</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/traceplot.html" class="external-link">traceplot</a></span><span class="op">(</span><span class="va">MCMC.betaj</span><span class="op">[</span>,<span class="va">p</span><span class="op">]</span>,</span>
<span>                      main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Trace of "</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">MCMC.betaj</span><span class="op">)</span><span class="op">[</span><span class="va">p</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/densplot.html" class="external-link">densplot</a></span><span class="op">(</span><span class="va">MCMC.betaj</span><span class="op">[</span>,<span class="va">p</span><span class="op">]</span>,</span>
<span>                     main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Density of "</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">MCMC.betaj</span><span class="op">)</span><span class="op">[</span><span class="va">p</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="va">beta.target</span><span class="op">[</span><span class="va">p</span>,<span class="va">j</span><span class="op">]</span>,col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">Hmsc_beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Hmsc/man/getPostEstimate.html" class="external-link">getPostEstimate</a></span><span class="op">(</span>hM<span class="op">=</span><span class="va">mod_Hmsc_sim</span>, parName<span class="op">=</span><span class="st">'Beta'</span><span class="op">)</span><span class="op">$</span><span class="va">mean</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## factor loadings lambda_j</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">MCMC.lambdaj</span> <span class="op">&lt;-</span> <span class="va">codaObject</span><span class="op">$</span><span class="va">Lambda</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"sp0"</span>,<span class="va">j</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">codaObject</span><span class="op">$</span><span class="va">Lambda</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">l</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">rL</span><span class="op">$</span><span class="va">nfMax</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/traceplot.html" class="external-link">traceplot</a></span><span class="op">(</span><span class="va">MCMC.lambdaj</span><span class="op">[</span>,<span class="va">l</span><span class="op">]</span>,</span>
<span>                      main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Trace of "</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">MCMC.lambdaj</span><span class="op">)</span><span class="op">[</span><span class="va">l</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/densplot.html" class="external-link">densplot</a></span><span class="op">(</span><span class="va">MCMC.lambdaj</span><span class="op">[</span>,<span class="va">l</span><span class="op">]</span>,</span>
<span>                     main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Density of "</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">MCMC.lambdaj</span><span class="op">)</span><span class="op">[</span><span class="va">l</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="va">lambda.target</span><span class="op">[</span><span class="va">l</span>,<span class="va">j</span><span class="op">]</span>,col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">Hmsc_lambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Hmsc/man/getPostEstimate.html" class="external-link">getPostEstimate</a></span><span class="op">(</span>hM<span class="op">=</span><span class="va">mod_Hmsc_sim</span>, parName<span class="op">=</span><span class="st">'Lambda'</span>, r<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">$</span><span class="va">mean</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">beta.target</span><span class="op">)</span>, <span class="va">Hmsc_beta</span>,</span>
<span>     xlab<span class="op">=</span><span class="st">"obs"</span>, ylab<span class="op">=</span><span class="st">"fitted"</span>, main<span class="op">=</span><span class="st">"Fixed species effect beta"</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>,b<span class="op">=</span><span class="fl">1</span>,col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">lambda.target</span><span class="op">)</span>,<span class="va">Hmsc_lambda</span>,</span>
<span>     xlab<span class="op">=</span><span class="st">"obs"</span>, ylab<span class="op">=</span><span class="st">"fitted"</span>, main<span class="op">=</span><span class="st">"Loading factors lambda"</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>,b<span class="op">=</span><span class="fl">1</span>,col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Latent variable W </span></span>
<span><span class="va">Hmsc_lvs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Hmsc/man/getPostEstimate.html" class="external-link">getPostEstimate</a></span><span class="op">(</span>hM<span class="op">=</span><span class="va">mod_Hmsc_sim</span>, parName<span class="op">=</span><span class="st">'Eta'</span>, r<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">$</span><span class="va">mean</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">l</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nl</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">W</span><span class="op">[</span>,<span class="va">l</span><span class="op">]</span>,<span class="va">Hmsc_lvs</span><span class="op">[</span>,<span class="va">l</span><span class="op">]</span>,</span>
<span>       main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Latent variable W_"</span>, <span class="va">l</span><span class="op">)</span>,</span>
<span>       xlab<span class="op">=</span><span class="st">"obs"</span>, ylab<span class="op">=</span><span class="st">"fitted"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>,b<span class="op">=</span><span class="fl">1</span>,col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## Prediction</span></span>
<span><span class="co"># probit_theta_latent </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">probit_theta</span>,<span class="va">probit_theta_latent_sim</span>,</span>
<span>     main<span class="op">=</span><span class="st">"probit(theta)"</span>, xlab <span class="op">=</span><span class="st">"obs"</span>, ylab<span class="op">=</span><span class="st">"fitted"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>,b<span class="op">=</span><span class="fl">1</span>,col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span></span></code></pre></div>
<p><img src="jSDM_Hmsc_files/figure-html/Hmsc-simulation-plot-1.png" width="800" style="display: block; margin: auto;"><img src="jSDM_Hmsc_files/figure-html/Hmsc-simulation-plot-2.png" width="800" style="display: block; margin: auto;"><img src="jSDM_Hmsc_files/figure-html/Hmsc-simulation-plot-3.png" width="800" style="display: block; margin: auto;"><img src="jSDM_Hmsc_files/figure-html/Hmsc-simulation-plot-4.png" width="800" style="display: block; margin: auto;"><img src="jSDM_Hmsc_files/figure-html/Hmsc-simulation-plot-5.png" width="800" style="display: block; margin: auto;"><img src="jSDM_Hmsc_files/figure-html/Hmsc-simulation-plot-6.png" width="800" style="display: block; margin: auto;"><img src="jSDM_Hmsc_files/figure-html/Hmsc-simulation-plot-7.png" width="800" style="display: block; margin: auto;"></p>
<p>Overall, the traces and the densities of the parameters indicate the convergence of the algorithm. Indeed, we observe on the traces that the values oscillate around averages without showing an upward or downward trend and we see that the densities are quite smooth and for the most part of Gaussian form.<br>
On the above figures, the estimated parameters are close to the expected values if the points are near the red line representing the identity function (<span class="math inline">\(y=x\)</span>).</p>
</div>
<div class="section level3" number="3.2">
<h3 id="mosquitos-dataset">
<span class="header-section-number">3.2</span> Mosquitos dataset<a class="anchor" aria-label="anchor" href="#mosquitos-dataset"></a>
</h3>
<p>We fit a binomial joint species distribution model, including latent variables, from the <a href="https://ecology.ghislainv.fr/jSDM/reference/mosquitos.html" class="external-link"><code>mosquitos</code></a> dataset using <code><a href="https://rdrr.io/pkg/Hmsc/man/Hmsc.html" class="external-link">Hmsc()</a></code> function to perform binomial probit regression.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Import center and reduce Mosquito dataset</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">mosquitos</span>, package<span class="op">=</span><span class="st">"jSDM"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">mosquitos</span><span class="op">)</span></span>
<span><span class="va">Env_Mosquitos</span> <span class="op">&lt;-</span> <span class="va">mosquitos</span><span class="op">[</span>,<span class="fl">17</span><span class="op">:</span><span class="fl">29</span><span class="op">]</span></span>
<span><span class="va">Env_Mosquitos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">Env_Mosquitos</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span>, <span class="va">Env_Mosquitos</span><span class="op">[</span>,<span class="fl">5</span><span class="op">:</span><span class="fl">13</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">PA_Mosquitos</span> <span class="op">&lt;-</span> <span class="va">mosquitos</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">16</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Define the model </span></span>
<span><span class="va">studyDesign</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>sample<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">PA_Mosquitos</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Hmsc/man/HmscRandomLevel.html" class="external-link">HmscRandomLevel</a></span><span class="op">(</span>units<span class="op">=</span><span class="va">studyDesign</span><span class="op">$</span><span class="va">sample</span><span class="op">)</span></span>
<span><span class="va">rL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Hmsc/man/setPriors.html" class="external-link">setPriors</a></span><span class="op">(</span><span class="va">rL</span>, nfMax<span class="op">=</span><span class="fl">2</span>, nfMin<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co"># Fit the model </span></span>
<span><span class="va">T1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Hmsc/man/Hmsc.html" class="external-link">Hmsc</a></span><span class="op">(</span>Y<span class="op">=</span><span class="va">PA_Mosquitos</span>, XData<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">Env_Mosquitos</span><span class="op">)</span>, XFormula<span class="op">=</span><span class="op">~</span><span class="va">.</span>, XScale <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>            distr<span class="op">=</span><span class="st">"probit"</span>, studyDesign<span class="op">=</span><span class="va">studyDesign</span>,</span>
<span>            ranLevels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"sample"</span><span class="op">=</span><span class="va">rL</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mod_Hmsc_Mosquitos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Hmsc/man/sampleMcmc.html" class="external-link">sampleMcmc</a></span><span class="op">(</span><span class="va">mod</span>, thin<span class="op">=</span><span class="fl">5</span>, samples<span class="op">=</span><span class="fl">1000</span>, transient <span class="op">=</span> <span class="fl">10000</span>, nChains <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">T2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="va">T_Hmsc_Mosquitos</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">T2</span>,<span class="va">T1</span>, units<span class="op">=</span><span class="st">"secs"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Predicted probit(theta) </span></span>
<span><span class="va">theta_latent_Mosquitos</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Hmsc/man/computePredictedValues.html" class="external-link">computePredictedValues</a></span><span class="op">(</span><span class="va">mod_Hmsc_Mosquitos</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,<span class="va">mean</span><span class="op">)</span></span>
<span><span class="va">probit_theta_latent_Mosquitos</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="va">theta_latent_Mosquitos</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Deviance </span></span>
<span><span class="va">logL</span><span class="op">=</span><span class="fl">0</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">PA_Mosquitos</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">PA_Mosquitos</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">logL</span><span class="op">=</span><span class="va">logL</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">dbinom</a></span><span class="op">(</span><span class="va">PA_Mosquitos</span> <span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span>,<span class="fl">1</span>,<span class="va">theta_latent_Mosquitos</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span>,<span class="fl">1</span><span class="op">)</span>  </span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">Deviance_Hmsc_Mosquitos</span>  <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">2</span><span class="op">*</span><span class="va">logL</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">T_Hmsc_Mosquitos</span>, <span class="va">mod_Hmsc_Mosquitos</span>,</span>
<span>     <span class="va">probit_theta_latent_Mosquitos</span>, <span class="va">Deviance_Hmsc_Mosquitos</span>,</span>
<span>     file<span class="op">=</span><span class="st">"jSDM_Hmsc_cache/Hmsc_Mosquitos.RData"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3" number="3.3">
<h3 id="eucalypts-dataset">
<span class="header-section-number">3.3</span> Eucalypts dataset<a class="anchor" aria-label="anchor" href="#eucalypts-dataset"></a>
</h3>
<p>We fit a binomial joint species distribution model, including latent variables, from the <a href="https://ecology.ghislainv.fr/jSDM/reference/eucalypts.html" class="external-link"><code>eucalypts</code></a> dataset using <code><a href="https://rdrr.io/pkg/Hmsc/man/Hmsc.html" class="external-link">Hmsc()</a></code> function to perform binomial probit regression.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Import center and reduce Eucalypts dataset</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">eucalypts</span>, package<span class="op">=</span><span class="st">"jSDM"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">eucalypts</span><span class="op">)</span></span>
<span><span class="va">Env_Eucalypts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">eucalypts</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Rockiness"</span>,<span class="st">"VallyBotFlat"</span>,<span class="st">"PPTann"</span>, <span class="st">"cvTemp"</span>,<span class="st">"T0"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,<span class="va">eucalypts</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sandiness"</span>,<span class="st">"Loaminess"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">PA_Eucalypts</span> <span class="op">&lt;-</span> <span class="va">eucalypts</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">12</span><span class="op">]</span></span>
<span><span class="va">Env_Eucalypts</span> <span class="op">&lt;-</span> <span class="va">Env_Eucalypts</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">PA_Eucalypts</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">0</span>,<span class="op">]</span></span>
<span><span class="co"># Remove sites where none species was recorded</span></span>
<span><span class="va">PA_Eucalypts</span><span class="op">&lt;-</span> <span class="va">PA_Eucalypts</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">PA_Eucalypts</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">0</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co"># Define the model </span></span>
<span><span class="va">studyDesign</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>sample<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">PA_Eucalypts</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Hmsc/man/HmscRandomLevel.html" class="external-link">HmscRandomLevel</a></span><span class="op">(</span>units<span class="op">=</span><span class="va">studyDesign</span><span class="op">$</span><span class="va">sample</span><span class="op">)</span></span>
<span><span class="va">rL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Hmsc/man/setPriors.html" class="external-link">setPriors</a></span><span class="op">(</span><span class="va">rL</span>, nfMax<span class="op">=</span><span class="fl">2</span>, nfMin<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co"># Fit the model </span></span>
<span><span class="va">T1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Hmsc/man/Hmsc.html" class="external-link">Hmsc</a></span><span class="op">(</span>Y<span class="op">=</span><span class="va">PA_Eucalypts</span>, XData<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">Env_Eucalypts</span><span class="op">)</span>, XFormula<span class="op">=</span><span class="op">~</span><span class="va">.</span>, XScale <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>            distr<span class="op">=</span><span class="st">"probit"</span>, studyDesign<span class="op">=</span><span class="va">studyDesign</span>,</span>
<span>            ranLevels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"sample"</span><span class="op">=</span><span class="va">rL</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mod_Hmsc_Eucalypts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Hmsc/man/sampleMcmc.html" class="external-link">sampleMcmc</a></span><span class="op">(</span><span class="va">mod</span>, thin<span class="op">=</span><span class="fl">5</span>, samples<span class="op">=</span><span class="fl">1000</span>, transient <span class="op">=</span> <span class="fl">10000</span>, nChains <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">T2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="va">T_Hmsc_Eucalypts</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">T2</span>,<span class="va">T1</span>, units<span class="op">=</span><span class="st">"secs"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Predicted probit(theta) </span></span>
<span><span class="va">theta_latent_Eucalypts</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Hmsc/man/computePredictedValues.html" class="external-link">computePredictedValues</a></span><span class="op">(</span><span class="va">mod_Hmsc_Eucalypts</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,<span class="va">mean</span><span class="op">)</span></span>
<span><span class="va">probit_theta_latent_Eucalypts</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="va">theta_latent_Eucalypts</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Deviance </span></span>
<span><span class="va">logL</span><span class="op">=</span><span class="fl">0</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">PA_Eucalypts</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">PA_Eucalypts</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">logL</span><span class="op">=</span><span class="va">logL</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">dbinom</a></span><span class="op">(</span><span class="va">PA_Eucalypts</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span>,<span class="fl">1</span>,<span class="va">theta_latent_Eucalypts</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span>,<span class="fl">1</span><span class="op">)</span>  </span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">Deviance_Hmsc_Eucalypts</span>  <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">2</span><span class="op">*</span><span class="va">logL</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">T_Hmsc_Eucalypts</span>, <span class="va">mod_Hmsc_Eucalypts</span>,</span>
<span>     <span class="va">probit_theta_latent_Eucalypts</span>, <span class="va">Deviance_Hmsc_Eucalypts</span>,</span>
<span>     file<span class="op">=</span><span class="st">"jSDM_Hmsc_cache/Hmsc_Eucalypts.RData"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3" number="3.4">
<h3 id="frogs-dataset">
<span class="header-section-number">3.4</span> Frogs dataset<a class="anchor" aria-label="anchor" href="#frogs-dataset"></a>
</h3>
<p>We fit a binomial joint species distribution model, including latent variables, from the <a href="https://ecology.ghislainv.fr/jSDM/reference/frogs.html" class="external-link"><code>frogs</code></a> dataset using <code><a href="https://rdrr.io/pkg/Hmsc/man/Hmsc.html" class="external-link">Hmsc()</a></code> function to perform binomial probit regression.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Import center and reduce Frogs dataset</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">frogs</span>, package<span class="op">=</span><span class="st">"jSDM"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">frogs</span><span class="op">)</span></span>
<span><span class="va">Env_Frogs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">frogs</span><span class="op">[</span>,<span class="st">"Covariate_1"</span><span class="op">]</span><span class="op">)</span>,<span class="va">frogs</span><span class="op">[</span>,<span class="st">"Covariate_2"</span><span class="op">]</span>,</span>
<span>                   <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">frogs</span><span class="op">[</span>,<span class="st">"Covariate_3"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">Env_Frogs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">frogs</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">PA_Frogs</span> <span class="op">&lt;-</span> <span class="va">frogs</span><span class="op">[</span>,<span class="fl">4</span><span class="op">:</span><span class="fl">12</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Define the model </span></span>
<span><span class="va">studyDesign</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>sample<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">PA_Frogs</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Hmsc/man/HmscRandomLevel.html" class="external-link">HmscRandomLevel</a></span><span class="op">(</span>units<span class="op">=</span><span class="va">studyDesign</span><span class="op">$</span><span class="va">sample</span><span class="op">)</span></span>
<span><span class="va">rL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Hmsc/man/setPriors.html" class="external-link">setPriors</a></span><span class="op">(</span><span class="va">rL</span>, nfMax<span class="op">=</span><span class="fl">2</span>, nfMin<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co"># Fit the model </span></span>
<span><span class="va">T1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Hmsc/man/Hmsc.html" class="external-link">Hmsc</a></span><span class="op">(</span>Y<span class="op">=</span><span class="va">PA_Frogs</span>, XData<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">Env_Frogs</span><span class="op">)</span>, XFormula<span class="op">=</span><span class="op">~</span><span class="va">.</span>, XScale <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>            distr<span class="op">=</span><span class="st">"probit"</span>, studyDesign<span class="op">=</span><span class="va">studyDesign</span>,</span>
<span>            ranLevels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"sample"</span><span class="op">=</span><span class="va">rL</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mod_Hmsc_Frogs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Hmsc/man/sampleMcmc.html" class="external-link">sampleMcmc</a></span><span class="op">(</span><span class="va">mod</span>, thin<span class="op">=</span><span class="fl">5</span>, samples<span class="op">=</span><span class="fl">1000</span>, transient <span class="op">=</span> <span class="fl">10000</span>, nChains <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">T2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="va">T_Hmsc_Frogs</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">T2</span>,<span class="va">T1</span>, units<span class="op">=</span><span class="st">"secs"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Predicted probit(theta) </span></span>
<span><span class="va">theta_latent_Frogs</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Hmsc/man/computePredictedValues.html" class="external-link">computePredictedValues</a></span><span class="op">(</span><span class="va">mod_Hmsc_Frogs</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,<span class="va">mean</span><span class="op">)</span></span>
<span><span class="va">probit_theta_latent_Frogs</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="va">theta_latent_Frogs</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Deviance </span></span>
<span><span class="va">logL</span><span class="op">=</span><span class="fl">0</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">PA_Frogs</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">PA_Frogs</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">logL</span><span class="op">=</span><span class="va">logL</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">dbinom</a></span><span class="op">(</span><span class="va">PA_Frogs</span> <span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span>,<span class="fl">1</span>,<span class="va">theta_latent_Frogs</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span>,<span class="fl">1</span><span class="op">)</span>  </span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">Deviance_Hmsc_Frogs</span>  <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">2</span><span class="op">*</span><span class="va">logL</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">T_Hmsc_Frogs</span>, <span class="va">mod_Hmsc_Frogs</span>,</span>
<span>     <span class="va">probit_theta_latent_Frogs</span>, <span class="va">Deviance_Hmsc_Frogs</span>,</span>
<span>     file<span class="op">=</span><span class="st">"jSDM_Hmsc_cache/Hmsc_Frogs.RData"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3" number="3.5">
<h3 id="fungi-dataset">
<span class="header-section-number">3.5</span> Fungi dataset<a class="anchor" aria-label="anchor" href="#fungi-dataset"></a>
</h3>
<p>We fit a binomial joint species distribution model, including latent variables, from the <a href="https://ecology.ghislainv.fr/jSDM/reference/fungi.html" class="external-link"><code>fungi</code></a> dataset using <code><a href="https://rdrr.io/pkg/Hmsc/man/Hmsc.html" class="external-link">Hmsc()</a></code> function to perform binomial probit regression.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Import center and reduce fungi dataset</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">fungi</span>, package<span class="op">=</span><span class="st">"jSDM"</span><span class="op">)</span></span>
<span><span class="va">Env_Fungi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">fungi</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"diam"</span>,<span class="st">"epi"</span>,<span class="st">"bark"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                   <span class="va">fungi</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dc1"</span>,<span class="st">"dc2"</span>,<span class="st">"dc3"</span>,<span class="st">"dc4"</span>,<span class="st">"dc5"</span>,</span>
<span>                            <span class="st">"quality3"</span>,<span class="st">"quality4"</span>,<span class="st">"ground3"</span>,<span class="st">"ground4"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">Env_Fungi</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"diam"</span>,<span class="st">"epi"</span>,<span class="st">"bark"</span>,<span class="st">"dc1"</span>,<span class="st">"dc2"</span>,<span class="st">"dc3"</span>,<span class="st">"dc4"</span>,<span class="st">"dc5"</span>,</span>
<span>                         <span class="st">"quality3"</span>,<span class="st">"quality4"</span>,<span class="st">"ground3"</span>,<span class="st">"ground4"</span><span class="op">)</span></span>
<span><span class="va">PA_Fungi</span> <span class="op">&lt;-</span> <span class="va">fungi</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"antser"</span>,<span class="st">"antsin"</span>,<span class="st">"astfer"</span>,<span class="st">"fompin"</span>,<span class="st">"hetpar"</span>,<span class="st">"junlut"</span>,</span>
<span>                     <span class="st">"phefer"</span>,<span class="st">"phenig"</span>,<span class="st">"phevit"</span>,<span class="st">"poscae"</span>,<span class="st">"triabi"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">Env_Fungi</span> <span class="op">&lt;-</span> <span class="va">Env_Fungi</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">PA_Fungi</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">0</span>,<span class="op">]</span></span>
<span><span class="co"># Remove sites where none species was recorded</span></span>
<span><span class="va">PA_Fungi</span><span class="op">&lt;-</span> <span class="va">PA_Fungi</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">PA_Fungi</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">0</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co"># Define the model </span></span>
<span><span class="va">studyDesign</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>sample<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">PA_Fungi</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Hmsc/man/HmscRandomLevel.html" class="external-link">HmscRandomLevel</a></span><span class="op">(</span>units<span class="op">=</span><span class="va">studyDesign</span><span class="op">$</span><span class="va">sample</span><span class="op">)</span></span>
<span><span class="va">rL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Hmsc/man/setPriors.html" class="external-link">setPriors</a></span><span class="op">(</span><span class="va">rL</span>, nfMax<span class="op">=</span><span class="fl">2</span>, nfMin<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co"># Fit the model </span></span>
<span><span class="va">T1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Hmsc/man/Hmsc.html" class="external-link">Hmsc</a></span><span class="op">(</span>Y<span class="op">=</span><span class="va">PA_Fungi</span>, XData<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">Env_Fungi</span><span class="op">)</span>, XFormula<span class="op">=</span><span class="op">~</span><span class="va">.</span>, XScale <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>            distr<span class="op">=</span><span class="st">"probit"</span>, studyDesign<span class="op">=</span><span class="va">studyDesign</span>,</span>
<span>            ranLevels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"sample"</span><span class="op">=</span><span class="va">rL</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mod_Hmsc_Fungi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Hmsc/man/sampleMcmc.html" class="external-link">sampleMcmc</a></span><span class="op">(</span><span class="va">mod</span>, thin<span class="op">=</span><span class="fl">5</span>, samples<span class="op">=</span><span class="fl">1000</span>, transient <span class="op">=</span> <span class="fl">10000</span>, nChains <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">T2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="va">T_Hmsc_Fungi</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">T2</span>,<span class="va">T1</span>, units<span class="op">=</span><span class="st">"secs"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Predicted probit(theta) </span></span>
<span><span class="va">theta_latent_Fungi</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Hmsc/man/computePredictedValues.html" class="external-link">computePredictedValues</a></span><span class="op">(</span><span class="va">mod_Hmsc_Fungi</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,<span class="va">mean</span><span class="op">)</span></span>
<span><span class="va">probit_theta_latent_Fungi</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="va">theta_latent_Fungi</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Deviance </span></span>
<span><span class="va">logL</span><span class="op">=</span><span class="fl">0</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">PA_Fungi</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">PA_Fungi</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">logL</span><span class="op">=</span><span class="va">logL</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">dbinom</a></span><span class="op">(</span><span class="va">PA_Fungi</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span>,<span class="fl">1</span>,<span class="va">theta_latent_Fungi</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span>,<span class="fl">1</span><span class="op">)</span>  </span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">Deviance_Hmsc_Fungi</span>  <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">2</span><span class="op">*</span><span class="va">logL</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">T_Hmsc_Fungi</span>, <span class="va">mod_Hmsc_Fungi</span>,</span>
<span>     <span class="va">probit_theta_latent_Fungi</span>, <span class="va">Deviance_Hmsc_Fungi</span>,</span>
<span>     file<span class="op">=</span><span class="st">"jSDM_Hmsc_cache/Hmsc_Fungi.RData"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3" number="3.6">
<h3 id="birds-dataset">
<span class="header-section-number">3.6</span> Birds dataset<a class="anchor" aria-label="anchor" href="#birds-dataset"></a>
</h3>
<p>We fit a binomial joint species distribution model latent variables from the <a href="https://ecology.ghislainv.fr/jSDM/reference/birds.html" class="external-link"><code>birds</code></a> dataset using <code><a href="https://rdrr.io/pkg/Hmsc/man/Hmsc.html" class="external-link">Hmsc()</a></code> function to perform binomial probit regression.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Birds dataset</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"birds"</span><span class="op">)</span></span>
<span><span class="va">PA_Birds</span> <span class="op">&lt;-</span> <span class="va">birds</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">158</span><span class="op">]</span></span>
<span><span class="co"># Remove species with less than 5 presences</span></span>
<span><span class="va">rare_sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">&gt;</span><span class="fl">0</span>, <span class="fl">2</span>, <span class="va">sum</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">5</span><span class="op">)</span> </span>
<span><span class="va">PA_Birds</span> <span class="op">&lt;-</span> <span class="va">PA_Birds</span><span class="op">[</span>, <span class="op">-</span><span class="va">rare_sp</span><span class="op">]</span></span>
<span><span class="co"># Transform presence-absence data with multiple visits per site into binary data</span></span>
<span><span class="va">PA_Birds</span><span class="op">[</span><span class="va">PA_Birds</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="co"># Scale environmental variables </span></span>
<span><span class="va">Env_Birds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">birds</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"elev"</span>,<span class="st">"rlength"</span>,<span class="st">"forest"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Define the model </span></span>
<span><span class="va">studyDesign</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>sample<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Hmsc/man/HmscRandomLevel.html" class="external-link">HmscRandomLevel</a></span><span class="op">(</span>units<span class="op">=</span><span class="va">studyDesign</span><span class="op">$</span><span class="va">sample</span><span class="op">)</span></span>
<span><span class="va">rL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Hmsc/man/setPriors.html" class="external-link">setPriors</a></span><span class="op">(</span><span class="va">rL</span>, nfMax<span class="op">=</span><span class="fl">2</span>, nfMin<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co"># Fit the model </span></span>
<span><span class="va">T1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Hmsc/man/Hmsc.html" class="external-link">Hmsc</a></span><span class="op">(</span>Y<span class="op">=</span><span class="va">PA_Birds</span>, XData<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">Env_Birds</span><span class="op">)</span>, XFormula<span class="op">=</span><span class="op">~</span><span class="va">.</span>, XScale <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>            distr<span class="op">=</span><span class="st">"probit"</span>, studyDesign<span class="op">=</span><span class="va">studyDesign</span>,</span>
<span>            ranLevels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"sample"</span><span class="op">=</span><span class="va">rL</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mod_Hmsc_Birds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Hmsc/man/sampleMcmc.html" class="external-link">sampleMcmc</a></span><span class="op">(</span><span class="va">mod</span>, thin<span class="op">=</span><span class="fl">5</span>, samples<span class="op">=</span><span class="fl">1000</span>, transient <span class="op">=</span> <span class="fl">10000</span>, nChains <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">T2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="va">T_Hmsc_Birds</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">T2</span>,<span class="va">T1</span>, units<span class="op">=</span><span class="st">"secs"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Predicted probit(theta) </span></span>
<span><span class="va">theta_latent_Birds</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Hmsc/man/computePredictedValues.html" class="external-link">computePredictedValues</a></span><span class="op">(</span><span class="va">mod_Hmsc_Birds</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,<span class="va">mean</span><span class="op">)</span></span>
<span><span class="va">probit_theta_latent_Birds</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="va">theta_latent_Birds</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Deviance</span></span>
<span><span class="va">logL</span><span class="op">=</span><span class="fl">0</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">logL</span><span class="op">=</span> <span class="va">logL</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">dbinom</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span>,<span class="fl">1</span>,<span class="va">theta_latent_Birds</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span>,<span class="fl">1</span><span class="op">)</span>  </span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">Deviance_Hmsc_Birds</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">2</span><span class="op">*</span><span class="va">logL</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">T_Hmsc_Birds</span>, <span class="va">mod_Hmsc_Birds</span>,</span>
<span>     <span class="va">probit_theta_latent_Birds</span>, <span class="va">Deviance_Hmsc_Birds</span>,</span>
<span>     file<span class="op">=</span><span class="st">"jSDM_Hmsc_cache/Hmsc_Birds.RData"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3" number="3.7">
<h3 id="mites-dataset">
<span class="header-section-number">3.7</span> Mites dataset<a class="anchor" aria-label="anchor" href="#mites-dataset"></a>
</h3>
<p>We fit a joint species distribution model, including latent variables, from the <a href="https://ecology.ghislainv.fr/jSDM/reference/mites.html" class="external-link"><code>mites</code></a> abundance dataset using <code><a href="https://rdrr.io/pkg/Hmsc/man/Hmsc.html" class="external-link">Hmsc()</a></code> function to perform a poisson log-linear regression.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Import center and reduce mites dataset</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">mites</span>, package<span class="op">=</span><span class="st">"jSDM"</span><span class="op">)</span></span>
<span><span class="co"># data.obs</span></span>
<span><span class="va">PA_Mites</span> <span class="op">&lt;-</span> <span class="va">mites</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">35</span><span class="op">]</span></span>
<span><span class="co"># Remove species with less than 10 presences</span></span>
<span><span class="va">rare_sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">PA_Mites</span><span class="op">&gt;</span><span class="fl">0</span>, <span class="fl">2</span>, <span class="va">sum</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">10</span><span class="op">)</span> </span>
<span><span class="va">PA_Mites</span> <span class="op">&lt;-</span> <span class="va">PA_Mites</span><span class="op">[</span>, <span class="op">-</span><span class="va">rare_sp</span><span class="op">]</span></span>
<span><span class="co"># Normalized continuous variables</span></span>
<span><span class="va">Env_Mites</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">mites</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"density"</span>,<span class="st">"water"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                    <span class="va">mites</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"substrate"</span>, <span class="st">"shrubs"</span>, <span class="st">"topo"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">mf.suit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.frame.html" class="external-link">model.frame</a></span><span class="op">(</span>formula<span class="op">=</span><span class="op">~</span><span class="va">.</span>, data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">Env_Mites</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">X_Mites</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">mf.suit</span>,<span class="st">"terms"</span><span class="op">)</span>, data<span class="op">=</span><span class="va">mf.suit</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define the model </span></span>
<span><span class="va">studyDesign</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>sample<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">PA_Mites</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Hmsc/man/HmscRandomLevel.html" class="external-link">HmscRandomLevel</a></span><span class="op">(</span>units<span class="op">=</span><span class="va">studyDesign</span><span class="op">$</span><span class="va">sample</span><span class="op">)</span></span>
<span><span class="va">rL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Hmsc/man/setPriors.html" class="external-link">setPriors</a></span><span class="op">(</span><span class="va">rL</span>, nfMax<span class="op">=</span><span class="fl">2</span>, nfMin<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co"># Fit the model </span></span>
<span><span class="va">T1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Hmsc/man/Hmsc.html" class="external-link">Hmsc</a></span><span class="op">(</span>Y<span class="op">=</span><span class="va">PA_Mites</span>, XData<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">Env_Mites</span><span class="op">)</span>, XFormula<span class="op">=</span><span class="op">~</span><span class="va">.</span>, XScale<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>            distr<span class="op">=</span><span class="st">"poisson"</span>, studyDesign<span class="op">=</span><span class="va">studyDesign</span>,</span>
<span>            ranLevels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"sample"</span><span class="op">=</span><span class="va">rL</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mod_Hmsc_Mites</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Hmsc/man/sampleMcmc.html" class="external-link">sampleMcmc</a></span><span class="op">(</span><span class="va">mod</span>, thin<span class="op">=</span><span class="fl">5</span>, samples<span class="op">=</span><span class="fl">1000</span>, transient <span class="op">=</span> <span class="fl">10000</span>, nChains <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">T2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">T_Hmsc_Mites</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">T2</span>,<span class="va">T1</span>, units<span class="op">=</span><span class="st">"secs"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Predicted probit(theta) </span></span>
<span><span class="va">theta_latent_Mites</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Hmsc/man/computePredictedValues.html" class="external-link">computePredictedValues</a></span><span class="op">(</span><span class="va">mod_Hmsc_Mites</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,<span class="va">mean</span><span class="op">)</span></span>
<span><span class="va">log_theta_latent_Mites</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">theta_latent_Mites</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Deviance</span></span>
<span><span class="va">logL</span><span class="op">=</span><span class="fl">0</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">PA_Mites</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">PA_Mites</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">logL</span><span class="op">=</span><span class="va">logL</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">dpois</a></span><span class="op">(</span><span class="va">PA_Mites</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span>,<span class="va">theta_latent_Mites</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span>,<span class="fl">1</span><span class="op">)</span>  </span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">Deviance_Hmsc_Mites</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">2</span><span class="op">*</span><span class="va">logL</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">T_Hmsc_Mites</span>, <span class="va">mod_Hmsc_Mites</span>,</span>
<span>     <span class="va">log_theta_latent_Mites</span>, <span class="va">Deviance_Hmsc_Mites</span>,</span>
<span>     file<span class="op">=</span><span class="st">"jSDM_Hmsc_cache/Hmsc_Mites.RData"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2" number="4">
<h2 id="package-jsdm">
<span class="header-section-number">4</span> Package <code>jSDM</code><a class="anchor" aria-label="anchor" href="#package-jsdm"></a>
</h2>
<p>In a second step, we fit the same joint species distribution models from each of the previous datasets using the <code>jSDM</code> package.</p>
<div class="section level3" number="4.1">
<h3 id="simulated-dataset-1">
<span class="header-section-number">4.1</span> Simulated dataset<a class="anchor" aria-label="anchor" href="#simulated-dataset-1"></a>
</h3>
<p>We fit a binomial joint species distribution model, including latent variables, from the simulated dataset using the <code><a href="../reference/jSDM_binomial_probit.html">jSDM_binomial_probit()</a></code> function to perform binomial probit regression.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"jSDM_Hmsc_cache/Hmsc_simulation.RData"</span><span class="op">)</span></span>
<span><span class="va">np</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ecology.ghislainv.fr/jSDM/" class="external-link">jSDM</a></span><span class="op">)</span></span>
<span><span class="co"># Fit the model</span></span>
<span><span class="va">T1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="va">mod_jSDM_sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/jSDM_binomial_probit.html">jSDM_binomial_probit</a></span><span class="op">(</span></span>
<span>  <span class="co"># Chains</span></span>
<span>  burnin<span class="op">=</span><span class="fl">10000</span>, mcmc<span class="op">=</span><span class="fl">5000</span>, thin<span class="op">=</span><span class="fl">5</span>,</span>
<span>  <span class="co"># Response variable</span></span>
<span>  presence_data<span class="op">=</span><span class="va">Y</span>, </span>
<span>  <span class="co"># Explanatory variables </span></span>
<span>  site_formula<span class="op">=</span><span class="op">~</span><span class="va">x1</span><span class="op">+</span><span class="va">x2</span>,   </span>
<span>  site_data<span class="op">=</span><span class="va">X</span>,</span>
<span>  <span class="co"># Model specification</span></span>
<span>  n_latent<span class="op">=</span><span class="fl">2</span>, site_effect<span class="op">=</span><span class="st">"none"</span>,</span>
<span>  <span class="co"># Starting values</span></span>
<span>  beta_start<span class="op">=</span><span class="fl">0</span>,</span>
<span>  lambda_start<span class="op">=</span><span class="fl">0</span>, W_start<span class="op">=</span><span class="fl">0</span>,</span>
<span>  <span class="co"># Priors </span></span>
<span>  mu_beta<span class="op">=</span><span class="fl">0</span>, V_beta<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">np</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  mu_lambda<span class="op">=</span><span class="fl">0</span>, V_lambda<span class="op">=</span><span class="fl">1</span>,</span>
<span>  <span class="co"># Various </span></span>
<span>  seed<span class="op">=</span><span class="fl">123</span>, verbose<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">T2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="va">T_jSDM_sim</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">T2</span>,<span class="va">T1</span>, units<span class="op">=</span><span class="st">"secs"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># RMSE</span></span>
<span><span class="va">SE</span><span class="op">=</span><span class="op">(</span><span class="va">theta</span><span class="op">-</span><span class="va">mod_jSDM_sim</span><span class="op">$</span><span class="va">theta_latent</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span>
<span><span class="va">RMSE_jSDM_sim</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">SE</span><span class="op">/</span><span class="op">(</span><span class="va">nsite</span><span class="op">*</span><span class="va">nsp</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">T_jSDM_sim</span>, <span class="va">mod_jSDM_sim</span>, <span class="va">RMSE_jSDM_sim</span>,</span>
<span>     file<span class="op">=</span><span class="st">"jSDM_Hmsc_cache/jSDM_simulation.RData"</span><span class="op">)</span></span></code></pre></div>
<p>We visually evaluate the convergence of MCMCs by representing the trace and density <em>a posteriori</em> of some estimated parameters and we evaluate the accuracy of the estimated parameters by plotting them against the parameters used to simulate the data-set.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span>file<span class="op">=</span><span class="st">"jSDM_Hmsc_cache/jSDM_simulation.RData"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span>file<span class="op">=</span><span class="st">"jSDM_Hmsc_cache/Hmsc_simulation.RData"</span><span class="op">)</span></span>
<span><span class="co"># ===================================================</span></span>
<span><span class="co"># Result analysis</span></span>
<span><span class="co"># ===================================================</span></span>
<span></span>
<span><span class="co"># Trace and density plot of MCMC chains of parameters to visually evaluate convergence </span></span>
<span><span class="co">## Fixed species effect beta</span></span>
<span><span class="va">np</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span><span class="va">mean_beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">nsp</span>,<span class="va">np</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nsp</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">p</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">mean_beta</span><span class="op">[</span><span class="va">j</span>,<span class="va">p</span><span class="op">]</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mod_jSDM_sim</span><span class="op">$</span><span class="va">mcmc.sp</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">p</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">j</span> <span class="op">&lt;</span> <span class="fl">3</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/traceplot.html" class="external-link">traceplot</a></span><span class="op">(</span><span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html" class="external-link">as.mcmc</a></span><span class="op">(</span><span class="va">mod_jSDM_sim</span><span class="op">$</span><span class="va">mcmc.sp</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">p</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                      main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Trace of "</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mod_jSDM_sim</span><span class="op">$</span><span class="va">mcmc.sp</span></span>
<span>                                         <span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="va">p</span><span class="op">]</span>,<span class="st">", species : "</span>,<span class="va">j</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/densplot.html" class="external-link">densplot</a></span><span class="op">(</span><span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html" class="external-link">as.mcmc</a></span><span class="op">(</span><span class="va">mod_jSDM_sim</span><span class="op">$</span><span class="va">mcmc.sp</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">p</span><span class="op">]</span><span class="op">)</span>, </span>
<span>                     main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Density of "</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mod_jSDM_sim</span><span class="op">$</span><span class="va">mcmc.sp</span></span>
<span>                                         <span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="va">p</span><span class="op">]</span>,<span class="st">", species : "</span>,<span class="va">j</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="va">beta.target</span><span class="op">[</span><span class="va">p</span>,<span class="va">j</span><span class="op">]</span>,col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## factor loadings lambda_j</span></span>
<span><span class="va">mean_lambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">nsp</span>,<span class="va">nl</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">nl</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nsp</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">l</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nl</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">mean_lambda</span><span class="op">[</span><span class="va">j</span>,<span class="va">l</span><span class="op">]</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mod_jSDM_sim</span><span class="op">$</span><span class="va">mcmc.sp</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">+</span><span class="va">l</span><span class="op">]</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">j</span> <span class="op">&lt;</span> <span class="fl">3</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/traceplot.html" class="external-link">traceplot</a></span><span class="op">(</span><span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html" class="external-link">as.mcmc</a></span><span class="op">(</span><span class="va">mod_jSDM_sim</span><span class="op">$</span><span class="va">mcmc.sp</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">+</span><span class="va">l</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                      main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Trace of"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mod_jSDM_sim</span><span class="op">$</span><span class="va">mcmc.sp</span></span>
<span>                                         <span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">+</span><span class="va">l</span><span class="op">]</span>,<span class="st">", species : "</span>,<span class="va">j</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/densplot.html" class="external-link">densplot</a></span><span class="op">(</span><span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html" class="external-link">as.mcmc</a></span><span class="op">(</span><span class="va">mod_jSDM_sim</span><span class="op">$</span><span class="va">mcmc.sp</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">+</span><span class="va">l</span><span class="op">]</span><span class="op">)</span>, </span>
<span>                     main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Density of"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mod_jSDM_sim</span><span class="op">$</span><span class="va">mcmc.sp</span></span>
<span>                                         <span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">+</span><span class="va">l</span><span class="op">]</span>,<span class="st">", species : "</span>,<span class="va">j</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="va">lambda.target</span><span class="op">[</span><span class="va">l</span>,<span class="va">j</span><span class="op">]</span>,col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">beta.target</span><span class="op">)</span>,<span class="va">mean_beta</span>, xlab<span class="op">=</span><span class="st">"obs"</span>, ylab<span class="op">=</span><span class="st">"fitted"</span>, </span>
<span>     main<span class="op">=</span><span class="st">"Fixed species effect beta"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>,b<span class="op">=</span><span class="fl">1</span>,col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">lambda.target</span><span class="op">)</span>,<span class="va">mean_lambda</span>, xlab<span class="op">=</span><span class="st">"obs"</span>, ylab<span class="op">=</span><span class="st">"fitted"</span>, </span>
<span>     main<span class="op">=</span><span class="st">"Loading factors lambda"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>,b<span class="op">=</span><span class="fl">1</span>,col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## W latent variables</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">l</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nl</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">W</span><span class="op">[</span>,<span class="va">l</span><span class="op">]</span>,<span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">mod_jSDM_sim</span><span class="op">$</span><span class="va">mcmc.latent</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"lv_"</span>,<span class="va">l</span><span class="op">)</span><span class="op">]</span><span class="op">]</span>,<span class="fl">2</span>,<span class="va">mean</span><span class="op">)</span>,</span>
<span>       main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Latent variable W_"</span>, <span class="va">l</span><span class="op">)</span>, xlab<span class="op">=</span><span class="st">"obs"</span>, ylab<span class="op">=</span><span class="st">"fitted"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>,b<span class="op">=</span><span class="fl">1</span>,col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">SE</span><span class="op">=</span><span class="op">(</span><span class="va">theta</span><span class="op">-</span><span class="va">mod_jSDM_sim</span><span class="op">$</span><span class="va">theta_latent</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span>
<span><span class="va">RMSE_jSDM_sim</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">SE</span><span class="op">/</span><span class="op">(</span><span class="va">nsite</span><span class="op">*</span><span class="va">nsp</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Deviance</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mod_jSDM_sim</span><span class="op">$</span><span class="va">mcmc.Deviance</span>, main<span class="op">=</span><span class="st">"Deviance"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#= Predictions</span></span>
<span><span class="co">## probit_theta</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">probit_theta</span>,<span class="va">mod_jSDM_sim</span><span class="op">$</span><span class="va">probit_theta_latent</span>,</span>
<span>     xlab<span class="op">=</span><span class="st">"obs"</span>,ylab<span class="op">=</span><span class="st">"fitted"</span>, main<span class="op">=</span><span class="st">"probit(theta)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>,b<span class="op">=</span><span class="fl">1</span>,col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ## theta</span></span>
<span><span class="co"># plot(pnorm(probit_theta),mod_jSDM_sim$theta_latent,</span></span>
<span><span class="co">#      xlab="obs",ylab="fitted", main="theta")</span></span>
<span><span class="co"># abline(a=0,b=1,col='red')</span></span></code></pre></div>
<p><img src="jSDM_Hmsc_files/figure-html/jSDM-simulation-plot-1.png" width="800" style="display: block; margin: auto;"><img src="jSDM_Hmsc_files/figure-html/jSDM-simulation-plot-2.png" width="800" style="display: block; margin: auto;"><img src="jSDM_Hmsc_files/figure-html/jSDM-simulation-plot-3.png" width="800" style="display: block; margin: auto;"><img src="jSDM_Hmsc_files/figure-html/jSDM-simulation-plot-4.png" width="800" style="display: block; margin: auto;"><img src="jSDM_Hmsc_files/figure-html/jSDM-simulation-plot-5.png" width="800" style="display: block; margin: auto;"><img src="jSDM_Hmsc_files/figure-html/jSDM-simulation-plot-6.png" width="800" style="display: block; margin: auto;"><img src="jSDM_Hmsc_files/figure-html/jSDM-simulation-plot-7.png" width="800" style="display: block; margin: auto;"><img src="jSDM_Hmsc_files/figure-html/jSDM-simulation-plot-8.png" width="800" style="display: block; margin: auto;"></p>
<p>Overall, the traces and the densities of the parameters indicate the convergence of the algorithm. Indeed, we observe on the traces that the values oscillate around averages without showing an upward or downward trend and we see that the densities are quite smooth and for the most part of Gaussian form.<br>
On the above figures, the estimated parameters are close to the expected values if the points are near the red line representing the identity function (<span class="math inline">\(y=x\)</span>).</p>
</div>
<div class="section level3" number="4.2">
<h3 id="mosquitos-dataset-1">
<span class="header-section-number">4.2</span> Mosquitos dataset<a class="anchor" aria-label="anchor" href="#mosquitos-dataset-1"></a>
</h3>
<p>We fit a binomial joint species distribution model, including latent variables, from the <a href="https://ecology.ghislainv.fr/jSDM/reference/mosquitos.html" class="external-link"><code>mosquitos</code></a> dataset using <code><a href="../reference/jSDM_binomial_probit.html">jSDM_binomial_probit()</a></code> function to perform binomial probit regression.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit the model</span></span>
<span><span class="va">T1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">mod_jSDM_Mosquitos</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/jSDM_binomial_probit.html">jSDM_binomial_probit</a></span><span class="op">(</span></span>
<span>  <span class="co"># Chains </span></span>
<span>  burnin<span class="op">=</span><span class="fl">10000</span>, mcmc<span class="op">=</span><span class="fl">5000</span>, thin<span class="op">=</span><span class="fl">5</span>,</span>
<span>  <span class="co"># Response variable </span></span>
<span>  presence_data<span class="op">=</span><span class="va">PA_Mosquitos</span>, </span>
<span>  <span class="co"># Explanatory variables </span></span>
<span>  site_formula<span class="op">=</span><span class="op">~</span><span class="va">.</span>,   </span>
<span>  site_data<span class="op">=</span><span class="va">Env_Mosquitos</span>,</span>
<span>  <span class="co"># Model specification</span></span>
<span>  site_effect<span class="op">=</span><span class="st">"none"</span>, n_latent<span class="op">=</span><span class="fl">2</span>,</span>
<span>  <span class="co"># Starting values </span></span>
<span>  beta_start<span class="op">=</span><span class="fl">0</span>,</span>
<span>  lambda_start<span class="op">=</span><span class="fl">0</span>, W_start<span class="op">=</span><span class="fl">0</span>,</span>
<span>  <span class="co"># Priors</span></span>
<span>  mu_beta<span class="op">=</span><span class="fl">0</span>, V_beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X_Mosquitos</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  mu_lambda<span class="op">=</span><span class="fl">0</span>, V_lambda<span class="op">=</span><span class="fl">1</span>,</span>
<span>  <span class="co"># Various </span></span>
<span>  seed<span class="op">=</span><span class="fl">123</span>, verbose<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">T2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">T_jSDM_Mosquitos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">T2</span>,<span class="va">T1</span>, units<span class="op">=</span><span class="st">"secs"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">T_jSDM_Mosquitos</span>, <span class="va">mod_jSDM_Mosquitos</span>,</span>
<span>     file<span class="op">=</span><span class="st">"jSDM_Hmsc_cache/jSDM_Mosquitos.RData"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3" number="4.3">
<h3 id="eucalypts-dataset-1">
<span class="header-section-number">4.3</span> Eucalypts dataset<a class="anchor" aria-label="anchor" href="#eucalypts-dataset-1"></a>
</h3>
<p>We fit a binomial joint species distribution model, including latent variables, from the <a href="https://ecology.ghislainv.fr/jSDM/reference/eucalypts.html" class="external-link"><code>eucalypts</code></a> dataset using <code><a href="../reference/jSDM_binomial_probit.html">jSDM_binomial_probit()</a></code> function to perform binomial probit regression.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit the model</span></span>
<span><span class="va">T1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">mod_jSDM_Eucalypts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/jSDM_binomial_probit.html">jSDM_binomial_probit</a></span><span class="op">(</span></span>
<span>  <span class="co"># Chains</span></span>
<span>  burnin<span class="op">=</span><span class="fl">10000</span>, mcmc<span class="op">=</span><span class="fl">5000</span>, thin<span class="op">=</span><span class="fl">5</span>,</span>
<span>  <span class="co"># Response variable </span></span>
<span>  presence_data<span class="op">=</span><span class="va">PA_Eucalypts</span>,</span>
<span>  <span class="co"># Explanatory variables </span></span>
<span>  site_formula<span class="op">=</span><span class="op">~</span><span class="va">.</span>,   </span>
<span>  site_data<span class="op">=</span><span class="va">Env_Eucalypts</span>,</span>
<span>  <span class="co"># Model specification</span></span>
<span>  n_latent<span class="op">=</span><span class="fl">2</span>, site_effect<span class="op">=</span><span class="st">"none"</span>,</span>
<span>  <span class="co"># Starting values </span></span>
<span>  beta_start<span class="op">=</span><span class="fl">0</span>,</span>
<span>  lambda_start<span class="op">=</span><span class="fl">0</span>, W_start<span class="op">=</span><span class="fl">0</span>,</span>
<span>  <span class="co"># Priors</span></span>
<span>  mu_beta<span class="op">=</span><span class="fl">0</span>, V_beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X_Eucalypts</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  mu_lambda<span class="op">=</span><span class="fl">0</span>, V_lambda<span class="op">=</span><span class="fl">1</span>,</span>
<span>  <span class="co"># Various </span></span>
<span>  seed<span class="op">=</span><span class="fl">123</span>, verbose<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">T2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">T_jSDM_Eucalypts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">T2</span>,<span class="va">T1</span>, units<span class="op">=</span><span class="st">"secs"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">T_jSDM_Eucalypts</span>, <span class="va">mod_jSDM_Eucalypts</span>,</span>
<span>     file<span class="op">=</span><span class="st">"jSDM_Hmsc_cache/jSDM_Eucalypts.RData"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3" number="4.4">
<h3 id="frogs-dataset-1">
<span class="header-section-number">4.4</span> Frogs dataset<a class="anchor" aria-label="anchor" href="#frogs-dataset-1"></a>
</h3>
<p>We fit a binomial joint species distribution model, including latent variables, from the <a href="https://ecology.ghislainv.fr/jSDM/reference/frogs.html" class="external-link"><code>frogs</code></a> dataset using <code><a href="../reference/jSDM_binomial_probit.html">jSDM_binomial_probit()</a></code> function to perform binomial probit regression.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit the model </span></span>
<span><span class="va">T1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">mod_jSDM_Frogs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/jSDM_binomial_probit.html">jSDM_binomial_probit</a></span><span class="op">(</span></span>
<span>  <span class="co"># Chains</span></span>
<span>  burnin<span class="op">=</span><span class="fl">10000</span>, mcmc<span class="op">=</span><span class="fl">5000</span>, thin<span class="op">=</span><span class="fl">5</span>,</span>
<span>  <span class="co"># Response variable </span></span>
<span>  presence_data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">PA_Frogs</span><span class="op">)</span>, </span>
<span>  <span class="co"># Explanatory variables </span></span>
<span>  site_formula<span class="op">=</span><span class="op">~</span><span class="va">.</span>,   </span>
<span>  site_data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">Env_Frogs</span><span class="op">)</span>,</span>
<span>  <span class="co"># Model specification </span></span>
<span>  n_latent<span class="op">=</span><span class="fl">2</span>, site_effect<span class="op">=</span><span class="st">"none"</span>,</span>
<span>  <span class="co"># Starting values </span></span>
<span>  beta_start<span class="op">=</span><span class="fl">0</span>,</span>
<span>  lambda_start<span class="op">=</span><span class="fl">0</span>, W_start<span class="op">=</span><span class="fl">0</span>,</span>
<span>  <span class="co"># Priors </span></span>
<span>  mu_beta<span class="op">=</span><span class="fl">0</span>, V_beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X_Frogs</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  mu_lambda<span class="op">=</span><span class="fl">0</span>, V_lambda<span class="op">=</span><span class="fl">1</span>,</span>
<span>  <span class="co"># Various </span></span>
<span>  seed<span class="op">=</span><span class="fl">123</span>, verbose<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">T2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">T_jSDM_Frogs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">T2</span>,<span class="va">T1</span>, units<span class="op">=</span><span class="st">"secs"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">T_jSDM_Frogs</span>, <span class="va">mod_jSDM_Frogs</span>,</span>
<span>     file<span class="op">=</span><span class="st">"jSDM_Hmsc_cache/jSDM_Frogs.RData"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3" number="4.5">
<h3 id="fungi-dataset-1">
<span class="header-section-number">4.5</span> Fungi dataset<a class="anchor" aria-label="anchor" href="#fungi-dataset-1"></a>
</h3>
<p>We fit a binomial joint species distribution model, including latent variables, from the <a href="https://ecology.ghislainv.fr/jSDM/reference/fungi.html" class="external-link"><code>fungi</code></a> dataset using <code><a href="../reference/jSDM_binomial_probit.html">jSDM_binomial_probit()</a></code> function to perform binomial probit regression.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit the model</span></span>
<span><span class="va">T1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">mod_jSDM_Fungi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/jSDM_binomial_probit.html">jSDM_binomial_probit</a></span><span class="op">(</span></span>
<span>  <span class="co"># Chains </span></span>
<span>  burnin<span class="op">=</span><span class="fl">10000</span>, mcmc<span class="op">=</span><span class="fl">5000</span>, thin<span class="op">=</span><span class="fl">5</span>,</span>
<span>  <span class="co"># Response variable </span></span>
<span>  presence_data<span class="op">=</span><span class="va">PA_Fungi</span>, </span>
<span>  <span class="co"># Explanatory variables </span></span>
<span>  site_formula<span class="op">=</span><span class="op">~</span><span class="va">.</span>,   </span>
<span>  site_data<span class="op">=</span><span class="va">Env_Fungi</span>,</span>
<span>  <span class="co"># Model specification</span></span>
<span>  n_latent<span class="op">=</span><span class="fl">2</span>, site_effect<span class="op">=</span><span class="st">"none"</span>,</span>
<span>  <span class="co"># Starting values </span></span>
<span>  beta_start<span class="op">=</span><span class="fl">0</span>,</span>
<span>  lambda_start<span class="op">=</span><span class="fl">0</span>, W_start<span class="op">=</span><span class="fl">0</span>,</span>
<span>  mu_beta<span class="op">=</span><span class="fl">0</span>, V_beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X_Fungi</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  mu_lambda<span class="op">=</span><span class="fl">0</span>, V_lambda<span class="op">=</span><span class="fl">1</span>,</span>
<span>  <span class="co"># Various </span></span>
<span>  seed<span class="op">=</span><span class="fl">123</span>, verbose<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">T2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">T_jSDM_Fungi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">T2</span>,<span class="va">T1</span>, units<span class="op">=</span><span class="st">"secs"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">T_jSDM_Fungi</span>, <span class="va">mod_jSDM_Fungi</span>,</span>
<span>     file<span class="op">=</span><span class="st">"jSDM_Hmsc_cache/jSDM_Fungi.RData"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3" number="4.6">
<h3 id="birds-dataset-1">
<span class="header-section-number">4.6</span> Birds dataset<a class="anchor" aria-label="anchor" href="#birds-dataset-1"></a>
</h3>
<p>We fit a binomial joint species distribution model including latent variables, from the <a href="https://ecology.ghislainv.fr/jSDM/reference/birds.html" class="external-link"><code>birds</code></a> dataset using <code><a href="../reference/jSDM_binomial_probit.html">jSDM_binomial_probit()</a></code> function to perform binomial probit regression.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Birds dataset</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"birds"</span><span class="op">)</span></span>
<span><span class="va">PA_Birds</span> <span class="op">&lt;-</span> <span class="va">birds</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">158</span><span class="op">]</span></span>
<span><span class="co"># Remove species with less than 5 presences</span></span>
<span><span class="va">rare_sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">&gt;</span><span class="fl">0</span>, <span class="fl">2</span>, <span class="va">sum</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">5</span><span class="op">)</span> </span>
<span><span class="va">PA_Birds</span> <span class="op">&lt;-</span> <span class="va">PA_Birds</span><span class="op">[</span>, <span class="op">-</span><span class="va">rare_sp</span><span class="op">]</span></span>
<span><span class="co"># Transform presence-absence data with multiple visits per site into binary data</span></span>
<span><span class="va">PA_Birds</span><span class="op">[</span><span class="va">PA_Birds</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="co"># Scale environmental variables </span></span>
<span><span class="va">Env_Birds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">birds</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"elev"</span>,<span class="st">"rlength"</span>,<span class="st">"forest"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit the model</span></span>
<span><span class="va">T1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">mod_jSDM_Birds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/jSDM_binomial_probit.html">jSDM_binomial_probit</a></span><span class="op">(</span></span>
<span>  <span class="co"># Chains </span></span>
<span>  burnin<span class="op">=</span><span class="fl">10000</span>, mcmc<span class="op">=</span><span class="fl">5000</span>, thin<span class="op">=</span><span class="fl">5</span>,</span>
<span>  <span class="co"># Response variable </span></span>
<span>  presence_data<span class="op">=</span><span class="va">PA_Birds</span>, </span>
<span>  <span class="co"># Explanatory variables </span></span>
<span>  site_formula<span class="op">=</span><span class="op">~</span><span class="va">.</span>,   </span>
<span>  site_data<span class="op">=</span><span class="va">Env_Birds</span>,</span>
<span>  <span class="co"># Model specification</span></span>
<span>  n_latent<span class="op">=</span><span class="fl">2</span>, site_effect<span class="op">=</span><span class="st">"none"</span>,</span>
<span>  <span class="co"># Starting values </span></span>
<span>  beta_start<span class="op">=</span><span class="fl">0</span>,</span>
<span>  lambda_start<span class="op">=</span><span class="fl">0</span>, W_start<span class="op">=</span><span class="fl">0</span>,</span>
<span>  <span class="co"># Priors </span></span>
<span>  mu_beta<span class="op">=</span><span class="fl">0</span>, V_beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X_Birds</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  mu_lambda<span class="op">=</span><span class="fl">0</span>, V_lambda<span class="op">=</span><span class="fl">1</span>,</span>
<span>  <span class="co"># Various </span></span>
<span>  seed<span class="op">=</span><span class="fl">123</span>, verbose<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">T2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">T_jSDM_Birds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">T2</span>,<span class="va">T1</span>, units<span class="op">=</span><span class="st">"secs"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">T_jSDM_Birds</span>, <span class="va">mod_jSDM_Birds</span>,</span>
<span>     file<span class="op">=</span><span class="st">"jSDM_Hmsc_cache/jSDM_Birds.RData"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3" number="4.7">
<h3 id="mites-dataset-1">
<span class="header-section-number">4.7</span> Mites dataset<a class="anchor" aria-label="anchor" href="#mites-dataset-1"></a>
</h3>
<p>We fit a joint species distribution model, including latent variables, from the <a href="https://ecology.ghislainv.fr/jSDM/reference/mites.html" class="external-link"><code>mites</code></a> abundance dataset using <code><a href="../reference/jSDM_poisson_log.html">jSDM_poisson_log()</a></code> function to perform a poisson log-linear regression.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit the model</span></span>
<span><span class="va">T1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">mod_jSDM_Mites</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/jSDM_poisson_log.html">jSDM_poisson_log</a></span><span class="op">(</span></span>
<span>  <span class="co"># Chains </span></span>
<span>  burnin<span class="op">=</span><span class="fl">10000</span>, mcmc<span class="op">=</span><span class="fl">5000</span>, thin<span class="op">=</span><span class="fl">5</span>,</span>
<span>  <span class="co"># Response variable </span></span>
<span>  count_data<span class="op">=</span><span class="va">PA_Mites</span>, </span>
<span>  <span class="co"># Explanatory variables </span></span>
<span>  site_formula<span class="op">=</span><span class="op">~</span><span class="va">.</span>,   </span>
<span>  site_data<span class="op">=</span><span class="va">Env_Mites</span>,</span>
<span>  <span class="co"># Model specification</span></span>
<span>  n_latent<span class="op">=</span><span class="fl">2</span>, site_effect<span class="op">=</span><span class="st">"none"</span>,</span>
<span>  <span class="co"># Starting values </span></span>
<span>  beta_start<span class="op">=</span><span class="fl">0</span>,</span>
<span>  lambda_start<span class="op">=</span><span class="fl">0</span>, W_start<span class="op">=</span><span class="fl">0</span>,</span>
<span>  <span class="co"># Priors </span></span>
<span>  mu_beta<span class="op">=</span><span class="fl">0</span>, V_beta<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X_Mites</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  mu_lambda<span class="op">=</span><span class="fl">0</span>, V_lambda<span class="op">=</span><span class="fl">1</span>,</span>
<span>  <span class="co"># Various </span></span>
<span>  ropt<span class="op">=</span><span class="fl">0.44</span>,</span>
<span>  seed<span class="op">=</span><span class="fl">123</span>, verbose<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">T2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">T_jSDM_Mites</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">T2</span>,<span class="va">T1</span>, units<span class="op">=</span><span class="st">"secs"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">T_jSDM_Mites</span>, <span class="va">mod_jSDM_Mites</span>,</span>
<span>     file<span class="op">=</span><span class="st">"jSDM_Hmsc_cache/jSDM_Mites.RData"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2" number="5">
<h2 id="comparison">
<span class="header-section-number">5</span> Comparison<a class="anchor" aria-label="anchor" href="#comparison"></a>
</h2>
<p>Then we compare the computation time and the results obtained with each package.</p>
<div class="section level3" number="5.1">
<h3 id="computation-time-and-deviance">
<span class="header-section-number">5.1</span> Computation time and deviance<a class="anchor" aria-label="anchor" href="#computation-time-and-deviance"></a>
</h3>
<table class="table table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
Simulated
</th>
<th style="text-align:left;">
Mosquitos
</th>
<th style="text-align:left;">
Eucalypts
</th>
<th style="text-align:left;">
Frogs
</th>
<th style="text-align:left;">
Fungi
</th>
<th style="text-align:left;">
Birds
</th>
<th style="text-align:left;">
Mites
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Computation time Hmsc (secondes)
</td>
<td style="text-align:left;">
641
</td>
<td style="text-align:left;">
283
</td>
<td style="text-align:left;">
171
</td>
<td style="text-align:left;">
125
</td>
<td style="text-align:left;">
197
</td>
<td style="text-align:left;">
1314
</td>
<td style="text-align:left;">
612
</td>
</tr>
<tr>
<td style="text-align:left;">
Computation time jSDM (secondes)
</td>
<td style="text-align:left;">
95
</td>
<td style="text-align:left;">
12
</td>
<td style="text-align:left;">
23
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
23
</td>
<td style="text-align:left;">
91
</td>
<td style="text-align:left;">
67
</td>
</tr>
<tr>
<td style="text-align:left;">
Deviance Hmsc
</td>
<td style="text-align:left;">
15421
</td>
<td style="text-align:left;">
1768
</td>
<td style="text-align:left;">
2656
</td>
<td style="text-align:left;">
353
</td>
<td style="text-align:left;">
1926
</td>
<td style="text-align:left;">
14641
</td>
<td style="text-align:left;">
7047
</td>
</tr>
<tr>
<td style="text-align:left;">
Deviance jSDM
</td>
<td style="text-align:left;">
15201
</td>
<td style="text-align:left;">
1267
</td>
<td style="text-align:left;">
1846
</td>
<td style="text-align:left;">
211
</td>
<td style="text-align:left;">
1377
</td>
<td style="text-align:left;">
14117
</td>
<td style="text-align:left;">
6812
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
<img src="figures/des.jpg" width="80" height="80">
</td>
<td style="text-align:left;">
<img src="figures/Mosquitos_.jpg" width="80" height="80">
</td>
<td style="text-align:left;">
<img src="figures/Eucalyptus_.jpg" width="80" height="80">
</td>
<td style="text-align:left;">
<img src="figures/Frogs_.jpg" width="80" height="80">
</td>
<td style="text-align:left;">
<img src="figures/Fungi_.jpg" width="80" height="80">
</td>
<td style="text-align:left;">
<img src="figures/birds.jpg" width="80" height="80">
</td>
<td style="text-align:left;">
<img src="figures/oribatid-mites.png" width="80" height="80">
</td>
</tr>
</tbody>
</table>
<p><code>jSDM</code> is <strong>7 to 28</strong> times faster than <code>Hmsc</code>.</p>
</div>
<div class="section level3" number="5.2">
<h3 id="root-mean-square-error-rmse-for-simulated-data">
<span class="header-section-number">5.2</span> Root-Mean-Square Error (RMSE) for simulated data<a class="anchor" aria-label="anchor" href="#root-mean-square-error-rmse-for-simulated-data"></a>
</h3>
<p>Computed for the probabilities of presences <span class="math inline">\(\theta_{ij}\)</span> on the simulated data-set.</p>
<table class="table table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Hmsc
</th>
<th style="text-align:right;">
jSDM
</th>
</tr></thead>
<tbody><tr>
<td style="text-align:left;">
RMSE
</td>
<td style="text-align:right;">
0.073
</td>
<td style="text-align:right;">
0.072
</td>
</tr></tbody>
</table>
</div>
<div class="section level3" number="5.3">
<h3 id="estimated-parameters">
<span class="header-section-number">5.3</span> Estimated Parameters<a class="anchor" aria-label="anchor" href="#estimated-parameters"></a>
</h3>
<p>We plot the parameters estimated with <code>jSDM</code> against those estimated with <code>Hmsc</code> to compare the results obtained with both packages.</p>
<div class="section level4" number="5.3.1">
<h4 id="simulated-dataset-2">
<span class="header-section-number">5.3.1</span> Simulated dataset<a class="anchor" aria-label="anchor" href="#simulated-dataset-2"></a>
</h4>
<p><img src="jSDM_Hmsc_files/figure-html/jSDM-Hmsc-simulation-1.png" width="800" style="display: block; margin: auto;"><img src="jSDM_Hmsc_files/figure-html/jSDM-Hmsc-simulation-2.png" width="800" style="display: block; margin: auto;"><img src="jSDM_Hmsc_files/figure-html/jSDM-Hmsc-simulation-3.png" width="800" style="display: block; margin: auto;"><img src="jSDM_Hmsc_files/figure-html/jSDM-Hmsc-simulation-4.png" width="800" style="display: block; margin: auto;"></p>
</div>
<div class="section level4" number="5.3.2">
<h4 id="mosquitos-dataset-2">
<span class="header-section-number">5.3.2</span> Mosquitos dataset<a class="anchor" aria-label="anchor" href="#mosquitos-dataset-2"></a>
</h4>
<p><img src="jSDM_Hmsc_files/figure-html/jSDM-Hmsc-mosquitos-1.png" width="800" style="display: block; margin: auto;"><img src="jSDM_Hmsc_files/figure-html/jSDM-Hmsc-mosquitos-2.png" width="800" style="display: block; margin: auto;"><img src="jSDM_Hmsc_files/figure-html/jSDM-Hmsc-mosquitos-3.png" width="800" style="display: block; margin: auto;"><img src="jSDM_Hmsc_files/figure-html/jSDM-Hmsc-mosquitos-4.png" width="800" style="display: block; margin: auto;"></p>
</div>
<div class="section level4" number="5.3.3">
<h4 id="eucalypts-dataset-2">
<span class="header-section-number">5.3.3</span> Eucalypts dataset<a class="anchor" aria-label="anchor" href="#eucalypts-dataset-2"></a>
</h4>
<p><img src="jSDM_Hmsc_files/figure-html/jSDM-Hmsc-Eucalypts-1.png" width="800" style="display: block; margin: auto;"><img src="jSDM_Hmsc_files/figure-html/jSDM-Hmsc-Eucalypts-2.png" width="800" style="display: block; margin: auto;"><img src="jSDM_Hmsc_files/figure-html/jSDM-Hmsc-Eucalypts-3.png" width="800" style="display: block; margin: auto;"><img src="jSDM_Hmsc_files/figure-html/jSDM-Hmsc-Eucalypts-4.png" width="800" style="display: block; margin: auto;"></p>
</div>
<div class="section level4" number="5.3.4">
<h4 id="frogs-dataset-2">
<span class="header-section-number">5.3.4</span> Frogs dataset<a class="anchor" aria-label="anchor" href="#frogs-dataset-2"></a>
</h4>
<p><img src="jSDM_Hmsc_files/figure-html/jSDM-Hmsc-frogs-1.png" width="800" style="display: block; margin: auto;"><img src="jSDM_Hmsc_files/figure-html/jSDM-Hmsc-frogs-2.png" width="800" style="display: block; margin: auto;"><img src="jSDM_Hmsc_files/figure-html/jSDM-Hmsc-frogs-3.png" width="800" style="display: block; margin: auto;"><img src="jSDM_Hmsc_files/figure-html/jSDM-Hmsc-frogs-4.png" width="800" style="display: block; margin: auto;"></p>
</div>
<div class="section level4" number="5.3.5">
<h4 id="fungi-dataset-2">
<span class="header-section-number">5.3.5</span> Fungi dataset<a class="anchor" aria-label="anchor" href="#fungi-dataset-2"></a>
</h4>
<p><img src="jSDM_Hmsc_files/figure-html/jSDM-Hmsc-fungi-1.png" width="800" style="display: block; margin: auto;"><img src="jSDM_Hmsc_files/figure-html/jSDM-Hmsc-fungi-2.png" width="800" style="display: block; margin: auto;"><img src="jSDM_Hmsc_files/figure-html/jSDM-Hmsc-fungi-3.png" width="800" style="display: block; margin: auto;"><img src="jSDM_Hmsc_files/figure-html/jSDM-Hmsc-fungi-4.png" width="800" style="display: block; margin: auto;"></p>
</div>
<div class="section level4" number="5.3.6">
<h4 id="birds-dataset-2">
<span class="header-section-number">5.3.6</span> Birds dataset<a class="anchor" aria-label="anchor" href="#birds-dataset-2"></a>
</h4>
<p><img src="jSDM_Hmsc_files/figure-html/jSDM-Hmsc-birds-1.png" width="800" style="display: block; margin: auto;"><img src="jSDM_Hmsc_files/figure-html/jSDM-Hmsc-birds-2.png" width="800" style="display: block; margin: auto;"><img src="jSDM_Hmsc_files/figure-html/jSDM-Hmsc-birds-3.png" width="800" style="display: block; margin: auto;"><img src="jSDM_Hmsc_files/figure-html/jSDM-Hmsc-birds-4.png" width="800" style="display: block; margin: auto;"></p>
</div>
<div class="section level4" number="5.3.7">
<h4 id="mites-dataset-2">
<span class="header-section-number">5.3.7</span> Mites dataset<a class="anchor" aria-label="anchor" href="#mites-dataset-2"></a>
</h4>
<p><img src="jSDM_Hmsc_files/figure-html/jSDM-Hmsc-mites-1.png" width="800" style="display: block; margin: auto;"><img src="jSDM_Hmsc_files/figure-html/jSDM-Hmsc-mites-2.png" width="800" style="display: block; margin: auto;"><img src="jSDM_Hmsc_files/figure-html/jSDM-Hmsc-mites-3.png" width="800" style="display: block; margin: auto;"><img src="jSDM_Hmsc_files/figure-html/jSDM-Hmsc-mites-4.png" width="800" style="display: block; margin: auto;"></p>
<p>On the figures above, the parameters estimated with <code>jSDM</code> are close to those obtained with <code>Hmsc</code> if the points are near the red line representing the identity function (<span class="math inline">\(y=x\)</span>).</p>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Borcard1994" class="csl-entry">
Borcard, D. &amp; Legendre, P. (1994) <a href="https://doi.org/10.1007/BF00714196" class="external-link">Environmental control and spatial structure in ecological communities: An example using oribatid mites (<span>Acari</span>, <span>Oribatei</span>)</a>. <em>Environmental and Ecological Statistics</em>, <strong>1</strong>, 37–61.
</div>
<div id="ref-Hui2016" class="csl-entry">
Hui, F.K.C. (2016) <a href="https://doi.org/10.1111/2041-210X.12514" class="external-link">Boral – <span>Bayesian</span> <span>Ordination</span> and <span>Regression</span> <span>Analysis</span> of <span>Multivariate</span> <span>Abundance</span> <span>Data</span> in r</a>. <em>Methods in Ecology and Evolution</em>, <strong>7</strong>, 744–750.
</div>
<div id="ref-Kery2006" class="csl-entry">
Kéry, M. &amp; Schmid, H. (2006) <a href="https://doi.org/10.1111/j.1365-2664.2005.01111.x" class="external-link">Estimating species richness: Calibrating a large avian monitoring programme</a>. <em>Journal of Applied Ecology</em>, <strong>43</strong>, 101–110.
</div>
<div id="ref-Ovaskainen2017" class="csl-entry">
Ovaskainen, O., Tikhonov, G., Norberg, A., Blanchet, F.G., Duan, L., Dunson, D., Roslin, T. &amp; Abrego, N. (2017) <a href="https://doi.org/10.1111/ele.12757" class="external-link">How to make more out of community data? A conceptual framework and its implementation as models and software</a>. <em>Ecology Letters</em>, <strong>20</strong>, 561–576.
</div>
<div id="ref-Warton2015" class="csl-entry">
Warton, D.I., Blanchet, F.G., O’Hara, R.B., Ovaskainen, O., Taskinen, S., Walker, S.C. &amp; Hui, F.K.C. (2015) <a href="https://doi.org/10.1016/j.tree.2015.09.007" class="external-link">So many variables: Joint modeling in community ecology</a>. <em>Trends in Ecology &amp; Evolution</em>, <strong>30</strong>, 766–779.
</div>
<div id="ref-Wilkinson2019" class="csl-entry">
Wilkinson, D.P., Golding, N., Guillera-Arroita, G., Tingley, R. &amp; McCarthy, M.A. (2019) <a href="https://doi.org/10.1111/2041-210X.13106" class="external-link">A comparison of joint species distribution models for presence-absence data</a>. <em>Methods in Ecology and Evolution</em>, <strong>10</strong>, 198–211.
</div>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://ecology.ghislainv.fr" class="external-link">Ghislain Vieilledent</a>, <a href="https://jeanneclement.github.io/" class="external-link">Jeanne Clément</a>, <a href="https://www.cirad.fr" class="external-link"><img src="https://ecology.ghislainv.fr/jSDM/logos/logo-cirad.png"></a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>

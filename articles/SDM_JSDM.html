<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Comparing SDMs and JSDMs ‚Ä¢ jSDM</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Comparing SDMs and JSDMs">
<meta property="og:description" content="jSDM">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">jSDM</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/jSDM.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Change log</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ghislainv/jSDM" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Comparing SDMs and JSDMs</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ghislainv/jSDM/blob/HEAD/vignettes/SDM_JSDM.Rmd" class="external-link"><code>vignettes/SDM_JSDM.Rmd</code></a></small>
      <div class="hidden name"><code>SDM_JSDM.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="dataset">
<span class="header-section-number">1</span> Dataset<a class="anchor" aria-label="anchor" href="#dataset"></a>
</h2>
<div class="section level3">
<h3 id="presence-absence-of-swiss-breeding-birds">
<span class="header-section-number">1.1</span> Presence-absence of Swiss breeding birds<a class="anchor" aria-label="anchor" href="#presence-absence-of-swiss-breeding-birds"></a>
</h3>

<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:birds-picture"></span>
<img src="figures/swiss_breeding_birds_atlas.jpg" alt="Swiss Breeding Birds Atlas (K√©ry &amp; Schmid 2006)." width="600" height="300"><p class="caption">
Figure 1.1: <strong><em>Swiss Breeding Birds Atlas</em></strong> <span class="citation">(K√©ry &amp; Schmid <a href="#ref-Kery2006" role="doc-biblioref">2006</a>)</span>.
</p>
</div>
<p>This data-set is available in the <a href="https://ecology.ghislainv.fr/jSDM/reference/jSDM-package.html" class="external-link"><code>jSDM-package</code></a>. It can be loaded with the <code><a href="https://rdrr.io/r/utils/data.html" class="external-link">data()</a></code> command. The <a href="https://ecology.ghislainv.fr/jSDM/reference/birds.html" class="external-link"><code>birds</code></a> data-set is in ‚Äúwide‚Äù format: each line is a site and the occurrence data are in columns.</p>
<p>The Swiss breeding bird survey (‚ÄúMonitoring H√§ufige Brutv√∂gel‚Äù MHB) has monitored the populations of 158 common species since 1999. The MHB sample consists of 267 1-km squares that are laid out as a grid across Switzerland. Fieldwork is conducted by about 200 skilled birdwatchers, most of them volunteers. Avian populations are monitored using a simplified territory mapping protocol, where each square is surveyed up to three times during the breeding season (only twice above the tree line).
Surveys are conducted along a transect that does not change over the years.</p>
<p>The data-set contains the 2014 data, except for one quadrat not surveyed in 2014.
It lists 158 bird species named in Latin and whose occurrences are expressed as the number of visits during which the species was observed on each site , with the exception of 13 species not surveyed in 2014 :</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://ecology.ghislainv.fr/jSDM/" class="external-link">"jSDM"</a></span><span class="op">)</span>
<span class="co">#&gt; ##</span>
<span class="co">#&gt; ## jSDM R package </span>
<span class="co">#&gt; ## For joint species distribution models </span>
<span class="co">#&gt; ## https://ecology.ghislainv.fr/jSDM </span>
<span class="co">#&gt; ##</span>
<span class="co"># Import center and reduce birds dataset</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">birds</span>, package<span class="op">=</span><span class="st">"jSDM"</span><span class="op">)</span>
<span class="co"># data.obs</span>
<span class="va">PA_Birds</span> <span class="op">&lt;-</span> <span class="va">birds</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">158</span><span class="op">]</span></code></pre></div>
<p>We transform abundance into presence-absence data and remove species with less than 10 presences to facilitate MCMC convergence. We also look at the number of observations per site.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Transform abundance into presence-absence</span>
<span class="va">PA_Birds</span><span class="op">[</span><span class="va">PA_Birds</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="co"># Remove species with less than 10 presences</span>
<span class="va">rare_sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">PA_Birds</span>, <span class="fl">2</span>, <span class="va">sum</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">10</span><span class="op">)</span>
<span class="va">PA_Birds</span> <span class="op">&lt;-</span> <span class="va">PA_Birds</span><span class="op">[</span>, <span class="op">-</span><span class="va">rare_sp</span><span class="op">]</span>
<span class="co"># Number of sites and species</span>
<span class="va">nsite</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>
<span class="va">nsite</span>
<span class="co">#&gt; [1] 266</span>
<span class="va">nsp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>
<span class="va">nsp</span>
<span class="co">#&gt; [1] 93</span>
<span class="co"># Number of observations per site</span>
<span class="va">nobs_site</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">PA_Birds</span>, <span class="fl">1</span>, <span class="va">sum</span><span class="op">)</span>
<span class="va">nobs_site</span>
<span class="co">#&gt;   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18  19  20 </span>
<span class="co">#&gt;  30  32  49  38  44  37  34  35  41  35  40  42  24  41  44  37  42  45  38  42 </span>
<span class="co">#&gt;  21  22  23  24  25  26  27  28  29  31  32  33  34  35  36  37  38  39  40  41 </span>
<span class="co">#&gt;  39  38  44  37  34  42  45  37  40  43  47  34  38  35  34  45  30  27  37  45 </span>
<span class="co">#&gt;  42  43  44  45  46  47  48  49  50  51  52  53  54  55  56  57  58  59  60  61 </span>
<span class="co">#&gt;  41  35  34  35  14  37  38  15  42   8  43  31  42  38  33  45  43  42  44  32 </span>
<span class="co">#&gt;  62  63  64  65  66  67  68  69  70  71  72  73  74  75  76  77  78  79  80  81 </span>
<span class="co">#&gt;  36  25  37  42  33  34  44  30  38  42  36  41   7   8  27  37  38  40  47  22 </span>
<span class="co">#&gt;  82  83  84  85  86  87  88  89  90  91  92  93  94  95  96  97  98  99 100 101 </span>
<span class="co">#&gt;  24  38  17   6  11  38  46  34  43  30  32  39  36  40  39  47  39  31  18  40 </span>
<span class="co">#&gt; 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 </span>
<span class="co">#&gt;  45  44  41  38  41  41  27  44  44  32  33   6   6  47  36  45  25  17  30  32 </span>
<span class="co">#&gt; 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 </span>
<span class="co">#&gt;  34  13  43  47  37  41  27  39  48  32  37  48  37  33  31  31  42  44  44  44 </span>
<span class="co">#&gt; 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 </span>
<span class="co">#&gt;  10  32  27  24  41  42  25  32  15  41  10  26  43  35  27   9  33  32  28  44 </span>
<span class="co">#&gt; 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 </span>
<span class="co">#&gt;  48  37  26  35  31  35  39  14  42  40  35  29  30   7  33  34  29  30  33  24 </span>
<span class="co">#&gt; 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 </span>
<span class="co">#&gt;  28  29  48  16  21   7  36  34  20  35   8  33  44  42  33  26  24  30  32  31 </span>
<span class="co">#&gt; 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 </span>
<span class="co">#&gt;  33  37  26  14  24  39  33  40  36  41  38  39  30  31  50  46  40  36  33  19 </span>
<span class="co">#&gt; 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 </span>
<span class="co">#&gt;  54  35  17  36  40  30  47  46  41  42  44  28  40  19  38  40  28  35  31  17 </span>
<span class="co">#&gt; 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 </span>
<span class="co">#&gt;  35  41  19  32  37  38  45   9  39  15  14  34  38  18  17  10  28  12  10  26 </span>
<span class="co">#&gt; 262 263 264 265 266 267 </span>
<span class="co">#&gt;  30  30  32  12  45  50</span>
<span class="co"># Number of observations per species</span>
<span class="va">nobs_sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">PA_Birds</span>, <span class="fl">2</span>, <span class="va">sum</span><span class="op">)</span>
<span class="va">nobs_sp</span>
<span class="co">#&gt;            Anas platyrhynchos                 Milvus milvus </span>
<span class="co">#&gt;                            55                            95 </span>
<span class="co">#&gt;                Milvus migrans            Accipiter gentilis </span>
<span class="co">#&gt;                            87                            11 </span>
<span class="co">#&gt;               Accipiter nisus                   Buteo buteo </span>
<span class="co">#&gt;                            26                           152 </span>
<span class="co">#&gt;             Falco tinnunculus                 Tetrao tetrix </span>
<span class="co">#&gt;                           122                            49 </span>
<span class="co">#&gt;                  Lagopus muta                Bonasa bonasia </span>
<span class="co">#&gt;                            27                            13 </span>
<span class="co">#&gt;              Alectoris graeca                   Fulica atra </span>
<span class="co">#&gt;                            10                            14 </span>
<span class="co">#&gt;       Columba livia domestica                 Columba oenas </span>
<span class="co">#&gt;                            16                            20 </span>
<span class="co">#&gt;              Columba palumbus         Streptopelia decaocto </span>
<span class="co">#&gt;                           170                            30 </span>
<span class="co">#&gt;               Cuculus canorus                   Strix aluco </span>
<span class="co">#&gt;                           133                            19 </span>
<span class="co">#&gt;                     Apus apus                Jynx torquilla </span>
<span class="co">#&gt;                            55                            13 </span>
<span class="co">#&gt;                 Picus viridis             Dryocopus martius </span>
<span class="co">#&gt;                           114                           109 </span>
<span class="co">#&gt;             Dendrocopos major               Alauda arvensis </span>
<span class="co">#&gt;                           183                            48 </span>
<span class="co">#&gt;               Hirundo rustica        Ptyonoprogne rupestris </span>
<span class="co">#&gt;                            97                            32 </span>
<span class="co">#&gt;              Delichon urbicum               Oriolus oriolus </span>
<span class="co">#&gt;                            52                            15 </span>
<span class="co">#&gt;                  Corvus corax                 Corvus corone </span>
<span class="co">#&gt;                            89                           180 </span>
<span class="co">#&gt;                     Pica pica       Nucifraga caryocatactes </span>
<span class="co">#&gt;                            93                            67 </span>
<span class="co">#&gt;           Garrulus glandarius          Pyrrhocorax graculus </span>
<span class="co">#&gt;                           176                            42 </span>
<span class="co">#&gt;                   Parus major               Parus caeruleus </span>
<span class="co">#&gt;                           198                           163 </span>
<span class="co">#&gt;                    Parus ater               Parus cristatus </span>
<span class="co">#&gt;                           199                           151 </span>
<span class="co">#&gt;               Parus palustris                Parus montanus </span>
<span class="co">#&gt;                           123                           102 </span>
<span class="co">#&gt;           Aegithalos caudatus                Sitta europaea </span>
<span class="co">#&gt;                            70                           170 </span>
<span class="co">#&gt;            Certhia familiaris         Certhia brachydactyla </span>
<span class="co">#&gt;                           156                            88 </span>
<span class="co">#&gt;               Cinclus cinclus       Troglodytes troglodytes </span>
<span class="co">#&gt;                            32                           234 </span>
<span class="co">#&gt;            Erithacus rubecula          Phoenicurus ochruros </span>
<span class="co">#&gt;                           219                           244 </span>
<span class="co">#&gt;       Phoenicurus phoenicurus              Saxicola rubetra </span>
<span class="co">#&gt;                            61                            27 </span>
<span class="co">#&gt;             Oenanthe oenanthe           Monticola saxatilis </span>
<span class="co">#&gt;                            52                            11 </span>
<span class="co">#&gt;              Turdus torquatus                 Turdus merula </span>
<span class="co">#&gt;                            85                           223 </span>
<span class="co">#&gt;                Turdus pilaris             Turdus philomelos </span>
<span class="co">#&gt;                            88                           210 </span>
<span class="co">#&gt;             Turdus viscivorus        Acrocephalus palustris </span>
<span class="co">#&gt;                           190                            11 </span>
<span class="co">#&gt;            Sylvia atricapilla                  Sylvia borin </span>
<span class="co">#&gt;                           217                           101 </span>
<span class="co">#&gt;                Sylvia curruca        Phylloscopus trochilus </span>
<span class="co">#&gt;                            64                            15 </span>
<span class="co">#&gt;        Phylloscopus collybita          Phylloscopus bonelli </span>
<span class="co">#&gt;                           213                            67 </span>
<span class="co">#&gt;       Phylloscopus sibilatrix               Regulus regulus </span>
<span class="co">#&gt;                            35                           173 </span>
<span class="co">#&gt;           Regulus ignicapilla             Muscicapa striata </span>
<span class="co">#&gt;                           174                           107 </span>
<span class="co">#&gt;            Ficedula hypoleuca            Prunella modularis </span>
<span class="co">#&gt;                            51                           174 </span>
<span class="co">#&gt;             Prunella collaris              Anthus trivialis </span>
<span class="co">#&gt;                            36                            95 </span>
<span class="co">#&gt;             Anthus spinoletta                Motacilla alba </span>
<span class="co">#&gt;                            78                           185 </span>
<span class="co">#&gt;             Motacilla cinerea               Lanius collurio </span>
<span class="co">#&gt;                            77                            48 </span>
<span class="co">#&gt;              Sturnus vulgaris             Passer domesticus </span>
<span class="co">#&gt;                           108                           109 </span>
<span class="co">#&gt;               Passer montanus        Montifringilla nivalis </span>
<span class="co">#&gt;                            81                            24 </span>
<span class="co">#&gt; Coccothraustes coccothraustes             Carduelis chloris </span>
<span class="co">#&gt;                            41                           122 </span>
<span class="co">#&gt;           Carduelis carduelis              Carduelis spinus </span>
<span class="co">#&gt;                           116                            35 </span>
<span class="co">#&gt;           Carduelis cannabina             Carduelis cabaret </span>
<span class="co">#&gt;                            83                            49 </span>
<span class="co">#&gt;            Serinus citrinella               Serinus serinus </span>
<span class="co">#&gt;                            35                            75 </span>
<span class="co">#&gt;             Pyrrhula pyrrhula             Loxia curvirostra </span>
<span class="co">#&gt;                           112                            74 </span>
<span class="co">#&gt;             Fringilla coelebs           Emberiza citrinella </span>
<span class="co">#&gt;                           243                            95 </span>
<span class="co">#&gt;                  Emberiza cia </span>
<span class="co">#&gt;                            31</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="environmental-variables">
<span class="header-section-number">1.2</span> Environmental variables<a class="anchor" aria-label="anchor" href="#environmental-variables"></a>
</h3>
<p>The environmental variables are:</p>
<ul>
<li>
<strong>elev</strong>: the mean elevation of the quadrat (m).</li>
<li>
<strong>forest</strong>: the percentage of forest cover in the quadrat.</li>
<li>
<strong>rlength</strong>: the length of the route walked in the quadrat (km).</li>
</ul>
<p>As a first approach, we just select the ‚Äúelev‚Äù variable considering a quadratic orthogonal polynomial.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Normalized continuous variables</span>
<span class="va">Env_Birds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>elev<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">birds</span><span class="op">[</span>,<span class="st">"elev"</span><span class="op">]</span><span class="op">)</span>,elev2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">birds</span><span class="op">[</span>,<span class="st">"elev"</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Number of environmental variables plus intercept</span>
<span class="va">np</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">Env_Birds</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>
<span class="va">np</span>
<span class="co">#&gt; [1] 3</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="fitting-species-distribution-models-sdm">
<span class="header-section-number">2</span> Fitting species distribution models (SDM)<a class="anchor" aria-label="anchor" href="#fitting-species-distribution-models-sdm"></a>
</h2>
<div class="section level3">
<h3 id="definition-of-model">
<span class="header-section-number">2.1</span> Definition of model<a class="anchor" aria-label="anchor" href="#definition-of-model"></a>
</h3>
<p>We consider a simple generalized linear multivariate model (GLMM) to estimate the occurrence probabilities on sites for each species such as :</p>
<p><span class="math display">\[y_{ij} \sim \mathcal{B}ernoulli(\theta_{ij})\]</span></p>
<p><span class="math display">\[ \mathrm{g}(\theta_{ij}) = X_i\beta_j \]</span></p>
<ul>
<li>
<span class="math inline">\(\mathrm{g}(\cdot)\)</span>: Link function (probit or logit).</li>
<li>
<span class="math inline">\(X_i\)</span>: Vector of explanatory variables for site <span class="math inline">\(i\)</span> (including intercept).</li>
<li>
<span class="math inline">\(\beta_j\)</span>: Effects of the explanatory variables on the probability of presence of species <span class="math inline">\(j\)</span>.</li>
</ul>
<p>We consider below binomial models with a probit link. We want to compare the parameters of the SDMs fitted using <code>BayesComm</code> and <code>jSDM</code> packages.</p>
</div>
<div class="section level3">
<h3 id="using-bayescomm">
<span class="header-section-number">2.2</span> Using <code>BayesComm</code><a class="anchor" aria-label="anchor" href="#using-bayescomm"></a>
</h3>
<p>In a first step, we use the package <code>BayesComm</code> described in the article <span class="citation">(Golding, Nunn &amp; Purse <a href="#ref-Golding2015" role="doc-biblioref">2015</a>)</span> to fit binomial models with a probit link function.
The package <code>BayesComm</code> fits Bayesian multivariate binary (probit) regression models for analysis of ecological communities. These models can be used to make inference about underlying inter-species interactions in communities and to separate the effects of environmental covariates and inter-species interactions on community assembly.</p>
<div class="section level4">
<h4 id="parameters-inference">
<span class="header-section-number">2.2.1</span> Parameters inference<a class="anchor" aria-label="anchor" href="#parameters-inference"></a>
</h4>
<p>We estimate the parameters of the species distribution model (SDM) with the function <code><a href="https://rdrr.io/pkg/BayesComm/man/BC.html" class="external-link">BC()</a></code> and the argument <code>model="environment"</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">BayesComm</span><span class="op">)</span>
<span class="va">T1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">mod_BC</span> <span class="op">&lt;-</span> <span class="fu">BayesComm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/BayesComm/man/BC.html" class="external-link">BC</a></span><span class="op">(</span>Y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">)</span>, X<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">Env_Birds</span><span class="op">)</span>, model<span class="op">=</span><span class="st">"environment"</span>, its<span class="op">=</span><span class="fl">20000</span>, thin<span class="op">=</span><span class="fl">10</span>, burn<span class="op">=</span><span class="fl">10000</span><span class="op">)</span>
<span class="co"># Estimates</span>
<span class="va">beta_est_BC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>sp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">)</span>, intercept<span class="op">=</span><span class="cn">NA</span>, elev<span class="op">=</span><span class="cn">NA</span>,  elev2<span class="op">=</span><span class="cn">NA</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nsp</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">beta_est_BC</span><span class="op">[</span><span class="va">j</span>, <span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="va">np</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod_BC</span>, chain<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"B$"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">)</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">statistics</span><span class="op">[</span>, <span class="st">"Mean"</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>
<span class="co">#Z_BC &lt;- apply(mod_BC$trace$z,c(2,3), mean)</span>
<span class="va">T2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">T_BC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">T2</span>,<span class="va">T1</span><span class="op">)</span>

<span class="co"># Deviance BayesComm</span>
<span class="va">X1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">nsite</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">Env_Birds</span><span class="op">)</span><span class="op">)</span>
<span class="va">probit_theta_latent_BC</span> <span class="op">&lt;-</span> <span class="va">X1</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">beta_est_BC</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Deviance</span>
<span class="va">logL</span><span class="op">=</span><span class="fl">0</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nsite</span><span class="op">)</span><span class="op">{</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nsp</span><span class="op">)</span><span class="op">{</span>
    <span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="va">probit_theta_latent_BC</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span><span class="op">)</span>
    <span class="va">logL</span> <span class="op">=</span> <span class="va">logL</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">dbinom</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span>,<span class="fl">1</span>,<span class="va">theta</span>,<span class="fl">1</span><span class="op">)</span>  
  <span class="op">}</span>
<span class="op">}</span>
<span class="va">deviance_BC</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">2</span><span class="op">*</span><span class="va">logL</span>

<span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">mod_BC</span>, file<span class="op">=</span><span class="st">"SDM_JSDM_cache/BC.rda"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">beta_est_BC</span>, <span class="va">T_BC</span>, <span class="va">deviance_BC</span>,
     <span class="va">probit_theta_latent_BC</span>,
     file<span class="op">=</span><span class="st">"SDM_JSDM_files/BC.rda"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="evaluation-of-mcmc-convergence">
<span class="header-section-number">2.2.2</span> Evaluation of MCMC convergence<a class="anchor" aria-label="anchor" href="#evaluation-of-mcmc-convergence"></a>
</h4>
<div class="section level5">
<h5 id="representation-of-results">
<span class="header-section-number">2.2.2.1</span> Representation of results<a class="anchor" aria-label="anchor" href="#representation-of-results"></a>
</h5>
<p>We visually evaluate the convergence of MCMCs by representing the trace and density <em>a posteriori</em> of the estimated parameters.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">BayesComm</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"SDM_JSDM_cache/BC.rda"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, oma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">2</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mod_BC</span>, chain<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"B$"</span>,<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span>main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"species "</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, outer<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>Overall, the traces and the densities of the parameters indicate the convergence of the algorithm. Indeed, we observe on the traces that the values oscillate around averages without showing an upward or downward trend and we see that the densities are quite smooth and for the most part of Gaussian form.</p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="using-jsdm">
<span class="header-section-number">2.3</span> Using <code>jSDM</code><a class="anchor" aria-label="anchor" href="#using-jsdm"></a>
</h3>
<p>In a second step, we use the package <code>jSDM</code> to fit binomial models with a probit link.</p>
<div class="section level4">
<h4 id="parameters-inference-1">
<span class="header-section-number">2.3.1</span> Parameters inference<a class="anchor" aria-label="anchor" href="#parameters-inference-1"></a>
</h4>
<p>We estimate the parameters of the SDM with the function <code><a href="../reference/jSDM_binomial_probit.html">jSDM_binomial_probit()</a></code> and the argument <code>n_latent=0</code> set by default.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Load libraries</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RevolutionAnalytics/doparallel" class="external-link">doParallel</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RevolutionAnalytics/foreach" class="external-link">foreach</a></span><span class="op">)</span>

<span class="co">## Make a cluster for parallel MCMCs</span>
<span class="va">nchains</span> <span class="op">&lt;-</span> <span class="fl">2</span>
<span class="va">ncores</span> <span class="op">&lt;-</span> <span class="va">nchains</span> <span class="co">## One core for each MCMC chains</span>
<span class="va">clust</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">makeCluster</a></span><span class="op">(</span><span class="va">ncores</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/doParallel/man/registerDoParallel.html" class="external-link">registerDoParallel</a></span><span class="op">(</span><span class="va">clust</span><span class="op">)</span>

<span class="co"># Starting values for two chains</span>
<span class="va">beta_start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>
<span class="co">#formatting of starting parameters generated by the function </span>
<span class="co"># Seeds</span>
<span class="va">seed_mcmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1234</span>, <span class="fl">4321</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ecology.ghislainv.fr/jSDM/" class="external-link">jSDM</a></span><span class="op">)</span>
<span class="co"># Model with foreach and doPar call</span>
<span class="va">mod_probit</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/pkg/foreach/man/foreach.html" class="external-link">foreach</a></span> <span class="op">(</span>i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">nchains</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/foreach/man/foreach.html" class="external-link">%dopar%</a></span> <span class="op">{</span>
    <span class="co"># Infering model parameters</span>
    <span class="va">T1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>
    <span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">jSDM</span><span class="fu">::</span><span class="fu"><a href="../reference/jSDM_binomial_probit.html">jSDM_binomial_probit</a></span><span class="op">(</span>
      <span class="co"># Iterations</span>
      mcmc <span class="op">=</span> <span class="fl">10000</span>,
      thin <span class="op">=</span> <span class="fl">10</span>,
      burnin <span class="op">=</span> <span class="fl">10000</span>,
      <span class="co"># Data</span>
      presence_data <span class="op">=</span> <span class="va">PA_Birds</span>,
      site_data <span class="op">=</span> <span class="va">Env_Birds</span>,
      site_formula<span class="op">=</span><span class="op">~</span><span class="va">.</span>,
      <span class="co"># Priors</span>
      V_beta <span class="op">=</span><span class="fl">10</span>,
      mu_beta <span class="op">=</span> <span class="fl">0</span>,
      <span class="co"># Starting values</span>
      beta_start <span class="op">=</span> <span class="va">beta_start</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,
      <span class="co"># Other</span>
      seed <span class="op">=</span> <span class="va">seed_mcmc</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,
      verbose <span class="op">=</span> <span class="fl">0</span>
    <span class="op">)</span>
    <span class="va">T2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>
    <span class="va">mod</span><span class="op">$</span><span class="va">T_jSDM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">T2</span>,<span class="va">T1</span><span class="op">)</span>
    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span>
  <span class="op">}</span>

<span class="co"># Stop cluster</span>
<span class="co">#stopCluster(clust)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="evaluation-of-mcmc-convergence-1">
<span class="header-section-number">2.3.2</span> Evaluation of MCMC convergence<a class="anchor" aria-label="anchor" href="#evaluation-of-mcmc-convergence-1"></a>
</h4>
<div class="section level5">
<h5 id="the-gelmanrubin-convergence-diagnostic">
<span class="header-section-number">2.3.2.1</span> The Gelman‚ÄìRubin convergence diagnostic<a class="anchor" aria-label="anchor" href="#the-gelmanrubin-convergence-diagnostic"></a>
</h5>
<p><strong>Definition</strong>:</p>
<p>The Gelman‚ÄìRubin diagnostic evaluates MCMC convergence by analyzing the difference between multiple Markov chains. The convergence is assessed by comparing the estimated between-chains and within-chain variances for each model parameter. Large differences between these variances indicate non-convergence. See <span class="citation">Gelman &amp; Rubin (<a href="#ref-Gelman1992" role="doc-biblioref">1992</a>)</span> and <span class="citation">Brooks &amp; Gelman (<a href="#ref-Brooks1998" role="doc-biblioref">1998</a>)</span> for the detailed description of the method.</p>
<p>Suppose we have <span class="math inline">\(M\)</span> chains, each of length <span class="math inline">\(N\)</span>, although the chains may be of different lengths. The same-length assumption simplifies the formulas and is used for convenience. For a model parameter <span class="math inline">\(\theta\)</span>, let <span class="math inline">\(\left(\theta_{ùëöt}\right)_{t=1}^N\)</span> be the <span class="math inline">\(ùëö\)</span>th simulated chain, <span class="math inline">\(ùëö=1,\dots,ùëÄ\)</span>. Let <span class="math inline">\(\hat{\theta}_ùëö=\frac{1}{N}\sum\limits_{t=1}^N \hat{\theta}_{mt}\)</span> and <span class="math inline">\(\hat{\sigma}^2_ùëö=\frac{1}{N-1}\sum\limits_{t=1}^N (\hat{\theta}_{mt}-\hat{\theta}_ùëö)^2\)</span> be the sample posterior mean and variance of the <span class="math inline">\(ùëö\)</span>th chain, and let the overall sample posterior mean be <span class="math inline">\(\hat{\theta}=\frac{1}{ùëÄ}\sum\limits_{m=1}^ùëÄ \hat{\theta}_m\)</span>.</p>
<p>The between-chains and within-chain variances are given by
<span class="math display">\[B=\frac{N}{M-1}\sum\limits_{m=1}^ùëÄ (\hat{\theta}_m - \hat{\theta})^2\]</span>
<span class="math display">\[W=\frac{1}{M}\sum\limits_{m=1}^ùëÄ\hat{\sigma}^2_m\]</span></p>
<p>Under certain stationarity conditions, the pooled variance :</p>
<p><span class="math display">\[\hat{V}=\frac{N-1}{N}W + \frac{M+1}{MN}B\]</span></p>
<p>is an unbiased estimator of the marginal posterior variance of <span class="math inline">\(\theta\)</span> (<span class="citation">Gelman &amp; Rubin (<a href="#ref-Gelman1992" role="doc-biblioref">1992</a>)</span>). The potential scale reduction factor (PSRF) is defined to be the ratio of <span class="math inline">\(\hat{ùëâ}\)</span> and <span class="math inline">\(ùëä\)</span>. If the <span class="math inline">\(ùëÄ\)</span> chains have converged to the target posterior distribution, then PSRF should be close to 1. The article <span class="citation">Brooks &amp; Gelman (<a href="#ref-Brooks1998" role="doc-biblioref">1998</a>)</span> corrected the original PSRF by accounting for sampling variability as follows:
<span class="math display">\[ \hat{R}= \sqrt{\frac{\hat{d}+3}{\hat{d}+1}\frac{\hat{V}}{W}}\]</span></p>
<p>where <span class="math inline">\(\hat{d}\)</span> is the degrees of freedom estimate of a <span class="math inline">\(ùë°\)</span> distribution.</p>
<p>PSRF estimates the potential decrease in the between-chains variability <span class="math inline">\(ùêµ\)</span> with respect to the within-chain variability <span class="math inline">\(ùëä\)</span>. If <span class="math inline">\(\hat{R}\)</span> is large, then longer simulation sequences are expected to either decrease <span class="math inline">\(ùêµ\)</span> or increase <span class="math inline">\(ùëä\)</span> because the simulations have not yet explored the full posterior distribution. As the article <span class="citation">Brooks &amp; Gelman (<a href="#ref-Brooks1998" role="doc-biblioref">1998</a>)</span> have suggested, if <span class="math inline">\(\hat{R} &lt; 1.2\)</span> for all model parameters, one can be fairly confident that convergence has been reached. Otherwise, longer chains or other means for improving the convergence may be needed. Even more reassuring is to apply the more stringent condition <span class="math inline">\(\hat{R} &lt; 1.1\)</span>.</p>
<p><strong>Compute <span class="math inline">\(\hat{R}\)</span></strong>:</p>
<p>We evaluate the convergence of the MCMC output in which two parallel chains are run (with starting values that are over dispersed relative to the posterior distribution).
Convergence is diagnosed when the four chains have ‚Äòforgotten‚Äô their initial values, and the output from all chains is indistinguishable.
If the convergence diagnostic gives values of potential scale reduction factor (PSRF) or <span class="math inline">\(\hat{R}\)</span> substantially above 1, its indicates lack of convergence.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">burnin</span> <span class="op">&lt;-</span> <span class="va">mod_probit</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">model_spec</span><span class="op">$</span><span class="va">burnin</span>
<span class="va">ngibbs</span> <span class="op">&lt;-</span> <span class="va">burnin</span> <span class="op">+</span> <span class="va">mod_probit</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">model_spec</span><span class="op">$</span><span class="va">mcmc</span>
<span class="va">thin</span> <span class="op">&lt;-</span>  <span class="va">mod_probit</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">model_spec</span><span class="op">$</span><span class="va">thin</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va">coda</span><span class="op">)</span>
<span class="va">arr2mcmc</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html" class="external-link">mcmc</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,
              start<span class="op">=</span><span class="va">burnin</span><span class="op">+</span><span class="fl">1</span> , end<span class="op">=</span><span class="va">ngibbs</span>, thin<span class="op">=</span><span class="va">thin</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="co"># MCMC lists</span>
<span class="va">mcmc_list_param</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.list.html" class="external-link">mcmc.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">mod_probit</span>,<span class="st">"[["</span>,<span class="st">"mcmc.sp"</span><span class="op">)</span>, <span class="va">arr2mcmc</span><span class="op">)</span><span class="op">)</span>
<span class="va">mcmc_list_beta0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.list.html" class="external-link">mcmc.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">mcmc_list_param</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"Intercept"</span>, 
                                                           <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mcmc_list_param</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
                                                           value<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span>, <span class="va">arr2mcmc</span><span class="op">)</span><span class="op">)</span>
<span class="co"># psrf gelman indice </span>
<span class="va">psrf_beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/gelman.diag.html" class="external-link">gelman.diag</a></span><span class="op">(</span><span class="va">mcmc_list_param</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"Intercept"</span>,
                                                     <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mcmc_list_param</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
                                                     invert<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span>,
                              multivariate<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">psrf</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span>
<span class="va">psrf_beta0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/gelman.diag.html" class="external-link">gelman.diag</a></span><span class="op">(</span><span class="va">mcmc_list_beta0</span>, multivariate<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">psrf</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span>

<span class="va">Rhat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Rhat<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">psrf_beta</span>, <span class="va">psrf_beta0</span><span class="op">)</span>,
                   Variable<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"beta"</span>, <span class="st">"beta0"</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Barplot</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">Rhat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Variable</span>, y<span class="op">=</span><span class="va">Rhat</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Averages of Rhat obtained for species effect"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span>, size<span class="op">=</span><span class="fl">14</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"skyblue"</span>, stat <span class="op">=</span> <span class="st">"identity"</span>, width<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">Rhat</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span>, vjust<span class="op">=</span><span class="fl">0</span>, hjust<span class="op">=</span><span class="op">-</span><span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept<span class="op">=</span><span class="fl">1</span>, color<span class="op">=</span><span class="st">'red'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">Rhat</span><span class="op">$</span><span class="va">Rhat</span><span class="op">)</span><span class="op">+</span><span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">12</span><span class="op">)</span>,
        axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">12</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">11</span><span class="op">)</span>,
        axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">11</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span> </code></pre></div>
<p><img src="SDM_JSDM_files/figure-html/MCMC-convergence-SDM-1.png" width="700" style="display: block; margin: auto;"></p>
<p>We can see that the <span class="math inline">\(\hat{R}\)</span> are very close to 1 for the species effects <span class="math inline">\(\beta\)</span> and the species intercept <span class="math inline">\(\beta_0\)</span>. We can therefore be fairly confident that convergence has been achieved for these parameters.</p>
</div>
<div class="section level5">
<h5 id="representation-of-results-1">
<span class="header-section-number">2.3.2.2</span> Representation of results<a class="anchor" aria-label="anchor" href="#representation-of-results-1"></a>
</h5>
<p>Overview of the results :</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># Output</span>
<span class="va">n_chains</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mod_probit</span><span class="op">)</span>
<span class="va">mod_jSDM</span> <span class="op">&lt;-</span> <span class="va">mod_probit</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="va">str_jSDM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/capture.output.html" class="external-link">capture.output</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">mod_jSDM</span>, max.level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, collapse<span class="op">=</span><span class="st">"\n"</span><span class="op">)</span>
<span class="co"># Fitted values</span>
<span class="va">beta_jSDM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">mod_jSDM</span><span class="op">$</span><span class="va">mcmc.sp</span>, <span class="va">colMeans</span><span class="op">)</span>
<span class="co">#Z_latent_jSDM &lt;- mod_jSDM$Z_latent</span>
<span class="va">probit_theta_jSDM</span> <span class="op">&lt;-</span> <span class="va">mod_jSDM</span><span class="op">$</span><span class="va">probit_theta_latent</span>
<span class="va">deviance_jSDM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mod_jSDM</span><span class="op">$</span><span class="va">mcmc.Deviance</span><span class="op">)</span>
<span class="va">T_jSDM</span> <span class="op">&lt;-</span> <span class="va">mod_jSDM</span><span class="op">$</span><span class="va">T_jSDM</span> 
<span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">T_jSDM</span>, <span class="va">n_chains</span>, <span class="va">str_jSDM</span>, <span class="va">beta_jSDM</span>, <span class="va">probit_theta_jSDM</span>, <span class="va">deviance_jSDM</span>, 
     file<span class="op">=</span><span class="st">"SDM_JSDM_files/jSDM.rda"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">#&gt; number of chains : 2</span>
<span class="co">#&gt; content of each chain : List of 7</span>
<span class="co">#&gt;  $ mcmc.Deviance      : 'mcmc' num [1:1000, 1] 17762 17805 17823 17782 17812 ...</span>
<span class="co">#&gt;   ..- attr(*, "mcpar")= num [1:3] 10001 19991 10</span>
<span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;  $ mcmc.sp            :List of 93</span>
<span class="co">#&gt;  $ Z_latent           : num [1:266, 1:93] -0.745 -0.732 0.458 -1.388 -1.741 ...</span>
<span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;  $ probit_theta_latent: num [1:266, 1:93] 0.175 0.175 -1.374 -1.173 -1.552 ...</span>
<span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;  $ theta_latent       : num [1:266, 1:93] 0.5689 0.5689 0.0877 0.1231 0.0634 ...</span>
<span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;  $ model_spec         :List of 15</span>
<span class="co">#&gt;  $ T_jSDM             : 'difftime' num 54.7729182243347</span>
<span class="co">#&gt;   ..- attr(*, "units")= chr "secs"</span>
<span class="co">#&gt;  - attr(*, "class")= chr "jSDM"</span></code></pre>
<p>We can also visually evaluate the convergence of MCMCs by representing the trace and density <em>a posteriori</em> of the estimated parameters.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, oma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">2</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mcmc_list_param</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"Milvus.milvus.beta"</span>,<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mcmc_list_param</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span>main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"species "</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, outer<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="SDM_JSDM_files/figure-html/plot-jSDM-1.png" width="600" style="display: block; margin: auto;"></p>
<p>Overall, the traces and the densities of the parameters indicate the convergence of the algorithm. Indeed, we observe on the traces that the values oscillate around averages without showing an upward or downward trend and we see that the densities are quite smooth and for the most part of Gaussian form.</p>
</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="fitting-joint-species-distribution-models-jsdm">
<span class="header-section-number">3</span> Fitting joint species distribution models (JSDM)<a class="anchor" aria-label="anchor" href="#fitting-joint-species-distribution-models-jsdm"></a>
</h2>
<p>We consider a latent variable model (LVM) to account for species co-occurrence on all sites <span class="citation">(Warton <em>et al.</em> <a href="#ref-Warton2015" role="doc-biblioref">2015</a>)</span> in the <code>jSDM</code> package, such as :</p>
<p><span class="math display">\[y_{ij} \sim \mathcal{B}ernoulli(\theta_{ij})\]</span></p>
<p><span class="math display">\[ \mathrm{g}(\theta_{ij}) = X_i\beta_j + W_i\lambda_j \]</span></p>
<ul>
<li>
<span class="math inline">\(\mathrm{g}(\cdot)\)</span>: Link function (probit or logit).</li>
<li>
<span class="math inline">\(X_i\)</span>: Vector of explanatory variables for site <span class="math inline">\(i\)</span> (including intercept).</li>
<li>
<span class="math inline">\(\beta_j\)</span>: Effects of the explanatory variables on the probability of presence of species <span class="math inline">\(j\)</span>.</li>
<li>
<span class="math inline">\(W_i\)</span>: Vector of random latent variables for site <span class="math inline">\(i\)</span>. <span class="math inline">\(W_i \sim N(0, 1)\)</span>. The number of latent variables must be fixed by the user (default to 2).</li>
<li>
<span class="math inline">\(\lambda_j\)</span>: Effects of the latent variables on the probability of presence of species <span class="math inline">\(j\)</span>. Also known as ‚Äúfactor loadings‚Äù <span class="citation">(Warton <em>et al.</em> <a href="#ref-Warton2015" role="doc-biblioref">2015</a>)</span>.</li>
</ul>
<p>This model is equivalent to the generalized linear multivariate model (GLMM) <span class="math inline">\(\mathrm{g}(\theta_{ij}) =\alpha_i + X_i.\beta_j + u_{ij}\)</span>, where <span class="math inline">\(u_{ij} \sim \mathcal{N}(0, \Sigma)\)</span> considered in the <code>BayesComm</code> package, with the constraint that the variance-covariance matrix <span class="math inline">\(\Sigma = \Lambda \Lambda^{\prime}\)</span>, where <span class="math inline">\(\Lambda\)</span> is the full matrix of factor loadings, with the <span class="math inline">\(\lambda_j\)</span> as its columns.</p>
<p>We consider below binomial models with a probit link.</p>
<div class="section level3">
<h3 id="using-bayescomm-1">
<span class="header-section-number">3.1</span> Using <code>BayesComm</code><a class="anchor" aria-label="anchor" href="#using-bayescomm-1"></a>
</h3>
<div class="section level4">
<h4 id="parameters-inference-2">
<span class="header-section-number">3.1.1</span> Parameters inference<a class="anchor" aria-label="anchor" href="#parameters-inference-2"></a>
</h4>
<p>We estimate the parameters of the JSDM with the function <code><a href="https://rdrr.io/pkg/BayesComm/man/BC.html" class="external-link">BC()</a></code> and the argument <code>model="full"</code> (intercept, covariates and community matrix).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">T1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">mod_BC_comm</span> <span class="op">&lt;-</span> <span class="fu">BayesComm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/BayesComm/man/BC.html" class="external-link">BC</a></span><span class="op">(</span>Y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">)</span>, X<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">Env_Birds</span><span class="op">)</span>, 
                             model<span class="op">=</span><span class="st">"full"</span>, its<span class="op">=</span><span class="fl">20000</span>, thin<span class="op">=</span><span class="fl">10</span>, burn<span class="op">=</span><span class="fl">10000</span><span class="op">)</span>
<span class="co"># Estimates</span>
<span class="va">beta_est_BC_comm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>sp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">)</span>, intercept<span class="op">=</span><span class="cn">NA</span>, elev<span class="op">=</span><span class="cn">NA</span>, elev2<span class="op">=</span><span class="cn">NA</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nsp</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">beta_est_BC_comm</span><span class="op">[</span><span class="va">j</span>, <span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="va">np</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod_BC_comm</span>,
                                                      chain<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"B$"</span>, 
                                                                   <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">)</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">statistics</span><span class="op">[</span>, <span class="st">"Mean"</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>
<span class="co">#Z_BayesComm_com &lt;- apply(mod_BC_comm$trace$z,c(2,3), mean)</span>
<span class="va">T2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">T_BC_comm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">T2</span>,<span class="va">T1</span><span class="op">)</span>

<span class="co"># Deviance BayesComm</span>
<span class="va">X1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">nsite</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">Env_Birds</span><span class="op">)</span><span class="op">)</span>
<span class="va">e</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">mod_BC_comm</span><span class="op">)</span>
<span class="va">probit_theta_latent_BC_comm</span> <span class="op">&lt;-</span> <span class="va">X1</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">beta_est_BC_comm</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="va">e</span>
<span class="co"># Deviance</span>
<span class="va">logL</span><span class="op">=</span><span class="fl">0</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nsite</span><span class="op">)</span><span class="op">{</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nsp</span><span class="op">)</span><span class="op">{</span>
    <span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="va">probit_theta_latent_BC_comm</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span><span class="op">)</span>
    <span class="va">logL</span> <span class="op">=</span> <span class="va">logL</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">dbinom</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span>,<span class="fl">1</span>,<span class="va">theta</span>,<span class="fl">1</span><span class="op">)</span>  
  <span class="op">}</span>
<span class="op">}</span>
<span class="va">deviance_BC_comm</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">2</span><span class="op">*</span><span class="va">logL</span>

<span class="co"># Correlation matrix</span>
<span class="va">R</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">mod_BC_comm</span><span class="op">$</span><span class="va">trace</span><span class="op">$</span><span class="va">R</span>,<span class="fl">2</span>,<span class="va">mean</span><span class="op">)</span>
<span class="va">R_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">nsp</span>,<span class="va">nsp</span><span class="op">)</span>
<span class="va">species</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">R_mat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">R_mat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">species</span>
<span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nsp</span><span class="op">)</span><span class="op">{</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">jprim</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nsp</span><span class="op">)</span><span class="op">{</span>
    <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">species</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>,<span class="st">"_"</span>,<span class="va">species</span><span class="op">[</span><span class="va">jprim</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">R</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">!=</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span>
      <span class="va">R_mat</span><span class="op">[</span><span class="va">j</span>,<span class="va">jprim</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">R_mat</span><span class="op">[</span><span class="va">jprim</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="va">R</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">species</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>,<span class="st">"_"</span>,<span class="va">species</span><span class="op">[</span><span class="va">jprim</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">R</span><span class="op">)</span><span class="op">)</span> <span class="op">]</span>  
    <span class="op">}</span>
  <span class="op">}</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">mod_BC_comm</span>, file<span class="op">=</span><span class="st">"SDM_JSDM_cache/BC_comm.rda"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">beta_est_BC_comm</span>, <span class="va">T_BC_comm</span>, <span class="va">R_mat</span>,
     <span class="va">deviance_BC_comm</span>, <span class="va">probit_theta_latent_BC_comm</span>,
     file<span class="op">=</span><span class="st">"SDM_JSDM_files/BC_comm.rda"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="evaluation-of-mcmc-convergence-2">
<span class="header-section-number">3.1.2</span> Evaluation of MCMC convergence<a class="anchor" aria-label="anchor" href="#evaluation-of-mcmc-convergence-2"></a>
</h4>
<div class="section level5">
<h5 id="representation-of-results-2">
<span class="header-section-number">3.1.2.1</span> Representation of results<a class="anchor" aria-label="anchor" href="#representation-of-results-2"></a>
</h5>
<p>We visually evaluate the convergence of MCMCs by representing the trace and density <em>a posteriori</em> of the estimated parameters.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"SDM_JSDM_cache/BC_comm.rda"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, oma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">2</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mod_BC_comm</span>, chain<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"B$"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span>main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"species "</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, outer<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="SDM_JSDM_files/figure-html/plot-BC_comm-1.png" width="600" style="display: block; margin: auto;"></p>
<p>Overall, the traces and the densities of the parameters indicate the convergence of the algorithm. Indeed, we observe on the traces that the values oscillate around averages without showing an upward or downward trend and we see that the densities are quite smooth and for the most part of Gaussian form.</p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="using-jsdm-1">
<span class="header-section-number">3.2</span> Using <code>jSDM</code><a class="anchor" aria-label="anchor" href="#using-jsdm-1"></a>
</h3>
<div class="section level4">
<h4 id="parameters-inference-3">
<span class="header-section-number">3.2.1</span> Parameters inference<a class="anchor" aria-label="anchor" href="#parameters-inference-3"></a>
</h4>
<p>We estimate the latent variables model parameters with the function <code><a href="../reference/jSDM_binomial_probit.html">jSDM_binomial_probit()</a></code> and the argument <code>n_latent=2</code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">parallel</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RevolutionAnalytics/doparallel" class="external-link">doParallel</a></span><span class="op">)</span>
<span class="co">## Make a cluster for parallel MCMCs</span>
<span class="va">nchains</span> <span class="op">&lt;-</span> <span class="fl">2</span>
<span class="va">ncores</span> <span class="op">&lt;-</span> <span class="va">nchains</span> <span class="co">## One core for each MCMC chains</span>
<span class="va">clust</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">makeCluster</a></span><span class="op">(</span><span class="va">ncores</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/doParallel/man/registerDoParallel.html" class="external-link">registerDoParallel</a></span><span class="op">(</span><span class="va">clust</span><span class="op">)</span>

<span class="co"># Starting parameters </span>
<span class="va">n_latent</span> <span class="op">&lt;-</span> <span class="fl">2</span> 
<span class="va">beta_start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>
<span class="va">lambda_start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>
<span class="va">W_start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_latent</span><span class="op">*</span><span class="va">nsite</span><span class="op">)</span>, <span class="va">nsite</span><span class="op">)</span>,
                <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_latent</span><span class="op">*</span><span class="va">nsite</span><span class="op">)</span>, <span class="va">nsite</span><span class="op">)</span><span class="op">)</span>
<span class="co">#formatting of starting parameters</span>
<span class="co">#and constraints on lambda generated by the function </span>
<span class="co"># Seeds</span>
<span class="va">seed_mcmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1234</span>, <span class="fl">4321</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Model</span>
<span class="va">mod_probit_lv</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/pkg/foreach/man/foreach.html" class="external-link">foreach</a></span> <span class="op">(</span>i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">nchains</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/foreach/man/foreach.html" class="external-link">%dopar%</a></span> <span class="op">{</span>
    <span class="co"># Infering model parameters</span>
    <span class="va">T1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>
    <span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">jSDM</span><span class="fu">::</span><span class="fu"><a href="../reference/jSDM_binomial_probit.html">jSDM_binomial_probit</a></span><span class="op">(</span>
      <span class="co"># Iterations</span>
      burnin<span class="op">=</span><span class="fl">10000</span>, mcmc<span class="op">=</span><span class="fl">10000</span>, thin<span class="op">=</span><span class="fl">10</span>,
      <span class="co"># Data</span>
      presence_data<span class="op">=</span><span class="va">PA_Birds</span>,
      site_data <span class="op">=</span> <span class="va">Env_Birds</span>,
      site_formula <span class="op">=</span> <span class="op">~</span><span class="va">.</span>,
      <span class="co"># Model specification </span>
      n_latent<span class="op">=</span><span class="fl">2</span>,
      site_effect<span class="op">=</span><span class="st">"none"</span>,
      <span class="co"># Priors</span>
      V_beta <span class="op">=</span><span class="fl">10</span>,
      mu_beta <span class="op">=</span> <span class="fl">0</span>,
      mu_lambda <span class="op">=</span> <span class="fl">0</span>,
      V_lambda<span class="op">=</span> <span class="fl">10</span>,
      <span class="co"># Starting values</span>
      beta_start <span class="op">=</span> <span class="va">beta_start</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,
      lambda_start <span class="op">=</span> <span class="va">lambda_start</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,
      W_start <span class="op">=</span> <span class="va">W_start</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,
      <span class="co"># Other</span>
      seed <span class="op">=</span> <span class="va">seed_mcmc</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,
      verbose <span class="op">=</span> <span class="fl">0</span>
    <span class="op">)</span>
    <span class="va">T2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>
    <span class="va">mod</span><span class="op">$</span><span class="va">T_jSDM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">T2</span>,<span class="va">T1</span><span class="op">)</span>
    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span>
  <span class="op">}</span>
<span class="co"># Stop cluster</span>
<span class="co">#stopCluster(clust)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="evaluation-of-mcmc-convergence-3">
<span class="header-section-number">3.2.2</span> Evaluation of MCMC convergence<a class="anchor" aria-label="anchor" href="#evaluation-of-mcmc-convergence-3"></a>
</h4>
<div class="section level5">
<h5 id="the-gelmanrubin-convergence-diagnostic-1">
<span class="header-section-number">3.2.2.1</span> The Gelman‚ÄìRubin convergence diagnostic<a class="anchor" aria-label="anchor" href="#the-gelmanrubin-convergence-diagnostic-1"></a>
</h5>
<p><strong>Compute <span class="math inline">\(\hat{R}\)</span></strong>:</p>
<p>We evaluate the convergence of the MCMC output in which two parallel chains are run (with starting values that are over dispersed relative to the posterior distribution).
Convergence is diagnosed when the four chains have ‚Äòforgotten‚Äô their initial values, and the output from all chains is indistinguishable.
If the convergence diagnostic gives values of potential scale reduction factor (PSRF) or <span class="math inline">\(\hat{R}\)</span> substantially above 1, its indicates lack of convergence.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">burnin</span> <span class="op">&lt;-</span> <span class="va">mod_probit_lv</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">model_spec</span><span class="op">$</span><span class="va">burnin</span>
<span class="va">ngibbs</span> <span class="op">&lt;-</span> <span class="va">burnin</span> <span class="op">+</span> <span class="va">mod_probit_lv</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">model_spec</span><span class="op">$</span><span class="va">mcmc</span>
<span class="va">thin</span> <span class="op">&lt;-</span>  <span class="va">mod_probit_lv</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">model_spec</span><span class="op">$</span><span class="va">thin</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va">coda</span><span class="op">)</span>
<span class="va">arr2mcmc</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html" class="external-link">mcmc</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,
              start<span class="op">=</span><span class="va">burnin</span><span class="op">+</span><span class="fl">1</span> , end<span class="op">=</span><span class="va">ngibbs</span>, thin<span class="op">=</span><span class="va">thin</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="co"># MCMC lists</span>
<span class="va">mcmc_list_param</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.list.html" class="external-link">mcmc.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">mod_probit_lv</span>,<span class="st">"[["</span>,<span class="st">"mcmc.sp"</span><span class="op">)</span>, <span class="va">arr2mcmc</span><span class="op">)</span><span class="op">)</span>
<span class="va">mcmc_list_lambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.list.html" class="external-link">mcmc.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">mcmc_list_param</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"lambda"</span>,
                                                            <span class="fu"><a href="https://rdrr.io/pkg/coda/man/varnames.html" class="external-link">varnames</a></span><span class="op">(</span><span class="va">mcmc_list_param</span><span class="op">)</span>,
                                                            value<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span>, <span class="va">arr2mcmc</span><span class="op">)</span><span class="op">)</span>
<span class="va">mcmc_list_lv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.list.html" class="external-link">mcmc.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">mod_probit_lv</span>,
                                        <span class="st">"[["</span>,<span class="st">"mcmc.latent"</span><span class="op">)</span>, <span class="va">arr2mcmc</span><span class="op">)</span><span class="op">)</span>
<span class="va">mcmc_list_beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.list.html" class="external-link">mcmc.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">mcmc_list_param</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"beta"</span>,
                                                          <span class="fu"><a href="https://rdrr.io/pkg/coda/man/varnames.html" class="external-link">varnames</a></span><span class="op">(</span><span class="va">mcmc_list_param</span><span class="op">)</span>,
                                                          value<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span>, <span class="va">arr2mcmc</span><span class="op">)</span><span class="op">)</span>
<span class="va">mcmc_list_beta0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.list.html" class="external-link">mcmc.list</a></span><span class="op">(</span><span class="va">mcmc_list_beta</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"Intercept"</span>, 
                                                   <span class="fu"><a href="https://rdrr.io/pkg/coda/man/varnames.html" class="external-link">varnames</a></span><span class="op">(</span><span class="va">mcmc_list_beta</span><span class="op">)</span>,
                                                   value<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="co"># psrf gelman indice </span>
<span class="va">psrf_beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/gelman.diag.html" class="external-link">gelman.diag</a></span><span class="op">(</span><span class="va">mcmc_list_beta</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"Intercept"</span>,
                                                     <span class="fu"><a href="https://rdrr.io/pkg/coda/man/varnames.html" class="external-link">varnames</a></span><span class="op">(</span><span class="va">mcmc_list_beta</span><span class="op">)</span>,
                                                     invert<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span>,
                              multivariate<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">psrf</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span>
<span class="va">psrf_beta0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/gelman.diag.html" class="external-link">gelman.diag</a></span><span class="op">(</span><span class="va">mcmc_list_beta0</span>, multivariate<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">psrf</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span>

<span class="va">psrf_lambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/gelman.diag.html" class="external-link">gelman.diag</a></span><span class="op">(</span><span class="va">mcmc_list_lambda</span>,
                                multivariate<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">psrf</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="va">psrf_lv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/gelman.diag.html" class="external-link">gelman.diag</a></span><span class="op">(</span><span class="va">mcmc_list_lv</span>,
                            multivariate<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">psrf</span><span class="op">[</span>,<span class="fl">2</span> <span class="op">]</span><span class="op">)</span>
<span class="va">Rhat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Rhat<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">psrf_beta0</span>, <span class="va">psrf_beta</span>, <span class="va">psrf_lambda</span>, <span class="va">psrf_lv</span><span class="op">)</span>,
                   Variable<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"beta0"</span>, <span class="st">"beta"</span>, <span class="st">"lambda"</span>, <span class="st">"W"</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Barplot</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">Rhat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Variable</span>, y<span class="op">=</span><span class="va">Rhat</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Averages of Rhat obtained for each type of parameter"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span>, size<span class="op">=</span><span class="fl">12</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"skyblue"</span>, stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">Rhat</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span>, vjust<span class="op">=</span><span class="fl">0</span>, hjust<span class="op">=</span><span class="op">-</span><span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept<span class="op">=</span><span class="fl">1</span>, color<span class="op">=</span><span class="st">'red'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">Rhat</span><span class="op">$</span><span class="va">Rhat</span><span class="op">)</span><span class="op">+</span><span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">margin</a></span><span class="op">(</span>t <span class="op">=</span> <span class="fl">0.1</span>, r <span class="op">=</span> <span class="fl">0.2</span>, b <span class="op">=</span> <span class="fl">0.1</span>, l <span class="op">=</span> <span class="fl">0.2</span>,<span class="st">"cm"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span> </code></pre></div>
<p><img src="SDM_JSDM_files/figure-html/MCMC-convergence-JSDM-1.png" width="700" style="display: block; margin: auto;"></p>
<p>We can see that the <span class="math inline">\(\hat{R}\)</span> are very close to 1 for the species effects <span class="math inline">\(\beta\)</span> and the species intercept <span class="math inline">\(\beta_0\)</span>. We can therefore be fairly confident that convergence has been achieved for these parameters.<br>
The <span class="math inline">\(\hat{R}\)</span> obtained for the latent variables <span class="math inline">\(W\)</span> and the factor loadings <span class="math inline">\(\lambda\)</span> are also pretty close to 1, indicating that convergence has been reached for these parameters.</p>
</div>
<div class="section level5">
<h5 id="representation-of-results-3">
<span class="header-section-number">3.2.2.2</span> Representation of results<a class="anchor" aria-label="anchor" href="#representation-of-results-3"></a>
</h5>
<p>Overview of the results :</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># Output</span>
<span class="va">n_chains</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mod_probit_lv</span><span class="op">)</span>
<span class="va">mod_jSDM_lv</span> <span class="op">&lt;-</span> <span class="va">mod_probit_lv</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="va">str_jSDM_lv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/capture.output.html" class="external-link">capture.output</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">mod_jSDM_lv</span>, max.level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, collapse<span class="op">=</span><span class="st">"\n"</span><span class="op">)</span>
<span class="co"># Fitted values</span>
<span class="va">param_jSDM_lv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">mod_jSDM_lv</span><span class="op">$</span><span class="va">mcmc.sp</span>, <span class="va">colMeans</span><span class="op">)</span>
<span class="co">#Z_latent_jSDM_lv &lt;- mod_jSDM_lv$Z_latent</span>
<span class="va">probit_theta_jSDM_lv</span> <span class="op">&lt;-</span> <span class="va">mod_jSDM_lv</span><span class="op">$</span><span class="va">probit_theta_latent</span>
<span class="va">deviance_jSDM_lv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mod_jSDM_lv</span><span class="op">$</span><span class="va">mcmc.Deviance</span><span class="op">)</span>
<span class="va">T_jSDM_lv</span> <span class="op">&lt;-</span> <span class="va">mod_jSDM_lv</span><span class="op">$</span><span class="va">T_jSDM</span>
<span class="va">residual_corr_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_residual_cor.html">get_residual_cor</a></span><span class="op">(</span><span class="va">mod_jSDM_lv</span><span class="op">)</span><span class="op">$</span><span class="va">cor.mean</span>
<span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">T_jSDM_lv</span>, <span class="va">n_chains</span>, <span class="va">str_jSDM_lv</span>, <span class="va">param_jSDM_lv</span>, <span class="va">probit_theta_jSDM_lv</span>, <span class="va">deviance_jSDM_lv</span>, <span class="va">residual_corr_mat</span>, 
     file<span class="op">=</span><span class="st">"SDM_JSDM_files/jSDM_lv.rda"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"SDM_JSDM_files/jSDM_lv.rda"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"number of chains :"</span>, <span class="va">n_chains</span>,<span class="st">"\n"</span><span class="op">)</span>
<span class="co">#&gt; number of chains : 2</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"content of each chain :"</span>, <span class="va">str_jSDM_lv</span>,<span class="st">"\n"</span><span class="op">)</span>
<span class="co">#&gt; content of each chain : List of 8</span>
<span class="co">#&gt;  $ mcmc.Deviance      : 'mcmc' num [1:1000, 1] 14762 14827 14802 14851 14806 ...</span>
<span class="co">#&gt;   ..- attr(*, "mcpar")= num [1:3] 10001 19991 10</span>
<span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;  $ mcmc.sp            :List of 93</span>
<span class="co">#&gt;  $ mcmc.latent        :List of 2</span>
<span class="co">#&gt;  $ Z_latent           : num [1:266, 1:93] -0.694 -0.796 0.494 -1.343 -1.54 ...</span>
<span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;  $ probit_theta_latent: num [1:266, 1:93] 0.2704 0.0943 -1.2707 -1.041 -1.3303 ...</span>
<span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;  $ theta_latent       : num [1:266, 1:93] 0.6037 0.537 0.1081 0.1551 0.0978 ...</span>
<span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;  $ model_spec         :List of 20</span>
<span class="co">#&gt;  $ T_jSDM             : 'difftime' num 1.87375484307607</span>
<span class="co">#&gt;   ..- attr(*, "units")= chr "mins"</span>
<span class="co">#&gt;  - attr(*, "class")= chr "jSDM"</span></code></pre></div>
<p>We visually evaluate the convergence of MCMCs by representing the trace and density <em>a posteriori</em> of the estimated parameters.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, oma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">2</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mcmc_list_param</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"Milvus.milvus.beta"</span>,<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mcmc_list_param</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span>main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"species "</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, outer<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="SDM_JSDM_files/figure-html/plot-jSDM-lv-1.png" width="600" style="display: block; margin: auto;"></p>
<p>Overall, the traces and the densities of the parameters indicate the convergence of the algorithm. Indeed, we observe on the traces that the values oscillate around averages without showing an upward or downward trend and we see that the densities are quite smooth and for the most part of Gaussian form.
# Comparison of results</p>
<p>We want to compare the deviance, computation time and parameters of the SDM and the JSDM fitted using <code>jSDM</code> or <code>BayesComm</code> packages for fitting.</p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="deviance-and-compilation-time">
<span class="header-section-number">3.3</span> Deviance and compilation time<a class="anchor" aria-label="anchor" href="#deviance-and-compilation-time"></a>
</h3>

<table class="table table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:comp-dev">Table 3.1: </span><strong>Deviance and computation time</strong>. of SDM and JSDM fitted by <code>jSDM</code> or <code>BayesComm</code>. 
</caption>
<thead><tr>
<th style="text-align:left;">
package
</th>
<th style="text-align:left;">
model
</th>
<th style="text-align:left;">
Time
</th>
<th style="text-align:right;">
Deviance
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
BayesComm
</td>
<td style="text-align:left;">
SDM
</td>
<td style="text-align:left;">
228.3 secs
</td>
<td style="text-align:right;">
17555
</td>
</tr>
<tr>
<td style="text-align:left;">
jSDM
</td>
<td style="text-align:left;">
SDM
</td>
<td style="text-align:left;">
54.8 secs
</td>
<td style="text-align:right;">
17809
</td>
</tr>
<tr>
<td style="text-align:left;">
BayesComm
</td>
<td style="text-align:left;">
JSDM (GLMM)
</td>
<td style="text-align:left;">
329.4 secs
</td>
<td style="text-align:right;">
13448
</td>
</tr>
<tr>
<td style="text-align:left;">
jSDM
</td>
<td style="text-align:left;">
JSDM (LVM)
</td>
<td style="text-align:left;">
112.4 secs
</td>
<td style="text-align:right;">
14770
</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="parameter-values">
<span class="header-section-number">3.4</span> Parameter values<a class="anchor" aria-label="anchor" href="#parameter-values"></a>
</h3>
<p>The sizes of the dots on the following graphs are proportional to the number of observations per species. Parameters related to abundant species are represented by larger dots than those associated with rare species.</p>
<p>First, we compare the intercept for each species between classical or joint species distribution model that takes into account co-occurrences between species, fitted using <code>BayesComm</code> or <code>jSDM</code>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># Intercepts</span>
<span class="co">## jSDM</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">beta_jSDM</span>,<span class="st">"["</span>, <span class="fl">1</span><span class="op">)</span> , <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">param_jSDM_lv</span>, <span class="st">"["</span>, <span class="fl">1</span><span class="op">)</span>, cex<span class="op">=</span><span class="va">nobs_sp</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">5</span><span class="op">)</span>,
     main<span class="op">=</span><span class="st">"Fixed species intercept beta"</span>,
     xlab<span class="op">=</span><span class="st">"SDM"</span>, ylab<span class="op">=</span><span class="st">"JSDM"</span><span class="op">)</span>
<span class="co"># BayesComm</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">beta_est_BC</span><span class="op">$</span><span class="va">intercept</span>, <span class="va">beta_est_BC_comm</span><span class="op">$</span><span class="va">intercept</span>,
       cex<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">nobs_sp</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">5</span><span class="op">)</span>,<span class="fl">75</span><span class="op">)</span>, col<span class="op">=</span><span class="st">'blue'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>, b<span class="op">=</span><span class="fl">1</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fitted by BayesComm"</span>,<span class="st">"fitted by jSDM"</span><span class="op">)</span>, pch<span class="op">=</span><span class="fl">1</span>, cex<span class="op">=</span><span class="fl">1.2</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'blue'</span>,<span class="st">'black'</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>, b<span class="op">=</span><span class="fl">1</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></code></pre></div>
<p><img src="SDM_JSDM_files/figure-html/comp-intercept-1.png" width="600" style="display: block; margin: auto;"></p>
<p>We compare the effect of the environmental variables for each species between the four models.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># Environmental variable effects</span>
<span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">np</span><span class="op">)</span><span class="op">{</span>
<span class="co">## jSDM</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">beta_jSDM</span>, <span class="st">"["</span>, <span class="va">k</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">param_jSDM_lv</span>,<span class="st">"["</span>, <span class="va">k</span><span class="op">)</span>, cex<span class="op">=</span><span class="va">nobs_sp</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">5</span><span class="op">)</span>,
          main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Fixed species effect "</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">beta_jSDM</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">k</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,
     xlab<span class="op">=</span><span class="st">"SDM"</span>, ylab<span class="op">=</span><span class="st">"JSDM"</span><span class="op">)</span>
<span class="co">## BayesComm</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">beta_est_BC</span><span class="op">[</span>,<span class="va">k</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span>, <span class="va">beta_est_BC_comm</span><span class="op">[</span>,<span class="va">k</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span>,
       cex<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">nobs_sp</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">5</span><span class="op">)</span>,<span class="fl">75</span><span class="op">)</span>, col<span class="op">=</span><span class="st">'blue'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>, b<span class="op">=</span><span class="fl">1</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fitted by BayesComm"</span>,<span class="st">"fitted by jSDM"</span><span class="op">)</span>, pch<span class="op">=</span><span class="fl">1</span>, cex<span class="op">=</span><span class="fl">1.2</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'blue'</span>,<span class="st">'black'</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p><img src="SDM_JSDM_files/figure-html/comp-env-effect-1.png" width="600" style="display: block; margin: auto;"><img src="SDM_JSDM_files/figure-html/comp-env-effect-2.png" width="600" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="predictions">
<span class="header-section-number">3.5</span> Predictions<a class="anchor" aria-label="anchor" href="#predictions"></a>
</h3>
<p>We compare the probit of occurrence probabilities predicted by the classical or joint species distribution, fitted using <code>BayesComm</code> or <code>jSDM</code>.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># Predictions</span>
<span class="co">## jSDM</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">probit_theta_jSDM</span>, <span class="va">probit_theta_jSDM_lv</span>,
     cex<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">nobs_sp</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">5</span><span class="op">)</span>, <span class="fl">75</span><span class="op">)</span>,
     main<span class="op">=</span><span class="st">"Predicted probit(theta)"</span>,
     xlab<span class="op">=</span><span class="st">"SDM"</span>,
     ylab<span class="op">=</span><span class="st">"JSDM"</span><span class="op">)</span>
<span class="co">## BayesComm</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">probit_theta_latent_BC</span>, <span class="va">probit_theta_latent_BC_comm</span>,
       cex<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">nobs_sp</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">5</span><span class="op">)</span>,<span class="fl">75</span><span class="op">)</span>, col<span class="op">=</span><span class="st">'blue'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>, b<span class="op">=</span><span class="fl">1</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fitted by BayesComm"</span>,<span class="st">"fitted by jSDM"</span><span class="op">)</span>, pch<span class="op">=</span><span class="fl">1</span>, cex<span class="op">=</span><span class="fl">1.2</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'blue'</span>,<span class="st">'black'</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="SDM_JSDM_files/figure-html/comp-pred-1.png" width="600" style="display: block; margin: auto;"></p>
<p>In one hand, the results obtained with <code>jSDM</code> and <code>BayesComm</code> are quite similar and therefore the use of a latent variable model (LVM) rather than a classical GLMM has only a minimal influence on the estimated values of the species effects (<span class="math inline">\(\beta\)</span>).</p>
<p>On the other hand, the estimated values of the species intercept are quite similar using a classical species distribution model (SDM) or a joint species distribution model (JSDM), but the estimated values of the other species effects differ slightly.</p>
</div>
<div class="section level3">
<h3 id="residual-correlaton-matrix">
<span class="header-section-number">3.6</span> Residual correlaton matrix<a class="anchor" aria-label="anchor" href="#residual-correlaton-matrix"></a>
</h3>
<p>After fitting the jSDM with latent variables, the <strong>full species residual correlation matrix</strong> <span class="math inline">\(R=(R_{ij})^{i=1,\ldots, nspecies}_{j=1,\ldots, nspecies}\)</span> can be derived from the covariance in the latent variables such as :
<span class="math display">\[\Sigma_{ij} = \begin{cases}
 \lambda_i .\lambda_j^T &amp; \text{ if } i \neq j \\
  \lambda_i .\lambda_j^T + 1 &amp; \text{ if } i=j
 \end{cases}\]</span>, then we compute correlations from covariances :
<span class="math display">\[R_{i,j} = \frac{\Sigma_{ij}}{\sqrt{\Sigma _{ii}\Sigma _{jj}}}\]</span>.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># Residual correlation matrix obtained with BayesComm</span>
<span class="va">reorder.cor.mean</span> <span class="op">&lt;-</span> <span class="fu">corrplot</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/corrplot/man/corrMatOrder.html" class="external-link">corrMatOrder</a></span><span class="op">(</span><span class="va">R_mat</span>, order <span class="op">=</span> <span class="st">"FPC"</span>, hclust.method <span class="op">=</span> <span class="st">"average"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>cex<span class="op">=</span><span class="fl">1</span>, cex.main<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span>
<span class="fu">corrplot</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/corrplot/man/corrplot.html" class="external-link">corrplot</a></span><span class="op">(</span><span class="va">R_mat</span><span class="op">[</span><span class="va">reorder.cor.mean</span>,<span class="va">reorder.cor.mean</span><span class="op">]</span>, title <span class="op">=</span> <span class="st">"Residual Correlation Matrix from BayesComm"</span>, diag <span class="op">=</span> <span class="cn">F</span>, type <span class="op">=</span> <span class="st">"lower"</span>, method <span class="op">=</span> <span class="st">"color"</span>,  mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span>, tl.srt <span class="op">=</span> <span class="fl">40</span>, tl.cex <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span>

<span class="co"># Residual correlation matrix obtained with jSDM</span>
<span class="va">reorder.cor.mean</span> <span class="op">&lt;-</span> <span class="fu">corrplot</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/corrplot/man/corrMatOrder.html" class="external-link">corrMatOrder</a></span><span class="op">(</span><span class="va">residual_corr_mat</span>, order <span class="op">=</span> <span class="st">"FPC"</span>, hclust.method <span class="op">=</span> <span class="st">"average"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">residual_corr_mat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">residual_corr_mat</span><span class="op">)</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>cex<span class="op">=</span><span class="fl">1</span>, cex.main<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span>
<span class="fu">corrplot</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/corrplot/man/corrplot.html" class="external-link">corrplot</a></span><span class="op">(</span><span class="va">residual_corr_mat</span><span class="op">[</span><span class="va">reorder.cor.mean</span>,<span class="va">reorder.cor.mean</span><span class="op">]</span>, title <span class="op">=</span> <span class="st">"Residual Correlation Matrix from jSDM"</span>, diag <span class="op">=</span> <span class="cn">F</span>, type <span class="op">=</span> <span class="st">"lower"</span>, method <span class="op">=</span> <span class="st">"color"</span>,  mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span>, tl.srt <span class="op">=</span> <span class="fl">40</span>, tl.cex <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span></code></pre></div>
<p><img src="SDM_JSDM_files/figure-html/residual_correlation_matrix-1.png" width="600" style="display: block; margin: auto;"><img src="SDM_JSDM_files/figure-html/residual_correlation_matrix-2.png" width="600" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references">
<div id="ref-Brooks1998">
<p>Brooks, S. &amp; Gelman, A. (1998) General Methods for Monitoring Convergence of Iterative Simulations. <em>J. Comput. Graphi. Stat.</em>, <strong>7</strong>, 434‚Äì455.</p>
</div>
<div id="ref-Gelman1992">
<p>Gelman, A. &amp; Rubin, D.B. (1992) Inference from Iterative Simulation Using Multiple Sequences. <em>Statistical Science</em>, <strong>7</strong>, 457‚Äì472.</p>
</div>
<div id="ref-Golding2015">
<p>Golding, N., Nunn, M.A. &amp; Purse, B.V. (2015) Identifying biotic interactions which drive the spatial distribution of a mosquito community. <em>Parasites &amp; Vectors</em>, <strong>8</strong>, 367.</p>
</div>
<div id="ref-Kery2006">
<p>K√©ry, M. &amp; Schmid, H. (2006) Estimating species richness: Calibrating a large avian monitoring programme. <em>Journal of Applied Ecology</em>, <strong>43</strong>, 101‚Äì110.</p>
</div>
<div id="ref-Warton2015">
<p>Warton, D.I., Blanchet, F.G., O‚ÄôHara, R.B., Ovaskainen, O., Taskinen, S., Walker, S.C. &amp; Hui, F.K.C. (2015) So many variables: Joint modeling in community ecology. <em>Trends in Ecology &amp; Evolution</em>, <strong>30</strong>, 766‚Äì779.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jeanne Cl√©ment, <a href="https://ecology.ghislainv.fr" class="external-link">Ghislain Vieilledent</a>, <a href="https://www.cirad.fr" class="external-link"><img src="https://ecology.ghislainv.fr/images/logos/logo-cirad.svg" height="24"></a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>

<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Comparing SDMs and JSDMs • jSDM</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Comparing SDMs and JSDMs">
<meta property="og:description" content="jSDM">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">jSDM</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/jSDM.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/SDM_JSDM.html">Comparing SDMs and JSDMs</a>
    </li>
    <li>
      <a href="../articles/jSDM_binomial_logit.html">Binomial logistic regression</a>
    </li>
    <li>
      <a href="../articles/jSDM_binomial_probit_block.html">Bernoulli probit regression</a>
    </li>
    <li>
      <a href="../articles/jSDM_binomial_probit_block_long_format.html">Bernoulli probit regression with data in long format</a>
    </li>
    <li>
      <a href="../articles/jSDM_boral.html">Comparison jSDM-boral</a>
    </li>
    <li>
      <a href="../articles/jSDM_in_parallel.html">Running jSDM in parallel</a>
    </li>
    <li>
      <a href="../articles/jSDM_poisson_log.html">Poisson log-linear regression</a>
    </li>
    <li>
      <a href="../articles/proof.html">Bayesian inference methods</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Change log</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="http://twitter.com/ghislainv">
    <span class="fa fa-twitter fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/ghislainv/jSDM">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="SDM_JSDM_files/jquery-1.11.3/jquery.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1">
<link href="SDM_JSDM_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet">
<script src="SDM_JSDM_files/bootstrap-3.3.5/js/bootstrap.min.js"></script><script src="SDM_JSDM_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script><script src="SDM_JSDM_files/bootstrap-3.3.5/shim/respond.min.js"></script><script src="SDM_JSDM_files/navigation-1.1/tabsets.js"></script><script src="SDM_JSDM_files/kePrint-0.0.1/kePrint.js"></script><link href="SDM_JSDM_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Comparing SDMs and JSDMs</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ghislainv/jSDM/blob/master/vignettes/SDM_JSDM.Rmd"><code>vignettes/SDM_JSDM.Rmd</code></a></small>
      <div class="hidden name"><code>SDM_JSDM.Rmd</code></div>

    </div>

    
    
<div id="dataset" class="section level1">
<h1 class="hasAnchor">
<a href="#dataset" class="anchor"></a><span class="header-section-number">1</span> Dataset</h1>
<div id="presence-absence-of-alpine-plants" class="section level2">
<h2 class="hasAnchor">
<a href="#presence-absence-of-alpine-plants" class="anchor"></a><span class="header-section-number">1.1</span> Presence-absence of alpine plants</h2>

<div class="figure" style="text-align: center">
<span id="fig:alpine-plant"></span>
<img src="figures/alpine_plants.png" alt="Alpine plants (Choler 2005)."><p class="caption">
Figure 1.1: <strong><em>Alpine plants</em></strong> <span class="citation">(Choler <a href="#ref-Choler2005">2005</a>)</span>.
</p>
</div>
<p>We consider alpine plants in Aravo (Valloire), south east France <span class="citation">(Choler <a href="#ref-Choler2005">2005</a>)</span>. The data are available from the R package <code>ade4</code> <span class="citation">(Dray &amp; Dufour <a href="#ref-Dray2007">2007</a>)</span>. The original dataset includes abundance data for 82 species in 75 sites.</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://ecology.ghislainv.fr/jSDM">jSDM</a></span>)
<span class="co">#&gt; ##</span>
<span class="co">#&gt; ## jSDM R package </span>
<span class="co">#&gt; ## For joint species distribution models </span>
<span class="co">#&gt; ## https://ecology.ghislainv.fr/jSDM </span>
<span class="co">#&gt; ##</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="kw">aravo</span>)
<span class="kw">aravo</span><span class="op">$</span><span class="kw">spe</span>[<span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>]
<span class="co">#&gt;      Agro.rupe Alop.alpi Anth.nipp Heli.sede Aven.vers</span>
<span class="co">#&gt; AR07         0         0         0         0         0</span>
<span class="co">#&gt; AR71         0         0         0         0         0</span>
<span class="co">#&gt; AR26         3         0         1         0         1</span>
<span class="co">#&gt; AR54         0         0         0         2         0</span>
<span class="co">#&gt; AR60         0         0         0         0         0</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="kw">aravo</span><span class="op">$</span><span class="kw">env</span>)
<span class="co">#&gt;      Aspect Slope Form PhysD ZoogD Snow</span>
<span class="co">#&gt; AR07      7     2    1    50    no  140</span>
<span class="co">#&gt; AR71      1    35    3    40    no  140</span>
<span class="co">#&gt; AR26      5     0    3    20    no  140</span>
<span class="co">#&gt; AR54      9    30    3    80    no  140</span>
<span class="co">#&gt; AR60      9     5    1    80    no  140</span>
<span class="co">#&gt; AR70      1    30    3    40    no  140</span>
</pre></div>
<p>We transform abundance into presence-absence data and remove species with less than 5 presences. We also look at the number of observations per site.</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="co"># Transform abundance into presence-absence</span>
<span class="kw">pres_data</span> <span class="op">&lt;-</span> <span class="kw">aravo</span><span class="op">$</span><span class="kw">spe</span>
<span class="kw">pres_data</span>[<span class="kw">pres_data</span> <span class="op">&gt;</span> <span class="fl">0</span>] <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="co"># Remove species with less than 5 presences</span>
<span class="kw">rare_sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="kw">pres_data</span>, <span class="fl">2</span>, <span class="kw">sum</span>) <span class="op">&lt;</span> <span class="fl">5</span>)
<span class="kw">pres_data</span> <span class="op">&lt;-</span> <span class="kw">pres_data</span>[, <span class="op">-</span><span class="kw">rare_sp</span>]
<span class="co"># Number of sites and species</span>
<span class="kw">nsite</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(<span class="kw">pres_data</span>)[<span class="fl">1</span>]
<span class="kw">nsite</span>
<span class="co">#&gt; [1] 75</span>
<span class="kw">nsp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(<span class="kw">pres_data</span>)[<span class="fl">2</span>]
<span class="kw">nsp</span>
<span class="co">#&gt; [1] 65</span>
<span class="co"># Number of observations per site</span>
<span class="kw">nobs_site</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="kw">pres_data</span>, <span class="fl">1</span>, <span class="kw">sum</span>)
<span class="kw">nobs_site</span>
<span class="co">#&gt; AR07 AR71 AR26 AR54 AR60 AR70 AR22 AR25 AR27 AR28 AR72 AR01 AR23 AR08 AR12 AR13 </span>
<span class="co">#&gt;   12   12   25   16   11   18   28   15   22   24   12   20   21   27   24   22 </span>
<span class="co">#&gt; AR61 AR49 AR50 AR52 AR29 AR30 AR51 AR05 AR53 AR06 AR16 AR56 AR75 AR69 AR15 AR63 </span>
<span class="co">#&gt;   20   20   21   20   27   24   25   23   12   28   17   12   16   28   20   25 </span>
<span class="co">#&gt; AR74 AR64 AR65 AR66 AR67 AR68 AR11 AR32 AR02 AR10 AR31 AR39 AR40 AR57 AR58 AR62 </span>
<span class="co">#&gt;    9    7    6   10   11   14   20   25   20   15   14   16   18   13   15   17 </span>
<span class="co">#&gt; AR24 AR37 AR38 AR03 AR14 AR19 AR20 AR36 AR42 AR44 AR34 AR35 AR46 AR47 AR48 AR41 </span>
<span class="co">#&gt;    5    7   11   12   13    6   14    9   12   10   10   13   10   15   15   18 </span>
<span class="co">#&gt; AR43 AR45 AR21 AR73 AR04 AR09 AR17 AR18 AR33 AR55 AR59 </span>
<span class="co">#&gt;   13   11   23   20   25   14   17   17   11   20   17</span>
<span class="co"># Number of observations per species</span>
<span class="kw">nobs_sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="kw">pres_data</span>, <span class="fl">2</span>, <span class="kw">sum</span>)
<span class="kw">nobs_sp</span>
<span class="co">#&gt; Agro.rupe Alop.alpi Anth.nipp Aven.vers Care.rosa Care.foet Care.parv Care.rupe </span>
<span class="co">#&gt;        29        37        17        15        28        20        12         5 </span>
<span class="co">#&gt; Care.semp Fest.quad Fest.viol Kobr.myos Luzu.lute  Poa.alpi  Poa.supi Sesl.caer </span>
<span class="co">#&gt;        12        11        13        23         8        59         6         7 </span>
<span class="co">#&gt; Alch.pent Alch.glau Alch.vulg Andr.brig Ante.carp Camp.sche Card.alpi Cera.stri </span>
<span class="co">#&gt;        26        14         5        17        17        36        16        29 </span>
<span class="co">#&gt; Cera.cera Leuc.alpi Cirs.acau Drab.aizo Erig.unif Gent.camp Gent.acau Gent.vern </span>
<span class="co">#&gt;        12        30         5        13        22        14         8        28 </span>
<span class="co">#&gt; Geum.mont Omal.supi Andr.vita Hier.pili Homo.alpi Leon.pyre Ligu.muto Lloy.sero </span>
<span class="co">#&gt;        45        37        16        11         6        39        20         5 </span>
<span class="co">#&gt; Minu.sedo Minu.vern Plan.alpi Poly.vivi Pote.aure Pote.cran Puls.vern Ranu.kuep </span>
<span class="co">#&gt;        39        10        36        31        36        11        18        19 </span>
<span class="co">#&gt; Sagi.glab Sali.herb Saxi.pani Sedu.alpe Semp.mont Sene.inca Sibb.proc Sile.acau </span>
<span class="co">#&gt;        24        24         9        19        21        10        45         8 </span>
<span class="co">#&gt; Vero.alpi Vero.bell Myos.alpe Tara.alpi Oxyt.camp Oxyt.lapp Lotu.alpi Trif.alpi </span>
<span class="co">#&gt;        16        35        19        11         5         6         9         6 </span>
<span class="co">#&gt; Trif.thal </span>
<span class="co">#&gt;         5</span>
</pre></div>
</div>
<div id="environmental-variables" class="section level2">
<h2 class="hasAnchor">
<a href="#environmental-variables" class="anchor"></a><span class="header-section-number">1.2</span> Environmental variables</h2>
<p>The environmental variables are:</p>
<ul>
<li>
<strong>Aspect</strong>: Relative south aspect (opposite of the sine of aspect with flat coded 0).</li>
<li>
<strong>Slope</strong>: Slope inclination (degrees).</li>
<li>
<strong>Form</strong>: Microtopographic landform index: 1 (convexity); 2 (convex slope); 3 (right slope); 4 (concave slope); 5 (concavity).</li>
<li>
<strong>Snow</strong>: Mean snowmelt date (Julian day) averaged over 1997-1999.</li>
<li>
<strong>PhysD</strong>: Physical disturbance, i.e., percentage of unvegetated soil due to physical processes.</li>
<li>
<strong>ZoogD</strong>: Zoogenic disturbance, i.e., quantity of unvegetated soil due to marmot activity: no; some; high.</li>
</ul>
<p>As a first approach, we just select the “Snow” variable considering a quadratic orthogonal polynomial.</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="kw">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html">poly</a></span>(<span class="kw">aravo</span><span class="op">$</span><span class="kw">env</span><span class="op">$</span><span class="kw">Snow</span>, <span class="fl">2</span>)
<span class="kw">env_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="fl">1</span>, <span class="kw">p</span>))
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="kw">env_data</span>) <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"int"</span>, <span class="st">"snow"</span>, <span class="st">"snow2"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="kw">env_data</span>)
<span class="co">#&gt;   int       snow     snow2</span>
<span class="co">#&gt; 1   1 -0.1571577 0.1587642</span>
<span class="co">#&gt; 2   1 -0.1571577 0.1587642</span>
<span class="co">#&gt; 3   1 -0.1571577 0.1587642</span>
<span class="co">#&gt; 4   1 -0.1571577 0.1587642</span>
<span class="co">#&gt; 5   1 -0.1571577 0.1587642</span>
<span class="co">#&gt; 6   1 -0.1571577 0.1587642</span>
<span class="co"># Number of environmental variables plus intercept</span>
<span class="kw">np</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span>(<span class="kw">env_data</span>)
</pre></div>
</div>
</div>
<div id="fitting-species-distribution-models" class="section level1">
<h1 class="hasAnchor">
<a href="#fitting-species-distribution-models" class="anchor"></a><span class="header-section-number">2</span> Fitting species distribution models</h1>
<div id="bayescomm" class="section level2">
<h2 class="hasAnchor">
<a href="#bayescomm" class="anchor"></a><span class="header-section-number">2.1</span> BayesComm</h2>
<div id="model-without-latent-variables" class="section level3">
<h3 class="hasAnchor">
<a href="#model-without-latent-variables" class="anchor"></a><span class="header-section-number">2.1.1</span> Model <strong>without</strong> latent variables</h3>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="co"># R is diagonal</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw">BayesComm</span>)
<span class="kw">T1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span>()
<span class="kw">mod_BayesComm</span> <span class="op">&lt;-</span> <span class="kw">BayesComm</span>::<span class="fu"><a href="https://rdrr.io/pkg/BayesComm/man/BC.html">BC</a></span>(Y=<span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="kw">pres_data</span>), X=<span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="kw">env_data</span>[,<span class="op">-</span><span class="fl">1</span>]), model=<span class="st">"environment"</span>, its=<span class="fl">50000</span>, thin=<span class="fl">25</span>, burn=<span class="fl">25000</span>)
<span class="co"># Estimates</span>
<span class="kw">beta_est_bayescomm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(sp=<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="kw">pres_data</span>), intercept=<span class="fl">NA</span>, snow=<span class="fl">NA</span>, snow2=<span class="fl">NA</span>)
<span class="co">for</span> (<span class="kw">j</span> <span class="co">in</span> <span class="fl">1</span><span class="op">:</span><span class="kw">nsp</span>) {
  <span class="kw">beta_est_bayescomm</span>[<span class="kw">j</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">4</span>] <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="kw">mod_BayesComm</span>, chain=<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"B$"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="kw">pres_data</span>)[<span class="kw">j</span>]))<span class="op">$</span><span class="kw">statistics</span>[, <span class="st">"Mean"</span>])
}
<span class="kw">T2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span>()
<span class="kw">T_BayesComm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html">difftime</a></span>(<span class="kw">T2</span>,<span class="kw">T1</span>)
<span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span>(<span class="kw">beta_est_bayescomm</span>, <span class="kw">T_BayesComm</span>,  file=<span class="st">"SDM_JSDM_files/BayesComm.rda"</span>)
</pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw">BayesComm</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(mfrow=<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">1</span>), oma=<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">2</span>,<span class="fl">0</span>))
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="kw">mod_BayesComm</span>, chain=<span class="st">"B$Agro.rupe"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/title.html">title</a></span>(main=<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"species "</span>, <span class="kw">aravo</span><span class="op">$</span><span class="kw">spe.names</span>[<span class="st">"Agro.rupe"</span>]), outer=<span class="fl">TRUE</span>)
</pre></div>
<p><img src="SDM_JSDM_files/figure-html/plot-BayesComm-1.png" style="display: block; margin: auto;"></p>
</div>
<div id="model-with-latent-variables" class="section level3">
<h3 class="hasAnchor">
<a href="#model-with-latent-variables" class="anchor"></a><span class="header-section-number">2.1.2</span> Model <strong>with</strong> latent variables</h3>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="kw">T1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span>()
<span class="kw">mod_BayesComm_lv</span> <span class="op">&lt;-</span> <span class="kw">BayesComm</span>::<span class="fu"><a href="https://rdrr.io/pkg/BayesComm/man/BC.html">BC</a></span>(Y=<span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="kw">pres_data</span>), X=<span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="kw">env_data</span>[,<span class="op">-</span><span class="fl">1</span>]), model=<span class="st">"full"</span>, its=<span class="fl">50000</span>, thin=<span class="fl">25</span>, burn=<span class="fl">25000</span>)
<span class="co"># Estimates</span>
<span class="kw">beta_est_bayescomm_lv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(sp=<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="kw">pres_data</span>), intercept=<span class="fl">NA</span>, snow=<span class="fl">NA</span>, snow2=<span class="fl">NA</span>)
<span class="co">for</span> (<span class="kw">j</span> <span class="co">in</span> <span class="fl">1</span><span class="op">:</span><span class="kw">nsp</span>) {
  <span class="kw">beta_est_bayescomm_lv</span>[<span class="kw">j</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">4</span>] <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="kw">mod_BayesComm_lv</span>, chain=<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"B$"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="kw">pres_data</span>)[<span class="kw">j</span>]))<span class="op">$</span><span class="kw">statistics</span>[, <span class="st">"Mean"</span>])
}
<span class="kw">Z_BayesComm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="kw">mod_BayesComm_lv</span><span class="op">$</span><span class="kw">trace</span><span class="op">$</span><span class="kw">z</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>,<span class="fl">3</span>), <span class="kw">mean</span>)
<span class="kw">T2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span>()
<span class="kw">T_BayesComm_lv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html">difftime</a></span>(<span class="kw">T2</span>,<span class="kw">T1</span>)
<span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span>(<span class="kw">beta_est_bayescomm_lv</span>, <span class="kw">Z_BayesComm</span>, <span class="kw">T_BayesComm_lv</span>, file=<span class="st">"SDM_JSDM_files/BayesComm_lv.rda"</span>)
</pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw">BayesComm</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(mfrow=<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">1</span>), oma=<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">2</span>,<span class="fl">0</span>))
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="kw">mod_BayesComm_lv</span>, chain=<span class="st">"B$Agro.rupe"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/title.html">title</a></span>(main=<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"species "</span>, <span class="kw">aravo</span><span class="op">$</span><span class="kw">spe.names</span>[<span class="st">"Agro.rupe"</span>]), outer=<span class="fl">TRUE</span>)
</pre></div>
<p><img src="SDM_JSDM_files/figure-html/plot-BayesComm_lv-1.png" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="binomial-model-for-presence-absence-data" class="section level2">
<h2 class="hasAnchor">
<a href="#binomial-model-for-presence-absence-data" class="anchor"></a><span class="header-section-number">2.2</span> Binomial model for presence-absence data</h2>
<p>We consider a latent variable model (LVM) to account for species co-occurrence on all sites <span class="citation">(Warton <em>et al.</em> <a href="#ref-Warton2015">2015</a>)</span>.</p>
<p><span class="math display">\[y_{ij} \sim \mathcal{B}ernoulli(\theta_{ij})\]</span></p>
<p><span class="math display">\[ \mathrm{g}(\theta_{ij}) =\alpha_i + X_i\beta_j + W_i\lambda_j \]</span></p>
<ul>
<li>
<span class="math inline">\(\mathrm{g}(\cdot)\)</span>: Link function (eg. logit or probit).</li>
<li>
<span class="math inline">\(\alpha_i\)</span>: Site random effect with <span class="math inline">\(\alpha_i \sim \mathcal{N}(0, V_{\alpha})\)</span>. Corresponds to a mean suitability for site <span class="math inline">\(i\)</span>.</li>
<li>
<span class="math inline">\(X_i\)</span>: Vector of explanatory variables for site <span class="math inline">\(i\)</span> (including intercept).</li>
<li>
<span class="math inline">\(\beta_j\)</span>: Effects of the explanatory variables on the probability of presence of species <span class="math inline">\(j\)</span>.</li>
<li>
<span class="math inline">\(W_i\)</span>: Vector of random latent variables for site <span class="math inline">\(i\)</span>. <span class="math inline">\(W_i \sim N(0, 1)\)</span>. The number of latent variables must be fixed by the user (default to 2).</li>
<li>
<span class="math inline">\(\lambda_j\)</span>: Effects of the latent variables on the probability of presence of species <span class="math inline">\(j\)</span>. Also known as “factor loadings” <span class="citation">(Warton <em>et al.</em> <a href="#ref-Warton2015">2015</a>)</span>.</li>
</ul>
<p>This model is equivalent to a multivariate GLMM <span class="math inline">\(\mathrm{g}(\theta_{ij}) =\alpha_i + X_i.\beta_j + u_{ij}\)</span>, where <span class="math inline">\(u_{ij} \sim \mathcal{N}(0, \Sigma)\)</span> with the constraint that the variance-covariance matrix <span class="math inline">\(\Sigma = \Lambda \Lambda^{\prime}\)</span>, where <span class="math inline">\(\Lambda\)</span> is the full matrix of factor loadings, with the <span class="math inline">\(\lambda_j\)</span> as its columns.</p>
</div>
<div id="binomial-model-with-probit-link" class="section level2">
<h2 class="hasAnchor">
<a href="#binomial-model-with-probit-link" class="anchor"></a><span class="header-section-number">2.3</span> Binomial model with probit link</h2>
<p>In a first step, we consider binomial models with a probit link. We compare models without and with latent variables and which may or may not include a random site effect.</p>
<div id="model-without-latent-variables-1" class="section level3">
<h3 class="hasAnchor">
<a href="#model-without-latent-variables-1" class="anchor"></a><span class="header-section-number">2.3.1</span> Model <strong>without</strong> latent variables</h3>
<p>We estimate the model parameters with the function <code><a href="../reference/jSDM_binomial_probit_block.html">jSDM_binomial_probit_block()</a></code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="co">## Load libraries</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">require</a></span>(<span class="kw">doParallel</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">require</a></span>(<span class="kw"><a href="https://github.com/RevolutionAnalytics/foreach">foreach</a></span>)

<span class="co">## Make a cluster for parallel MCMCs</span>
<span class="kw">nchains</span> <span class="op">&lt;-</span> <span class="fl">2</span>
<span class="kw">ncores</span> <span class="op">&lt;-</span> <span class="kw">nchains</span> <span class="co">## One core for each MCMC chains</span>
<span class="kw">clust</span> <span class="op">&lt;-</span> <span class="fu">makeCluster</span>(<span class="kw">ncores</span>)
<span class="fu"><a href="https://rdrr.io/pkg/doParallel/man/registerDoParallel.html">registerDoParallel</a></span>(<span class="kw">clust</span>)

<span class="co"># Starting values for two chains</span>
<span class="kw">beta_start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span>)
<span class="co">#formatting of starting parameters generated by the function </span>
<span class="co"># Seeds</span>
<span class="kw">seed_mcmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1234</span>, <span class="fl">4321</span>)
</pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://ecology.ghislainv.fr/jSDM">jSDM</a></span>)
<span class="co"># Model with foreach and doPar call</span>
<span class="kw">mod_probit</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/pkg/foreach/man/foreach.html">foreach</a></span> (i = <span class="fl">1</span><span class="op">:</span><span class="kw">nchains</span>) <span class="op">%dopar%</span> {
    <span class="co"># Infering model parameters</span>
    <span class="kw">mod</span> <span class="op">&lt;-</span> <span class="kw">jSDM</span>::<span class="fu"><a href="../reference/jSDM_binomial_probit_block.html">jSDM_binomial_probit_block</a></span>(
      <span class="co"># Iterations</span>
      mcmc = <span class="fl">25000</span>,
      thin = <span class="fl">25</span>,
      burnin = <span class="fl">25000</span>,
      <span class="co"># Data</span>
      presence_site_sp = <span class="kw">pres_data</span>,
      site_data = <span class="kw">env_data</span>[,<span class="op">-</span><span class="fl">1</span>],
      site_suitability=<span class="op">~</span><span class="kw">.</span>,
      <span class="co"># Priors</span>
      mu_beta = <span class="fl">0</span>,
      V_beta = <span class="fl">10</span>,
      <span class="co"># Starting values</span>
      beta_start = <span class="kw">beta_start</span>[<span class="kw">i</span>],
      <span class="co"># Other</span>
      seed = <span class="kw">seed_mcmc</span>[<span class="kw">i</span>],
      verbose = <span class="fl">1</span>
    )
    <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="kw">mod</span>)
  }

<span class="co"># Stop cluster</span>
<span class="fu">stopCluster</span>(<span class="kw">clust</span>)
<span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span>(<span class="kw">mod_probit</span>,
     file=<span class="st">"SDM_JSDM_files/mod_probit.rda"</span>)
</pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span>(file=<span class="st">"SDM_JSDM_files/mod_probit.rda"</span>)
<span class="co"># Output</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="kw">mod_probit</span>)
<span class="co">#&gt; [1] 2</span>
<span class="kw">m1</span> <span class="op">&lt;-</span> <span class="kw">mod_probit</span>[[<span class="fl">1</span>]]
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="kw">m1</span>, max.level = <span class="fl">1</span>)
<span class="co">#&gt; List of 5</span>
<span class="co">#&gt;  $ mcmc.Deviance    : 'mcmc' num [1:1000, 1] 3927 3882 3948 3920 3929 ...</span>
<span class="co">#&gt;   ..- attr(*, "mcpar")= num [1:3] 25001 49976 25</span>
<span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;  $ mcmc.sp          :List of 65</span>
<span class="co">#&gt;  $ Z_latent         : num [1:75, 1:65] -0.98 -1.022 0.682 -1.001 -0.999 ...</span>
<span class="co">#&gt;  $ probit_theta_pred: num [1:75, 1:65] -0.48 -0.48 -0.48 -0.48 -0.48 ...</span>
<span class="co">#&gt;  $ model_spec       :List of 15</span>
<span class="co">#&gt;  - attr(*, "class")= chr "jSDM"</span>
</pre></div>
<p>We evaluate the convergence of the MCMC output in which two parallel chains are run with starting values that are overdispersed relative to the posterior distribution.
Convergence is diagnosed when the chains have ‘forgotten’ their initial values, and the output from all chains is indistinguishable.
If the convergence diagnostic gives values substantially above 1, its indicates lack of convergence.</p>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">require</a></span>(<span class="kw">coda</span>)
<span class="co">#&gt; Loading required package: coda</span>
<span class="kw">arr2mcmc</span> <span class="op">&lt;-</span> <span class="fu">function</span>(<span class="kw">x</span>) {
  <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html">mcmc</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(<span class="kw">x</span>)))
}
<span class="co"># MCMC lists</span>
<span class="kw">mcmc_list_beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.list.html">mcmc.list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="kw">mod_probit</span>,<span class="st">"[["</span>,<span class="st">"mcmc.sp"</span>), <span class="kw">arr2mcmc</span>))
<span class="kw">mcmc_list_deviance</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.list.html">mcmc.list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="kw">mod_probit</span>,<span class="st">"[["</span>,<span class="st">"mcmc.Deviance"</span>), <span class="kw">arr2mcmc</span>))
<span class="co"># psrf gelman indice </span>
<span class="kw">psrf_beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/coda/man/gelman.diag.html">gelman.diag</a></span>(<span class="kw">mcmc_list_beta</span>)<span class="op">$</span><span class="kw">mpsrf</span>
<span class="co"># gelman indice</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="st">"psrf_beta:"</span>, <span class="kw">psrf_beta</span>, <span class="st">"\n"</span>)
<span class="co">#&gt; psrf_beta: 1.238203</span>
</pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="kw">beta_m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="kw">m1</span><span class="op">$</span><span class="kw">mcmc.sp</span>, <span class="kw">colMeans</span>)
<span class="kw">probit_theta_m1</span> <span class="op">&lt;-</span> <span class="kw">m1</span><span class="op">$</span><span class="kw">probit_theta_pred</span>
<span class="kw">deviance_m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="kw">m1</span><span class="op">$</span><span class="kw">mcmc.Deviance</span>)
</pre></div>
<p><strong>Comparison with BayesComm</strong></p>
<div class="sourceCode" id="cb13"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span>(<span class="st">"SDM_JSDM_files/BayesComm.rda"</span>)
<span class="kw">beta_est_m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="kw">beta_m1</span>), ncol=<span class="fl">3</span>, byrow=<span class="kw">T</span>))
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="kw">beta_est_m1</span>) <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"intercept"</span>,<span class="st">"snow"</span>,<span class="st">"snow2"</span>)
<span class="kw">beta_est_m1</span><span class="op">$</span><span class="kw">sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="kw">pres_data</span>)
<span class="co"># Intercept</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="kw">beta_est_bayescomm</span><span class="op">$</span><span class="kw">intercept</span>, <span class="kw">beta_est_m1</span><span class="op">$</span><span class="kw">intercept</span>,
     main=<span class="st">"beta_intercept"</span>, xlab=<span class="st">"fitted by BayesComm"</span>, ylab=<span class="st">"fitted by jSDM"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(a=<span class="fl">0</span>, b=<span class="fl">1</span>, col=<span class="st">"red"</span>)
</pre></div>
<p><img src="SDM_JSDM_files/figure-html/BayesComm-comparison-1.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb14"><pre class="downlit">
<span class="co"># Snow</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="kw">beta_est_bayescomm</span><span class="op">$</span><span class="kw">snow</span>, <span class="kw">beta_est_m1</span><span class="op">$</span><span class="kw">snow</span>,
     main=<span class="st">"beta_snow"</span>, xlab=<span class="st">"fitted by BayesComm"</span>, ylab=<span class="st">"fitted by jSDM"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(a=<span class="fl">0</span>, b=<span class="fl">1</span>, col=<span class="st">"red"</span>)
</pre></div>
<p><img src="SDM_JSDM_files/figure-html/BayesComm-comparison-2.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb15"><pre class="downlit">
<span class="co"># Snow2</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="kw">beta_est_bayescomm</span><span class="op">$</span><span class="kw">snow2</span>, <span class="kw">beta_est_m1</span><span class="op">$</span><span class="kw">snow2</span>,
     main=<span class="st">"beta_snow2"</span>, xlab=<span class="st">"fitted by BayesComm"</span>, ylab=<span class="st">"fitted by jSDM"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(a=<span class="fl">0</span>, b=<span class="fl">1</span>, col=<span class="st">"red"</span>)
</pre></div>
<p><img src="SDM_JSDM_files/figure-html/BayesComm-comparison-3.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div id="model-with-latent-variables-1" class="section level3">
<h3 class="hasAnchor">
<a href="#model-with-latent-variables-1" class="anchor"></a><span class="header-section-number">2.3.2</span> Model <strong>with</strong> latent variables</h3>
<div class="sourceCode" id="cb16"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw">parallel</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw">doParallel</span>)
<span class="co">## Make a cluster for parallel MCMCs</span>
<span class="kw">nchains</span> <span class="op">&lt;-</span> <span class="fl">2</span>
<span class="kw">ncores</span> <span class="op">&lt;-</span> <span class="kw">nchains</span> <span class="co">## One core for each MCMC chains</span>
<span class="kw">clust</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html">makeCluster</a></span>(<span class="kw">ncores</span>)
<span class="fu"><a href="https://rdrr.io/pkg/doParallel/man/registerDoParallel.html">registerDoParallel</a></span>(<span class="kw">clust</span>)

<span class="co"># Number of latent variables</span>
<span class="kw">nl</span> <span class="op">&lt;-</span> <span class="fl">2</span>

<span class="co"># Starting parameters </span>
<span class="kw">lambda_start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span>)
<span class="kw">beta_start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span>)
<span class="kw">W_start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.001</span>,<span class="op">-</span><span class="fl">0.001</span>)
<span class="co">#formatting of starting parameters</span>
<span class="co">#and constraints on lambda generated by the function </span>
<span class="co"># Seeds</span>
<span class="kw">seed_mcmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1234</span>, <span class="fl">4321</span>)
</pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit">
<span class="co"># Model</span>
<span class="kw">mod_probit_lv</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/pkg/foreach/man/foreach.html">foreach</a></span> (i = <span class="fl">1</span><span class="op">:</span><span class="kw">nchains</span>) <span class="op">%dopar%</span> {
    <span class="co"># Infering model parameters</span>
    <span class="kw">mod</span> <span class="op">&lt;-</span> <span class="kw">jSDM</span>::<span class="fu"><a href="../reference/jSDM_binomial_probit_block.html">jSDM_binomial_probit_block</a></span>(
      <span class="co"># Iterations</span>
      burnin=<span class="fl">25000</span>, mcmc=<span class="fl">25000</span>, thin=<span class="fl">25</span>,
      <span class="co"># Data</span>
      presence_site_sp=<span class="kw">pres_data</span>,
      site_data = <span class="kw">env_data</span>[,<span class="op">-</span><span class="fl">1</span>],
      site_suitability = <span class="op">~</span><span class="kw">.</span>,
      <span class="co"># Model specification </span>
      n_latent=<span class="fl">2</span>,
      site_effect=<span class="st">"none"</span>,
      <span class="co"># Priors</span>
      V_beta = <span class="fl">10</span>,
      mu_beta = <span class="fl">0</span>,
      mu_lambda = <span class="fl">0</span>,
      V_lambda= <span class="fl">10</span>,
      <span class="co"># Starting values</span>
      beta_start = <span class="kw">beta_start</span>[<span class="kw">i</span>],
      lambda_start = <span class="kw">lambda_start</span>[<span class="kw">i</span>],
      W_start = <span class="kw">W_start</span>[<span class="kw">i</span>],
      <span class="co"># Other</span>
      seed = <span class="kw">seed_mcmc</span>[<span class="kw">i</span>],
      verbose = <span class="fl">1</span>
    )
    <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="kw">mod</span>)
  }


<span class="co"># Stop cluster</span>
<span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html">stopCluster</a></span>(<span class="kw">clust</span>)
<span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span>(<span class="kw">mod_probit_lv</span>, file=<span class="st">"SDM_JSDM_files/mod_probit_lv.rda"</span>)
</pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span>(file=<span class="st">"SDM_JSDM_files/mod_probit_lv.rda"</span>)
<span class="co"># Output</span>
<span class="kw">m2</span> <span class="op">&lt;-</span> <span class="kw">mod_probit_lv</span>[[<span class="fl">1</span>]]
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="kw">m2</span>, max.level = <span class="fl">1</span>)
<span class="co">#&gt; List of 6</span>
<span class="co">#&gt;  $ mcmc.Deviance    : 'mcmc' num [1:1000, 1] 2974 2990 2962 2929 2991 ...</span>
<span class="co">#&gt;   ..- attr(*, "mcpar")= num [1:3] 25001 49976 25</span>
<span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;  $ mcmc.sp          :List of 65</span>
<span class="co">#&gt;  $ mcmc.latent      :List of 2</span>
<span class="co">#&gt;  $ Z_latent         : num [1:75, 1:65] -1.118 -0.957 0.56 -0.986 -1.3 ...</span>
<span class="co">#&gt;  $ probit_theta_pred: num [1:75, 1:65] -0.623 -0.317 -0.836 -0.368 -0.97 ...</span>
<span class="co">#&gt;  $ model_spec       :List of 20</span>
<span class="co">#&gt;  - attr(*, "class")= chr "jSDM"</span>
</pre></div>
<pre><code>#&gt; psrf_lv: 1.372882
#&gt; psrf_beta: 1.016833</code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit">
<span class="kw">param_m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="kw">m2</span><span class="op">$</span><span class="kw">mcmc.sp</span>,<span class="kw">colMeans</span>)
<span class="kw">probit_theta_m2</span> <span class="op">&lt;-</span> <span class="kw">m2</span><span class="op">$</span><span class="kw">probit_theta_pred</span>
<span class="kw">deviance_m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span>(<span class="kw">m2</span><span class="op">$</span><span class="kw">mcmc.Deviance</span>)
</pre></div>
<p><em>Comparison with BayesComm</em></p>
<div class="sourceCode" id="cb21"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span>(<span class="st">"SDM_JSDM_files/BayesComm_lv.rda"</span>)
<span class="kw">beta_est_m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="kw">param_m2</span>,<span class="st">"["</span>,<span class="fl">1</span><span class="op">:</span><span class="kw">np</span>)), ncol=<span class="fl">3</span>, byrow=<span class="kw">T</span>))
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="kw">beta_est_m2</span>) <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"intercept"</span>,<span class="st">"snow"</span>,<span class="st">"snow2"</span>)
<span class="kw">beta_est_m2</span><span class="op">$</span><span class="kw">sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="kw">pres_data</span>)
<span class="co"># Intercept</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="kw">beta_est_bayescomm_lv</span><span class="op">$</span><span class="kw">intercept</span>, <span class="kw">beta_est_m1</span><span class="op">$</span><span class="kw">intercept</span>,
     main=<span class="st">"beta_intercept"</span>, xlab=<span class="st">"fitted by BayesComm"</span>, ylab=<span class="st">"fitted by jSDM"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(a=<span class="fl">0</span>, b=<span class="fl">1</span>, col=<span class="st">"red"</span>)
</pre></div>
<p><img src="SDM_JSDM_files/figure-html/BayesComm-comparison-lv-1.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb22"><pre class="downlit">
<span class="co"># Snow</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="kw">beta_est_bayescomm_lv</span><span class="op">$</span><span class="kw">snow</span>, <span class="kw">beta_est_m1</span><span class="op">$</span><span class="kw">snow</span>,
     main=<span class="st">"beta_snow"</span>, xlab=<span class="st">"fitted by BayesComm"</span>, ylab=<span class="st">"fitted by jSDM"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(a=<span class="fl">0</span>, b=<span class="fl">1</span>, col=<span class="st">"red"</span>)
</pre></div>
<p><img src="SDM_JSDM_files/figure-html/BayesComm-comparison-lv-2.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb23"><pre class="downlit">
<span class="co"># Snow2</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="kw">beta_est_bayescomm_lv</span><span class="op">$</span><span class="kw">snow2</span>, <span class="kw">beta_est_m1</span><span class="op">$</span><span class="kw">snow2</span>,
     main=<span class="st">"beta_snow2"</span>, xlab=<span class="st">"fitted by BayesComm"</span>, ylab=<span class="st">"fitted by jSDM"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(a=<span class="fl">0</span>, b=<span class="fl">1</span>, col=<span class="st">"red"</span>)
</pre></div>
<p><img src="SDM_JSDM_files/figure-html/BayesComm-comparison-lv-3.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb24"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="kw">Z_BayesComm</span>, <span class="kw">m2</span><span class="op">$</span><span class="kw">Z_latent</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(a=<span class="fl">0</span>, b=<span class="fl">1</span>, col=<span class="st">"red"</span>)
</pre></div>
<p><img src="SDM_JSDM_files/figure-html/BayesComm-comparison-lv-4.png" width="576" style="display: block; margin: auto;"></p>
</div>
</div>
</div>
<div id="results" class="section level1">
<h1 class="hasAnchor">
<a href="#results" class="anchor"></a><span class="header-section-number">3</span> Results</h1>
<p>Comparison of models with and without latent variables.</p>
<div id="comparison-of-parameter-values" class="section level2">
<h2 class="hasAnchor">
<a href="#comparison-of-parameter-values" class="anchor"></a><span class="header-section-number">3.1</span> Comparison of parameter values</h2>
<p>We compare the intercept for each species between the two models.</p>
<div class="sourceCode" id="cb25"><pre class="downlit">
<span class="co"># Intercepts</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="kw">beta_m1</span>,<span class="st">"["</span>, <span class="fl">1</span>) , <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="kw">param_m2</span>, <span class="st">"["</span>, <span class="fl">1</span>), cex=<span class="kw">nobs_sp</span><span class="op">^</span>(<span class="fl">1</span><span class="op">/</span><span class="fl">3</span>),
     main=<span class="st">"Fixed species intercept beta"</span>,
     xlab=<span class="st">"m1 without latent variables"</span>, ylab=<span class="st">"m2 with latent variables"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(a=<span class="fl">0</span>, b=<span class="fl">1</span>, col=<span class="st">"red"</span>)
</pre></div>
<p><img src="SDM_JSDM_files/figure-html/comp-intercept-lv-1.png" width="576" style="display: block; margin: auto;"></p>
<p>We compare the effect of the environmental variables for each species between the two models.</p>
<div class="sourceCode" id="cb26"><pre class="downlit">
<span class="co"># Environmental variable effects</span>
<span class="co">for</span>(<span class="kw">k</span> <span class="co">in</span> <span class="fl">2</span><span class="op">:</span><span class="kw">np</span>){
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="kw">beta_m1</span>, <span class="st">"["</span>, <span class="kw">k</span>), <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="kw">param_m2</span>,<span class="st">"["</span>, <span class="kw">k</span>), cex=<span class="kw">nobs_sp</span><span class="op">^</span>(<span class="fl">1</span><span class="op">/</span><span class="fl">3</span>),
          main=<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"Fixed species effect "</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="kw">beta_m1</span>[[<span class="fl">1</span>]][<span class="kw">k</span>])),
     xlab=<span class="st">"m1 without latent variables"</span>, ylab=<span class="st">"m2 with latent variables"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(a=<span class="fl">0</span>, b=<span class="fl">1</span>, col=<span class="st">"red"</span>)
}
</pre></div>
<p><img src="SDM_JSDM_files/figure-html/comp-env-effect-lv-1.png" width="576" style="display: block; margin: auto;"><img src="SDM_JSDM_files/figure-html/comp-env-effect-lv-2.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div id="comparison-of-predictions" class="section level2">
<h2 class="hasAnchor">
<a href="#comparison-of-predictions" class="anchor"></a><span class="header-section-number">3.2</span> Comparison of predictions</h2>
<div class="sourceCode" id="cb27"><pre class="downlit">
<span class="co"># Predictions</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="kw">probit_theta_m1</span>, <span class="kw">probit_theta_m2</span>, cex=<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="kw">nobs_sp</span><span class="op">^</span>(<span class="fl">1</span><span class="op">/</span><span class="fl">3</span>), <span class="fl">75</span>),
     main=<span class="st">"Predicted probit(theta)"</span>,
     xlab=<span class="st">"m1 without latent variables"</span>, ylab=<span class="st">"m2 with latent variables"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(a=<span class="fl">0</span>, b=<span class="fl">1</span>, col=<span class="st">"red"</span>)
</pre></div>
<p><img src="SDM_JSDM_files/figure-html/comp-pred-lv-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div id="deviance" class="section level2">
<h2 class="hasAnchor">
<a href="#deviance" class="anchor"></a><span class="header-section-number">3.3</span> Deviance</h2>

<div class="sourceCode" id="cb28"><pre class="downlit">
<span class="co"># Deviance</span>
<span class="kw">dev_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(mod=<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"probit"</span>, <span class="st">"probit_lv"</span>),
                     dev=<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">deviance_m1</span>, <span class="kw">deviance_m2</span>))
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="kw">dev_df</span>) <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"m1 "</span>,<span class="st">"m2"</span>)
<span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(<span class="kw">dev_df</span>, caption=<span class="st">"Deviance comparison. Between probit models without and with latent variables and which may or may not include a random site effect. "</span>, booktabs=<span class="fl">TRUE</span>, digits=<span class="fl">0</span>, row.names=<span class="kw">T</span>) <span class="op">%&gt;%</span>
  <span class="fu">kable_styling</span>(position=<span class="st">"center"</span>, full_width = <span class="fl">FALSE</span>)
</pre></div>
<table class="table table">
<caption>
<span id="tab:comp-dev">Table 3.1: </span><strong>Deviance comparison</strong>. Between probit models without and with latent variables and which may or may not include a random site effect. 
</caption>
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
mod
</th>
<th style="text-align:right;">
dev
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
m1
</td>
<td style="text-align:left;">
probit
</td>
<td style="text-align:right;">
3919
</td>
</tr>
<tr>
<td style="text-align:left;">
m2
</td>
<td style="text-align:left;">
probit_lv
</td>
<td style="text-align:right;">
2962
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-Choler2005">
<p>Choler, P. (2005) Consistent shifts in alpine plant traits along a mesotopographical gradient. <em>Arctic, Antarctic, and Alpine Research</em>, <strong>37</strong>, 444–453.</p>
</div>
<div id="ref-Dray2007">
<p>Dray, S. &amp; Dufour, A.-B. (2007) The ade4 package: Implementing the duality diagram for ecologists. <em>Journal of Statistical Software</em>, <strong>22</strong>.</p>
</div>
<div id="ref-Warton2015">
<p>Warton, D.I., Blanchet, F.G., O’Hara, R.B., Ovaskainen, O., Taskinen, S., Walker, S.C. &amp; Hui, F.K. (2015) So many variables: Joint modeling in community ecology. <em>Trends in Ecology &amp; Evolution</em>, <strong>30</strong>, 766–779.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://ecology.ghislainv.fr">Ghislain Vieilledent</a>, Jeanne Clément, <a href="https://www.cirad.fr"><img src="https://ecology.ghislainv.fr/images/logos/logo-cirad.svg" height="24"></a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>

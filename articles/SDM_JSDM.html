<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Comparing SDMs and JSDMs • jSDM</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Comparing SDMs and JSDMs">
<meta property="og:description" content="jSDM">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">jSDM</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/jSDM.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Change log</a>
</li>
<li>
  <a></a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ghislainv/jSDM">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="SDM_JSDM_files/jquery-1.11.3/jquery.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1">
<link href="SDM_JSDM_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet">
<script src="SDM_JSDM_files/bootstrap-3.3.5/js/bootstrap.min.js"></script><script src="SDM_JSDM_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script><script src="SDM_JSDM_files/bootstrap-3.3.5/shim/respond.min.js"></script><style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="SDM_JSDM_files/navigation-1.1/tabsets.js"></script><script src="SDM_JSDM_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Comparing SDMs and JSDMs</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ghislainv/jSDM/blob/master/vignettes/SDM_JSDM.Rmd"><code>vignettes/SDM_JSDM.Rmd</code></a></small>
      <div class="hidden name"><code>SDM_JSDM.Rmd</code></div>

    </div>

    
    
<div id="dataset" class="section level1">
<h1 class="hasAnchor">
<a href="#dataset" class="anchor"></a><span class="header-section-number">1</span> Dataset</h1>
<div id="presence-absence-of-swiss-breeding-birds" class="section level2">
<h2 class="hasAnchor">
<a href="#presence-absence-of-swiss-breeding-birds" class="anchor"></a><span class="header-section-number">1.1</span> Presence-absence of Swiss breeding birds</h2>

<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:birds-picture"></span>
<img src="figures/swiss_breeding_birds_atlas.jpg" alt="Swiss Breeding Birds Atlas (Kéry &amp; Schmid 2006)." width="600" height="300"><p class="caption">
Figure 1.1: <strong><em>Swiss Breeding Birds Atlas</em></strong> <span class="citation">(Kéry &amp; Schmid <a href="#ref-Kery2006" role="doc-biblioref">2006</a>)</span>.
</p>
</div>
<p>This data-set is available in the <a href="https://ecology.ghislainv.fr/jSDM/reference/jSDM-package.html"><code>jSDM-package</code></a>. It can be loaded with the <code><a href="https://rdrr.io/r/utils/data.html">data()</a></code> command. The <a href="https://ecology.ghislainv.fr/jSDM/reference/birds.html"><code>birds</code></a> data-set is in “wide” format: each line is a site and the occurrence data are in columns.</p>
<p>The Swiss breeding bird survey (“Monitoring Häufige Brutvögel” MHB) has monitored the populations of 158 common species since 1999. The MHB sample consists of 267 1-km squares that are laid out as a grid across Switzerland. Fieldwork is conducted by about 200 skilled birdwatchers, most of them volunteers. Avian populations are monitored using a simplified territory mapping protocol, where each square is surveyed up to three times during the breeding season (only twice above the tree line).
Surveys are conducted along a transect that does not change over the years.</p>
<p>The data-set contains the 2014 data, except for one quadrat not surveyed in 2014.
It lists 158 bird species named in Latin and whose occurrences are expressed as the number of visits during which the species was observed on each site , with the exception of 13 species not surveyed in 2014 :</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://ecology.ghislainv.fr/jSDM">"jSDM"</a></span><span class="op">)</span>
<span class="co">#&gt; ##</span>
<span class="co">#&gt; ## jSDM R package </span>
<span class="co">#&gt; ## For joint species distribution models </span>
<span class="co">#&gt; ## https://ecology.ghislainv.fr/jSDM </span>
<span class="co">#&gt; ##</span>
<span class="co"># Import center and reduce birds dataset</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">birds</span>, package<span class="op">=</span><span class="st">"jSDM"</span><span class="op">)</span>
<span class="co"># data.obs</span>
<span class="va">PA_Birds</span> <span class="op">&lt;-</span> <span class="va">birds</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">158</span><span class="op">]</span></code></pre></div>
<p>We transform abundance into presence-absence data and remove species with less than 10 presences to facilitate MCMC convergence. We also look at the number of observations per site.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Transform abundance into presence-absence</span>
<span class="va">PA_Birds</span><span class="op">[</span><span class="va">PA_Birds</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="co"># Remove species with less than 10 presences</span>
<span class="va">rare_sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">PA_Birds</span>, <span class="fl">2</span>, <span class="va">sum</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">10</span><span class="op">)</span>
<span class="va">PA_Birds</span> <span class="op">&lt;-</span> <span class="va">PA_Birds</span><span class="op">[</span>, <span class="op">-</span><span class="va">rare_sp</span><span class="op">]</span>
<span class="co"># Number of sites and species</span>
<span class="va">nsite</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>
<span class="va">nsite</span>
<span class="co">#&gt; [1] 266</span>
<span class="va">nsp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>
<span class="va">nsp</span>
<span class="co">#&gt; [1] 93</span>
<span class="co"># Number of observations per site</span>
<span class="va">nobs_site</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">PA_Birds</span>, <span class="fl">1</span>, <span class="va">sum</span><span class="op">)</span>
<span class="va">nobs_site</span>
<span class="co">#&gt;   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18  19  20 </span>
<span class="co">#&gt;  30  32  49  38  44  37  34  35  41  35  40  42  24  41  44  37  42  45  38  42 </span>
<span class="co">#&gt;  21  22  23  24  25  26  27  28  29  31  32  33  34  35  36  37  38  39  40  41 </span>
<span class="co">#&gt;  39  38  44  37  34  42  45  37  40  43  47  34  38  35  34  45  30  27  37  45 </span>
<span class="co">#&gt;  42  43  44  45  46  47  48  49  50  51  52  53  54  55  56  57  58  59  60  61 </span>
<span class="co">#&gt;  41  35  34  35  14  37  38  15  42   8  43  31  42  38  33  45  43  42  44  32 </span>
<span class="co">#&gt;  62  63  64  65  66  67  68  69  70  71  72  73  74  75  76  77  78  79  80  81 </span>
<span class="co">#&gt;  36  25  37  42  33  34  44  30  38  42  36  41   7   8  27  37  38  40  47  22 </span>
<span class="co">#&gt;  82  83  84  85  86  87  88  89  90  91  92  93  94  95  96  97  98  99 100 101 </span>
<span class="co">#&gt;  24  38  17   6  11  38  46  34  43  30  32  39  36  40  39  47  39  31  18  40 </span>
<span class="co">#&gt; 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 </span>
<span class="co">#&gt;  45  44  41  38  41  41  27  44  44  32  33   6   6  47  36  45  25  17  30  32 </span>
<span class="co">#&gt; 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 </span>
<span class="co">#&gt;  34  13  43  47  37  41  27  39  48  32  37  48  37  33  31  31  42  44  44  44 </span>
<span class="co">#&gt; 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 </span>
<span class="co">#&gt;  10  32  27  24  41  42  25  32  15  41  10  26  43  35  27   9  33  32  28  44 </span>
<span class="co">#&gt; 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 </span>
<span class="co">#&gt;  48  37  26  35  31  35  39  14  42  40  35  29  30   7  33  34  29  30  33  24 </span>
<span class="co">#&gt; 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 </span>
<span class="co">#&gt;  28  29  48  16  21   7  36  34  20  35   8  33  44  42  33  26  24  30  32  31 </span>
<span class="co">#&gt; 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 </span>
<span class="co">#&gt;  33  37  26  14  24  39  33  40  36  41  38  39  30  31  50  46  40  36  33  19 </span>
<span class="co">#&gt; 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 </span>
<span class="co">#&gt;  54  35  17  36  40  30  47  46  41  42  44  28  40  19  38  40  28  35  31  17 </span>
<span class="co">#&gt; 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 </span>
<span class="co">#&gt;  35  41  19  32  37  38  45   9  39  15  14  34  38  18  17  10  28  12  10  26 </span>
<span class="co">#&gt; 262 263 264 265 266 267 </span>
<span class="co">#&gt;  30  30  32  12  45  50</span>
<span class="co"># Number of observations per species</span>
<span class="va">nobs_sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">PA_Birds</span>, <span class="fl">2</span>, <span class="va">sum</span><span class="op">)</span>
<span class="va">nobs_sp</span>
<span class="co">#&gt;            Anas platyrhynchos                 Milvus milvus </span>
<span class="co">#&gt;                            55                            95 </span>
<span class="co">#&gt;                Milvus migrans            Accipiter gentilis </span>
<span class="co">#&gt;                            87                            11 </span>
<span class="co">#&gt;               Accipiter nisus                   Buteo buteo </span>
<span class="co">#&gt;                            26                           152 </span>
<span class="co">#&gt;             Falco tinnunculus                 Tetrao tetrix </span>
<span class="co">#&gt;                           122                            49 </span>
<span class="co">#&gt;                  Lagopus muta                Bonasa bonasia </span>
<span class="co">#&gt;                            27                            13 </span>
<span class="co">#&gt;              Alectoris graeca                   Fulica atra </span>
<span class="co">#&gt;                            10                            14 </span>
<span class="co">#&gt;       Columba livia domestica                 Columba oenas </span>
<span class="co">#&gt;                            16                            20 </span>
<span class="co">#&gt;              Columba palumbus         Streptopelia decaocto </span>
<span class="co">#&gt;                           170                            30 </span>
<span class="co">#&gt;               Cuculus canorus                   Strix aluco </span>
<span class="co">#&gt;                           133                            19 </span>
<span class="co">#&gt;                     Apus apus                Jynx torquilla </span>
<span class="co">#&gt;                            55                            13 </span>
<span class="co">#&gt;                 Picus viridis             Dryocopus martius </span>
<span class="co">#&gt;                           114                           109 </span>
<span class="co">#&gt;             Dendrocopos major               Alauda arvensis </span>
<span class="co">#&gt;                           183                            48 </span>
<span class="co">#&gt;               Hirundo rustica        Ptyonoprogne rupestris </span>
<span class="co">#&gt;                            97                            32 </span>
<span class="co">#&gt;              Delichon urbicum               Oriolus oriolus </span>
<span class="co">#&gt;                            52                            15 </span>
<span class="co">#&gt;                  Corvus corax                 Corvus corone </span>
<span class="co">#&gt;                            89                           180 </span>
<span class="co">#&gt;                     Pica pica       Nucifraga caryocatactes </span>
<span class="co">#&gt;                            93                            67 </span>
<span class="co">#&gt;           Garrulus glandarius          Pyrrhocorax graculus </span>
<span class="co">#&gt;                           176                            42 </span>
<span class="co">#&gt;                   Parus major               Parus caeruleus </span>
<span class="co">#&gt;                           198                           163 </span>
<span class="co">#&gt;                    Parus ater               Parus cristatus </span>
<span class="co">#&gt;                           199                           151 </span>
<span class="co">#&gt;               Parus palustris                Parus montanus </span>
<span class="co">#&gt;                           123                           102 </span>
<span class="co">#&gt;           Aegithalos caudatus                Sitta europaea </span>
<span class="co">#&gt;                            70                           170 </span>
<span class="co">#&gt;            Certhia familiaris         Certhia brachydactyla </span>
<span class="co">#&gt;                           156                            88 </span>
<span class="co">#&gt;               Cinclus cinclus       Troglodytes troglodytes </span>
<span class="co">#&gt;                            32                           234 </span>
<span class="co">#&gt;            Erithacus rubecula          Phoenicurus ochruros </span>
<span class="co">#&gt;                           219                           244 </span>
<span class="co">#&gt;       Phoenicurus phoenicurus              Saxicola rubetra </span>
<span class="co">#&gt;                            61                            27 </span>
<span class="co">#&gt;             Oenanthe oenanthe           Monticola saxatilis </span>
<span class="co">#&gt;                            52                            11 </span>
<span class="co">#&gt;              Turdus torquatus                 Turdus merula </span>
<span class="co">#&gt;                            85                           223 </span>
<span class="co">#&gt;                Turdus pilaris             Turdus philomelos </span>
<span class="co">#&gt;                            88                           210 </span>
<span class="co">#&gt;             Turdus viscivorus        Acrocephalus palustris </span>
<span class="co">#&gt;                           190                            11 </span>
<span class="co">#&gt;            Sylvia atricapilla                  Sylvia borin </span>
<span class="co">#&gt;                           217                           101 </span>
<span class="co">#&gt;                Sylvia curruca        Phylloscopus trochilus </span>
<span class="co">#&gt;                            64                            15 </span>
<span class="co">#&gt;        Phylloscopus collybita          Phylloscopus bonelli </span>
<span class="co">#&gt;                           213                            67 </span>
<span class="co">#&gt;       Phylloscopus sibilatrix               Regulus regulus </span>
<span class="co">#&gt;                            35                           173 </span>
<span class="co">#&gt;           Regulus ignicapilla             Muscicapa striata </span>
<span class="co">#&gt;                           174                           107 </span>
<span class="co">#&gt;            Ficedula hypoleuca            Prunella modularis </span>
<span class="co">#&gt;                            51                           174 </span>
<span class="co">#&gt;             Prunella collaris              Anthus trivialis </span>
<span class="co">#&gt;                            36                            95 </span>
<span class="co">#&gt;             Anthus spinoletta                Motacilla alba </span>
<span class="co">#&gt;                            78                           185 </span>
<span class="co">#&gt;             Motacilla cinerea               Lanius collurio </span>
<span class="co">#&gt;                            77                            48 </span>
<span class="co">#&gt;              Sturnus vulgaris             Passer domesticus </span>
<span class="co">#&gt;                           108                           109 </span>
<span class="co">#&gt;               Passer montanus        Montifringilla nivalis </span>
<span class="co">#&gt;                            81                            24 </span>
<span class="co">#&gt; Coccothraustes coccothraustes             Carduelis chloris </span>
<span class="co">#&gt;                            41                           122 </span>
<span class="co">#&gt;           Carduelis carduelis              Carduelis spinus </span>
<span class="co">#&gt;                           116                            35 </span>
<span class="co">#&gt;           Carduelis cannabina             Carduelis cabaret </span>
<span class="co">#&gt;                            83                            49 </span>
<span class="co">#&gt;            Serinus citrinella               Serinus serinus </span>
<span class="co">#&gt;                            35                            75 </span>
<span class="co">#&gt;             Pyrrhula pyrrhula             Loxia curvirostra </span>
<span class="co">#&gt;                           112                            74 </span>
<span class="co">#&gt;             Fringilla coelebs           Emberiza citrinella </span>
<span class="co">#&gt;                           243                            95 </span>
<span class="co">#&gt;                  Emberiza cia </span>
<span class="co">#&gt;                            31</span></code></pre></div>
</div>
<div id="environmental-variables" class="section level2">
<h2 class="hasAnchor">
<a href="#environmental-variables" class="anchor"></a><span class="header-section-number">1.2</span> Environmental variables</h2>
<p>The environmental variables are:</p>
<ul>
<li>
<strong>elev</strong>: the mean elevation of the quadrat (m).</li>
<li>
<strong>forest</strong>: the percentage of forest cover in the quadrat.</li>
<li>
<strong>rlength</strong>: the length of the route walked in the quadrat (km).</li>
</ul>
<p>As a first approach, we just select the “elev” variable considering a quadratic orthogonal polynomial.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Normalized continuous variables</span>
<span class="va">Env_Birds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>elev<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">birds</span><span class="op">[</span>,<span class="st">"elev"</span><span class="op">]</span><span class="op">)</span>,elev2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">birds</span><span class="op">[</span>,<span class="st">"elev"</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Number of environmental variables plus intercept</span>
<span class="va">np</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">Env_Birds</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>
<span class="va">np</span>
<span class="co">#&gt; [1] 3</span></code></pre></div>
</div>
</div>
<div id="fitting-species-distribution-models-sdm" class="section level1">
<h1 class="hasAnchor">
<a href="#fitting-species-distribution-models-sdm" class="anchor"></a><span class="header-section-number">2</span> Fitting species distribution models (SDM)</h1>
<p>We consider a simple generalized linear multivariate model (GLMM) to estimate the occurrence probabilities on sites for each species such as :</p>
<p><span class="math display">\[y_{ij} \sim \mathcal{B}ernoulli(\theta_{ij})\]</span></p>
<p><span class="math display">\[ \mathrm{g}(\theta_{ij}) = X_i\beta_j \]</span></p>
<ul>
<li>
<span class="math inline">\(\mathrm{g}(\cdot)\)</span>: Link function (probit or logit).</li>
<li>
<span class="math inline">\(X_i\)</span>: Vector of explanatory variables for site <span class="math inline">\(i\)</span> (including intercept).</li>
<li>
<span class="math inline">\(\beta_j\)</span>: Effects of the explanatory variables on the probability of presence of species <span class="math inline">\(j\)</span>.</li>
</ul>
<p>We consider below binomial models with a probit link.</p>
<div id="using-bayescomm" class="section level2">
<h2 class="hasAnchor">
<a href="#using-bayescomm" class="anchor"></a><span class="header-section-number">2.1</span> Using <code>BayesComm</code>
</h2>
<p>In a first step, we use the package <code>BayesComm</code> described in the article <span class="citation">(Golding, Nunn &amp; Purse <a href="#ref-Golding2015" role="doc-biblioref">2015</a>)</span> to fit binomial models with a probit link function.
The package <code>BayesComm</code> fits Bayesian multivariate binary (probit) regression models for analysis of ecological communities. These models can be used to make inference about underlying inter-species interactions in communities and to separate the effects of environmental covariates and inter-species interactions on community assembly.
We want to compare the parameters of the models fitted with <code>BayesComm</code> and <code>jSDM</code>.</p>
<p>We estimate the parameters of the species distribution model (SDM) with the function <code><a href="https://rdrr.io/pkg/BayesComm/man/BC.html">BC()</a></code> and the argument <code>model="environment"</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">BayesComm</span><span class="op">)</span>
<span class="va">T1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">mod_BC</span> <span class="op">&lt;-</span> <span class="fu">BayesComm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/BayesComm/man/BC.html">BC</a></span><span class="op">(</span>Y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">)</span>, X<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">Env_Birds</span><span class="op">)</span>, model<span class="op">=</span><span class="st">"environment"</span>, its<span class="op">=</span><span class="fl">20000</span>, thin<span class="op">=</span><span class="fl">10</span>, burn<span class="op">=</span><span class="fl">10000</span><span class="op">)</span>
<span class="co"># Estimates</span>
<span class="va">beta_est_BC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>sp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">)</span>, intercept<span class="op">=</span><span class="cn">NA</span>, elev<span class="op">=</span><span class="cn">NA</span>,  elev2<span class="op">=</span><span class="cn">NA</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nsp</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">beta_est_BC</span><span class="op">[</span><span class="va">j</span>, <span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="va">np</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod_BC</span>, chain<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"B$"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">)</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">statistics</span><span class="op">[</span>, <span class="st">"Mean"</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>
<span class="co">#Z_BC &lt;- apply(mod_BC$trace$z,c(2,3), mean)</span>
<span class="va">T2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">T_BC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html">difftime</a></span><span class="op">(</span><span class="va">T2</span>,<span class="va">T1</span><span class="op">)</span>

<span class="co"># Deviance BayesComm</span>
<span class="va">X1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">nsite</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">Env_Birds</span><span class="op">)</span><span class="op">)</span>
<span class="va">probit_theta_latent_BC</span> <span class="op">&lt;-</span> <span class="va">X1</span> <span class="op">%*%</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">beta_est_BC</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Deviance</span>
<span class="va">logL</span><span class="op">=</span><span class="fl">0</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nsite</span><span class="op">)</span><span class="op">{</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nsp</span><span class="op">)</span><span class="op">{</span>
    <span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">pnorm</a></span><span class="op">(</span><span class="va">probit_theta_latent_BC</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span><span class="op">)</span>
    <span class="va">logL</span> <span class="op">=</span> <span class="va">logL</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">dbinom</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span>,<span class="fl">1</span>,<span class="va">theta</span>,<span class="fl">1</span><span class="op">)</span>  
  <span class="op">}</span>
<span class="op">}</span>
<span class="va">deviance_BC</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">2</span><span class="op">*</span><span class="va">logL</span>

<span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span><span class="va">mod_BC</span>, file<span class="op">=</span><span class="st">"SDM_JSDM_cache/BC.rda"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span><span class="va">beta_est_BC</span>, <span class="va">T_BC</span>, <span class="va">deviance_BC</span>, <span class="va">probit_theta_latent_BC</span>, file<span class="op">=</span><span class="st">"SDM_JSDM_files/BC.rda"</span><span class="op">)</span></code></pre></div>
<p>We visually evaluate the convergence of MCMCs by representing the trace and density a posteriori of the estimated parameters.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">BayesComm</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"SDM_JSDM_cache/BC.rda"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, oma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">2</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mod_BC</span>, chain<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"B$"</span>,<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/title.html">title</a></span><span class="op">(</span>main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"species "</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, outer<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
<div id="using-jsdm" class="section level2">
<h2 class="hasAnchor">
<a href="#using-jsdm" class="anchor"></a><span class="header-section-number">2.2</span> Using <code>jSDM</code>
</h2>
<p>In a second step, we use the package <code>jSDM</code> to fit binomial models with a probit link.</p>
<p>We estimate the parameters of the SDM with the function <code><a href="../reference/jSDM_binomial_probit.html">jSDM_binomial_probit()</a></code> and the argument <code>n_latent=0</code> set by default.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Load libraries</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va">doParallel</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RevolutionAnalytics/foreach">foreach</a></span><span class="op">)</span>

<span class="co">## Make a cluster for parallel MCMCs</span>
<span class="va">nchains</span> <span class="op">&lt;-</span> <span class="fl">2</span>
<span class="va">ncores</span> <span class="op">&lt;-</span> <span class="va">nchains</span> <span class="co">## One core for each MCMC chains</span>
<span class="va">clust</span> <span class="op">&lt;-</span> <span class="fu">makeCluster</span><span class="op">(</span><span class="va">ncores</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/doParallel/man/registerDoParallel.html">registerDoParallel</a></span><span class="op">(</span><span class="va">clust</span><span class="op">)</span>

<span class="co"># Starting values for two chains</span>
<span class="va">beta_start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>
<span class="co">#formatting of starting parameters generated by the function </span>
<span class="co"># Seeds</span>
<span class="va">seed_mcmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1234</span>, <span class="fl">4321</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ecology.ghislainv.fr/jSDM">jSDM</a></span><span class="op">)</span>
<span class="co"># Model with foreach and doPar call</span>
<span class="va">mod_probit</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/pkg/foreach/man/foreach.html">foreach</a></span> <span class="op">(</span>i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">nchains</span><span class="op">)</span> <span class="op">%dopar%</span> <span class="op">{</span>
    <span class="co"># Infering model parameters</span>
    <span class="va">T1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span>
    <span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">jSDM</span><span class="fu">::</span><span class="fu"><a href="../reference/jSDM_binomial_probit.html">jSDM_binomial_probit</a></span><span class="op">(</span>
      <span class="co"># Iterations</span>
      mcmc <span class="op">=</span> <span class="fl">10000</span>,
      thin <span class="op">=</span> <span class="fl">10</span>,
      burnin <span class="op">=</span> <span class="fl">10000</span>,
      <span class="co"># Data</span>
      presence_data <span class="op">=</span> <span class="va">PA_Birds</span>,
      site_data <span class="op">=</span> <span class="va">Env_Birds</span>,
      site_formula<span class="op">=</span><span class="op">~</span><span class="va">.</span>,
      <span class="co"># Priors</span>
      V_beta <span class="op">=</span><span class="fl">10</span>,
      mu_beta <span class="op">=</span> <span class="fl">0</span>,
      <span class="co"># Starting values</span>
      beta_start <span class="op">=</span> <span class="va">beta_start</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,
      <span class="co"># Other</span>
      seed <span class="op">=</span> <span class="va">seed_mcmc</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,
      verbose <span class="op">=</span> <span class="fl">0</span>
    <span class="op">)</span>
    <span class="va">T2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span>
    <span class="va">mod</span><span class="op">$</span><span class="va">T_jSDM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html">difftime</a></span><span class="op">(</span><span class="va">T2</span>,<span class="va">T1</span><span class="op">)</span>
    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span>
  <span class="op">}</span>

<span class="co"># Stop cluster</span>
<span class="co">#stopCluster(clust)</span></code></pre></div>
<p>Overview of the results :</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Output</span>
<span class="va">n_chains</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">mod_probit</span><span class="op">)</span>
<span class="va">mod_jSDM</span> <span class="op">&lt;-</span> <span class="va">mod_probit</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="va">str_jSDM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/capture.output.html">capture.output</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">mod_jSDM</span>, max.level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, collapse<span class="op">=</span><span class="st">"\n"</span><span class="op">)</span>
<span class="co"># Fitted values</span>
<span class="va">beta_jSDM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">mod_jSDM</span><span class="op">$</span><span class="va">mcmc.sp</span>, <span class="va">colMeans</span><span class="op">)</span>
<span class="co">#Z_latent_jSDM &lt;- mod_jSDM$Z_latent</span>
<span class="va">probit_theta_jSDM</span> <span class="op">&lt;-</span> <span class="va">mod_jSDM</span><span class="op">$</span><span class="va">probit_theta_latent</span>
<span class="va">deviance_jSDM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">mod_jSDM</span><span class="op">$</span><span class="va">mcmc.Deviance</span><span class="op">)</span>
<span class="va">T_jSDM</span> <span class="op">&lt;-</span> <span class="va">mod_jSDM</span><span class="op">$</span><span class="va">T_jSDM</span> 
<span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span><span class="va">T_jSDM</span>, <span class="va">n_chains</span>, <span class="va">str_jSDM</span>, <span class="va">beta_jSDM</span>, <span class="va">probit_theta_jSDM</span>, <span class="va">deviance_jSDM</span>, 
     file<span class="op">=</span><span class="st">"SDM_JSDM_files/jSDM.rda"</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; number of chains : 2
#&gt; content of each chain : List of 7
#&gt;  $ mcmc.Deviance      : 'mcmc' num [1:1000, 1] 17762 17805 17823 17782 17812 ...
#&gt;   ..- attr(*, "mcpar")= num [1:3] 10001 19991 10
#&gt;   ..- attr(*, "dimnames")=List of 2
#&gt;  $ mcmc.sp            :List of 93
#&gt;  $ Z_latent           : num [1:266, 1:93] -0.745 -0.732 0.458 -1.388 -1.741 ...
#&gt;  $ probit_theta_latent: num [1:266, 1:93] 0.175 0.175 -1.374 -1.173 -1.552 ...
#&gt;  $ theta_latent       : num [1:266, 1:93] 0.5689 0.5689 0.0877 0.1231 0.0634 ...
#&gt;  $ model_spec         :List of 15
#&gt;  $ T_jSDM             : 'difftime' num 2.02899392843246
#&gt;   ..- attr(*, "units")= chr "mins"
#&gt;  - attr(*, "class")= chr "jSDM"</code></pre>
<p>We evaluate the convergence of the MCMC output in which two parallel chains are run with starting values that are overdispersed relative to the posterior distribution.
Convergence is diagnosed when the chains have ‘forgotten’ their initial values, and the output from all chains is indistinguishable.
If the convergence diagnostic gives values of potential scale reduction factor or psrf
substantially above 1, its indicates lack of convergence.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va">coda</span><span class="op">)</span>
<span class="va">arr2mcmc</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html">mcmc</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="co"># MCMC lists</span>
<span class="va">mcmc_list_beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.list.html">mcmc.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">mod_probit</span>,<span class="st">"[["</span>,<span class="st">"mcmc.sp"</span><span class="op">)</span>, <span class="va">arr2mcmc</span><span class="op">)</span><span class="op">)</span>
<span class="co"># psrf gelman indice </span>
<span class="va">psrf_beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/gelman.diag.html">gelman.diag</a></span><span class="op">(</span><span class="va">mcmc_list_beta</span><span class="op">)</span><span class="op">$</span><span class="va">psrf</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span><span class="va">psrf_beta</span>, file<span class="op">=</span><span class="st">"SDM_JSDM_files/psrf.rda"</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; psrf beta: 1.01313</code></pre>
<p>We can also visually evaluate the convergence of MCMCs by representing the trace and density a posteriori of the estimated parameters.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, oma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">2</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mcmc_list_beta</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"sp_2.beta"</span>,<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">mcmc_list_beta</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/title.html">title</a></span><span class="op">(</span>main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"species "</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, outer<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="SDM_JSDM_files/figure-html/plot-jSDM-1.png" width="600" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="fitting-joint-species-distribution-models-jsdm" class="section level1">
<h1 class="hasAnchor">
<a href="#fitting-joint-species-distribution-models-jsdm" class="anchor"></a><span class="header-section-number">3</span> Fitting joint species distribution models (JSDM)</h1>
<p>We consider a latent variable model (LVM) to account for species co-occurrence on all sites <span class="citation">(Warton <em>et al.</em> <a href="#ref-Warton2015" role="doc-biblioref">2015</a>)</span> in the <code>jSDM</code> package, such as :</p>
<p><span class="math display">\[y_{ij} \sim \mathcal{B}ernoulli(\theta_{ij})\]</span></p>
<p><span class="math display">\[ \mathrm{g}(\theta_{ij}) = X_i\beta_j + W_i\lambda_j \]</span></p>
<ul>
<li>
<span class="math inline">\(\mathrm{g}(\cdot)\)</span>: Link function (probit or logit).</li>
<li>
<span class="math inline">\(X_i\)</span>: Vector of explanatory variables for site <span class="math inline">\(i\)</span> (including intercept).</li>
<li>
<span class="math inline">\(\beta_j\)</span>: Effects of the explanatory variables on the probability of presence of species <span class="math inline">\(j\)</span>.</li>
<li>
<span class="math inline">\(W_i\)</span>: Vector of random latent variables for site <span class="math inline">\(i\)</span>. <span class="math inline">\(W_i \sim N(0, 1)\)</span>. The number of latent variables must be fixed by the user (default to 2).</li>
<li>
<span class="math inline">\(\lambda_j\)</span>: Effects of the latent variables on the probability of presence of species <span class="math inline">\(j\)</span>. Also known as “factor loadings” <span class="citation">(Warton <em>et al.</em> <a href="#ref-Warton2015" role="doc-biblioref">2015</a>)</span>.</li>
</ul>
<p>This model is equivalent to the generalized linear multivariate model (GLMM) <span class="math inline">\(\mathrm{g}(\theta_{ij}) =\alpha_i + X_i.\beta_j + u_{ij}\)</span>, where <span class="math inline">\(u_{ij} \sim \mathcal{N}(0, \Sigma)\)</span> considered in the <code>BayesComm</code> package, with the constraint that the variance-covariance matrix <span class="math inline">\(\Sigma = \Lambda \Lambda^{\prime}\)</span>, where <span class="math inline">\(\Lambda\)</span> is the full matrix of factor loadings, with the <span class="math inline">\(\lambda_j\)</span> as its columns.</p>
<p>We consider below binomial models with a probit link.</p>
<div id="using-bayescomm-1" class="section level2">
<h2 class="hasAnchor">
<a href="#using-bayescomm-1" class="anchor"></a><span class="header-section-number">3.1</span> Using <code>BayesComm</code>
</h2>
<p>We estimate the parameters of the JSDM with the function <code><a href="https://rdrr.io/pkg/BayesComm/man/BC.html">BC()</a></code> and the argument <code>model="full"</code> (intercept, covariates and community matrix).</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">T1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">mod_BC_comm</span> <span class="op">&lt;-</span> <span class="fu">BayesComm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/BayesComm/man/BC.html">BC</a></span><span class="op">(</span>Y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">)</span>, X<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">Env_Birds</span><span class="op">)</span>, model<span class="op">=</span><span class="st">"full"</span>, its<span class="op">=</span><span class="fl">20000</span>, thin<span class="op">=</span><span class="fl">10</span>, burn<span class="op">=</span><span class="fl">10000</span><span class="op">)</span>
<span class="co"># Estimates</span>
<span class="va">beta_est_BC_comm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>sp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">)</span>, intercept<span class="op">=</span><span class="cn">NA</span>, elev<span class="op">=</span><span class="cn">NA</span>, elev2<span class="op">=</span><span class="cn">NA</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nsp</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">beta_est_BC_comm</span><span class="op">[</span><span class="va">j</span>, <span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="va">np</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod_BC_comm</span>, chain<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"B$"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">)</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">statistics</span><span class="op">[</span>, <span class="st">"Mean"</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>
<span class="co">#Z_BayesComm_com &lt;- apply(mod_BC_comm$trace$z,c(2,3), mean)</span>
<span class="va">T2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">T_BC_comm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html">difftime</a></span><span class="op">(</span><span class="va">T2</span>,<span class="va">T1</span><span class="op">)</span>

<span class="co"># Deviance BayesComm</span>
<span class="va">X1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">nsite</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">Env_Birds</span><span class="op">)</span><span class="op">)</span>
<span class="va">e</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">residuals</a></span><span class="op">(</span><span class="va">mod_BC_comm</span><span class="op">)</span>
<span class="va">probit_theta_latent_BC_comm</span> <span class="op">&lt;-</span> <span class="va">X1</span> <span class="op">%*%</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">beta_est_BC_comm</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="va">e</span>
<span class="co"># Deviance</span>
<span class="va">logL</span><span class="op">=</span><span class="fl">0</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nsite</span><span class="op">)</span><span class="op">{</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nsp</span><span class="op">)</span><span class="op">{</span>
    <span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">pnorm</a></span><span class="op">(</span><span class="va">probit_theta_latent_BC_comm</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span><span class="op">)</span>
    <span class="va">logL</span> <span class="op">=</span> <span class="va">logL</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">dbinom</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span>,<span class="fl">1</span>,<span class="va">theta</span>,<span class="fl">1</span><span class="op">)</span>  
  <span class="op">}</span>
<span class="op">}</span>
<span class="va">deviance_BC_comm</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">2</span><span class="op">*</span><span class="va">logL</span>

<span class="co"># Correlation matrix</span>
<span class="va">R</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">mod_BC_comm</span><span class="op">$</span><span class="va">trace</span><span class="op">$</span><span class="va">R</span>,<span class="fl">2</span>,<span class="va">mean</span><span class="op">)</span>
<span class="va">R_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">nsp</span>,<span class="va">nsp</span><span class="op">)</span>
<span class="va">species</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">R_mat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">R_mat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">species</span>
<span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nsp</span><span class="op">)</span><span class="op">{</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">jprim</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nsp</span><span class="op">)</span><span class="op">{</span>
    <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">species</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>,<span class="st">"_"</span>,<span class="va">species</span><span class="op">[</span><span class="va">jprim</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">R</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">!=</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span>
      <span class="va">R_mat</span><span class="op">[</span><span class="va">j</span>,<span class="va">jprim</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">R_mat</span><span class="op">[</span><span class="va">jprim</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="va">R</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">species</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>,<span class="st">"_"</span>,<span class="va">species</span><span class="op">[</span><span class="va">jprim</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">R</span><span class="op">)</span><span class="op">)</span> <span class="op">]</span>  
    <span class="op">}</span>
  <span class="op">}</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span><span class="va">mod_BC_comm</span>, file<span class="op">=</span><span class="st">"SDM_JSDM_cache/BC_comm.rda"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span><span class="va">beta_est_BC_comm</span>, <span class="va">T_BC_comm</span>, <span class="va">R_mat</span>,
     <span class="va">deviance_BC_comm</span>, <span class="va">probit_theta_latent_BC_comm</span>,
     file<span class="op">=</span><span class="st">"SDM_JSDM_files/BC_comm.rda"</span><span class="op">)</span></code></pre></div>
<p>We visually evaluate the convergence of MCMCs by representing the trace and density a posteriori of the estimated parameters.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"SDM_JSDM_cache/BC_comm.rda"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, oma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">2</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mod_BC_comm</span>, chain<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"B$"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/title.html">title</a></span><span class="op">(</span>main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"species "</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, outer<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="SDM_JSDM_files/figure-html/plot-BC_comm-1.png" width="600" style="display: block; margin: auto;"></p>
</div>
<div id="using-jsdm-1" class="section level2">
<h2 class="hasAnchor">
<a href="#using-jsdm-1" class="anchor"></a><span class="header-section-number">3.2</span> Using <code>jSDM</code>
</h2>
<p>We estimate the latent variables model parameters with the function <code><a href="../reference/jSDM_binomial_probit.html">jSDM_binomial_probit()</a></code> and the argument <code>n_latent=2</code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">parallel</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">doParallel</span><span class="op">)</span>
<span class="co">## Make a cluster for parallel MCMCs</span>
<span class="va">nchains</span> <span class="op">&lt;-</span> <span class="fl">2</span>
<span class="va">ncores</span> <span class="op">&lt;-</span> <span class="va">nchains</span> <span class="co">## One core for each MCMC chains</span>
<span class="va">clust</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html">makeCluster</a></span><span class="op">(</span><span class="va">ncores</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/doParallel/man/registerDoParallel.html">registerDoParallel</a></span><span class="op">(</span><span class="va">clust</span><span class="op">)</span>

<span class="co"># Starting parameters </span>
<span class="va">lambda_start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>
<span class="va">beta_start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>
<span class="va">W_start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="op">-</span><span class="fl">0.1</span><span class="op">)</span>
<span class="co">#formatting of starting parameters</span>
<span class="co">#and constraints on lambda generated by the function </span>
<span class="co"># Seeds</span>
<span class="va">seed_mcmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1234</span>, <span class="fl">4321</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Model</span>
<span class="va">mod_probit_lv</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/pkg/foreach/man/foreach.html">foreach</a></span> <span class="op">(</span>i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">nchains</span><span class="op">)</span> <span class="op">%dopar%</span> <span class="op">{</span>
    <span class="co"># Infering model parameters</span>
    <span class="va">T1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span>
    <span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">jSDM</span><span class="fu">::</span><span class="fu"><a href="../reference/jSDM_binomial_probit.html">jSDM_binomial_probit</a></span><span class="op">(</span>
      <span class="co"># Iterations</span>
      burnin<span class="op">=</span><span class="fl">10000</span>, mcmc<span class="op">=</span><span class="fl">10000</span>, thin<span class="op">=</span><span class="fl">10</span>,
      <span class="co"># Data</span>
      presence_data<span class="op">=</span><span class="va">PA_Birds</span>,
      site_data <span class="op">=</span> <span class="va">Env_Birds</span>,
      site_formula <span class="op">=</span> <span class="op">~</span><span class="va">.</span>,
      <span class="co"># Model specification </span>
      n_latent<span class="op">=</span><span class="fl">2</span>,
      site_effect<span class="op">=</span><span class="st">"none"</span>,
      <span class="co"># Priors</span>
      V_beta <span class="op">=</span><span class="fl">10</span>,
      mu_beta <span class="op">=</span> <span class="fl">0</span>,
      mu_lambda <span class="op">=</span> <span class="fl">0</span>,
      V_lambda<span class="op">=</span> <span class="fl">10</span>,
      <span class="co"># Starting values</span>
      beta_start <span class="op">=</span> <span class="va">beta_start</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,
      lambda_start <span class="op">=</span> <span class="va">lambda_start</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,
      W_start <span class="op">=</span> <span class="va">W_start</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,
      <span class="co"># Other</span>
      seed <span class="op">=</span> <span class="va">seed_mcmc</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,
      verbose <span class="op">=</span> <span class="fl">0</span>
    <span class="op">)</span>
    <span class="va">T2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span>
    <span class="va">mod</span><span class="op">$</span><span class="va">T_jSDM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html">difftime</a></span><span class="op">(</span><span class="va">T2</span>,<span class="va">T1</span><span class="op">)</span>
    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span>
  <span class="op">}</span>
<span class="co"># Stop cluster</span>
<span class="co">#stopCluster(clust)</span></code></pre></div>
<p>Overview of the results :</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Output</span>
<span class="va">n_chains</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">mod_probit_lv</span><span class="op">)</span>
<span class="va">mod_jSDM_lv</span> <span class="op">&lt;-</span> <span class="va">mod_probit_lv</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="va">str_jSDM_lv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/capture.output.html">capture.output</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">mod_jSDM_lv</span>, max.level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, collapse<span class="op">=</span><span class="st">"\n"</span><span class="op">)</span>
<span class="co"># Fitted values</span>
<span class="va">param_jSDM_lv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">mod_jSDM_lv</span><span class="op">$</span><span class="va">mcmc.sp</span>, <span class="va">colMeans</span><span class="op">)</span>
<span class="co">#Z_latent_jSDM_lv &lt;- mod_jSDM_lv$Z_latent</span>
<span class="va">probit_theta_jSDM_lv</span> <span class="op">&lt;-</span> <span class="va">mod_jSDM_lv</span><span class="op">$</span><span class="va">probit_theta_latent</span>
<span class="va">deviance_jSDM_lv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">mod_jSDM_lv</span><span class="op">$</span><span class="va">mcmc.Deviance</span><span class="op">)</span>
<span class="va">T_jSDM_lv</span> <span class="op">&lt;-</span> <span class="va">mod_jSDM_lv</span><span class="op">$</span><span class="va">T_jSDM</span>
<span class="va">residual_corr_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_residual_cor.html">get_residual_cor</a></span><span class="op">(</span><span class="va">mod_jSDM_lv</span><span class="op">)</span><span class="op">$</span><span class="va">cor.mean</span>
<span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span><span class="va">T_jSDM_lv</span>, <span class="va">n_chains</span>, <span class="va">str_jSDM_lv</span>, <span class="va">param_jSDM_lv</span>, <span class="va">probit_theta_jSDM_lv</span>, <span class="va">deviance_jSDM_lv</span>, <span class="va">residual_corr_mat</span>, 
     file<span class="op">=</span><span class="st">"SDM_JSDM_files/jSDM_lv.rda"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"SDM_JSDM_files/jSDM_lv.rda"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"number of chains :"</span>, <span class="va">n_chains</span>,<span class="st">"\n"</span><span class="op">)</span>
<span class="co">#&gt; number of chains : 2</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"content of each chain :"</span>, <span class="va">str_jSDM_lv</span>,<span class="st">"\n"</span><span class="op">)</span>
<span class="co">#&gt; content of each chain : List of 8</span>
<span class="co">#&gt;  $ mcmc.Deviance      : 'mcmc' num [1:1000, 1] 14753 14784 14734 14789 14713 ...</span>
<span class="co">#&gt;   ..- attr(*, "mcpar")= num [1:3] 10001 19991 10</span>
<span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;  $ mcmc.sp            :List of 93</span>
<span class="co">#&gt;  $ mcmc.latent        :List of 2</span>
<span class="co">#&gt;  $ Z_latent           : num [1:266, 1:93] -0.788 -0.802 0.5 -1.388 -1.559 ...</span>
<span class="co">#&gt;  $ probit_theta_latent: num [1:266, 1:93] 0.0226 0.05 -1.16 -1.2047 -1.374 ...</span>
<span class="co">#&gt;  $ theta_latent       : num [1:266, 1:93] 0.5089 0.5197 0.1293 0.1187 0.0904 ...</span>
<span class="co">#&gt;  $ model_spec         :List of 20</span>
<span class="co">#&gt;  $ T_jSDM             : 'difftime' num 4.34671612183253</span>
<span class="co">#&gt;   ..- attr(*, "units")= chr "mins"</span>
<span class="co">#&gt;  - attr(*, "class")= chr "jSDM"</span></code></pre></div>
<p>We then evaluate if the chains have ‘forgotten’ their initial values, and if the output from all chains is indistinguishable.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># psrf</span>
<span class="va">mcmc_list_param</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.list.html">mcmc.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">mod_probit_lv</span>,<span class="st">"[["</span>,<span class="st">"mcmc.sp"</span><span class="op">)</span>, <span class="va">arr2mcmc</span><span class="op">)</span><span class="op">)</span>
<span class="va">mcmc_list_centered_lambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.list.html">mcmc.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span>
  <span class="va">mcmc_list_param</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"lambda"</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"sp_1.lambda_2"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">mcmc_list_param</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
                                       invert<span class="op">=</span><span class="cn">TRUE</span>, value<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,value<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span>,
  <span class="va">scale</span>, scale<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>,<span class="va">arr2mcmc</span><span class="op">)</span><span class="op">)</span>
<span class="va">mcmc_list_lv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.list.html">mcmc.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">mod_probit_lv</span>,
                                        <span class="st">"[["</span>,<span class="st">"mcmc.latent"</span><span class="op">)</span>, <span class="va">arr2mcmc</span><span class="op">)</span><span class="op">)</span>
<span class="va">mcmc_list_centered_lv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.list.html">mcmc.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">mcmc_list_lv</span>, <span class="va">scale</span>, scale<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>,<span class="va">arr2mcmc</span><span class="op">)</span><span class="op">)</span>
<span class="va">psrf_beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/gelman.diag.html">gelman.diag</a></span><span class="op">(</span><span class="va">mcmc_list_param</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="va">np</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">psrf</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="va">psrf_lv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/gelman.diag.html">gelman.diag</a></span><span class="op">(</span><span class="va">mcmc_list_centered_lv</span><span class="op">)</span><span class="op">$</span><span class="va">psrf</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="va">psrf_lambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/gelman.diag.html">gelman.diag</a></span><span class="op">(</span><span class="va">mcmc_list_centered_lambda</span><span class="op">)</span><span class="op">$</span><span class="va">psrf</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span><span class="va">psrf_beta</span>, <span class="va">psrf_lv</span>, <span class="va">psrf_lambda</span>, file<span class="op">=</span><span class="st">"SDM_JSDM_files/psrf_lv.rda"</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; psrf latent variables W : 1.021986
#&gt; psrf lambda: 1.033683
#&gt; psrf beta: 1.106444</code></pre>
<p>The convergence diagnostic gives values of potential scale reduction factor or psrf
not substantially above 1, its indicates some convergence.</p>
<p>We visually evaluate the convergence of MCMCs by representing the trace and density a posteriori of the estimated parameters.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, oma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">2</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mcmc_list_param</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"sp_2.beta"</span>,<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">mcmc_list_param</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/title.html">title</a></span><span class="op">(</span>main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"species "</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, outer<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="SDM_JSDM_files/figure-html/plot-jSDM-lv-1.png" width="600" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="comparison-of-results" class="section level1">
<h1 class="hasAnchor">
<a href="#comparison-of-results" class="anchor"></a><span class="header-section-number">4</span> Comparison of results</h1>
<div id="deviance-and-compilation-time" class="section level2">
<h2 class="hasAnchor">
<a href="#deviance-and-compilation-time" class="anchor"></a><span class="header-section-number">4.1</span> Deviance and compilation time</h2>

</div>
<div id="parameter-values" class="section level2">
<h2 class="hasAnchor">
<a href="#parameter-values" class="anchor"></a><span class="header-section-number">4.2</span> Parameter values</h2>
<p>The sizes of the dots on the following graphs are proportional to the number of observations per species. Parameters related to abundant species are represented by larger dots than those associated with rare species.</p>
<p>First, we compare the intercept for each species between classical or joint species distribution model that takes into account co-occurrences between species, fitted using <code>BayesComm</code> or <code>jSDM</code>.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Intercepts</span>
<span class="co">## jSDM</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">beta_jSDM</span>,<span class="st">"["</span>, <span class="fl">1</span><span class="op">)</span> , <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">param_jSDM_lv</span>, <span class="st">"["</span>, <span class="fl">1</span><span class="op">)</span>, cex<span class="op">=</span><span class="va">nobs_sp</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">5</span><span class="op">)</span>,
     main<span class="op">=</span><span class="st">"Fixed species intercept beta"</span>,
     xlab<span class="op">=</span><span class="st">"SDM"</span>, ylab<span class="op">=</span><span class="st">"JSDM"</span><span class="op">)</span>
<span class="co"># BayesComm</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">beta_est_BC</span><span class="op">$</span><span class="va">intercept</span>, <span class="va">beta_est_BC_comm</span><span class="op">$</span><span class="va">intercept</span>,
       cex<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">nobs_sp</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">5</span><span class="op">)</span>,<span class="fl">75</span><span class="op">)</span>, col<span class="op">=</span><span class="st">'blue'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>, b<span class="op">=</span><span class="fl">1</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"fitted by BayesComm"</span>,<span class="st">"fitted by jSDM"</span><span class="op">)</span>, pch<span class="op">=</span><span class="fl">1</span>, cex<span class="op">=</span><span class="fl">1.2</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'blue'</span>,<span class="st">'black'</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>, b<span class="op">=</span><span class="fl">1</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></code></pre></div>
<p><img src="SDM_JSDM_files/figure-html/comp-intercept-1.png" width="600" style="display: block; margin: auto;"></p>
<p>We compare the effect of the environmental variables for each species between the four models.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Environmental variable effects</span>
<span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">np</span><span class="op">)</span><span class="op">{</span>
<span class="co">## jSDM</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">beta_jSDM</span>, <span class="st">"["</span>, <span class="va">k</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">param_jSDM_lv</span>,<span class="st">"["</span>, <span class="va">k</span><span class="op">)</span>, cex<span class="op">=</span><span class="va">nobs_sp</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">5</span><span class="op">)</span>,
          main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Fixed species effect "</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">beta_jSDM</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">k</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,
     xlab<span class="op">=</span><span class="st">"SDM"</span>, ylab<span class="op">=</span><span class="st">"JSDM"</span><span class="op">)</span>
<span class="co">## BayesComm</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">beta_est_BC</span><span class="op">[</span>,<span class="va">k</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span>, <span class="va">beta_est_BC_comm</span><span class="op">[</span>,<span class="va">k</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span>,
       cex<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">nobs_sp</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">5</span><span class="op">)</span>,<span class="fl">75</span><span class="op">)</span>, col<span class="op">=</span><span class="st">'blue'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>, b<span class="op">=</span><span class="fl">1</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"fitted by BayesComm"</span>,<span class="st">"fitted by jSDM"</span><span class="op">)</span>, pch<span class="op">=</span><span class="fl">1</span>, cex<span class="op">=</span><span class="fl">1.2</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'blue'</span>,<span class="st">'black'</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p><img src="SDM_JSDM_files/figure-html/comp-env-effect-1.png" width="600" style="display: block; margin: auto;"><img src="SDM_JSDM_files/figure-html/comp-env-effect-2.png" width="600" style="display: block; margin: auto;"></p>
</div>
<div id="predictions" class="section level2">
<h2 class="hasAnchor">
<a href="#predictions" class="anchor"></a><span class="header-section-number">4.3</span> Predictions</h2>
<p>We compare the probit of occurence probabilities predicted by the classical or joint species distribution, fitted using <code>BayesComm</code> or <code>jSDM</code>.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Predictions</span>
<span class="co">## jSDM</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">probit_theta_jSDM</span>, <span class="va">probit_theta_jSDM_lv</span>,
     cex<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">nobs_sp</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">5</span><span class="op">)</span>, <span class="fl">75</span><span class="op">)</span>,
     main<span class="op">=</span><span class="st">"Predicted probit(theta)"</span>,
     xlab<span class="op">=</span><span class="st">"SDM"</span>,
     ylab<span class="op">=</span><span class="st">"JSDM"</span><span class="op">)</span>
<span class="co">## BayesComm</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">probit_theta_latent_BC</span>, <span class="va">probit_theta_latent_BC_comm</span>,
       cex<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">nobs_sp</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">5</span><span class="op">)</span>,<span class="fl">75</span><span class="op">)</span>, col<span class="op">=</span><span class="st">'blue'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>, b<span class="op">=</span><span class="fl">1</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"fitted by BayesComm"</span>,<span class="st">"fitted by jSDM"</span><span class="op">)</span>, pch<span class="op">=</span><span class="fl">1</span>, cex<span class="op">=</span><span class="fl">1.2</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'blue'</span>,<span class="st">'black'</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="SDM_JSDM_files/figure-html/comp-pred-1.png" width="600" style="display: block; margin: auto;"></p>
</div>
<div id="residual-correlaton-matrix" class="section level2">
<h2 class="hasAnchor">
<a href="#residual-correlaton-matrix" class="anchor"></a><span class="header-section-number">4.4</span> Residual correlaton matrix</h2>
<p>After fitting the jSDM with latent variables, the <strong>full species residual correlation matrix</strong> <span class="math inline">\(R=(R_{ij})^{i=1,\ldots, nspecies}_{j=1,\ldots, nspecies}\)</span> can be derived from the covariance in the latent variables such as :
<span class="math display">\[\Sigma_{ij} = \begin{cases}
 \lambda_i .\lambda_j^T &amp; \text{ if } i \neq j \\
  \lambda_i .\lambda_j^T + 1 &amp; \text{ if } i=j
 \end{cases}\]</span>, then we compute correlations from covariances :
<span class="math display">\[R_{i,j} = \frac{\Sigma_{ij}}{\sqrt{\Sigma _{ii}\Sigma _{jj}}}\]</span>.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Residual correlation matrix obtained with BayesComm</span>
<span class="va">reorder.cor.mean</span> <span class="op">&lt;-</span> <span class="fu">corrplot</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/corrplot/man/corrMatOrder.html">corrMatOrder</a></span><span class="op">(</span><span class="va">R_mat</span>, order <span class="op">=</span> <span class="st">"FPC"</span>, hclust.method <span class="op">=</span> <span class="st">"average"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>cex<span class="op">=</span><span class="fl">1</span>, cex.main<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span>
<span class="fu">corrplot</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/corrplot/man/corrplot.html">corrplot</a></span><span class="op">(</span><span class="va">R_mat</span><span class="op">[</span><span class="va">reorder.cor.mean</span>,<span class="va">reorder.cor.mean</span><span class="op">]</span>, title <span class="op">=</span> <span class="st">"Residual Correlation Matrix from BayesComm"</span>, diag <span class="op">=</span> <span class="cn">F</span>, type <span class="op">=</span> <span class="st">"lower"</span>, method <span class="op">=</span> <span class="st">"color"</span>,  mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span>, tl.srt <span class="op">=</span> <span class="fl">40</span>, tl.cex <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span>

<span class="co"># Residual correlation matrix obtained with jSDM</span>
<span class="va">reorder.cor.mean</span> <span class="op">&lt;-</span> <span class="fu">corrplot</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/corrplot/man/corrMatOrder.html">corrMatOrder</a></span><span class="op">(</span><span class="va">residual_corr_mat</span>, order <span class="op">=</span> <span class="st">"FPC"</span>, hclust.method <span class="op">=</span> <span class="st">"average"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">residual_corr_mat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">residual_corr_mat</span><span class="op">)</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">PA_Birds</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>cex<span class="op">=</span><span class="fl">1</span>, cex.main<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span>
<span class="fu">corrplot</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/corrplot/man/corrplot.html">corrplot</a></span><span class="op">(</span><span class="va">residual_corr_mat</span><span class="op">[</span><span class="va">reorder.cor.mean</span>,<span class="va">reorder.cor.mean</span><span class="op">]</span>, title <span class="op">=</span> <span class="st">"Residual Correlation Matrix from jSDM"</span>, diag <span class="op">=</span> <span class="cn">F</span>, type <span class="op">=</span> <span class="st">"lower"</span>, method <span class="op">=</span> <span class="st">"color"</span>,  mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span>, tl.srt <span class="op">=</span> <span class="fl">40</span>, tl.cex <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span></code></pre></div>
<p><img src="SDM_JSDM_files/figure-html/residual_correlation_matrix-1.png" width="600" style="display: block; margin: auto;"><img src="SDM_JSDM_files/figure-html/residual_correlation_matrix-2.png" width="600" style="display: block; margin: auto;"></p>
<p>In one hand, the results obtained with <code>jSDM</code> and <code>BayesComm</code> are quite similar and therefore the use of a latent variable model (LVM) rather than a classical GLMM has only a minimal influence on the estimated values of the species effects (<span class="math inline">\(\beta\)</span>).</p>
<p>On the other hand, the estimated values of the species intercept are quite similar using a classical species distribution model (SDM) or a joint species distribution model (JSDM), but the estimated values of the other species effects differ slightly.</p>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-Golding2015">
<p>Golding, N., Nunn, M.A. &amp; Purse, B.V. (2015) Identifying biotic interactions which drive the spatial distribution of a mosquito community. <em>Parasites &amp; Vectors</em>, <strong>8</strong>, 367.</p>
</div>
<div id="ref-Kery2006">
<p>Kéry, M. &amp; Schmid, H. (2006) Estimating species richness: Calibrating a large avian monitoring programme. <em>Journal of Applied Ecology</em>, <strong>43</strong>, 101–110.</p>
</div>
<div id="ref-Warton2015">
<p>Warton, D.I., Blanchet, F.G., O’Hara, R.B., Ovaskainen, O., Taskinen, S., Walker, S.C. &amp; Hui, F.K.C. (2015) So many variables: Joint modeling in community ecology. <em>Trends in Ecology &amp; Evolution</em>, <strong>30</strong>, 766–779.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jeanne Clément, <a href="https://ecology.ghislainv.fr">Ghislain Vieilledent</a>, <a href="https://www.cirad.fr"><img src="https://ecology.ghislainv.fr/images/logos/logo-cirad.svg" height="24"></a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>

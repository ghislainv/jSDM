<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Binomial probit regression with selected constrained species — jSDM_binomial_probit_sp_constrained • jSDM</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Binomial probit regression with selected constrained species — jSDM_binomial_probit_sp_constrained"><meta property="og:description" content="The jSDM_binomial_probit_sp_constrained function performs in parallel Binomial probit regressions in a Bayesian framework. The function calls a Gibbs sampler written in C++ code which uses conjugate priors to estimate the conditional posterior distribution of model's parameters. Then the function evaluates the convergence of MCMC \(\lambda\) chains using the Gelman-Rubin convergence diagnostic (\(\hat{R}\)). \(\hat{R}\) is computed using the gelman.diag function. We identify the species (\(\hat{j}_l\)) having the higher \(\hat{R}\) for \(\lambda_{\hat{j}_l}\). These species drive the structure of the latent axis \(l\). The \(\lambda\) corresponding to this species are constrained to be positive and placed on the diagonal of the \(\Lambda\) matrix for fitting a second model. This usually improves the convergence of the latent variables and factor loadings. The function returns the parameter posterior distributions for this second model."><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">jSDM</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/jSDM.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Change log</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/ghislainv/jSDM" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Binomial probit regression with selected constrained species</h1>
    <small class="dont-index">Source: <a href="https://github.com/ghislainv/jSDM/blob/HEAD/R/jSDM_binomial_probit_sp_constrained.R" class="external-link"><code>R/jSDM_binomial_probit_sp_constrained.R</code></a></small>
    <div class="hidden name"><code>jSDM_binomial_probit_sp_constrained.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The <code>jSDM_binomial_probit_sp_constrained</code> function performs in parallel Binomial probit regressions in a Bayesian framework. The function calls a Gibbs sampler written in C++ code which uses conjugate priors to estimate the conditional posterior distribution of model's parameters. Then the function evaluates the convergence of MCMC \(\lambda\) chains using the Gelman-Rubin convergence diagnostic (\(\hat{R}\)). \(\hat{R}\) is computed using the <code><a href="https://rdrr.io/pkg/coda/man/gelman.diag.html" class="external-link">gelman.diag</a></code> function. We identify the species (\(\hat{j}_l\)) having the higher \(\hat{R}\) for \(\lambda_{\hat{j}_l}\). These species drive the structure of the latent axis \(l\). The \(\lambda\) corresponding to this species are constrained to be positive and placed on the diagonal of the \(\Lambda\) matrix for fitting a second model. This usually improves the convergence of the latent variables and factor loadings. The function returns the parameter posterior distributions for this second model.</p>
    </div>


    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>burnin</dt>
<dd><p>The number of burn-in iterations for the sampler.</p></dd>


<dt>mcmc</dt>
<dd><p>The number of Gibbs iterations for the sampler. Total number of Gibbs iterations is equal to <code>burnin+mcmc</code> for each chain.
<code>burnin+mcmc</code> must be divisible by 10 and superior or equal to 100 so that the progress bar can be displayed.</p></dd>


<dt>thin</dt>
<dd><p>The thinning interval used in the simulation. The number of MCMC iterations must be divisible by this value.</p></dd>


<dt>nchains</dt>
<dd><p>The number of Monte Carlo Markov Chains (MCMCs) simulated in parallel. If not specified, the number of chains is set to 2.</p></dd>


<dt>ncores</dt>
<dd><p>The number of cores to use for parallel execution. If not specified, the number of cores is set to 2.</p></dd>


<dt>presence_data</dt>
<dd><p>A matrix \(n_{site} \times n_{species}\) indicating the presence by a 1 (or the absence by a 0) of each species on each site.</p></dd>


<dt>site_formula</dt>
<dd><p>A one-sided formula of the form '~x1+...+xp' specifying the explanatory variables for the suitability process of the model,
used to form the design matrix \(X\) of size \(n_{site} \times np\).</p></dd>


<dt>site_data</dt>
<dd><p>A data frame containing the model's explanatory variables by site.</p></dd>


<dt>trait_data</dt>
<dd><p>A data frame containing the species traits which can be included as part of the model. Default to <code>NULL</code> to fit a model without species traits.</p></dd>


<dt>trait_formula</dt>
<dd><p>A one-sided formula of the form '~ t1 + ... + tk + x1:t1 + ... + xp:tk' specifying the interactions between the environmental variables and the species traits to be considered in the model,
used to form the trait design matrix \(Tr\) of size \(n_{species} \times nt\) and to set to \(0\) the \(\gamma\) parameters corresponding to interactions not taken into account according to the formula. 
Default to <code>NULL</code> to fit a model with all possible interactions between species traits found in <code>trait_data</code> and environmental variables defined by <code>site_formula</code>.</p></dd>


<dt>n_latent</dt>
<dd><p>An integer which specifies the number of latent variables to generate. Defaults to \(0\).</p></dd>


<dt>site_effect</dt>
<dd><p>A string indicating whether row effects are included as fixed effects (<code>"fixed"</code>), as random effects (<code>"random"</code>), or not included (<code>"none"</code>) in the model. 
If fixed effects, then for parameter identifiability the first row effect is set to zero, which analogous to acting as a reference level when dummy variables are used.
If random effects, they are drawn from a normal distribution with mean zero and unknown variance, analogous to a random intercept in mixed models. Defaults to <code>"none"</code>.</p></dd>


<dt>beta_start</dt>
<dd><p>Starting values for \(\beta\) parameters of the suitability process for each species must be either a scalar or a \(np \times n_{species}\) matrix.
If <code>beta_start</code> takes a scalar value, then that value will serve for all of the \(\beta\) parameters. 
Different starting values for each chain can be specified by a list or a vector of length <code>nchains</code>, by default the same starting values are considered for all chains.</p></dd>


<dt>gamma_start</dt>
<dd><p>Starting values for \(\gamma\) parameters that represent the influence of species-specific traits on species' responses \(\beta\),
<code>gamma_start</code> must be either a scalar, a vector of length \(nt\), \(np\) or \(nt.np\) or a \(nt \times np\) matrix.
 If <code>gamma_start</code> takes a scalar value, then that value will serve for all of the \(\gamma\) parameters.
 If <code>gamma_start</code> is a vector of length \(nt\) or \(nt.np\) the resulting \(nt \times np\) matrix is filled by column with specified values,
  if a \(np\)-length vector is given, the matrix is filled by row. 
 Different starting values for each chain can be specified by a list or a vector of length <code>nchains</code>, by default the same starting values are considered for all chains.</p></dd>


<dt>lambda_start</dt>
<dd><p>Starting values for \(\lambda\) parameters corresponding to the latent variables for each species must be either a scalar
or a \(n_{latent} \times n_{species}\) upper triangular matrix with strictly positive values on the diagonal,
ignored if <code>n_latent=0</code>.
If <code>lambda_start</code> takes a scalar value, then that value will serve for all of the \(\lambda\) parameters except those concerned by the constraints explained above.
Different starting values for each chain can be specified by a list or a vector of length <code>nchains</code>, by default the same starting values are considered for all chains.</p></dd>


<dt>W_start</dt>
<dd><p>Starting values for latent variables must be either a scalar or a \(nsite \times n_latent\) matrix, ignored if <code>n_latent=0</code>.
If <code>W_start</code> takes a scalar value, then that value will serve for all of the \(W_{il}\) with \(i=1,\ldots,n_{site}\) and \(l=1,\ldots,n_{latent}\).
Different starting values for each chain can be specified by a list or a vector of length <code>nchains</code>, by default the same starting values are considered for all chains.</p></dd>


<dt>alpha_start</dt>
<dd><p>Starting values for random site effect parameters must be either a scalar or a \(n_{site}\)-length vector, ignored if <code>site_effect="none"</code>.
If <code>alpha_start</code> takes a scalar value, then that value will serve for all of the \(\alpha\) parameters.
Different starting values for each chain can be specified by a list or a vector of length <code>nchains</code>, by default the same starting values are considered for all chains.</p></dd>


<dt>V_alpha</dt>
<dd><p>Starting value for variance of random site effect if <code>site_effect="random"</code> or constant variance of the Gaussian prior distribution for the fixed site effect if 
<code>site_effect="fixed"</code>. Must be a strictly positive scalar, ignored if <code>site_effect="none"</code>.
 Different starting values for each chain can be specified by a list or a vector of length <code>nchains</code>, by default the same starting values are considered for all chains.</p></dd>


<dt>shape</dt>
<dd><p>Shape parameter of the Inverse-Gamma prior for the random site effect variance <code>V_alpha</code>, ignored if <code>site_effect="none"</code> or <code>site_effect="fixed"</code>. 
Must be a strictly positive scalar. Default to 0.5 for weak informative prior.</p></dd>


<dt>rate</dt>
<dd><p>Rate parameter of the Inverse-Gamma prior for the random site effect variance <code>V_alpha</code>, ignored if <code>site_effect="none"</code> or <code>site_effect="fixed"</code>
Must be a strictly positive scalar. Default to 0.0005 for weak informative prior.</p></dd>


<dt>mu_beta</dt>
<dd><p>Means of the Normal priors for the \(\beta\) parameters of the suitability process. <code>mu_beta</code> must be either a scalar or a \(np\)-length vector.
If <code>mu_beta</code> takes a scalar value, then that value will serve as the prior mean for all of the \(\beta\) parameters.
 The default value is set to 0 for an uninformative prior, ignored if <code>trait_data</code> is specified.</p></dd>


<dt>V_beta</dt>
<dd><p>Variances of the Normal priors for the \(\beta\) parameters of the suitability process.
 <code>V_beta</code> must be either a scalar or a \(np \times np\) symmetric positive semi-definite square matrix.
 If <code>V_beta</code> takes a scalar value, then that value will serve as the prior variance for all of the \(\beta\) parameters,
  so the variance covariance matrix used in this case is diagonal with the specified value on the diagonal. 
The default variance is large and set to 10 for an uninformative flat prior.</p></dd>


<dt>mu_gamma</dt>
<dd><p>Means of the Normal priors for the \(\gamma\) parameters.
<code>mu_gamma</code> must be either a scalar, a vector of length \(nt\), \(np\) or \(nt.np\) or a \(nt \times np\) matrix.
If <code>mu_gamma</code> takes a scalar value, then that value will serve as the prior mean for all of the \(\gamma\) parameters.
If <code>mu_gamma</code> is a vector of length \(nt\) or \(nt.np\) the resulting \(nt \times np\) matrix is filled by column with specified values,
 if a \(np\)-length vector is given, the matrix is filled by row. 
The default value is set to 0 for an uninformative prior, ignored if <code>trait_data=NULL</code>.</p></dd>


<dt>V_gamma</dt>
<dd><p>Variances of the Normal priors for the \(\gamma\) parameters.
<code>V_gamma</code> must be either a scalar, a vector of length \(nt\), \(np\) or \(nt.np\) or a \(nt \times np\) positive matrix.
If <code>V_gamma</code> takes a scalar value, then that value will serve as the prior variance for all of the \(\gamma\) parameters.
If <code>V_gamma</code> is a vector of length \(nt\) or \(nt.np\) the resulting \(nt \times np\) matrix is filled by column with specified values,
 if a \(np\)-length vector is given, the matrix is filled by row. 
The default variance is large and set to 10 for an uninformative flat prior, ignored if <code>trait_data=NULL</code>.</p></dd>


<dt>mu_lambda</dt>
<dd><p>Means of the Normal priors for the \(\lambda\) parameters corresponding to the latent variables. 
<code>mu_lambda</code> must be either a scalar or a \(n_{latent}\)-length vector. 
If <code>mu_lambda</code> takes a scalar value, then that value will serve as the prior mean for all of the \(\lambda\) parameters.
 The default value is set to 0 for an uninformative prior.</p></dd>


<dt>V_lambda</dt>
<dd><p>Variances of the Normal priors for the \(\lambda\) parameters corresponding to the latent variables.
 <code>V_lambda</code> must be either a scalar or a \(n_{latent} \times n_{latent}\) symmetric positive semi-definite square matrix.
If <code>V_lambda</code> takes a scalar value, then that value will serve as the prior variance for all of \(\lambda\) parameters,
 so the variance covariance matrix used in this case is diagonal with the specified value on the diagonal.
The default variance is large and set to 10 for an uninformative flat prior.</p></dd>


<dt>seed</dt>
<dd><p>The seed for the random number generator. Default to <code>c(123, 1234)</code> for two chains and for more chains different seeds are generated for each chain.</p></dd>


<dt>verbose</dt>
<dd><p>A switch (0,1) which determines whether or not the progress of the sampler is printed to the screen.
Default is 1: a progress bar is printed, indicating the step (in %) reached by the Gibbs sampler.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A list of length <code>nchains</code> where each element is an object of class <code>"jSDM"</code> acting like a list including :</p>
<dl><dt>mcmc.alpha</dt>
<dd><p>An mcmc object that contains the posterior samples for site effects \(\alpha\), not returned if <code>site_effect="none"</code>.</p></dd>

<dt>mcmc.V_alpha</dt>
<dd><p>An mcmc object that contains the posterior samples for variance of random site effect, not returned if <code>site_effect="none"</code> or <code>site_effect="fixed"</code>.</p></dd>

<dt>mcmc.latent</dt>
<dd><p>A list by latent variable of mcmc objects that contains the posterior samples for latent variables \(W_l\) with \(l=1,\ldots,n_{latent}\), not returned if <code>n_latent=0</code>.</p></dd>

<dt>mcmc.sp</dt>
<dd><p>A list by species of mcmc objects that contains the posterior samples for species effects \(\beta_j\) and \(\lambda_j\) if <code>n_latent&gt;0</code> with \(j=1,\ldots,n_{species}\).</p></dd>

<dt>mcmc.gamma</dt>
<dd><p>A list by covariates of mcmc objects that contains the posterior samples for \(\gamma_p\) parameters with \(p=1,\ldots,np\) if <code>trait_data</code> is specified.</p></dd>

<dt>mcmc.Deviance</dt>
<dd><p>The posterior sample of the deviance (\(D\)) is also provided, with \(D\) defined as : \(D=-2\log(\prod_{ij} P(y_{ij}|\beta_j,\lambda_j, \alpha_i, W_i))\).</p></dd>
 
<dt>Z_latent</dt>
<dd><p>Predictive posterior mean of the latent variable Z.</p></dd>

<dt>probit_theta_latent</dt>
<dd><p>Predictive posterior mean of the probability to each species to be present on each site, transformed by probit link function.</p></dd>

<dt>theta_latent</dt>
<dd><p>Predictive posterior mean of the probability to each species to be present on each site.</p></dd>

<dt>model_spec</dt>
<dd><p>Various attributes of the model fitted, including the response and model matrix used, distributional assumptions as link function, family and number of latent variables, hyperparameters used in the Bayesian estimation and mcmc, burnin and thin.</p></dd>

<dt>sp_constrained</dt>
<dd><p>Indicates the reference species (\(\hat{j}_l\)) considered that structures itself most clearly on each latent axis \(l\), chosen such as \(\lambda_{\hat{j}_l}\) maximize the \(\hat{R}\) computed on all chains. The \(lambda\) corresponding to this species are constrained to be positive by being placed on the diagonal of the \(\Lambda\) matrix.</p></dd>

</dl><p>The <code>mcmc.</code> objects can be summarized by functions provided by the <code>coda</code> package.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>We model an ecological process where the presence or absence of species \(j\) on site \(i\) is explained by habitat suitability.</p>
<p><b>Ecological process:</b>
$$y_{ij} \sim \mathcal{B}ernoulli(\theta_{ij})$$
where</p><table class="table table"><tr><td>if <code>n_latent=0</code> and <code>site_effect="none"</code></td><td>probit\((\theta_{ij}) =  X_i \beta_j\)</td></tr><tr><td>if <code>n_latent&gt;0</code> and <code>site_effect="none"</code></td><td>probit\((\theta_{ij}) =  X_i \beta_j + W_i \lambda_j\)</td></tr><tr><td>if <code>n_latent=0</code> and <code>site_effect="random"</code></td><td>probit\((\theta_{ij}) =  X_i \beta_j  + \alpha_i\)  and \(\alpha_i \sim \mathcal{N}(0,V_\alpha)\)</td></tr><tr><td>if <code>n_latent&gt;0</code> and <code>site_effect="fixed"</code></td><td>probit\((\theta_{ij}) =  X_i \beta_j + W_i \lambda_j + \alpha_i\)</td></tr><tr><td>if <code>n_latent=0</code> and <code>site_effect="fixed"</code></td><td>probit\((\theta_{ij}) =  X_i \beta_j  + \alpha_i\)</td></tr><tr><td>if <code>n_latent&gt;0</code> and <code>site_effect="random"</code></td><td>probit\((\theta_{ij}) =  X_i \beta_j + W_i \lambda_j + \alpha_i\) and \(\alpha_i \sim \mathcal{N}(0,V_\alpha)\)</td></tr></table><p>In the absence of data on species traits (<code>trait_data=NULL</code>), the effect of species \(j\): \(\beta_j\);
follows the same <em>a priori</em> Gaussian distribution such that \(\beta_j \sim \mathcal{N}_{np}(\mu_{\beta},V_{\beta})\),
for each species.</p>
<p>If species traits data are provided, the effect of species \(j\): \(\beta_j\);
follows an <em>a priori</em> Gaussian distribution such that \(\beta_j \sim \mathcal{N}_{np}(\mu_{\beta_j},V_{\beta})\),
where \(\mu_{\beta_jp} = \sum_{k=1}^{nt} t_{jk}.\gamma_{kp}\), takes different values for each species.</p>
<p>We assume that \(\gamma_{kp} \sim \mathcal{N}(\mu_{\gamma_{kp}},V_{\gamma_{kp}})\) as prior distribution.</p>
<p>We define the matrix \(\gamma=(\gamma_{kp})_{k=1,...,nt}^{p=1,...,np}\) such as :</p>
<table class="table table"><tr><td></td><td><strong>\(x_0\)</strong></td><td><strong>\(x_1\)</strong></td><td>...</td><td><strong>\(x_p\)</strong></td><td>...</td><td><strong>\(x_{np}\)</strong></td><td></td></tr><tr><td></td><td>__________</td><td>________</td><td>________</td><td>________</td><td>________</td><td>________</td><td></td></tr><tr><td><strong>\(t_0\)</strong> |</td><td><strong>\(\gamma_{0,0}\)</strong></td><td><em>\(\gamma_{0,1}\)</em></td><td>...</td><td><em>\(\gamma_{0,p}\)</em></td><td>...</td><td><em>\(\gamma_{0,np}\)</em></td><td>{ <em>effect of </em></td></tr><tr><td>|</td><td><strong>intercept</strong></td><td></td><td></td><td></td><td></td><td></td><td><em>environmental</em></td></tr><tr><td>|</td><td></td><td></td><td></td><td></td><td></td><td></td><td><em>   variables</em></td></tr><tr><td><strong>\(t_1\)</strong> |</td><td>\(\gamma_{1,0}\)</td><td><em>\(\gamma_{1,1}\)</em></td><td>...</td><td><em>\(\gamma_{1,p}\)</em></td><td>...</td><td><em>\(\gamma_{1,np}\)</em></td><td></td></tr><tr><td>... |</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td></td></tr><tr><td><strong>\(t_k\)</strong> |</td><td><em>\(\gamma_{k,0}\)</em></td><td><em>\(\gamma_{k,1}\)</em></td><td>...</td><td>\(\gamma_{k,p}\)</td><td>...</td><td>\(\gamma_{k,np}\)</td><td></td></tr><tr><td>... |</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td></td></tr><tr><td><strong>\(t_{nt}\)</strong> |</td><td><em>\(\gamma_{nt,0}\)</em></td><td>\(\gamma_{nt,1}\)</td><td>...</td><td>\(\gamma_{nt,p}\)</td><td>...</td><td>\(\gamma_{nt,np}\)</td><td></td></tr><tr><td></td><td><em>average</em></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td><em>trait effect</em></td><td></td><td>interaction</td><td>traits</td><td>environment</td><td></td><td></td></tr></table></div>
    <div id="references">
    <h2>References</h2>
    <p>Chib, S. and Greenberg, E. (1998) Analysis of multivariate probit models. <em>Biometrika</em>, 85, 347-361.</p>
<p>Warton, D. I.; Blanchet, F. G.; O'Hara, R. B.; O'Hara, R. B.; Ovaskainen, O.; Taskinen, S.; Walker, S. C. and Hui, F. K. C. (2015) So Many Variables: Joint Modeling in Community Ecology. <em>Trends in Ecology &amp; Evolution</em>, 30, 766-779.</p>
<p>Ovaskainen, O., Tikhonov, G., Norberg, A., Blanchet, F. G., Duan, L., Dunson, D., Roslin, T. and Abrego, N. (2017) How to make more out of community data? A conceptual framework and its implementation as models and software. <em>Ecology Letters</em>, 20, 561-576.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="https://rdrr.io/pkg/coda/man/plot.mcmc.html" class="external-link">plot.mcmc</a></code>, <code><a href="https://rdrr.io/pkg/coda/man/summary.mcmc.html" class="external-link">summary.mcmc</a></code> <code><a href="https://rdrr.io/pkg/coda/man/mcmc.list.html" class="external-link">mcmc.list</a></code> <br><code><a href="https://rdrr.io/pkg/coda/man/mcmc.html" class="external-link">mcmc</a></code>  <code><a href="https://rdrr.io/pkg/coda/man/gelman.diag.html" class="external-link">gelman.diag</a></code> <code><a href="jSDM_binomial_probit.html">jSDM_binomial_probit</a></code></p></div>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Ghislain Vieilledent &lt;ghislain.vieilledent@cirad.fr&gt;</p>
<p>Jeanne Clément &lt;jeanne.clement16@laposte.net&gt;</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">#======================================</span></span></span>
<span class="r-in"><span><span class="co"># jSDM_binomial_probit_sp_constrained()</span></span></span>
<span class="r-in"><span><span class="co"># Example with simulated data</span></span></span>
<span class="r-in"><span><span class="co">#====================================</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#=================</span></span></span>
<span class="r-in"><span><span class="co">#== Load libraries</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ecology.ghislainv.fr/jSDM/" class="external-link">jSDM</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#==================</span></span></span>
<span class="r-in"><span><span class="co">#== Data simulation</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#= Number of sites</span></span></span>
<span class="r-in"><span><span class="va">nsite</span> <span class="op">&lt;-</span> <span class="fl">50</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#= Set seed for repeatability</span></span></span>
<span class="r-in"><span><span class="va">seed</span> <span class="op">&lt;-</span> <span class="fl">1234</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="va">seed</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#= Number of species</span></span></span>
<span class="r-in"><span><span class="va">nsp</span> <span class="op">&lt;-</span> <span class="fl">10</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#= Number of latent variables</span></span></span>
<span class="r-in"><span><span class="va">n_latent</span> <span class="op">&lt;-</span> <span class="fl">2</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#= Ecological process (suitability)</span></span></span>
<span class="r-in"><span><span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">nsite</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">nsite</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">nsite</span><span class="op">)</span>,<span class="va">x1</span>,<span class="va">x2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">np</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#= Latent variables W</span></span></span>
<span class="r-in"><span><span class="va">W</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">nsite</span><span class="op">*</span><span class="va">n_latent</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, <span class="va">nsite</span>, <span class="va">n_latent</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#= Fixed species effect beta </span></span></span>
<span class="r-in"><span><span class="va">beta.target</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">nsp</span><span class="op">*</span><span class="va">np</span>,<span class="op">-</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                        byrow<span class="op">=</span><span class="cn">TRUE</span>, nrow<span class="op">=</span><span class="va">nsp</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#= Factor loading lambda  </span></span></span>
<span class="r-in"><span><span class="va">lambda.target</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_latent</span>, <span class="va">nsp</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">nsp</span><span class="op">*</span><span class="va">n_latent</span>, <span class="op">-</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, byrow<span class="op">=</span><span class="cn">TRUE</span>, nrow<span class="op">=</span><span class="va">nsp</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">lambda.target</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lower.tri.html" class="external-link">upper.tri</a></span><span class="op">(</span><span class="va">mat</span>, diag<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lower.tri.html" class="external-link">upper.tri</a></span><span class="op">(</span><span class="va">mat</span>, diag<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">lambda.target</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n_latent</span>, <span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#= Variance of random site effect </span></span></span>
<span class="r-in"><span><span class="va">V_alpha.target</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span></span>
<span class="r-in"><span><span class="co">#= Random site effect alpha</span></span></span>
<span class="r-in"><span><span class="va">alpha.target</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">nsite</span>,<span class="fl">0</span> , <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">V_alpha.target</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Simulation of response data with probit link</span></span></span>
<span class="r-in"><span><span class="va">probit_theta</span> <span class="op">&lt;-</span> <span class="va">X</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="va">beta.target</span> <span class="op">+</span> <span class="va">W</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="va">lambda.target</span> <span class="op">+</span> <span class="va">alpha.target</span></span></span>
<span class="r-in"><span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="va">probit_theta</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">e</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">nsp</span><span class="op">*</span><span class="va">nsite</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,<span class="va">nsite</span>,<span class="va">nsp</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Latent variable Z </span></span></span>
<span class="r-in"><span><span class="va">Z_true</span> <span class="op">&lt;-</span> <span class="va">probit_theta</span> <span class="op">+</span> <span class="va">e</span></span></span>
<span class="r-in"><span><span class="co"># Presence-absence matrix Y</span></span></span>
<span class="r-in"><span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span> <span class="op">(</span><span class="cn">NA</span>, <span class="va">nsite</span>,<span class="va">nsp</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nsite</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nsp</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span> <span class="op">(</span> <span class="va">Z_true</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span><span class="va">Y</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">}</span></span></span>
<span class="r-in"><span>    <span class="kw">else</span> <span class="op">{</span><span class="va">Y</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span><span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#==================================</span></span></span>
<span class="r-in"><span><span class="co">#== Site-occupancy model</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Increase number of iterations (burnin and mcmc) to get convergence</span></span></span>
<span class="r-in"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">jSDM_binomial_probit_sp_constrained</span><span class="op">(</span><span class="co"># Iteration</span></span></span>
<span class="r-in"><span>                                           burnin<span class="op">=</span><span class="fl">100</span>,</span></span>
<span class="r-in"><span>                                           mcmc<span class="op">=</span><span class="fl">200</span>,</span></span>
<span class="r-in"><span>                                           thin<span class="op">=</span><span class="fl">1</span>,</span></span>
<span class="r-in"><span>                                           <span class="co"># parallel MCMCs</span></span></span>
<span class="r-in"><span>                                           nchains<span class="op">=</span><span class="fl">2</span>, ncores<span class="op">=</span><span class="fl">2</span>,</span></span>
<span class="r-in"><span>                                           <span class="co"># Response variable</span></span></span>
<span class="r-in"><span>                                           presence_data<span class="op">=</span><span class="va">Y</span>,</span></span>
<span class="r-in"><span>                                           <span class="co"># Explanatory variables</span></span></span>
<span class="r-in"><span>                                           site_formula<span class="op">=</span><span class="op">~</span><span class="va">x1</span><span class="op">+</span><span class="va">x2</span>,</span></span>
<span class="r-in"><span>                                           site_data <span class="op">=</span> <span class="va">X</span>,</span></span>
<span class="r-in"><span>                                           n_latent<span class="op">=</span><span class="fl">2</span>,</span></span>
<span class="r-in"><span>                                           site_effect<span class="op">=</span><span class="st">"random"</span>,</span></span>
<span class="r-in"><span>                                           <span class="co"># Starting values</span></span></span>
<span class="r-in"><span>                                           alpha_start<span class="op">=</span><span class="fl">0</span>,</span></span>
<span class="r-in"><span>                                           beta_start<span class="op">=</span><span class="fl">0</span>,</span></span>
<span class="r-in"><span>                                           lambda_start<span class="op">=</span><span class="fl">0</span>,</span></span>
<span class="r-in"><span>                                           W_start<span class="op">=</span><span class="fl">0</span>,</span></span>
<span class="r-in"><span>                                           V_alpha<span class="op">=</span><span class="fl">1</span>,</span></span>
<span class="r-in"><span>                                           <span class="co"># Priors</span></span></span>
<span class="r-in"><span>                                           shape<span class="op">=</span><span class="fl">0.5</span>, rate<span class="op">=</span><span class="fl">0.0005</span>,</span></span>
<span class="r-in"><span>                                           mu_beta<span class="op">=</span><span class="fl">0</span>, V_beta<span class="op">=</span><span class="fl">1</span>,</span></span>
<span class="r-in"><span>                                           mu_lambda<span class="op">=</span><span class="fl">0</span>, V_lambda<span class="op">=</span><span class="fl">1</span>,</span></span>
<span class="r-in"><span>                                           seed<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">123</span>,<span class="fl">1234</span><span class="op">)</span>, verbose<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># ===================================================</span></span></span>
<span class="r-in"><span><span class="co"># Result analysis</span></span></span>
<span class="r-in"><span><span class="co"># ===================================================</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#==========</span></span></span>
<span class="r-in"><span><span class="co">#== Outputs</span></span></span>
<span class="r-in"><span><span class="va">burnin</span> <span class="op">&lt;-</span> <span class="va">mod</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">model_spec</span><span class="op">$</span><span class="va">burnin</span></span></span>
<span class="r-in"><span><span class="va">ngibbs</span> <span class="op">&lt;-</span> <span class="va">burnin</span> <span class="op">+</span> <span class="va">mod</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">model_spec</span><span class="op">$</span><span class="va">mcmc</span></span></span>
<span class="r-in"><span><span class="va">thin</span> <span class="op">&lt;-</span>  <span class="va">mod</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">model_spec</span><span class="op">$</span><span class="va">thin</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va">coda</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: coda</span>
<span class="r-in"><span><span class="va">arr2mcmc</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html" class="external-link">mcmc</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>              start<span class="op">=</span><span class="va">burnin</span><span class="op">+</span><span class="fl">1</span> , end<span class="op">=</span><span class="va">ngibbs</span>, thin<span class="op">=</span><span class="va">thin</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">mcmc_list_Deviance</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.list.html" class="external-link">mcmc.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">mod</span>,<span class="st">"[["</span>,<span class="st">"mcmc.Deviance"</span><span class="op">)</span>, <span class="va">arr2mcmc</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mcmc_list_alpha</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.list.html" class="external-link">mcmc.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">mod</span>,<span class="st">"[["</span>,<span class="st">"mcmc.alpha"</span><span class="op">)</span>, <span class="va">arr2mcmc</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mcmc_list_V_alpha</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.list.html" class="external-link">mcmc.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">mod</span>,<span class="st">"[["</span>,<span class="st">"mcmc.V_alpha"</span><span class="op">)</span>, <span class="va">arr2mcmc</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mcmc_list_param</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.list.html" class="external-link">mcmc.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">mod</span>,<span class="st">"[["</span>,<span class="st">"mcmc.sp"</span><span class="op">)</span>, <span class="va">arr2mcmc</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mcmc_list_lv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.list.html" class="external-link">mcmc.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">mod</span>,<span class="st">"[["</span>,<span class="st">"mcmc.latent"</span><span class="op">)</span>, <span class="va">arr2mcmc</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mcmc_list_beta</span> <span class="op">&lt;-</span> <span class="va">mcmc_list_param</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"beta"</span>,<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mcmc_list_param</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">mcmc_list_beta0</span> <span class="op">&lt;-</span> <span class="va">mcmc_list_beta</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"Intercept"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mcmc_list_beta</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">mcmc_list_lambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.list.html" class="external-link">mcmc.list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">mcmc_list_param</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"lambda"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mcmc_list_param</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>         <span class="va">arr2mcmc</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Compute Rhat</span></span></span>
<span class="r-in"><span><span class="va">psrf_alpha</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/gelman.diag.html" class="external-link">gelman.diag</a></span><span class="op">(</span><span class="va">mcmc_list_alpha</span>, multivariate<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">psrf</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">psrf_V_alpha</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/coda/man/gelman.diag.html" class="external-link">gelman.diag</a></span><span class="op">(</span><span class="va">mcmc_list_V_alpha</span><span class="op">)</span><span class="op">$</span><span class="va">psrf</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">psrf_beta0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/gelman.diag.html" class="external-link">gelman.diag</a></span><span class="op">(</span><span class="va">mcmc_list_beta0</span><span class="op">)</span><span class="op">$</span><span class="va">psrf</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">psrf_beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/gelman.diag.html" class="external-link">gelman.diag</a></span><span class="op">(</span><span class="va">mcmc_list_beta</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"Intercept"</span>,</span></span>
<span class="r-in"><span>                                                   <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mcmc_list_beta</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                                   invert<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">psrf</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">psrf_lambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/gelman.diag.html" class="external-link">gelman.diag</a></span><span class="op">(</span><span class="va">mcmc_list_lambda</span>,</span></span>
<span class="r-in"><span>                                multivariate<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">psrf</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>                    na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">psrf_lv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/gelman.diag.html" class="external-link">gelman.diag</a></span><span class="op">(</span><span class="va">mcmc_list_lv</span>, multivariate<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">psrf</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">Rhat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Rhat<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">psrf_alpha</span>, <span class="va">psrf_V_alpha</span>, <span class="va">psrf_beta0</span>, <span class="va">psrf_beta</span>,</span></span>
<span class="r-in"><span>                          <span class="va">psrf_lambda</span>, <span class="va">psrf_lv</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                   Variable<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"alpha"</span>, <span class="st">"Valpha"</span>, <span class="st">"beta0"</span>, <span class="st">"beta"</span>,</span></span>
<span class="r-in"><span>                              <span class="st">"lambda"</span>, <span class="st">"W"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Barplot</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">Rhat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Variable</span>, y<span class="op">=</span><span class="va">Rhat</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Averages of Rhat obtained with jSDM for each type of parameter"</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span>, size<span class="op">=</span><span class="fl">15</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"skyblue"</span>, stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">Rhat</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>, vjust<span class="op">=</span><span class="fl">0</span>, hjust<span class="op">=</span><span class="op">-</span><span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept<span class="op">=</span><span class="fl">1</span>, color<span class="op">=</span><span class="st">'red'</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="jSDM_binomial_probit_sp_constrained-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#= Parameter estimates</span></span></span>
<span class="r-in"><span><span class="va">nchains</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## beta_j</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html" class="external-link">pdf</a></span><span class="op">(</span>file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"Posteriors_species_effect_jSDM_probit.pdf"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mcmc_list_param</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> agg_png </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       2 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Latent variables </span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html" class="external-link">pdf</a></span><span class="op">(</span>file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"Posteriors_latent_variables_jSDM_probit.pdf"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mcmc_list_lv</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> agg_png </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       2 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Random site effect and its variance</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html" class="external-link">pdf</a></span><span class="op">(</span>file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"Posteriors_site_effect_jSDM_probit.pdf"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mcmc_list_V_alpha</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mcmc_list_alpha</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> agg_png </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       2 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Predictive posterior mean for each observation</span></span></span>
<span class="r-in"><span><span class="co"># Species effects beta and factor loadings lambda</span></span></span>
<span class="r-in"><span><span class="va">param</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nchains</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span><span class="va">param</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">mod</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">mcmc.sp</span>,<span class="va">colMeans</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                     nrow<span class="op">=</span><span class="va">nsp</span>, byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nchains</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span><span class="op">(</span><span class="va">i</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">beta.target</span><span class="op">)</span>, <span class="va">param</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="va">np</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>         main<span class="op">=</span><span class="st">"species effect beta"</span>,</span></span>
<span class="r-in"><span>         xlab <span class="op">=</span><span class="st">"obs"</span>, ylab <span class="op">=</span><span class="st">"fitted"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>,b<span class="op">=</span><span class="fl">1</span>, col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="kw">else</span><span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">beta.target</span><span class="op">)</span>, <span class="va">param</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="va">np</span><span class="op">]</span>, col<span class="op">=</span><span class="va">i</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-plt img"><img src="jSDM_binomial_probit_sp_constrained-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">for</span><span class="op">(</span><span class="va">l</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_latent</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nchains</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span> <span class="op">(</span><span class="va">i</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">lambda.target</span><span class="op">)</span><span class="op">[</span>,<span class="va">l</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>           <span class="va">param</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">np</span><span class="op">+</span><span class="va">l</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>           main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"factor loadings lambda_"</span>, <span class="va">l</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           xlab <span class="op">=</span><span class="st">"obs"</span>, ylab <span class="op">=</span><span class="st">"fitted"</span><span class="op">)</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>,b<span class="op">=</span><span class="fl">1</span>, col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">lambda.target</span><span class="op">)</span><span class="op">[</span>,<span class="va">l</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>             <span class="va">param</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">np</span><span class="op">+</span><span class="va">l</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>             col<span class="op">=</span><span class="va">i</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-plt img"><img src="jSDM_binomial_probit_sp_constrained-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co">## W latent variables</span></span></span>
<span class="r-in"><span><span class="va">mean_W</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nchains</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">mean_W</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">mod</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">mcmc.latent</span>,<span class="va">colMeans</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">for</span> <span class="op">(</span><span class="va">l</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_latent</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nchains</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span> <span class="op">(</span><span class="va">i</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">W</span><span class="op">[</span>,<span class="va">l</span><span class="op">]</span>, <span class="va">mean_W</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">l</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>           main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Latent variable W_"</span>, <span class="va">l</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           xlab <span class="op">=</span><span class="st">"obs"</span>, ylab <span class="op">=</span><span class="st">"fitted"</span><span class="op">)</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>,b<span class="op">=</span><span class="fl">1</span>, col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>    <span class="kw">else</span><span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">W</span><span class="op">[</span>,<span class="va">l</span><span class="op">]</span>, <span class="va">mean_W</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">l</span><span class="op">]</span>, col<span class="op">=</span><span class="va">i</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-plt img"><img src="jSDM_binomial_probit_sp_constrained-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#= W.lambda</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nchains</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="va">i</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">W</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="va">lambda.target</span>, </span></span>
<span class="r-in"><span>         <span class="va">mean_W</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">param</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="op">(</span><span class="va">np</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="op">(</span><span class="va">np</span><span class="op">+</span><span class="va">n_latent</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>         main <span class="op">=</span> <span class="st">"W.lambda"</span>,</span></span>
<span class="r-in"><span>         xlab <span class="op">=</span><span class="st">"obs"</span>, ylab <span class="op">=</span><span class="st">"fitted"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>,b<span class="op">=</span><span class="fl">1</span>, col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="kw">else</span><span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">W</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="va">lambda.target</span>, </span></span>
<span class="r-in"><span>           <span class="va">mean_W</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">param</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="op">(</span><span class="va">np</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="op">(</span><span class="va">np</span><span class="op">+</span><span class="va">n_latent</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           col<span class="op">=</span><span class="va">i</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Site effect alpha et V_alpha</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">alpha.target</span>,<span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">mod</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">mcmc.alpha</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>     xlab<span class="op">=</span><span class="st">"obs"</span>, ylab<span class="op">=</span><span class="st">"fitted"</span>,</span></span>
<span class="r-in"><span>     main<span class="op">=</span><span class="st">"Random site effect alpha"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>,b<span class="op">=</span><span class="fl">1</span>, col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">V_alpha.target</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mod</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">mcmc.V_alpha</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>       pch<span class="op">=</span><span class="fl">18</span>, cex<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"bottomright"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"V_alpha"</span><span class="op">)</span>, pch <span class="op">=</span><span class="fl">18</span>, pt.cex<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">nchains</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">alpha.target</span>, <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">mod</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">mcmc.alpha</span><span class="op">)</span>, col<span class="op">=</span><span class="va">i</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">V_alpha.target</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mod</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">mcmc.V_alpha</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>         pch<span class="op">=</span><span class="fl">18</span>, col<span class="op">=</span><span class="va">i</span>, cex<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-plt img"><img src="jSDM_binomial_probit_sp_constrained-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#= Predictions </span></span></span>
<span class="r-in"><span><span class="co">## probabilities theta</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="va">probit_theta</span><span class="op">)</span>, <span class="va">mod</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">theta_latent</span>,</span></span>
<span class="r-in"><span>     main<span class="op">=</span><span class="st">"theta"</span>,xlab<span class="op">=</span><span class="st">"obs"</span>,ylab<span class="op">=</span><span class="st">"fitted"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">nchains</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="va">probit_theta</span><span class="op">)</span>, <span class="va">mod</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">theta_latent</span>, col<span class="op">=</span><span class="va">i</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>,b<span class="op">=</span><span class="fl">1</span>, col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## probit(theta)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">probit_theta</span>, <span class="va">mod</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">probit_theta_latent</span>,</span></span>
<span class="r-in"><span>     main<span class="op">=</span><span class="st">"probit(theta)"</span>,xlab<span class="op">=</span><span class="st">"obs"</span>,ylab<span class="op">=</span><span class="st">"fitted"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">nchains</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">probit_theta</span>, <span class="va">mod</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">probit_theta_latent</span>, col<span class="op">=</span><span class="va">i</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>,b<span class="op">=</span><span class="fl">1</span>, col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="jSDM_binomial_probit_sp_constrained-6.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co">## Deviance</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mcmc_list_Deviance</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="jSDM_binomial_probit_sp_constrained-7.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by <a href="https://jeanneclement.github.io/" class="external-link">Jeanne Clément</a>, <a href="https://ecology.ghislainv.fr" class="external-link">Ghislain Vieilledent</a>, <a href="https://www.cirad.fr" class="external-link"><img src="https://ecology.ghislainv.fr/images/logos/logo-cirad.svg" height="24"></a>.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

